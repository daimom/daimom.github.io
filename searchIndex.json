[
{
		"title": "Steam deckå®‰è£ç­†è¨˜",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/191. Steam deckå®‰è£é™¤éŒ¯è¨˜/",
		"content": "å‰è¨€\nå¥½ä¹…æ²’è²·è–èª•ç¦®ç‰©äº†ï¼Œ\nå‰é™£å­åˆæœ‰äººèªªsteam deck oledå¾ˆæ¨ï¼Œ\nçœ‹äº†å¹¾æ¬¡éƒ½æ²’ç¾è²¨ï¼Œ\nä¸Šé€±äº”ï¼Œå‰›å¥½å–µåˆ°pchomeæœ‰è²¨ï¼Œä¸‹è¨‚éš”å¤©åˆ°ã€‚\nç¦®æ‹œå…­åƒå–œé…’ï¼Œåˆé€›äº†ä¸€ä¸‹lalaportï¼Œ\nç¦®æ‹œå¤©ä¸­åˆè·Ÿæœ‹å‹åƒé£¯ï¼Œæ‰é–‹å§‹å‹•å·¥ï¼Œ\nç„¶å¾Œå°±æ˜¯ä¸€æ•´å€‹è¸©å‘è¨˜ã€‚\nç¦®æ‹œå¤©é–‹å§‹å®‰è£ï¼Œç¬¬ä¸€æ¬¡æsteamä¸€å †å•é¡Œã€‚\næ­£æ–‡\nå®‰è£æ™‚ï¼Œä¸€ç›´å¡åœ¨å®‰è£å‰©é¤˜1ç§’\næˆ‘è©¦äº†å¹¾ç¨®æ–¹æ³•ï¼Œ\n\né‡é–‹æ©Ÿï¼ˆæ²’ç”¨ï¼‰ï¼Œé‡é–‹äº†äº”å…­æ¬¡ï¼Œé‚„æ˜¯å¡ä½\n\nçœ‹reditèªª ä¸è¦é€£2.4gçš„wifiï¼Œé‡é–‹æ©Ÿå®‰è£ï¼Œä¸€æ¨£å¡\n\nä¸æ–·é—œé–‰wifiå¾Œï¼Œé‡é€£æˆ‘ä¹Ÿè©¦éï¼Œæ²’ç”¨(è¨­å®šé–‹é—œåœ¨å³ä¸‹æ–¹çš„é‚£ä¸‰å€‹é»ï¼‰ã€‚\n\næœ€å¾Œæ”¹é€£æ‰‹æ©Ÿçš„ç†±é»åˆ†äº«ï¼Œçµ‚æ–¼éäº†\n\nå¤–æ›æ¨è–¦(ä¸è£ä¹Ÿå¯ä»¥ï¼‰\nç›®å‰çœ‹åˆ°çš„éƒ½æ˜¯ä¸€äº›æ¯”è¼ƒå€‹äººåŒ–çš„æ±è¥¿ï¼Œ\nä¹Ÿå¯èƒ½æˆ‘éŠæˆ²ç©ä¸å¤šï¼Œ\nä¹‹å‰ä¸»è¦éƒ½åœ¨ç©p4\nç¬¬ä¸€æ­¥å…ˆå®‰è£Â Decky loaderï¼Œå¯ä»¥åƒè€ƒ ç‰ˆä¸Šçš„Â é€™ç¯‡\nï¼ˆæ¡Œé¢æ¨¡å¼ï¼ŒæŒ‰å·¦ä¸‹çš„steamæŒ‰éˆ•-&gt;é›»æº-&gt;åˆ‡æ›è‡³æ¡Œé¢ï¼‰\nï¼ˆæ²’å¤–æ¥éµç›¤çš„è©±ï¼Œéœ€æŒ‰ä¸‹ steamæŒ‰éˆ•+X ï¼Œé–‹å•“è¢å¹•å°éµç›¤)\nå‰é¢çš„è¨­å®šå…ˆæ”¹å¥½ï¼Œå¾Œé¢å®‰è£ä¸éœ€è¦è¼¸å…¥æŒ‡ä»¤ï¼Œåœ¨ç¶²ç«™ä¸Šé»æ“Šå³å¯ä¸‹è¼‰ï¼Œ\nç„¶å¾Œå°ç€ä¸‹è¼‰ä¸‹ä¾†çš„æª”æ¡ˆï¼Œé»å…©ä¸‹å®‰è£ï¼Œ\næœ€å¾Œå¾æ¡Œé¢ä¸Šçš„ åœ–ç¤ºï¼Œå›åˆ°æŒæ©Ÿç•«é¢ã€‚\nç›®å‰æˆ‘è£çš„æœ‰\n\nBluetooth ï¼š æ“šèªªæ˜¯èƒ½è®“è—ç‰™è€³æ©Ÿè‡ªå‹•é€£ç·š\n\nAnimation Changerï¼šé—œæ©Ÿ(é•·æŒ‰é›»æºï¼‰ã€æš«åœï¼ˆçŸ­æŒ‰é›»æºï¼‰çš„ç•«é¢ä¿®æ”¹\n\nProtonDB Badgesï¼šåˆ¤æ–·éŠæˆ²åœ¨è£ç½®ä¸Šçš„å¯ç©æ€§\n\nSteamGridDBï¼šä¿®æ”¹æŒæ©Ÿæ¨¡å¼ä¸‹éŠæˆ²çš„åœ–ç‰‡ï¼Œè£é€™å€‹æ˜¯æŒæ©Ÿæ¨¡å¼ä¸‹çš„Chromeæ²’åœ–æ¡ˆçœŸçš„å¤ªé†œäº†ã€‚\n\nCSS-Loaderï¼šæ¡Œé¢ä½ˆæ™¯ï¼Œå¯ä»¥åˆ°å®˜ç¶²çœ‹æœ‰å“ªäº›\n\nAnimation Changer ï¼Œå½±ç‰‡æ”¾å¤§\nå®‰è£CSS-Loaderï¼Œç„¶å¾Œæœå°‹Â Â Full Suspend ï¼Œå®‰è£å®Œå¾Œå³å¯ã€‚\nè£œä¸å®‰è£\nå‰é¢æ­¥é©Ÿï¼Œè«‹çœ‹é€™ä¸€ç¯‡steam deckå¤æ—¥ç‹‚æƒ³æ›²ä¸­æ–‡18+è£œä¸ï¼Œå¦‚æœä½ bottleç„¡æ³•å»ºç«‹çš„è©±å†å›ä¾†ã€‚\nåŒäº‹ä¸€ç›´æ¨å‘æˆ‘å¤æ—¥ç‹‚æƒ³æ›²ï¼Œç„¶å¾Œbottleçš„bottlesç„¡æ³•å»ºç«‹ï¼Œä¸€ç›´å¡åœ¨Arial fontçš„å­—é«”å®‰è£å¤±æ•—ï¼Œ\næŸ¥åŸæ–‡æœ‰äººæ¨è–¦ç”¨Q4wineï¼Œå°±è©¦è©¦çœ‹äº†ã€‚\nä½†åœ¨flatseléœ€å°‡Q4wineåº•ä¸‹çš„Filesystemä¸­çš„All system filesæ‰“é–‹ï¼Œ\nå®‰è£æ™‚æ‰èƒ½å¤ è®€å–åˆ°steam deckå¤æ—¥ç‹‚æƒ³æ›²ä¸­æ–‡18+è£œä¸Â é€™é‚Šèªªçš„\nZ:\\home\\deck\\Summer Memories\n\né¡å¤–è£œå……\n\nprotonDBÂ ï¼šæŸ¥éŠæˆ²ç›¸å®¹æ€§çš„ç¶²ç«™ï¼Œä¸åŒçç‰Œä»£è¡¨çš„æ„æ€\n\nç™½é‡‘ï¼šå®Œç¾åŸ·è¡Œã€‚\né‡‘ï¼šèª¿æ•´å¾Œå®Œç¾åŸ·è¡Œã€‚\néŠ€ï¼šæœ‰å°å•é¡Œï¼Œä½†å¯ç©ã€‚\néŠ…ï¼šå¯ç©ï¼Œä½†ç¶“å¸¸é‡åˆ°éŠæˆ²å´©æ½°ç­‰å•é¡Œã€‚\nç„¡æ³•åŸ·è¡Œï¼šå¦‚é¡Œã€‚\nOledç‡ˆè™Ÿé–ƒçˆæ„æ€\n\nç‹€æ…‹\nèªªæ˜\n\nä¸‰é–ƒç´…ç‡ˆ\né›»æ± é›»åŠ›ä¸è¶³ç„¡æ³•é–‹æ©Ÿ\n\nå•Ÿå‹•ä¸­(ç¶ ç‡ˆ)\nä¸»æ©Ÿåœ¨PSUé€£æ¥ç‹€æ…‹ä¸”é›»æ± å·²ç¶“å……æ»¿\n\nå•Ÿå‹•ä¸­(ç™½ç‡ˆ)\nä¸»æ©Ÿåœ¨PSUé€£æ¥ç‹€æ…‹ä¸”å……é›»åŠŸç‡èˆ‡PDå”å®šæœ‰æˆåŠŸè¾¨è­˜ä¸¦åœ¨é›»é‡é”åˆ°è§¸ç™¼é–¾å€¼å¾Œé€²å…¥æ—è·¯å……é›»\n\nå•Ÿå‹•ä¸­(æ©˜ç‡ˆ)\nä¸»æ©Ÿåœ¨PSUé€£æ¥ç‹€æ…‹ä¸”å……é›»åŠŸç‡ä¸è¶³æˆ–PDå”å®šç„¡æ³•è¾¨è­˜,ç°¡å–®èªªå°±æ˜¯ä»¥ä½åŠŸç‡å……é›»\n\nå•Ÿå‹•ä¸­(ç´…ç‡ˆ)\nåµæ¸¬åˆ°ä¸»æ©Ÿæº«åº¦é«˜æ–¼95åº¦C,ç„¡æ³•é–‹æ©Ÿ\n\nå‘¼å¸ç™½ç‡ˆ\nä¸»æ©Ÿé–‹æ©Ÿä¸­\n\nå‘¼å¸è—ç‡ˆ\nä¸»æ©Ÿæ›´æ–°éŸŒé«”æˆ–ç³»çµ±ä¸­\n\nç„¡äº®ç‡ˆ\nä¸»æ©Ÿé—œæ©Ÿ,ä¸”æ²’æœ‰åµæ¸¬åˆ°PSUé€£æ¥\n\nsteamdbï¼šæŸ¥éŠæˆ²ç‰¹åƒ¹æ­·å²åƒ¹æ ¼\né‡ç½®sudo å¯†ç¢¼\nå¦‚æœä½ å¿˜è¨˜å¯†ç¢¼ï¼ˆå› çˆ²æˆ‘å°±å¿˜äº†ï¼‰ï¼Œ\nåªå‰©ä¸‹é‡åˆ·é€™ä¸€æ¢è·¯äº†ã€‚\nå°‡steam decké—œæ©Ÿï¼ŒæŒ‰ä½å³ä¸‹æ–¹çš„ã€...ã€èˆ‡é–‹æ©ŸæŒ‰éˆ•é–‹æ©Ÿï¼Œ\nç„¶å¾Œæ¸…é™¤è³‡æ–™å§ã€‚\nçµ„åˆéµ\né•·æŒ‰SteamæŒ‰éˆ•ï¼Œæœ‰å¿«é€Ÿéµåˆ—è¡¨\nsteam + R1 ï¼š æˆªåœ–\nsteam +X ï¼š é–‹å•“è¢å¹•éµç›¤\nã€ ... ã€+é¡æ¯”ä¸Šä¸‹ï¼šèª¿æ•´è¢å¹•äº®åº¦\nã€ ... ã€+é›»æºï¼šÂ Recovery Manager\néŸ³é‡ã€ - ã€+é›»æº ï¼šBoot Manager\néŸ³é‡ã€ + ã€+é›»æºÂ Â ï¼šBiOS\né…ä»¶\næœªä¾†æ‡‰è©²å†ä¾†ä¸‹é¢å¹¾å€‹æ±è¥¿ï¼Œå†è§€å¯Ÿçœ‹çœ‹éœ€ä¸éœ€è¦äº†ã€‚\n\ntomtoc Steam Deckç¡¬æ®¼æ”¶ç´åŒ… ï¼šçœ‹èµ·ä¾†è·Ÿsteam deckå¾ˆåˆ\nInnergie C6 Duo 63ç“¦ USB-C é›™å­”ï¼šè‡ºé”çš„å……é›»å™¨ï¼Œç¾åœ¨æœ‰ä¸€å€‹å–®å­”çš„ï¼Œä½†æœ‰æ™‚è¦æ‹”ä¾†æ‹”å»ä¸æ–¹ä¾¿ã€‚\ntype c hubï¼šæ„Ÿè¦ºé‚„æ˜¯é —éœ€è¦ï¼Œå¦‚æœè¦ç”¨æ¡Œé¢æ¨¡å¼æ¥éµç›¤ã€æ»‘é¼ æˆ–å¤–æ¥è¢å¹•çš„è©±ï¼Œé€™å€‹è¦å†æ‰¾æ‰¾çœ‹äº†ã€‚\n\nç›®å‰æ‡‰è©²å°±é€™æ¨£ï¼Œ\nå‰©ä¸‹çš„ç­‰æœ‰ç¢°åˆ°å†ç ”ç©¶ã€‚\nref.\n\nSteam Deck å¤§æ¨“ï¼\nSuspend animations are extremely small using Deck Loader\n[é–’èŠ] SteamDeckå…©å‘¨å¿ƒå¾—(é…ä»¶ã€èª¿æ ¡ã€å¥—ä»¶)",
		"tags": [ "note","ğŸ®"]
},

{
		"title": "Obsidianç™¼ä½ˆåˆ°github.ioå€‹äººç¶²ç«™",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/193. Obsidianç™¼ä½ˆåˆ°github.ioå€‹äººç¶²ç«™/",
		"content": "å‰è¨€\nå‰é™£å­å¼„å¥½äº†Obsidianè‡ªå‹•ç™¼ä½ˆåˆ°vercelï¼Œ\næˆæœä¹Ÿé‚„ä¸éŒ¯ï¼Œä½†å°±æ˜¯å¶çˆ¾æœ‰é»å•é¡Œï¼Œ\nå› ç‚ºæ˜¯å…è²»ç”¨æˆ¶ï¼Œæ‰€ä»¥æœƒç¢°åˆ°ç„¡æ³•æ›´æ–°ã€‚\næœ‰å¤©ä¸€æ€’ä¹‹ä¸‹ï¼Œå°±è‡ªå·±æ”¹æˆç”¨githubäº†ã€‚\næ­£æ–‡\né¦–å…ˆå‰é¢é‚„æ˜¯ä¸€æ¨£<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ†’ SideProject/160.Obsidianç™¼ä½ˆç¶²ç«™/\">160.Obsidianç™¼ä½ˆç¶²ç«™</a>ï¼Œ\næ­¥é©Ÿè¦å…ˆè¨­å®šå¥½å¾Obsidiantå‚³åˆ°ä½ çš„githubã€‚\n\nç•¶ä½ åœ¨Obsidiané¸æ“‡publishæ™‚ï¼Œæœƒå°‡å…§å®¹å‚³åˆ°public_vercel é€™å€‹repositoryã€‚\n\næ‰€ä»¥ï¼Œæ¥ä¸‹ä¾†çš„æµç¨‹æ˜¯ï¼Œåœ¨public_vercel ä½¿ç”¨github actionï¼Œ\nå°‡obsidiançš„å…§å®¹ç·¨è­¯æˆhtmlï¼Œå†è½‰åˆ°githubçš„ç¶²ç«™ä¸Šé¢ã€‚\n\nåˆ°githubå»ºç«‹å€‹äººç¶²é \nåˆ°githubï¼Œå»ºç«‹ä¸€å€‹è‡ªå·±ä½¿ç”¨è€…çš„å­ç¶²åŸŸï¼Œ\nrepositoryçš„åç¨±æœƒæ˜¯ user.github.io é€™ç¨®åç¨±ï¼Œ\nåªæœ‰useré€™å€‹å­—å¯ä»¥æ”¹ã€‚\nå»ºç«‹å®Œå¾Œï¼Œå¯ä»¥å…ˆå¼„å€‹index.htmlåˆ°githubè£é¢ï¼Œ\nç„¶å¾Œè¨ªå•å‰›å‰›å»ºç«‹çš„ç¶²å€ï¼Œ\næˆ‘å»ºç«‹çš„åç¨±ç‚ºdaimom.github.io\n\næ‰€ä»¥ç¶²å€å°±æ˜¯ daimom.github.io\nref. github_page\n\nå°‡npmè½‰æˆpnpm\nå…¶å¯¦é€™ä¸€æ­¥ä¹Ÿå¯ä»¥ä¸åšï¼Œ\né‚£å°±æ˜¯å¯«github actionçš„æ™‚å€™ï¼Œä¸èƒ½ç”¨pnpmåªèƒ½ç”¨npmï¼Œ\nç¨‹å¼æ‡‰è©²ä¹Ÿè¦å°æ”¹ä¸€ä¸‹ï¼Œ\nä½†pnpmæœƒæ¯”è¼ƒå¿«ï¼Œæˆ‘å°±é †ä¾¿æ”¹ä¸€æ”¹äº†ã€‚\n\nåˆ° public_vercelçš„è³‡æ–™å¤¾åº•ä¸‹ï¼ŒåŸ·è¡Œä¸‹é¢ä¸‰è¡Œï¼Œåƒè€ƒå¾ npm é·ç§»åˆ° pnpmï¼Œ\næœ‰äº›æ­¥é©Ÿæˆ‘æ¸¬è©¦æ˜¯ä¸éœ€è¦ï¼Œ\né‡é»æ˜¯ pnpm importï¼Œè¦å°‡package-lock.json è½‰æˆ pnpm-lock.yamlã€‚\n# åˆªé™¤npm package\nrm -rf node_modules\n# å®‰è£pnpm\nnpm install -g pnpm\n# è½‰æ›ç›¸é—œæª”æ¡ˆ\npnpm import\n\nå®Œæˆå¾Œï¼Œä¸Šå‚³åˆ°githubã€‚\n\nå»ºç«‹github action\nè³‡æ–™å¤¾çµæ§‹å¦‚ä¸‹\n\nèƒ½æ”¹æª”æ¡ˆåç¨±çš„åªæœ‰build-site.yamlä»¥åŠ install-pnpmï¼Œ\nä½†å¾Œè€…è¦æ”¹çš„è©±ï¼Œç¨‹å¼å…§å®¹ä¹Ÿéœ€è¦æ”¹ï¼Œä¸ç†Ÿçš„è©±ä¸å»ºè­°æ›´æ”¹ã€‚\n\nbuild-site.yamlçš„ç¨‹å¼å¦‚ä¸‹\nname: 'Build Sites'\n\non:\nworkflow_dispatch:\ninputs:\ndeployment-version:\ndescription: æŒ‡å®šç‰ˆæœ¬\nrequired: false\nschedule:\n- cron: '0 10 * * *'\njobs:\nbuild-site-test:\nruns-on: ubuntu-latest\nsteps:\n# [Checkout]\n- name: Checkout code repository\nuses: actions/checkout@v4\nwith:\nfetch-depth: 0\n\n# [åŸ·è¡Œè…³æœ¬] æ§‹å»º pnpm åŠ Node ç’°å¢ƒ\n- name: '[Macro] Prepare environment'\nuses: ./.github/actions/install-pnpm\n\n# [åŸ·è¡Œè…³æœ¬] æ§‹å»ºhtml\n- name: '[Macro] Build sites '\nshell: bash\nrun: pnpm build\n\n- name: Push to HTML Repository\nrun: |\ngit config --global user.email $\ngit config --global user.name &quot;daimom&quot;\ngit config --list\ngit clone https://$@github.com/daimom/daimom.github.io.git temp-html-repo\ncp -r dist/. temp-html-repo/\n\ncd temp-html-repo\ngit add .\ngit commit -m &quot;Update from Build Repository&quot;\ngit remote -v\ngit push origin main\n\ninstall-pnpm/action.yamlçš„ç¨‹å¼å¦‚ä¸‹\nname: 'prepare'\ndescription: 'Prepare environment'\n\nruns:\nusing: 'composite'\nsteps:\n- name: Setup pnpm\nuses: pnpm/action-setup@v2\nwith:\nversion: 8\n- name: Setup node.js\nuses: actions/setup-node@v4\nwith:\nnode-version: 20\ncache: 'pnpm'\n\n- name: Install dependencies\nshell: bash\nrun: pnpm install\n\nç°¡æ˜“èªªæ˜\né€™é‚Šçš„è¨­å®šæ˜¯æ¯å¤©çš„UTC 10:00 åŸ·è¡Œä¸€æ¬¡ï¼Œ\nå¦‚æœè¦è‡ªå®šæ™‚é–“çš„è©±ï¼Œå¯ä»¥åƒè€ƒCrontabÂ ä¸­æ–‡ç·šä¸ŠÂ ç·¨è¼¯å™¨\næ¸¬è©¦çš„æ™‚å€™å¯ä»¥å…ˆæŠŠ\nschedule:\n- cron: '0 10 * * *'\n\næ”¹æˆ\npush:\nbranches:\n\t- 'main'\n\né€™æ¨£åªè¦æ¨ä¸Šå»mainå°±æœƒè§¸ç™¼å‹•ä½œäº†(æ³¨æ„æ’ç‰ˆ)ã€‚\nref. ä»¥ GitHub Action ä¾†ç™¼æ¨æ–‡\næˆ–è€…æ˜¯ç›´æ¥æ‰‹å‹•éƒ¨ç½²ï¼Œ\nåœ¨public_vercelçš„github actioné¸æ“‡ä½ çš„Action ï¼Œå†é¸ Run workflow\n\nç¨‹å¼è£é¢çš„ $ æ˜¯è¦åˆ°repositoryè£é¢è¨­å®šã€‚\n\nä¹Ÿå¯ä»¥ç›´æ¥è¼¸å…¥ä½ çš„emailï¼Œåæ­£emailé€™æ±è¥¿æ‡‰è©²å·²ç¶“...ã€‚\nä½†é‡é»æ˜¯åº•ä¸‹çš„ $ ï¼Œ\né€™å€‹ä¸€å®šè¦ç”¨secretéš±è—ï¼Œè€Œä¸”ä¸èƒ½å¤–æµã€‚\nç”¢ç”Ÿçš„æ–¹å¼ï¼Œè©³é–±ï¼Œ <a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ†’ SideProject/160.Obsidianç™¼ä½ˆç¶²ç«™/#github-token\">160.Obsidianç™¼ä½ˆç¶²ç«™#å»ºç«‹github token</a>\nå†ä¾†å°‡ç”¢ç”Ÿçš„tokenï¼Œæ–°å¢åˆ°sercretè£é¢ã€‚\nref.\n\nGitHub Actions æ–‡ä»¶\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ’» Code/110.github action pipelineç­†è¨˜/\">110.github action pipelineç­†è¨˜</a>",
		"tags": [ "note","ğŸ†’"]
},

{
		"title": "200. Net core SDKå®‰è£è‡³container",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/200. Net core SDKå®‰è£è‡³container/",
		"content": "å‰è¨€\nå¾Œç«¯ä¹‹å‰ç™¼äº†ä¸€å€‹ç‰ˆæœ¬ä¸Šå»å¾Œï¼Œ\nè¨˜æ†¶é«”å°±ä¸€è·¯å¾€ä¸Šé£†ï¼Œ\nä»–å€‘ä¹ŸæŸ¥ä¸å‡ºå€‹æ‰€ä»¥ï¼Œ\nå¾Œä¾†å¹«ä»–å€‘æŸ¥ï¼Œæœ‰è«‹ä»–å€‘åŠ å€‹ç¨‹å¼ç¢¼è©¦è©¦ï¼Œçœ‹ä¾†ä¹ŸæˆåŠŸäº†ã€‚\nä½†ç‚ºäº†ä»¥å¾Œï¼Œé‚„æ˜¯çŸ¥é“ä¸€ä¸‹è¦æ€éº¼æŠ“è¨˜æ†¶é«”çš„ç”¨é‡æ¯”è¼ƒå¥½ï¼Œ\nå°±äº¤çµ¦ä»–å»çœ‹äº†ã€‚\n&lt;PropertyGroup&gt;\n&lt;ServerGarbageCollection&gt;false&lt;/ServerGarbageCollection&gt;\n&lt;/PropertyGroup&gt;\n\nref. ã€è­¯ã€‘Asp.net coreæ‡‰ç”¨åœ¨ Kubernetesä¸Šè¨˜æ†¶é«”ä½¿ç”¨ç‡éé«˜å•é¡Œåˆ†æ\næ­£æ–‡\nä»¥ä¸‹ç‚ºåŒäº‹åŸ·è¡Œçš„æŒ‡ä»¤ï¼Œ\nå¯èƒ½éœ€è¦å…ˆå®‰è£wgetä¹‹é¡çš„æ±è¥¿ã€‚\n\nè£ dotnet SDK\n\nwget https://dot.net/v1/dotnet-install.sh -O dotnet-install.sh\nchmod +x ./dotnet-install.sh\n./dotnet-install.sh --version latest\n\nåŸ·è¡Œ\n\nè£å®Œå¾Œï¼Œæœ€å¥½å…ˆç”¨ find / -iname dotnet ï¼Œ\næŸ¥ä¸€ä¸‹å®‰è£å¾Œçš„dotnetåœ¨å“ªã€‚\nåŸ·è¡Œçš„æ™‚å€™ï¼Œè¨˜å¾—ç”¨ ./dotnet --version ï¼Œçš„æ–¹å¼åŸ·è¡Œã€‚\nä¸ç„¶ï¼Œé è¨­æ˜¯ç”¨/usr/bin è£é¢çš„dotnetåŸ·è¡Œçš„ã€‚\n\né™¤éŒ¯\næ²’ç ”ç©¶ï¼Œä½†åŒäº‹æ˜¯åƒè€ƒä¸‹é¢é€™ç¯‡å»å¯¦ä½œã€‚\nåƒè€ƒé€£çµ Identifying Memory Leaks with dotnet-dump and dotnet-gcdump\n\nref.\n\nå·²ç·¨å¯«æŒ‡ä»¤ç¢¼çš„å®‰è£\nIdentifying Memory Leaks with dotnet-dump and dotnet-gcdump",
		"tags": [ "note","ğŸ³"]
},

{
		"title": "201. kustomize patch",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/201. kustomize patch/",
		"content": "å‰è¨€\næ‡¶ç™Œç™¼ä½œï¼Œè¦éƒ¨ç½²æ–°ç’°å¢ƒæ™‚ï¼Œ\næƒ³åˆ°æ¯å€‹deploymentè¦ä¸€å€‹ä¸€å€‹æ”¹ï¼Œå°±å¥½æ‡¶ã€‚\nè©²æ›æ“¬å‡ºä¾†äº† kustomizeï¼Œ\nkubectl ç¾åœ¨é è¨­å°±æœ‰æ”¯æ´ï¼Œä»¥å‰é‚„è¦å–®ç¨è£æŒ‡ä»¤ã€‚\næ­£æ–‡\næŸ¥çœ‹kustomizeçš„çµæœ\nkubectl kustomize ./\n\nåŸ·è¡Œæ–¹å¼\nkubectl apply -k &lt;folder path&gt;\n\nä¿®æ”¹æ˜ åƒæª”\nè¦æ³¨æ„å¾—é»æ˜¯ï¼Œ deployment.yaml çš„imageè£é¢çš„æ˜ åƒæª”åç¨±ï¼Œ\nè¦å°æ‡‰åˆ°kustomize.yaml çš„ images.nameã€‚\nä»¥ä¸‹é¢çš„ç¯„ä¾‹ä¾†èªªï¼Œ my-image:1.2.3 å…¶ä¸­my-imageå°±æ˜¯æ˜ åƒæª”åç¨±ï¼Œ\næ‰€ä»¥åœ¨kustomize.yamlè£é¢çš„image nameè¦å¯« my-image\ndeployment.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: my-app\nspec:\ntemplate:\nspec:\ncontainers:\n- name: my-container\nimage: my-image:1.2.3\n\nkustomize.yaml\nresources:\n- ../../../base\nimages:\n- name: my-image\nnewName: my.image.registry/nginx\nnewTag: 1.4.0\n\nä¿®æ”¹å…¶ä»–æ¬„ä½\né™¤äº†ä¸€èˆ¬èƒ½ä¿®æ”¹çš„æ±è¥¿ï¼Œèƒ½ç”¨ cross-cutting field ä¿®æ”¹ä»¥å¤–ï¼Œ\nå…¶ä»–è¦ä¿®æ”¹åªèƒ½é€épatchçš„æ–¹å¼ã€‚\nå…¶ä¸­ patchesJson6902è·Ÿ patchesStrategicMergeï¼Œ\nç›®å‰å·²ç¶“è¢«patcheså–ä»£ï¼Œä¹Ÿå°‡æ–¼å¾ŒçºŒç‰ˆæœ¬deprecated.\nä¸” patchesèƒ½å¤ åœ¨ nameä»¥åŠnamespaceä¸Šä½¿ç”¨regexã€‚\nref. What is the difference between patches vs patchesJson6902 in Kustomize\ncross-cutting åŸºæœ¬æœ‰é€™äº›\n\nå¦‚æœä¸Šé¢æœ‰ç”¨åˆ° cross-cutting çš„åƒæ•¸ï¼Œä¸‹é¢çš„åŸå§‹æª”ï¼Œ\nåªè¦å¯«åŸå§‹çš„å°±å¥½ï¼Œä¸ç”¨å¯«ä¿®æ”¹éçš„åƒæ•¸ã€‚\nä¾‹å¦‚ namespace åœ¨åŸå§‹çš„deployment.yamlæ˜¯defaultï¼Œ\nç„¶å¾Œåœ¨ kustomize.yaml è£é¢ ä¿®æ”¹æˆ gameï¼Œ\né‚£Patchesé‚„æ˜¯å¯«åŸæœ¬çš„defaultã€‚\nPatchesåº•ä¸‹çš„patchï¼Œåªè¦æœ‰ä»¥ä¸‹è³‡è¨Šå³å¯ï¼Œ\nç„¶å¾Œå°±æ˜¯è¦ä¿®æ”¹çš„è¨­å®šäº†ã€‚\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: systemmanageservice\n\nä¸‹é¢ç¯„ä¾‹æ˜¯ï¼Œä¿®æ”¹containeråº•ä¸‹çš„envè®Šæ•¸ã€‚\npatches:\n- target:\nkind: Deployment\nname: systemmanageservice\npatch: |-\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: systemmanageservice\nspec:\ntemplate:\nspec:\ncontainers:\n- name: systemmanageservice\nenv:\n- name: ASPNETCORE_ENVIRONMENT\nvalue: QA\n\nref.\n\nKustomize åŠŸèƒ½ç‰¹æ€§åˆ—è¡¨\npatches\n\npatchesJson6902\nä¸Šé¢æœ‰æåˆ°patchesæ˜¯ patchesJson6902 èˆ‡\npatchesStrategicMergeçš„çµåˆã€‚\næ–¼æ˜¯ patchesä¹Ÿæ”¯æ´ä¸‹é¢é€™ç¨®ç”¨æ³•ã€‚\nä½¿ç”¨ op ä¾†ä½œæ–°å¢æˆ–å–ä»£ã€‚\napiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\n\npatchesJson6902:\n- target:\nversion: v1\nkind: Deployment\nname: my-deployment\npatch: |-\n- op: add\npath: /some/new/path\nvalue: value\n- op: replace\npath: /some/existing/path\nvalue: &quot;new value&quot;",
		"tags": [ "note","âˆ"]
},

{
		"title": "GCPå¤šå¸³è™Ÿåˆ‡æ›",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/202. GCPå¤šå¸³è™Ÿåˆ‡æ›/",
		"content": "å‰è¨€\næœ€è¿‘é©é€¢å°ˆæ¡ˆæ¬å®¶æ™‚æœŸï¼Œå¸³è™Ÿè¦åˆ‡ä¾†åˆ‡å»ï¼Œ\nçµæœä¸€åˆ‡éå»å°±ä¸èƒ½ç”¨äº†ã€‚\néŒ¯èª¤å¯«ï¼Œä½ çš„Bå¸³è™Ÿç„¡æ³•åœ¨Aå°ˆæ¡ˆä½¿ç”¨ã€‚\næ­£æ–‡\nOSæ˜¯ MacOSï¼Œwindowæœƒä¸æœƒæœ‰ç›¸åŒéŒ¯èª¤ä¸æ¸…æ¥š\nè©¦äº†å¹¾æ¬¡ï¼Œåˆ‡æ›GCPå¸³è™Ÿçš„æŒ‡ä»¤éƒ½æ²’ç”¨ï¼Œ\næœ€å¾Œæ‘¸å‡ºä¸€å¥—å¯è¡Œçš„æ­¥é©Ÿ\n\nå…ˆç¢ºå®šç›®å‰ä½¿ç”¨çš„gcpå¸³è™Ÿæ˜¯å“ªä¸€å€‹ï¼Œ* ä»£è¡¨ä½¿ç”¨ä¸­çš„å¸³è™Ÿ\n\ngcloud auth list\n\nç„¶å¾Œç¢ºèªconfigè¨­å®šæœ‰æ²’æœ‰éŒ¯\ngcloud config list\n\nå¦‚æœå¸³è™Ÿæˆ–projectæœ‰éŒ¯èª¤ï¼Œå°±ä¿®æ”¹\n# ä¿®æ”¹å¸³è™Ÿ\ngcloud config set account abc@abc.com\n# ä¿®æ”¹project\ngcloud config set project project_id\n\nç¢ºèªè¦ä½¿ç”¨å°ˆæ¡ˆçš„contextè¨­å®š\næŒ‡ä»¤\n\n# å–å¾—æ‰€æœ‰clusterè¨­å®š\nkubectl config get-contexts\n# åˆ‡æ›è¦ä½¿ç”¨çš„cluster\nkubectl config use-context [NAME]\n# æª¢æŸ¥ç›®å‰ä½¿ç”¨ä¸­çš„cluster\nkubectl config current-context\n\nDocker åˆ‡æ›\né¸æ“‡ç’°å¢ƒå¾Œæ»‘é¼ é»ä¸€ä¸‹\n\nå®Œæˆå¾Œï¼Œé‡é–‹ Terminal\nä¸€å®šè¦é‡é–‹ï¼ï¼ï¼ï¼ä¸ç„¶æœƒåƒé¬¼æ‰“ç‰†ä¸€æ¨£ï¼Œä¸€ç›´è·³éŒ¯èª¤ã€‚\n\nå·®é»éƒ½æƒ³ç›´æ¥ç”¨ gcloud auth revoke &lt;account&gt; æŠŠå¸³è™Ÿå¼·åˆ¶ç™»å‡ºäº†ã€‚\n2024/04/11\nè¦åˆ‡å¸³è™Ÿæ™‚ï¼Œterraformåˆæ›äº†ï¼Œä¸€ç›´æç¤ºæˆ‘ç”¨å¦ä¸€å€‹å¸³è™Ÿã€‚\nä½†ç”¨kubectl æŒ‡ä»¤æ™‚ï¼Œéƒ½æ­£å¸¸ã€‚\nå¾Œä¾†åŸ·è¡Œé€™è¡Œï¼Œ\ngcloud auth application-default login\n\né‡æ–°ç™»å…¥å¾Œæ­£å¸¸ã€‚\nref.\n\n[GCP]gcloudåˆ‡æ›å¸³è™Ÿã€å°ˆæ¡ˆ\ngcloud auth",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "istio Authorization æ‹’çµ•æŒ‡å®šæª”æ¡ˆç€è¦½",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/203. istio Authorization æ‹’çµ•æŒ‡å®šæª”æ¡ˆç€è¦½/",
		"content": "å‰è¨€\næ¥åˆ°å€‹éœ€æ±‚ï¼Œè¦é™å®šç¶²ç«™çš„æŸå€‹å‰¯æª”åä¸èƒ½è¢«ç€è¦½ã€‚\næ­£æ–‡\nAuthorization-policyçš„yaml\nRuleè¦å‰‡åˆ†æˆä¸‰å¤§å¡Š\nFrom\nè«‹æ±‚ä¾†æº\nTo\nè«‹æ±‚ç›®çš„\nWhen\næŒ‡å®šçš„è«‹æ±‚é™„åŠ æ¢ä»¶\nTo\nnginxæŸ¥ä¸€ä¸‹ï¼Œæ˜¯æœ‰é¡ä¼¼çš„æ±è¥¿ã€‚\nä½†istioæˆ‘çœ‹äº†å®˜æ–¹æ–‡ä»¶ï¼Œ\nå¯«æ³•æ˜¯\n- to:\n- operation:\npaths: [&quot;/user/profile/*&quot;]\n\nç›®å‰åªæœ‰æ”¯æ´å–®å€‹ *\n\nExact match:Â abcÂ will match on valueÂ abc.\nå®Œå…¨åŒ¹é…ï¼šÂ abcÂ å°‡åŒ¹é…å€¼Â abcÂ ã€‚\nPrefix match:Â abc*Â will match on valueÂ abcÂ andÂ abcd.\nå‰ç¶´åŒ¹é…ï¼šÂ abc*Â å°‡åŒ¹é…å€¼Â abcÂ å’ŒÂ abcdÂ ã€‚\nSuffix match:Â *abcÂ will match on valueÂ abcÂ andÂ xabc.\nå¾Œç¶´åŒ¹é…ï¼šÂ *abcÂ å°‡åŒ¹é…å€¼Â abcÂ å’ŒÂ xabcÂ ã€‚\nPresence match:Â *Â will match when value is not empty.\nå­˜åœ¨åŒ¹é…ï¼šç•¶å€¼ä¸ç‚ºç©ºæ™‚ï¼ŒÂ *Â å°‡åŒ¹é…ã€‚\n\nç¾åœ¨çš„ç›®æ¨™æ˜¯è¦é˜»æ“‹ index-erscvs.js.map ï¼Œç¦æ­¢ä»»ä½•äººè§€çœ‹ã€‚\nä½† index-erscvs.js ä¸èƒ½è¢«deny\næ–¼æ˜¯\nkind: AuthorizationPolicy\nmetadata:\nname: frontend-map-policy\nspec:\nselector:\nmatchLabels:\ngroup: frontend\naction: DENY\nrules:\n- to:\n- operation:\nhosts: [&quot;abc.def.com&quot;]\nports: [&quot;80&quot;]\npaths: [&quot;*.js.map&quot;]\n\nå„ªå…ˆé †åºè©•ä¼°è¡¨ Custom &gt; Deny &gt; Allow\nref. Authorization Policy\nWhen\næ³¨æ„ï¼Œvaluesä¸æ”¯æ´CIDRï¼Œéœ€ç”¨* ä»£æ›¿ç§æœ‰ç¶²æ®µ\né€™é‚Šæ²¿ç”¨ <a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/186. istioçš„Authorization policy(ç™½åå–®)/\">186. istioçš„Authorization policy(ç™½åå–®)</a> çš„æ–¹å¼ï¼Œ\nè¨­å®šç™½åå–®ã€‚\næ–¼æ˜¯ï¼Œä¸‹é¢çš„è¨­å®šæ–¹å¼ï¼Œlabel æ˜¯ group=frontendçš„deployï¼Œ\nä¸å…è¨±è¨ªå•*.js.mapçš„æª”æ¡ˆï¼Œé™¤äº†ä¾†æºæ˜¯ 123.123.123.123\napiVersion: security.istio.io/v1\nkind: AuthorizationPolicy\nmetadata:\nname: frontend-map-policy\nspec:\nselector:\nmatchLabels:\ngroup: frontend\naction: DENY\nrules:\n- to:\n- operation:\nhosts: [&quot;abc.def.com&quot;]\nports: [&quot;80&quot;]\npaths: [&quot;*.js.map&quot;]\nwhen:\n- key: request.headers[X-Envoy-External-Address]\nnotValues:\n- &quot;123.123.123.123&quot;\n\né©—è­‰æ™‚ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„æŒ‡ä»¤å”åŠ©æŸ¥è©¢ï¼Œ\nè¦æ³¨æ„æ˜¯ä¸æ˜¯è¢«å…¶ä»–çš„policyå½±éŸ¿äº†\n# å…ˆé–‹å•Ÿdebugæ¨¡å¼ï¼Œè³‡è¨Šæ¯”è¼ƒå¤šï¼ŒæŸ¥å®Œå¾Œå°‡deployé‡å•Ÿå³å¯\nistioctl proxy-config log deploy/httpbin --level &quot;rbac:debug&quot; | grep rbac\n\nfor i in {1..20}; do curl -H 'Cache-Control: no-cache, no-store' https://abc.def.com/assets/index-d74bceac.js -s -o /dev/null -w &quot;%{http_code}\\n&quot;; done\n\nkubectl logs &lt;pod name&gt; -c istio-proxy\n\næ³¨æ„\nwhen è·Ÿ to å¦‚æœç”¨ ä¸‹é¢æ–¹å¼çš„è©±ï¼Œè¡¨ç¤ºæ˜¯å…©æ¢è¦å‰‡\n...\n\t- to:\n\t\t...\n\t- when:\n\t\t...\n\né€™æ¨£æ‰æ˜¯åŒä¸€æ¢è¦å‰‡ï¼Œ\næˆ‘çŠ¯äº†é€™å€‹è ¢éŒ¯èª¤\n\t- to:\n\t\t...\n\t when:\n\t\t...\n\nref.\n\nAuthorization Policy\nAuthorization Policy Conditions\nauthorizationPolicyè©³è§£",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "205. Grafana ç­†è¨˜",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/205. Grafana ç­†è¨˜/",
		"content": "å‰æ–‡\næ­£æ–‡\nå–®ä½æ›ç®—\nbyte(IEC)ï¼šä»¥1024è½‰æ›è¨ˆç®—ã€‚2MB = 2042 kb\nbyte(SI) ï¼š ä»¥åé€²ä½è¨ˆç®—ã€‚ 2MB= 2000kb\næ›´æ›ç·šæ¢é¡è‰²\n\nå…ˆæŠŠLegend æ‰“é–‹\né»é¸Legendçš„é¡è‰²\n\néš±è—\nOverridesè£¡é¢çš„é¸é …ï¼Œæœ‰æ™‚æœƒè¢«æ‰“å‹¾ï¼Œå°è‡´ç·šåœ–ä¸æœƒå‡ºç¾\nåŒ¯å‡º\n\né»é¸æ¨™é¡Œçš„å³é‚Šåˆ†äº«æŒ‰éˆ•\n\né¸æ“‡Export ï¼Œå†ä¾†çœ‹è¦å­˜æª”æˆ–æª¢è¦–Json",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "steamDeck çš„ Cheat Engineæ›¿ä»£å“",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/206. steamDeck çš„ Cheat Engineæ›¿ä»£å“/",
		"content": "å‰è¨€\næ˜¥ç‰¹å…¥æ‰‹äº†å¹¾æ¬¾ è·Ÿå¼Ÿå¼Ÿä¸€èµ·ç©çš„éŠæˆ²ï¼Œ\nä½†æœ‰äº›æ™‚å€™é‡è¤‡åˆ·çš„æœ‰é»ç…©ï¼Œ\nå°±æƒ³èªªæ”¹ä¸€ä¸‹çœé»æ™‚é–“ï¼Œ\næŸ¥äº†ä¸€äº›è³‡è¨Šï¼Œç™¼ç¾CheatEngineä¸æ˜¯ä¸èƒ½è£ï¼Œ\nä½†æœ‰å¤ éº»ç…©ï¼ï¼ï¼ï¼ï¼\næ­£æ–‡\né®é‡è²æ˜ï¼Œä¿®æ”¹æœ‰ä¸€å®šé¢¨éšªã€‚\næ„Ÿè¬å·´å‹C.Cå‘ŠçŸ¥å¦ä¸€å¥—è»Ÿé«”ã€memory deckã€\nç›´æ¥åœ¨Decky loader æœå°‹ï¼Œå®‰è£å³å¯ã€‚\næœå°‹æ–¹å¼ä¹Ÿå¾ˆç°¡å–®ï¼Œç›´æ¥æŒ‰æŒæ©Ÿå³ä¸‹çš„ ... å°±èƒ½æœå°‹ã€‚\nç¼ºé»æ˜¯æ¯æ¬¡è¦æ”¹å°±è¦é‡æ–°æœå°‹ä¸€æ¬¡ã€‚\næœ€å¾Œåœ¨redditæ‰¾åˆ°äº†Â memory_hack\né€™æ¬¾çš„å¥½è™•åœ¨æ–¼ï¼Œsteam deck(æ¡Œé¢æ¨¡å¼)é–‹å•ŸéŠæˆ²å¾Œï¼Œ\nç”¨æ‰‹æ©Ÿæˆ–é›»è…¦åœ¨åŒä¸€å€‹wifiåº•ä¸‹ï¼Œé–‹å•Ÿç¶²é å³å¯ä¿®æ”¹ã€‚\nå®‰è£æ–¹å¼ä¹Ÿå¾ˆç°¡å–®ï¼Œ\n\nå»ºç«‹ä¸€å€‹è³‡æ–™å¤¾ï¼Œè¦æ”¾å®‰è£æª”\n\npython3 &lt;(wget -qO- https://github.com/primetime00/memory_hack/raw/master/app/patches/install.py)\n\nå®‰è£å®Œå¾Œï¼Œæœƒå•ä½ è¦ä¸è¦ç•¶æˆé è¨­ç¨‹å¼ï¼Œæˆ‘æ˜¯é¸n ï¼Œç•¶æœ‰éœ€è¦æ™‚å†åˆ°å‰›å‰›çš„è³‡æ–™å¤¾å•Ÿå‹•å°±å¥½ã€‚\n\nå•Ÿå‹•æŒ‡ä»¤ï¼Œåˆ°è©²è³‡æ–™å¤¾åº•ä¸‹åŸ·è¡ŒÂ Â Â ./run.sh\nå®‰è£èªªæ˜é€£çµ\nç„¶å¾Œå°±å¯ä»¥å…ˆåœ¨steam deckä¸Šé¢é–‹ç¶²é ï¼Œhttp://localhost:5000 çœ‹æœ‰æ²’æœ‰è³‡æ–™ã€‚\nå¦‚æœè¦ç”¨æ‰‹æ©Ÿæˆ–é›»è…¦é€£çš„è©±ï¼Œ\nå¯ä»¥å¦å¤–é–‹å•Ÿkonsole ï¼ŒåŸ·è¡Œ ip -4 addrÂ Â å°±æœƒçœ‹åˆ°ä½ çš„ipï¼Œå‡è¨­æ˜¯192.168.0.125ï¼Œ\nåœ¨æ‰‹æ©Ÿä¸Šé–‹å•Ÿ http://192.168.0.125:5000 ï¼Œå°±æœƒçœ‹åˆ°ç•«é¢äº†ã€‚\nç°¡æ˜“æ“ä½œ\n\nåˆ° Search çš„é ç±¤ä¸Šï¼Œé¸æ“‡ Processçš„ éŠæˆ²åç¨±\n\nè¼¸å…¥æ•¸å€¼æŸ¥è©¢ï¼Œé€šå¸¸è¦å…©æ¬¡æŸ¥è©¢ï¼Œç¬¬ä¸€æ¬¡æœ‰å¾ˆå¤šè³‡æ–™ï¼Œç•¶æ•¸å€¼è®Šå‹•æ™‚ï¼Œå†æœå°‹ä¸€æ¬¡ï¼Œå°±æœƒæœ‰äº†\n\nè¤‡è£½è¨˜æ†¶é«”ä½ç½®\n\nåˆ° Codeçš„é ç±¤ï¼Œé¸æ“‡ Processçš„éŠæˆ²åç¨±\n\nè¼¸å…¥æ•¸å€¼ï¼Œæ—é‚Šçš„æ–¹æ ¼ï¼Œæ‰“å‹¾è¡¨ç¤ºé–å®šæ•¸å€¼ã€‚\n\np.s æ”¹å®Œå¾Œï¼Œæ•¸å€¼å¯èƒ½ä¸æœƒé¦¬ä¸Šé‡ç¾ï¼Œè®“éŠæˆ²çš„æ•¸å€¼è®Šå‹•ä¸€ä¸‹ã€‚\nå®Œæ•´æ“ä½œèªªæ˜ï¼Œè«‹åƒè€ƒÂ Memory Hack Beginner Tutorial\nä¹‹å‰æœ‰äººä»‹ç´¹å¦ä¸€æ¬¾ï¼Œ\nMemory Deck ï¼Œç›´æ¥åœ¨æŒæ©Ÿæ¨¡å¼ä¸‹çš„Decky loader å•†åº—æœå°‹ï¼Œ\nè£èµ·ä¾†å°±å¥½äº†ã€‚",
		"tags": [ "note","ğŸ®"]
},

{
		"title": "207. mapgenieæ•´æ‰¹unfound",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/207. mapgenieæ•´æ‰¹unfound/",
		"content": "å‰è¨€\nå‰é™£å­ç©éŠæˆ²æ™‚ç™¼ç¾ä¸€å€‹ç¶²ç«™ï¼Œmapgenie.io\nè£¡é¢æœ‰å¾ˆå¤šéŠæˆ²çš„åœ°åœ–ï¼Œ\næŒ‰ä¸‹foundä»¥å¾Œï¼Œä¸æƒ³ä¸€å€‹ä¸€å€‹æŠŠå‹¾æ‹¿æ‰ã€‚\næ­£æ–‡\næœ‰é¤˜åŠ›çš„è©±ï¼Œæ‡‰è©²æ˜¯è²·VIPæœƒå“¡æ‰å°ï¼Œ\nä½†æˆ‘è¦ºå¾—æˆ‘ç”¨ä¸åˆ°é‚£éº¼å¤šåŠŸèƒ½ï¼Œ\nå¯èƒ½é€™å€‹åŠŸèƒ½ä¹Ÿæ˜¯VIPå°ˆç”¨ã€‚\nç•¢ç«ŸèŠ±éŒ¢å°±æ˜¯è¦çœæ™‚é–“ï¼Œä¸æƒ³èŠ±éŒ¢åˆæƒ³çœæ™‚é–“çš„è©±ï¼Œ\næ´—æ´—ç¡å§ã€‚\n\næ‰“é–‹ç¶²é çš„é–‹ç™¼è€…å·¥å…·ï¼Œ\næ‰¾åˆ° body &gt; div#app\nåº•ä¸‹çš„scriptsï¼Œæœƒé•·çš„åƒé€™æ¨£\n\næœ€ä¸Šé¢æœ‰ä¸€äº›æ•¸å­—ï¼Œé‚£äº›æ•¸å­—å°±æ˜¯æˆ‘å€‘è¦çš„ã€‚\n\né¸æ“‡ç¶²è·¯é ç±¤\nå†ä¾†å°‡ä¸€å€‹foundé—œæ‰ï¼Œæœƒçœ‹åˆ°åº•ä¸‹çš„Fetch/XHRï¼Œæ–°å¢ä¸€ç­†ã€‚\né»é¸å¾Œï¼Œæ³¨æ„çœ‹ç®­é ­æ˜¯ä¸æ˜¯å¯«DELETE\n\nè¤‡è£½æˆCURL\nå°è‘—å‰›å‰›çš„58673æŒ‰å³éµï¼Œé¸æ“‡è¤‡è£½æˆCURL\n\nç„¶å¾Œæ‰¾å€‹è¨˜äº‹æœ¬è²¼ä¸Šï¼Œä½ æœƒç™¼ç¾ä¸€é•·ä¸²çš„æ±è¥¿ã€‚\næˆ‘æ¸¬è©¦éï¼Œå¯ä»¥æŠŠ -H 'cookie:' æ•´æ®µæ‹¿æ‰ï¼Œ\nå…¶ä»–æ±è¥¿æ‡‰è©²å°±ä¸å¥½åˆªäº†ã€‚\n\nå†ä¾†å°±æ˜¯æ›´æ›æœ€ä¸Šé¢çš„æ•¸å­—ï¼Œå°±ä¸ç”¨ä¸€å€‹ä¸€å€‹é»æ¨™èªŒï¼Œç„¶å¾ŒæŠŠå‹¾æ‹¿æ‰äº†ã€‚\nä¸Šé¢çš„åœ–ç‰‡ï¼Œæˆ‘åªç¯€éŒ„äº†ä¸‰è¡Œï¼Œå®Œæ•´çš„ä¸åªé€™æ¨£ã€‚\nç„¶å¾Œå°‡curlä¸Ÿå» å‘½ä»¤ææ˜¯å­—å…ƒåŸ·è¡Œå°±å¥½äº†ã€‚\næ›´æ‡¶ä¸€é»ï¼Œå¼„å€‹forè¿´åœˆï¼ŒæŠŠæ•¸å­—è‡ªå‹•å¸¶é€²å»ç¶²å€ã€‚\nå¯ä»¥åƒè€ƒ <a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/135. gsutilæ•´æ‰¹è¤‡è£½/\">135. gsutilæ•´æ‰¹è¤‡è£½</a>\né‚„æœ‰å¦ä¸€ç¨®å°±æ˜¯å»æ‰¾newmanå»æè‡ªå‹•åŒ–å¸¶å…¥åƒæ•¸æ‡‰è©²ä¹Ÿèƒ½åšåˆ°ã€‚",
		"tags": [ "note","ğŸ†’"]
},

{
		"title": "208. æ¶è¨­sftp",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/208. æ¶è¨­ sftp/",
		"content": "äº‹ç”±\néœ€è¦ä¸€å€‹åœ°æ–¹æ”¾å¤§é‡çš„è³‡æ–™ï¼Œæ—¥å¾Œæä¾›çµ¦å®¢æˆ¶ä¸‹è¼‰ï¼Œ\næœ¬ä¾†æƒ³èªªç”¨GCSå°±å¥½ï¼Œä½†å¦‚æœè¦ä¸€æ¬¡ä¸‹è¼‰å¥½å¹¾å€‹æª”æ¡ˆå°±æ²’è¾¦æ³•äº†ã€‚\nåªå¥½ä¹–ä¹–å¼„FTPã€‚\næ­£æ–‡\nä¸€é–‹å§‹ç”¨vsftpï¼Œæå€‹docker å¤§æ¦‚æ²’10åˆ†é˜å°±å¥½äº†ã€‚\næœ‰ä¸€åŠçš„æ™‚é–“åœ¨æ‰¾imageä¸Šé¢ï¼Œ\nä½†å¦‚æœè¦é”æˆã€ä¸€å€‹ä½¿ç”¨è€…ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰ä½¿ç”¨è€…çš„ç›®éŒ„ï¼Œå…¶ä»–ä½¿ç”¨è€…éœ€è¦ç¨ç«‹ã€å°±æ‡µäº†ã€‚\nå¾ŒçºŒæ‰¾è³‡æ–™æ™‚ï¼Œçœ‹åˆ°é³¥å“¥èªªäº†ä¸€å¥è©±ï¼Œã€æ‰€ä»¥ï¼Œå»ºè­°æ‚¨ï¼Œé™¤éå¿…è¦ï¼Œå¦å‰‡çš„è©±ï¼Œä½¿ç”¨ SSH æä¾›çš„ sftp-server åŠŸèƒ½å³å¯ã€\nref. FTP çš„å®‰å…¨æ€§å•é¡Œèˆ‡æ›¿ä»£æ–¹æ¡ˆ\næ‰€ä»¥æˆ‘å°±è½‰å¾€sftpäº†ã€‚\nå…ˆä¾†é‡æ¸…ç›®æ¨™ï¼Œ\n\nä¸€å€‹æœ€é«˜æ¬Šé™çš„å¸³è™Ÿï¼Œ\nå¯ä»¥åœ¨æ‰€æœ‰ä½¿ç”¨è€…çš„ç›®éŒ„æ–°å¢æª”æ¡ˆï¼Œ\nç„¶å¾Œæ‰€æœ‰ä½¿ç”¨è€…é–“æ˜¯ä¸èƒ½äº’ç›¸çœ‹åˆ°å½¼æ­¤çš„æª”æ¡ˆã€‚\n\ndocker image ä½¿ç”¨ corilus/sftpï¼Œ\nä¸‹è¼‰é‡å·²é”1Mã€‚\nå¦‚æœåªæ˜¯ç°¡å–®çš„ftpåŠŸèƒ½ï¼Œç›´æ¥æ¶èµ·ä¾†å°±å¥½äº†ã€‚\nä½†è¦åšæˆä¸Šé¢çš„ç›®æ¨™ï¼Œè¦ç”¨mountçš„æ–¹å¼ï¼Œå°‡è³‡æ–™å¤¾æ›è¼‰åˆ°ä¸»ç›®éŒ„åº•ä¸‹ã€‚\nè©³ç´°ä½œæ³•åƒè€ƒä¸‹é¢ã€‚\ndocker-compose.yaml\nversion: '3'\nservices:\nsftp:\ncontainer_name: sftp\nimage: corilus/sftp\nprivileged: true\nvolumes:\n- ./mount.sh:/etc/sftp.d/bindmount.sh\n- ./userlist.conf:/etc/sftp/users.conf:ro\n- ./upload:/home\nports:\n- &quot;2222:22&quot;\nrestart: always\n\næŒ‡ä»¤èªªæ˜ï¼Œå¯åƒè€ƒ <a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/108. linux shell é€²éšæŒ‡ä»¤/#bdeaee\">108. linux shell é€²éšæŒ‡ä»¤#^bdeaee</a>\nmount.sh\n#!/bin/bash\n# File mounted as: /etc/sftp.d/bindmount.sh\n# Just an example (make your own)\n\nfunction bindmount() {\nif [[ ! -d &quot;$1&quot; ]]; then\nmkdir -p &quot;$1&quot;\nfi\n\nif [[ ! -d &quot;$2&quot; ]]; then\n\t mkdir -p &quot;$2&quot;\nfi\n\nchown -R :100 &quot;$1&quot; &quot;$2&quot;\nchmod 775 &quot;$1&quot; &quot;$2&quot;\nmount --bind &quot;$1&quot; &quot;$2&quot;\n}\n\n# Remember permissions, you may have to fix them:\n# chown -R :users /data/common\nbindmount &quot;/home/mike/upload&quot; &quot;/home/ms/mike&quot;\nbindmount &quot;/home/aaron/upload&quot; &quot;/home/ms/aaron&quot;\n\nuserlist.conf\nms:ms:1001:100\nmike:mike:1002:100\naaron:aaron:1003:100\n\næœ¬ä¾†æƒ³ç”¨lnçš„æ–¹å¼å»æ“ä½œï¼Œ\nå¾terminal èƒ½å¤ é€²å»è³‡æ–™å¤¾ï¼Œä½†ç”¨FTPç™»å…¥å°±æ˜¯èªª no such file or dirctory\nå•äº†è€åŠå¤©GPTä¹Ÿéƒ½æ˜¯å¤±æ•—ï¼Œ\nå¾ä¸€é–‹å§‹èªªè¦åŠ å€‹ä¸å­˜åœ¨çš„åƒæ•¸ FollowSymlinks ï¼Œ\nåˆ°å¾Œé¢çš„ä¸€é€£ä¸²é‡è¤‡å›ç­”ã€‚\næœ€å¾Œçœ‹åˆ° Symbolic link and filezilla over sftp\nçœ‹ä¾†æ˜¯lnçš„å…ˆå¤©é™åˆ¶ï¼Œæ‰€ä»¥æ”¹ç”¨mountå¾Œï¼Œèª¿å€‹æ¬Šé™ï¼Œå¥½äº†ã€‚\nref.\n\nCorilus/sftp Github",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "209.k8sä¸­srsçš„å„å€‹podÂ  metricså–å¾—",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/209. k8sä¸­srsçš„å„å€‹pod  metricså–å¾—/",
		"content": "äº‹ç”±\nåŒäº‹æ­£åœ¨å¼„SRSä¸²æµï¼Œç…§æˆ‘ä»¥å‰çš„å¯«æ³•ï¼Œ\næ˜¯é€éserviceå»å–å¾—å–®ä¸€å€‹podçš„metricsï¼Œ\né€™æ¨£åªæœƒæœ‰ä¸€å€‹podçš„è³‡æ–™ï¼Œ\næ‰€ä»¥è¦æƒ³è¾¦æ³•å–å¾—æ‰€æœ‰podçš„è³‡æ–™ã€‚\næ­£æ–‡\nç”±æ–¼æˆ‘æœ‰å¥—ç”¨istioï¼Œ\næ–¼æ˜¯æœ‰å¥—istio-proxyçš„podé€šé€šæœƒé è¨­å¡\nprometheus.io/path: /stats/prometheus\nprometheus.io/port: '15020'\nprometheus.io/scrape: 'true'\n\næ‰€ä»¥ç›´æ¥åœ¨deployåŠ åƒæ•¸é€²å»æ™‚ï¼Œä¹Ÿæœƒè¢«æ”¹å¯«ã€‚\næ–¼æ˜¯åªå¥½é¡å¤–å¯«job å¦‚ä¸‹\n- job_name: 'srs'\nscrape_interval: 10s\nstatic_configs:\n- targets:\n- 'srs.default.svc.cluster.local:9972'\n\nå‘¼å« service çš„ srs ï¼Œç„¶å¾Œå»å–å¾—metricsçš„metricsã€‚\nä½†ç•¶æœ‰å¤šå€‹podçš„æ™‚å€™ï¼Œé€™å°±æœƒå‡ºå•é¡Œäº†ã€‚\nå› ç‚ºserviceåˆ°podçš„æµé‡å¹³å‡åˆ†é…ï¼Œä½ ä¸æœƒçŸ¥é“ä»–é€£å»å“ªå€‹podã€‚\nä½†ä»Šå¤©æˆ‘è¦æŠ“å…¨éƒ¨metricsï¼Œé€™ç¨®å¯«æ³•å°±æœƒå‡ºå•é¡Œã€‚\nå…¶ä¸­ static_configs é€™å€‹åªé©ç”¨æ–¼ å›ºå®šå­—ä¸²ï¼Œ\næ‰€ä»¥å°æ–¼æœƒè®Šä¾†è®Šå»çš„pod ipæ²’æœ‰ç”¨ã€‚\næ–¼æ˜¯è¦æ”¹æˆ\n- job_name: 'srs'\nscrape_interval: 10s\nkubernetes_sd_configs:\n- role: pod\nrelabel_configs:\n- source_labels: [__meta_kubernetes_pod_name]\naction: keep\nregex: srs-.*\n- source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]\naction: replace\ntarget_label: __metrics_path__\nreplacement: /metrics # å¼·åˆ¶æŒ‡å®šè·¯å¾‘ç‚º /metrics\n- source_labels: [__meta_kubernetes_pod_container_port_name]\naction: replace\ntarget_label: portname\nreplacement: 9972\n\nè¦å‰‡ç”±ä¸Šå¾€ä¸‹ä¾åºåŸ·è¡Œï¼Œæœ‰ç¬¦åˆæ‰æœƒå¾€ä¸‹ã€‚\nkubernetes_sd_configs æœ‰é€™5ç¨®æ–¹å¼(GPTæŠ„ä¾†çš„)\n\nrole: endpointsï¼š\n\né€™å€‹çµ„æ…‹é …å‘Šè¨´ Prometheus å»ç™¼ç¾ Kubernetes ä¸­çš„ç«¯é»å°è±¡ã€‚ç«¯é»å°è±¡ä»£è¡¨äº†æœå‹™çš„å¾Œç«¯ Pod çš„ IP åœ°å€å’Œé€£æ¥åŸ ã€‚\né€šéæ­¤çµ„æ…‹é …ï¼ŒPrometheus å¯ä»¥ç›´æ¥èˆ‡å¾Œç«¯ Pod é€²è¡Œé€šè¨Šï¼Œæ”¶é›†æŒ‡æ¨™è³‡æ–™ã€‚\n\nrole: serviceï¼š\n\né€™å€‹çµ„æ…‹é …å‘Šè¨´ Prometheus å»ç™¼ç¾ Kubernetes ä¸­çš„æœå‹™å°è±¡ã€‚\nPrometheus å°‡æœƒç‚ºæ¯å€‹æœå‹™ç™¼ç¾æœå‹™çš„æ‰€æœ‰å¾Œç«¯ Podï¼Œä¸¦å¾æ¯å€‹ Pod ä¸­æŠ“å–æŒ‡æ¨™è³‡æ–™ã€‚\n\nrole: podï¼š\n\né€™å€‹çµ„æ…‹é …å‘Šè¨´ Prometheus å»ç™¼ç¾ Kubernetes ä¸­çš„ Pod å°è±¡ã€‚\nPrometheus å°‡æœƒç‚ºæ¯å€‹ç™¼ç¾çš„ Pod æ”¶é›†æŒ‡æ¨™è³‡æ–™ã€‚\n\nrole: ingressï¼š\n\né€™å€‹çµ„æ…‹é …å‘Šè¨´ Prometheus å»ç™¼ç¾ Kubernetes ä¸­çš„ Ingress å°è±¡ã€‚\nPrometheus å°‡æœƒç›£è¦– Ingress å°è±¡ï¼Œä¸¦æ”¶é›†èˆ‡ä¹‹ç›¸é—œçš„æŒ‡æ¨™è³‡æ–™ã€‚\n\nrole: nodeï¼š\n\né€™å€‹çµ„æ…‹é …å‘Šè¨´ Prometheus å»ç™¼ç¾ Kubernetes ä¸­çš„ç¯€é»å°è±¡ã€‚\nPrometheus å°‡æœƒç‚ºæ¯å€‹ç¯€é»æ”¶é›†ç›¸é—œçš„æŒ‡æ¨™è³‡æ–™ã€‚\n\nå†ä¾†æ˜¯é‡é» relabel_configs\nåˆ†åˆ¥æœ‰\n\nsource_labelsï¼šä¾†æºæ¨™ç±¤ï¼Œå¯ä»¥åƒè€ƒprometheusçš„UIï¼Œä¸Šé¢æœ‰é¡¯ç¤ºå¾ˆå¤šlabel\n\nactionï¼šå››ç¨®å‹•ä½œï¼ˆkeep,drop,replace,labelmapï¼‰ã€‚\næ±ºå®šä½ è¦å°‡å€¼ä¿ç•™ã€çµ‚æ­¢ã€å–ä»£æˆ–æ¨™ç±¤å°æ‡‰\ntarget_labelï¼šç›®çš„æ¨™ç±¤ï¼Œ\næŠ“è³‡æ–™çš„urlï¼Œç”±ä¸‹é¢ä¸‰ç¨®ç‰¹æ®Šæ¨™ç±¤çµ„æˆ__scheme__Â +Â __address__Â +Â __metrics_path__ã€‚\nç¯„ä¾‹ï¼š https://192.168.103.224:9527/metrics\nä¸»è¦æ˜¯æ±ºå®šç‰¹æ®Šæ¨™ç±¤è¦ç”¨ä»€éº¼ï¼Œä¸ç„¶éš¨ä¾¿å–åéƒ½å¯ä»¥ã€‚\nregexï¼Œç•¶ä½œæ˜¯æ¢ä»¶åˆ¤æ–·é€™è£¡é¢çš„å€¼è¦ç¬¦åˆè¦å‰‡èƒ½å¾€ä¸‹ã€‚\nä¸‹é¢regexæ„æ€æ˜¯ï¼Œpod nameè¦ç¬¦åˆsrs-.*çš„æ‰ä¿ç•™ã€‚\n\n- source_labels: [__meta_kubernetes_pod_name]\naction: keep\nregex: srs-.*\n\nreplacementï¼šè®Šæ›´çš„å€¼\n\nref.\n\nSRS-Prometheus Exporter\nRelabeling é‡æ–°æ¨™è¨˜\n[Prometheus] Service Discovery &amp; Relabel",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "210. Arc Browserç­†è¨˜",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/210. Arc Browserç­†è¨˜/",
		"content": "å‰è¨€\næœ€è¿‘çœ‹åˆ°ä¸€å€‹é —ç¥çš„ç€è¦½å™¨ï¼ŒArc from The Browser Company\næœ€è¿‘å‰›å‡ºäº†win11ç‰ˆæœ¬ï¼Œmacå‰‡è¦12ç‰ˆæœ¬ä»¥ä¸Šæ‰èƒ½ä½¿ç”¨ã€‚\næˆ‘çš„macæ˜¯2015å¹´çš„å¯ä»¥å®‰è£ã€‚\næ­£æ–‡\nå¯ä»¥å…ˆçœ‹ä¸€ä¸‹é€™å€‹Arc çœŸé¦™ï¼è…¦æ´å¤§é–‹çš„åŠŸèƒ½è®“è¶…å¤š Chrome æ­»å¿ ç²‰æ±ºå®šæŠŠ Arc ç•¶ä½œé è¨­ç€è¦½å™¨äº†ï¼ è£¡é¢æœ‰ç°¡å–®çš„æ•™å­¸ã€‚\n\nè¦æ³¨æ„çš„æ˜¯ï¼Œç¾åœ¨çš„ç‰ˆæœ¬å·²ç¶“æŠŠå…§å»ºNoteç æ‰äº†ï¼Œ\nå¦‚æœè¦ä½¿ç”¨åªèƒ½ç”¨ç·šä¸Šçš„ã€‚\næ‰“é–‹ Preferences &gt; Profiles &gt; New documents\né¸æ“‡ä½ è¦è¨­å®šçš„ç·šä¸Šæœå‹™\n\nç€è¦½å™¨è¨­å®šæª”\nARC æœ¬èº«ä¹Ÿæ˜¯ç”¨chromeçš„æ ¸å¿ƒå»åšçš„ï¼Œ\næ‰€ä»¥é™¤äº†Arcæœ¬èº«çš„è¨­å®šä»¥å¤–ï¼Œé‚„æœ‰chromiumçš„è¨­å®šã€‚\né€²å»çš„æ–¹å¼ Preferences &gt; Profiles &gt; Search Settings..\n\nç›®å‰æœƒå¸¸ç”¨åˆ°çš„å¿«é€Ÿéµ\nâŒ˜+Sï¼šé–‹é—œå·¦é‚Šçš„SideBar\nâŒ˜+Tï¼šé–‹å•Ÿæ–°åˆ†é \n\næ³¨æ„ï¼Œé–‹å•Ÿçš„åˆ†é é è¨­åªæœƒç¶­æŒ12hourï¼Œ\næ›´æ”¹å¯åˆ° åœ–1 çš„Archive tabs afterä¿®æ”¹\n\nâŒ˜ï¼‹âŒ¥(options)ï¼‹Gï¼šå¿«é€Ÿé–‹å•ŸchatGPT\n\nArchiveçš„æ­·å²ç´€éŒ„\nåœ¨sidebar å¾€å·¦æ»‘å³å¯ã€‚\næˆ–ç›´æ¥é»é¸",
		"tags": [ "note","ğŸ†’"]
},

{
		"title": "211. k8s service endpointç„¡æ³•é€£çµ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/211. k8s serviceèˆ‡ endpointç„¡æ³•é€£çµ/",
		"content": "å‰è¨€\næŸå¤©åœ¨å»ºç«‹æ–°çš„å¢é›†ï¼Œ\næœå‹™éƒ½å·²ç¶“æ¶å¥½æº–å‚™çµ¦RDäº†ï¼Œ\næœ€å¾Œæ‰ç™¼ç¾ï¼Œå¹³å¸¸ç”¨çš„é€£ç·šæ–¹å¼é€£ä¸åˆ°GCPçš„Memorystore.Redisã€‚\né€™å€‹å•é¡Œå¡äº†æ•´æ•´ä¸€é€±ï¼Œ\nä¸æ–·çš„åˆªé™¤é‡å»ºã€æ¯”å°ã€æ‰¾å·®ç•°ã€‚\næ•…äº‹å±•é–‹\nGKE ç‰ˆæœ¬ï¼š 1.28.7-gke.1026000\nå…ˆç°¡å–®èªªä¸€ä¸‹æ¶æ§‹ï¼Œ\nistioå¢åŠ 6379 çš„port ï¼Œ\næ–°å¢redisçš„svcä»¥åŠendpointï¼Œ\nç”±æ–¼redisæ˜¯GCPçš„æœå‹™ï¼Œæ•…æœ¬èº«æ²’æœ‰podï¼Œ\nè®“istioèƒ½å¤ é€évirtusalServiceé€£åˆ°é€™å€‹serviceï¼Œ\nç„¶å¾ŒRDé€éé€™å€‹ipä»¥åŠporté€£åˆ° GCPçš„Redisã€‚\nå…ˆä¾†çœ‹éŒ¯èª¤çš„ä½¿ç”¨æ–¹å¼ï¼Œ\n\nåœ¨port nameä¸Šé¢è¨­å®šredisçš„åç¨±ï¼Œ\nå°è‡´svcçš„endpointsä¸Šé¢ç„¡æ³•ç¶å®šã€‚\nä¸è¨­å®šport nameçš„è©±\n\nå‰‡å¯ä»¥æ­£å¸¸ç¶å®šã€‚\nç›®å‰çŒœæ¸¬ï¼Œå¯èƒ½è·Ÿ IANAçš„port nameæœ‰é—œä¿‚ã€‚\nä½†ç‚ºä»€éº¼æœƒé€™æ¨£ï¼Œ\nå°±ä¸æ¸…æ¥šäº†ã€‚\n# Service Name and Transport Protocol Port Number Registry\nç›®å‰æ¸¬è©¦å‡ºä¾†ï¼Œåªè¦æœ‰è¨­å®šNameå°±æœƒç¶ä¸åˆ°endpointsã€‚\nå¦å¤–ï¼ŒEndpointSliceç›®å‰(2024/05/20)ä»æœƒç„¡æ³•ç¶å®šï¼Œ\nè«‹å…ˆæ”¹ç”¨Endpointçš„apiã€‚\n\napiVersion: discovery.k8s.io/v1\nkind: EndpointSlice\nmetadata:\nname: redis # must be the same as service name\nnamespace: istio-system\nlabels:\n# You should set the &quot;kubernetes.io/service-name&quot; label.\n# Set its value to match the name of the Service\nkubernetes.io/service-name: redis\naddressType: IPv4\nports:\n- name: redis # should match with the name of the service port defined above\nappProtocol: redis\nprotocol: TCP\nport: 6379\nendpoints:\n- addresses:\n- &quot;10.1.11.43&quot;\n\n---\napiVersion: v1\nkind: Service\nmetadata:\nname: redis\nnamespace: istio-system\nspec:\nports:\n- protocol: TCP\nport: 6379\ntargetPort: 6379\nname: redis\n\nåƒç…§å®˜æ–¹æ–‡ä»¶çš„ä½œæ³•ä¹Ÿä¸æœƒç¶å®šã€‚\nServices without selectors\n2024/05/8\næœ‰å¦ä¸€å€‹å·¥ç¨‹å¸«å‘ŠçŸ¥ï¼Œ\nendpointé‚£é‚Šçš„Port Nameä¹ŸåŠ ä¸Šå»çš„è©±ï¼Œ\nå°±å¥½äº†ã€‚\nçµè«–\né ‚å¤šæ”¹æ”¹ Endpointsçš„addresså°±å¥½äº†ï¼Œ\nport nameé‚£äº›ï¼Œåˆ¥äº‚åŠ ã€‚\nè¦åŠ å°±è¦ä¸€èµ·åŠ ï¼Œä¸”åç¨±ä¹Ÿè¦ä¸€æ¨£ã€‚\n---\napiVersion: v1\nkind: Endpoints\nmetadata:\nname: redis # must be the same as service name\nnamespace: istio-system\nsubsets:\n- addresses:\n- ip: 10.122.11.43\nports:\n- port: 6379\n\t name: redis\n---\napiVersion: v1\nkind: Service\nmetadata:\nname: redis\nnamespace: istio-system\nspec:\nports:\n- protocol: TCP\nport: 6379\ntargetPort: 6379\nname: redis",
		"tags": [ "note","âˆ"]
},

{
		"title": "212. k8sçš„è¦ªå’Œæ€§èˆ‡åè¦ªå’Œæ€§",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/212. k8sçš„è¦ªå’Œæ€§èˆ‡åè¦ªå’Œæ€§/",
		"content": "ç·£ç”±\nå¾Œç«¯çš„æœå‹™ï¼Œæ²’æœ‰HPAï¼Œæ‰€ä»¥ç›®å‰éƒ½å–®Podåœ¨åŸ·è¡Œã€‚\nä½†å¾ˆä¸å·§çš„ï¼Œéƒ½åœ¨åŒä¸€å€‹Nodeè£¡é¢ã€‚\næ‰€ä»¥ç•¶ä¸€å€‹Nodeå‡ºå•é¡Œæ™‚ï¼Œå…¶ä»–æœå‹™æœƒä¸€èµ·é™£äº¡ã€‚\nä½†åªæœ‰ä¸€å€‹NodePoolï¼Œä¹Ÿæ²’è¾¦æ³•ç”¨nodeSelectorã€‚\næ­£æ–‡\nGKEç‰ˆæœ¬ï¼š1.27\nå…ˆä¸Šç¯„ä¾‹ï¼Œè©³ç´°èªªæ˜åœ¨ä¸‹é¢(æ ¼å¼æœ‰é»è·‘æ‰ï¼Œè¤‡è£½ä½¿ç”¨æ™‚è¦æ³¨æ„ï¼‰ã€‚\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: bms\nlabels:\ngroup: svc\napp: backend\nspec:\nreplicas: 1\nselector:\nmatchLabels:\ngroup: svc\napp: backend\ntemplate:\nmetadata:\nlabels:\ngroup: svc\napp: backend\nspec:\ncontainers:\n- name: service\nimage: my-image:v1.0.6\nports:\n- name: http\ncontainerPort: 80\nprotocol: TCP\naffinity:\npodAntiAffinity:\n\t\t\tpreferredDuringSchedulingIgnoredDuringExecution:\n\t - weight: 100\n\t\t podAffinityTerm:\n\t labelSelector:\n\t matchExpressions:\n\t - key: app\n\t operator: In\n\t values:\n\t - gcp\n\t topologyKey: kubernetes.io/hostname\n\né€™å€‹çš„ç”¨é€”ï¼Œä¸»è¦æ˜¯è®“podæ±ºå®šè¦è·Ÿå“ªå€‹æœå‹™åœ¨ä¸€èµ·ï¼Œæˆ–ä¸åœ¨ä¸€èµ·ã€‚\nå…¶ä¸­æ¯”è¼ƒé‡è¦çš„åƒæ•¸ï¼Œ\nåè¦ªå’Œæ€§èˆ‡è¦ªå’Œæ€§\n\npodAntiAffinity\npodAffinity\n\nå‰è€…æ˜¯åè¦ªå’Œæ€§ï¼Œä¸è¦è·Ÿå“ªå€‹æœå‹™åœ¨ä¸€èµ·\nå¾Œè€…æ˜¯è¦ªå’Œæ€§ï¼Œè¦è·Ÿå“ªå€‹æœå‹™åœ¨ä¸€èµ·\nå¿…è¦èˆ‡æœ€å¥½å¯ä»¥\n\nrequiredDuringSchedulingIgnoredDuringExecution\npreferredDuringSchedulingIgnoredDuringExecution\n\nå‰è€…æ˜¯ä¸€å®šè¦é”æˆä¸‹é¢çš„æ¢ä»¶ï¼Œ\nå¾Œè€…æ˜¯æœ€å¥½æ˜¯é”æˆé€™æ¨£çš„æ¢ä»¶ï¼Œä¸¦è¨­æˆæ¯”é‡åˆ†æ•¸\né¸æ“‡æ¢ä»¶\nrequiredDuringSchedulingIgnoredDuringExecution:\n- labelSelector:\nmatchExpressions:\n- key: app\noperator: In\nvalues:\n- gcp\ntopologyKey: kubernetes.io/hostname\n\npreferredDuringSchedulingIgnoredDuringExecution:\n- weight: 100\npodAffinityTerm:\nlabelSelector:\nmatchExpressions:\n- key: app\noperator: In\nvalues:\n- gcp\ntopologyKey: kubernetes.io/hostname\n\nå¤§è‡´ä¸Šçš„é‚è¼¯ä¸€æ¨£ï¼Œ\nä½†preferredDuringSchedulingIgnoredDuringExecution ï¼Œ\nå¿…é ˆåŠ ä¸ŠpodAffinityTerm ã€‚\nç°¡å–®èªªæ˜è¦å‰‡ï¼Œ\né¸æ“‡é€™å€‹æœå‹™è¦è·Ÿå“ªå€‹labelç•¶æ¯”è¼ƒå€¼ã€‚\nç„¶å¾Œï¼ŒtopologyKey æœ‰é»é¡ä¼¼SQL groupçš„æ¦‚å¿µï¼Œä½ è¦æ ¹æ“šå“ªå€‹ä¾†åˆ†ç¾¤ã€‚\nä¸Šé¢çš„ä¾‹å­æ˜¯æ ¹æ“š node nameä¾†å€åˆ†ï¼Œ\né‚„æœ‰æ ¹æ“šå€åŸŸ kind.zone ä¾†åˆ†ã€‚\nå¦‚æœæƒ³çŸ¥é“æœ‰å“ªäº›çš„è©±ï¼Œå¯ä»¥ä¸‹æŒ‡ä»¤çœ‹ä¸€ä¸‹ã€‚\nkubectl get nodes --show-labels\n\nä¸Šé¢æ˜¯ç°¡å–®çš„å¯«æ³•ï¼Œ\nè©³ç´°éç¨‹å¯ä»¥åƒè€ƒ çŸ½è°·ç‰›å¤§å¤§çš„æ–‡ç« ï¼Œé€£çµåœ¨ä¸‹æ–¹ã€‚\nref.\n\nçŸ½è°·ç‰›-è§£å¯† Assigning Pod To Nodes(ä¸‹)\nK8sæ–‡ä»¶-å°‡ Pod æŒ‡æ´¾çµ¦ç¯€é»\n[Kubernetes] Assigning Pods to Nodes",
		"tags": [ "note","âˆ"]
},

{
		"title": "214. Elastic APIå»ºç«‹ Index_template",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/214. Elastic APIå»ºç«‹ Index_template/",
		"content": "å‰è¨€\nå¹«åŒäº‹æ¸¬è©¦ä¸åŒLOGçš„åˆªé™¤æ™‚é–“ï¼Œ\næ¯æ¬¡è¦å»é»ä¸€é»åˆæ€•å¿˜è¨˜ï¼Œ\nå¼„å€‹APIäº†ï¼Œ\nä¸çŸ¥é“ä¹‹å¾Œèƒ½ä¸èƒ½åœ¨éƒ¨å±¬æ™‚ç›´æ¥æ›ä¸Šå»ï¼Œå†ç ”ç©¶çœ‹çœ‹ã€‚\né€™æ¬¡å°±å…ˆç°¡å–®å»ºç«‹å€‹ index templateè·Ÿlife cycleäº†\næ­£æ–‡\né¦–å…ˆè¦å…ˆç¢ºå®šä½ çš„filebeatæœ‰å°‡è³‡æ–™ä¸Ÿåˆ°elasticè£¡é¢ï¼Œå¯åƒè€ƒ<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/57.filebeat è£œå……èªªæ˜/\">57.filebeat è£œå……èªªæ˜</a>ã€‚\nå†ä¾†æ ¹æ“šä½ å»ºçš„æ˜¯indicesé‚„æ˜¯datastreamï¼Œä¾†æ±ºå®šä½ çš„index_templateã€‚\nä¸‹é¢çš„æŒ‡ä»¤ï¼Œéƒ½åœ¨dev toolsä¸­åŸ·è¡Œã€‚\n\nAPIå¾Œé¢çš„æœ€å¾Œä¸€å€‹è·¯å¾‘ç‚ºåç¨±\n\nindices\n\nAPIå»ºç«‹ Index Lifecycle Policies\n\nPUT _ilm/policy/worker\n{\n&quot;policy&quot;: {\n&quot;_meta&quot;: {\n&quot;description&quot;: &quot;used for worker log&quot;,\n&quot;author&quot;: &quot;Ezio&quot;,\n&quot;project&quot;: {\n&quot;name&quot;: &quot;srs&quot;,\n&quot;department&quot;: &quot;lerouge&quot;\n}\n},\n&quot;phases&quot;: {\n&quot;hot&quot;: {\n&quot;min_age&quot;: &quot;0ms&quot;,\n&quot;actions&quot;: {\n&quot;set_priority&quot;: {\n&quot;priority&quot;: 100\n},\n&quot;rollover&quot;: {\n&quot;max_age&quot;: &quot;3d&quot;,\n&quot;max_primary_shard_size&quot;: &quot;50gb&quot;\n}\n}\n},\n&quot;delete&quot;: {\n&quot;min_age&quot;: &quot;3d&quot;,\n&quot;actions&quot;: {\n&quot;delete&quot;: {\n&quot;delete_searchable_snapshot&quot;: true\n}\n}\n}\n}\n}\n}\n\nå»ºç«‹ index_template\n\nPUT _index_template/worker\n{\n&quot;index_patterns&quot; : [&quot;worker-*&quot;],\n&quot;template&quot;: {\n&quot;settings&quot;: {\n&quot;index&quot;: {\n&quot;lifecycle&quot;: {\n&quot;name&quot;: &quot;videoworker&quot;\n}\n}\n}\n},\n&quot;composed_of&quot;: [&quot;ecs@mappings&quot;, &quot;logs@mappings&quot;,&quot;logs@settings&quot;],\n&quot;priority&quot; : 200,\n&quot;version&quot;: 1,\n&quot;_meta&quot;: {\n&quot;description&quot;: &quot;test by Ezio&quot;,\n&quot;latest_modify_date&quot;: &quot;2024-05-28&quot;\n}\n}\n\næª¢æŸ¥ Index Lifecycle Policies åŠ index template\n\nGET _ilm/policy/worker # Index Lifecycle Policies\nGET _index_template/worker # index template\n\nref.\n\nCreate or update lifecycle policy API\nIndex templates\n\ndata stream\n\nå»ºç«‹ index template\nèˆ‡ä¸Šé¢çš„å·®ç•°é»åœ¨æ–¼ï¼Œæœ‰æ²’æœ‰å¢åŠ data_streamèˆ‡ template.lifecycle.data_retention\n\nPUT _index_template/videowork\n{\n&quot;index_patterns&quot; : [&quot;videoworker-*&quot;],\n&quot;template&quot;: {\n&quot;lifecycle&quot;: {\n&quot;data_retention&quot;: &quot;3d&quot;\n}\n},\n&quot;data_stream&quot;: { },\n&quot;composed_of&quot;: [&quot;ecs@mappings&quot;, &quot;logs@mappings&quot;,&quot;logs@settings&quot;],\n&quot;priority&quot; : 200,\n&quot;version&quot;: 1,\n&quot;_meta&quot;: {\n&quot;description&quot;: &quot;test by Ezio&quot;,\n&quot;latest_modify_date&quot;: &quot;2024-05-28&quot;\n}\n}\n\nref. Create a data stream with a lifecycle\nindices vs data stream\nä¸‹é¢è³‡æ–™æ˜¯ç”¨gpt-4oæä¾›çš„\n\nç‰¹æ€§\nIndices\nData Streams\n\nç®¡ç†æ–¹å¼\næ‰‹å‹•ç®¡ç†æˆ–ä½¿ç”¨ ILM\nè‡ªå‹•ç®¡ç†æ»¾å‹•å’Œç´¢å¼•\n\næ•¸æ“šå­˜å„²\né©åˆä»»æ„çµæ§‹æ•¸æ“š\nå°ˆç‚ºæ™‚é–“åºåˆ—æ•¸æ“šè¨­è¨ˆ\n\nå°æ‡‰çµ„æ…‹\næ¯å€‹ç´¢å¼•ç¨ç«‹çµ„æ…‹\né€éç´¢å¼•ç¯„æœ¬è‡ªå‹•çµ„æ…‹\n\næ»¾å‹•ç­–ç•¥\néœ€æ‰‹å‹•æˆ– ILM çµ„æ…‹\nè‡ªå‹•æ»¾å‹•\n\næŸ¥è©¢æ€§èƒ½\nåŸºæ–¼æ¨™æº–ç´¢å¼•\nå„ªåŒ–æ™‚é–“åºåˆ—æ•¸æ“šæŸ¥è©¢\n\nç´¢å¼•å‰µå»º\nä½¿ç”¨ PUT /index_name\né€éç´¢å¼•ç¯„æœ¬è‡ªå‹•å‰µå»º\n\né©ç”¨æ•¸æ“š\nä»»æ„æ•¸æ“šï¼ŒåŒ…æ‹¬éæ™‚é–“åºåˆ—æ•¸æ“š\nä¸»è¦ç‚ºæ—¥èªŒã€æŒ‡æ¨™ç­‰æ™‚é–“åºåˆ—æ•¸æ“š\n\nå­¸ç¿’æ›²ç·š\néœ€è¦å­¸ç¿’å’Œç®¡ç†ç´¢å¼•çš„ç´°ç¯€\nç°¡åŒ–ï¼Œç‰¹åˆ¥é©åˆå¤§è¦æ¨¡æ™‚é–“åºåˆ—æ•¸æ“š\n\nç”Ÿå‘½é€±æœŸç®¡ç†\néœ€è¦çµ„æ…‹ ILM\nè‡ªå‹•ç®¡ç†\n\nå­˜å„²æ•ˆç‡\nä¾è³´æ‰‹å‹•å„ªåŒ–\nç‚ºæ™‚é–“åºåˆ—æ•¸æ“šè¨­è¨ˆï¼Œå…·å‚™å­˜å„²æ•ˆç‡\n\nå„ªç¼ºé»\n\né …ç›®\nIndices\nData Streams\n\nå„ªé»\n- æ›´éˆæ´»ï¼Œå¯ç”¨æ–¼ä»»æ„é¡å‹æ•¸æ“š\n- è‡ªå‹•ç®¡ç†æ»¾å‹•å’Œç´¢å¼•\n\n- å®Œå…¨è‡ªå®šç¾©å°æ‡‰å’Œè¨­ç½®\n- ç°¡åŒ–çµ„æ…‹å’Œç®¡ç†\n\n- æ”¯æ´è¤‡é›œçš„æŸ¥è©¢å’Œèšåˆ\n- å„ªåŒ–æ™‚é–“åºåˆ—æ•¸æ“šæŸ¥è©¢å’Œå­˜å„²\n\n- é©åˆå¤§è¦æ¨¡æ—¥èªŒå’ŒæŒ‡æ¨™æ•¸æ“š\n\nç¼ºé»\n- éœ€æ‰‹å‹•ç®¡ç†ç´¢å¼•å’Œæ»¾å‹•ç­–ç•¥\n- ä¸»è¦é‡å°æ™‚é–“åºåˆ—æ•¸æ“š\n\n- çµ„æ…‹å’Œç®¡ç†ç›¸å°è¤‡é›œ\n- ä¸é©åˆéæ™‚é–“åºåˆ—æ•¸æ“š\n\n- éœ€è¦çµ„æ…‹å’Œç¶­è­· ILM\n- å°æ‡‰å’Œè¨­ç½®ç›¸å°ä¸éˆæ´»\n\næ¨è–¦ä½¿ç”¨å ´æ™¯\n\nä½¿ç”¨å ´æ™¯\nIndices\nData Streams\n\næ—¥èªŒç®¡ç†\nå¯ä»¥ä½¿ç”¨ï¼Œä½†éœ€è¦æ‰‹å‹•çµ„æ…‹æ»¾å‹•å’Œç®¡ç†\næœ€ä½³é¸æ“‡ï¼Œè‡ªå‹•ç®¡ç†ï¼Œç°¡åŒ–é‹ç¶­\n\næ‡‰ç”¨ç›£æ§\nå¯ä»¥ä½¿ç”¨ï¼Œä½†éœ€è‡ªå®šç¾©ç´¢å¼•å’Œå°æ‡‰\næœ€ä½³é¸æ“‡ï¼Œå°ˆç‚ºæ™‚é–“åºåˆ—æ•¸æ“šè¨­è¨ˆ\n\nå®šæœŸå ±è¡¨\né©åˆä»»ä½•é¡å‹å ±è¡¨\né©åˆæ™‚é–“åºåˆ—å ±è¡¨\n\næ­·å²æ•¸æ“šæŸ¥è©¢\næœ€ä½³é¸æ“‡ï¼Œå¯é‡å°å…·é«”éœ€æ±‚å„ªåŒ–æŸ¥è©¢\né©åˆåŸºæ–¼æ™‚é–“ç¯„åœçš„æ­·å²æ•¸æ“šæŸ¥è©¢\n\nè¤‡é›œæ•¸æ“šåˆ†æ\næœ€ä½³é¸æ“‡ï¼Œæ”¯æ´éˆæ´»çš„å°æ‡‰å’ŒæŸ¥è©¢\né©åˆæ™‚é–“åºåˆ—æ•¸æ“šçš„å¿«é€ŸæŸ¥è©¢å’Œèšåˆ\n\néæ™‚é–“åºåˆ—æ•¸æ“šå­˜å„²\næœ€ä½³é¸æ“‡ï¼Œé©åˆæ‰€æœ‰é¡å‹æ•¸æ“š\nä¸æ¨è–¦ï¼Œåƒ…é©åˆæ™‚é–“åºåˆ—æ•¸æ“š\n\nçµè«–\nå…¶å¯¦å¾APIä¾†çœ‹çš„è©±ï¼Œç›´æ¥ç”¨data streamæ¯”è¼ƒå¿«ï¼Œä¹Ÿæ¯”è¼ƒçœäº‹ã€‚\nåŠ ä¸Šç›®å‰ç”¨çš„æ˜¯ECKï¼Œ\næˆ‘æ ¹æœ¬æ²’å»è¨­è¨ˆ warm phase æˆ– cold phaseçš„ç¡¬ç¢Ÿã€‚\nref. ES çš„è¶…å‰ä½ˆç½² - Index Template",
		"tags": [ "note","ğŸ—’"]
},

{
		"title": "216. GKEæ›è¼‰ReadWrite Manyçš„PVC",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/216. GKEæ›è¼‰ReadWrite Manyçš„PVC/",
		"content": "ç·£ç”±\nGKEä¸Šé¢çš„pvcæ˜¯ä¸æ”¯æ´ReadWrite Manyçš„ã€‚\nç”¨é€”æ˜¯å…¨éƒ¨çš„Logå¯«åˆ°åŒä¸€å€‹è³‡æ–™å¤¾ï¼Œ\nç„¶å¾Œå†ç”¨filebeatæ“·å–åˆ°EFKã€‚\nä¸»é¡Œ\né€™é‚Šè¦åšçš„æ˜¯è‡ªå»ºä¸€å€‹NFS serverã€‚\ndeployè£¡é¢ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨GCEä¸Šé¢å»ºç«‹ä¸€å€‹ç¡¬ç¢Ÿï¼Œ\nç„¶å¾Œåœ¨deployä¸Šé¢æŒ‡å®šã€‚å°±æ˜¯ä¸‹é¢é€™æ®µï¼Œ\né€™åŸæœ¬æ˜¯å‰ä»»çš„æ–¹å¼ï¼Œæˆ‘ç›´æ¥æ”¹æ‰äº†ã€‚\nç›´æ¥åœ¨ä¸€å€‹yamlè£¡é¢å…¨éƒ¨å¼„å¥½ã€‚\ngcePersistentDisk:\npdName: gke-log-nfs-disk\nfsType: ext4\n\nNFS-server.yaml\n---\napiVersion: v1\nkind: Namespace\nmetadata:\nname: nfs\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\nname: nfs-pvc\nnamespace: nfs\nspec:\nstorageClassName: &quot;standard&quot;\nresources:\nrequests:\nstorage: 100Gi\naccessModes:\n- ReadWriteOnce\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: nfs-server\nnamespace: nfs\nspec:\nreplicas: 1\nselector:\nmatchLabels:\nrole: nfs-server\ntemplate:\nmetadata:\nlabels:\nrole: nfs-server\nspec:\ncontainers:\n- name: nfs-server\nimage: gcr.io/google_containers/volume-nfs:0.8\nports:\n- name: nfs\ncontainerPort: 2049\n- name: mountd\ncontainerPort: 20048\n- name: rpcbind\ncontainerPort: 111\nsecurityContext:\nprivileged: true\nvolumeMounts:\n- mountPath: /exports\nname: nfs-pvc\nvolumes:\n- name: nfs-pvc\npersistentVolumeClaim:\nclaimName: nfs-pvc\n# gcePersistentDisk:\n# pdName: gke-log-nfs-disk\n# fsType: ext4\n---\napiVersion: v1\nkind: Service\nmetadata:\nname: nfs-server\nnamespace: nfs\nspec:\nports:\n- name: nfs\nport: 2049\n- name: mountd\nport: 20048\n- name: rpcbind\nport: 111\nselector:\nrole: nfs-server\n\nå†ä¾†æ˜¯æ›è¼‰ä¸€å€‹provisioner\nnfs-provisioner.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: nfs-client-provisioner\nnamespace: nfs\nlabels:\napp: nfs-client-provisioner\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: nfs-client-provisioner\nstrategy:\ntype: Recreate\ntemplate:\nmetadata:\nlabels:\napp: nfs-client-provisioner\nspec:\nserviceAccountName: nfs-client-provisioner\ncontainers:\n- name: nfs-client-provisioner\nimage: gcr.io/k8s-staging-sig-storage/nfs-subdir-external-provisioner:v4.0.2\n# image: registry.k8s.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2\nvolumeMounts:\n- name: nfs-client-root\nmountPath: /persistentvolumes\nenv:\n- name: PROVISIONER_NAME\nvalue: nfs-log\n- name: NFS_SERVER\nvalue: nfs-server.nfs.svc.cluster.local\n- name: NFS_PATH\nvalue: /\nvolumes:\n- name: nfs-client-root\nnfs:\nserver: nfs-server.nfs.svc.cluster.local\npath: /\n---\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\nname: nfs-log\nprovisioner: nfs-log\nparameters:\narchiveOnDelete: &quot;false&quot;\n\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\nname: nfs-client-provisioner-runner\nrules:\n- apiGroups: [&quot;&quot;]\nresources: [&quot;nodes&quot;]\nverbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;]\n- apiGroups: [&quot;&quot;]\nresources: [&quot;persistentvolumes&quot;]\nverbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;delete&quot;]\n- apiGroups: [&quot;&quot;]\nresources: [&quot;persistentvolumeclaims&quot;]\nverbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;update&quot;]\n- apiGroups: [&quot;storage.k8s.io&quot;]\nresources: [&quot;storageclasses&quot;]\nverbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;]\n- apiGroups: [&quot;&quot;]\nresources: [&quot;events&quot;]\nverbs: [&quot;create&quot;, &quot;update&quot;, &quot;patch&quot;]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\nname: run-nfs-client-provisioner\nsubjects:\n- kind: ServiceAccount\nname: nfs-client-provisioner\nnamespace: nfs\nroleRef:\nkind: ClusterRole\nname: nfs-client-provisioner-runner\napiGroup: rbac.authorization.k8s.io\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\nname: nfs-client-provisioner\nnamespace: nfs\n---\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\nname: leader-locking-nfs-client-provisioner\nnamespace: nfs\nrules:\n- apiGroups: [&quot;&quot;]\nresources: [&quot;endpoints&quot;]\nverbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;update&quot;, &quot;patch&quot;]\n---\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\nname: leader-locking-nfs-client-provisioner\nnamespace: nfs\nsubjects:\n- kind: ServiceAccount\nname: nfs-client-provisioner\nroleRef:\nkind: Role\nname: leader-locking-nfs-client-provisioner\napiGroup: rbac.authorization.k8s.io\n\nè¦ä½¿ç”¨çš„è©±ï¼Œ\nå»ºç«‹ä¸€å€‹pvc, storageClassNameæ”¹æˆä¸Šé¢å»ºç«‹çš„storageClass\nå…¶ä»–deployæ›è¼‰æ–¹å¼ï¼Œè·Ÿæ›pvcä¸€æ¨£ã€‚\n---\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\nname: logs-nfs-pvc\nnamespace: default\nspec:\naccessModes:\n- ReadWriteMany\nstorageClassName: nfs-log\nresources:\nrequests:\nstorage: 100Gi\n\nref.\n\nåœ¨GKEä¸Šä½¿ç”¨ReadWrite Manyçš„Disk\nnfs-subdir-external-provisioner",
		"tags": [ "note","âˆ"]
},

{
		"title": "217. iptables ç­†è¨˜",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/217. iptables ç­†è¨˜/",
		"content": "ç·£ç”±\nistioé‡æ–°è¤‡ç¿’æ¦‚å¿µçš„æ™‚å€™ï¼Œ\nåˆç¢°åˆ°äº†iptableï¼Œç„¶å¾Œï¼Œæˆ‘åˆå¿˜äº†ã€‚\næ²’æœ‰ç”¨è‡ªå·±ç†è§£éçš„ä½œæ³•ï¼Œ\næœç„¶å¾ˆå®¹æ˜“å¿˜è¨˜å•Šã€‚\nä¸»é¡Œ\niptablesç°¡å–®èªªæ˜¯å€‹ç®¡é«˜é€Ÿå…¬è·¯å¤§é–€çš„ã€‚\nåŸºæœ¬æœ‰ä¸‰æ¢è·¯(chain)ï¼Œ\nåˆ†åˆ¥æ˜¯\n\nfilterï¼šé€™æ¢è·¯æœƒç›´æ¥åˆ°ç®¡é«˜é€Ÿå…¬è·¯å¤§é–€çš„ç®¡ç†å–®ä½å¤§æ¨“è£¡é¢ã€‚\nnatï¼šè¦å»é€™æ¢é«˜é€Ÿå…¬è·¯çš„å…¶ä»–åœ°æ–¹ï¼Œå°±å¾€é€™é‚Šã€‚\nmangleï¼šç‰¹æ¬Šé“è·¯ï¼Œæœ‰é«˜å®˜è¦éæ™‚ï¼Œå°±èµ°é€™æ¢ã€‚\n\né³¥å“¥çš„èªªæ˜ï¼š\n\nfilter (éæ¿¾å™¨)ï¼šä¸»è¦è·Ÿé€²å…¥ Linux æœ¬æ©Ÿçš„å°åŒ…æœ‰é—œï¼Œé€™å€‹æ˜¯é è¨­çš„ table å–”ï¼\n\nINPUTï¼šä¸»è¦èˆ‡æƒ³è¦é€²å…¥æˆ‘å€‘ Linux æœ¬æ©Ÿçš„å°åŒ…æœ‰é—œï¼›\nOUTPUTï¼šä¸»è¦èˆ‡æˆ‘å€‘ Linux æœ¬æ©Ÿæ‰€è¦é€å‡ºçš„å°åŒ…æœ‰é—œï¼›\nFORWARDï¼šé€™å€‹å’šå’šèˆ‡ Linux æœ¬æ©Ÿæ¯”è¼ƒæ²’æœ‰é—œä¿‚ï¼Œ ä»–å¯ä»¥ã€è½‰éå°åŒ…ã€åˆ°å¾Œç«¯çš„é›»è…¦ä¸­ï¼Œèˆ‡ä¸‹åˆ— nat table ç›¸é—œæ€§è¼ƒé«˜ã€‚\n\nnat (ä½å€è½‰æ›)ï¼šæ˜¯ Network Address Translation çš„ç¸®å¯«ï¼Œ é€™å€‹è¡¨æ ¼ä¸»è¦åœ¨é€²è¡Œä¾†æºèˆ‡ç›®çš„ä¹‹ IP æˆ– port çš„è½‰æ›ï¼Œèˆ‡ Linux æœ¬æ©Ÿè¼ƒç„¡é—œï¼Œä¸»è¦èˆ‡ Linux ä¸»æ©Ÿå¾Œçš„å€åŸŸç¶²è·¯å…§é›»è…¦è¼ƒæœ‰ç›¸é—œã€‚\n\nPREROUTINGï¼šåœ¨é€²è¡Œè·¯ç”±åˆ¤æ–·ä¹‹å‰æ‰€è¦é€²è¡Œçš„è¦å‰‡(DNAT/REDIRECT)\nPOSTROUTINGï¼šåœ¨é€²è¡Œè·¯ç”±åˆ¤æ–·ä¹‹å¾Œæ‰€è¦é€²è¡Œçš„è¦å‰‡(SNAT/MASQUERADE)\nOUTPUTï¼š\n\nmangle (ç ´å£è€…)ï¼šé€™å€‹è¡¨æ ¼ä¸»è¦æ˜¯èˆ‡ç‰¹æ®Šçš„å°åŒ…çš„è·¯ç”±æ——æ¨™æœ‰é—œï¼Œ æ—©æœŸåƒ…æœ‰ PREROUTING åŠ OUTPUT éˆï¼Œä¸éå¾ kernel 2.4.18 ä¹‹å¾ŒåŠ å…¥äº† INPUT åŠ FORWARD éˆã€‚ ç”±æ–¼é€™å€‹è¡¨æ ¼èˆ‡ç‰¹æ®Šæ——æ¨™ç›¸é—œæ€§è¼ƒé«˜ï¼Œæ‰€ä»¥åƒå’±å€‘é€™ç¨®å–®ç´”çš„ç’°å¢ƒç•¶ä¸­ï¼Œè¼ƒå°‘ä½¿ç”¨ mangle é€™å€‹è¡¨æ ¼ã€‚\n\nref. iptables çš„è¡¨æ ¼ (table) èˆ‡éˆ (chain)\n\næ¯å€‹chainè£¡é¢éƒ½æœ‰è‡ªå·±ruleï¼Œ\nrule 1 æ˜¯å»å½°åŒ–ï¼Œ\nrule 2 æ˜¯å»å“¡æ—ï¼Œ\nrule 3æ˜¯å»å˜‰ç¾©ã€‚\nå¾å°ä¸­å—ä¸‹è¦å»å½°åŒ–çš„è©±ï¼Œrule 1 ç¬¦åˆå°±ç›´æ¥å»å½°åŒ–äº†ã€‚\nä½†å¦‚æœæ˜¯è¦å»å˜‰ç¾©ï¼Œå‰é¢ä¸ç¬¦åˆï¼Œå°±è·³éï¼Œç›´åˆ°rule 3åˆ¤æ–·ç¬¦åˆæ‰æœƒåŸ·è¡Œã€‚\nref. Istio ä¸­çš„ Sidecar æ³¨å…¥ã€é€æ˜æµé‡åŠ«æŒåŠæµé‡è·¯ç”±éç¨‹è©³è§£",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "219. Google Cloud Managed Service for Prometheus  è²»ç”¨",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/219. Google Cloud Managed Service for Prometheus  è²»ç”¨/",
		"content": "ç·£ç”±\nç”±æ–¼GKEé è¨­æƒ å•Ÿç”¨ Google Cloud Managed Service for Prometheusï¼Œ\nä¾†æ¯”è¼ƒä¸€ä¸‹ï¼Œçœ‹ä¹‹å¾Œæ˜¯ä¸æ˜¯èƒ½å¤ ä¸€å€‹ç¶²ç«™çœ‹åˆ°å…¨éƒ¨çš„åœ–è¡¨ã€‚\nä¸éä¹Ÿè¦å…ˆçœ‹ä¸‹åƒ¹æ ¼ï¼Œå¦‚æœå¤ªè²´ï¼Œé‚£ä¹Ÿåªèƒ½åˆ†é–‹äº†ã€‚\nä¸»é¡Œ\n2024/06/07\nåƒ¹æ ¼\n\n$0.06/ç™¾è¬å€‹æ¨£æœ¬â€ ï¼šæ³¨å…¥çš„å‰ 0-50 å„„å€‹æ¨£æœ¬â€ \n$0.048/ç™¾è¬æ¨£æœ¬ï¼šæ¥ä¸‹ä¾†çš„ 50-2500 å„„å€‹æ¨£æœ¬\n$0.036/ç™¾è¬æ¨£æœ¬ï¼šæ¥ä¸‹ä¾†æ³¨å…¥çš„ 250-5,000 å„„å€‹æ¨£æœ¬\næ³¨å…¥çš„æ¯ç™¾è¬å€‹æ¨£æœ¬ $0.024ï¼šè¶…é 5000 å„„å€‹æ¨£æœ¬\n\né€™æ•¸å­—ä»¥ç™¾è¬è¨ˆã€‚\nä¸€ä¸‹å­çœŸçš„ä¸çŸ¥é“è©²æ€éº¼ç®—ï¼Œ\né‚£å°±å…ˆç®—å‡º æ¯10ç§’ä¸€å€‹metricï¼Œé‚£ä¸€å€‹æœˆæœƒæœ‰å¤šå°‘è³‡æ–™ã€‚\nans: 259,200ç­†ã€‚æ‰€ä»¥ä¸€å€‹æœˆ $0.06USD\nåŠ æ¸›ç®—ä¸€ä¸‹50å„„å€‹æ¨£æœ¬ï¼Œè¦å¤šå°‘éŒ¢ã€‚\nans: $300 USD\nç¾åœ¨ä¾†ç®—ä¸€ä¸‹ï¼Œä¸€èˆ¬å»ºpvcè¦å¤šå°‘ï¼Œ\nå»ºç«‹ä¸€å€‹PVCï¼Œé è¨­ä½¿ç”¨ Balanced persistent diskã€‚\npvcé€šå¸¸æ›å€‹100Gï¼Œæ¯å€‹æœˆç´„$10 USDã€‚\n\nType\nPrice (monthly in USD)\n\nStandard provisioned space\n$0.04 per GiB\n\nSSD provisioned space\n$0.17 per GiB\n\nBalanced provisioned space\n$0.1 per GiB\n\nçµè«–\né€™åƒ¹æ ¼çœ‹èµ·ä¾†é‚„é —æœ‰å¸å¼•åŠ›çš„ï¼Œä¾†è©¦è©¦çœ‹å§ã€‚\næ—¥å¾Œå¦‚æœè¦å¾å¸³å–®çœ‹æœ‰å¤šå°‘ç­†è³‡æ–™çš„è©±ï¼Œ\nService -&gt; Cloud Monitoring\nSKUs -&gt; Prometheus Samples Ingested &amp; Monitoring API Requests\nref.\n\nCloud Monitoring åƒ¹æ ¼æ‘˜è¦\nè²»ç”¨æ§åˆ¶å’Œæ­¸å› \nç¡¬ç¢Ÿåƒ¹æ ¼",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "220. winSWå°‡ç¨‹å¼è®Šæˆæœå‹™çš„å¥½æ±è¥¿",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/220. windowså°‡ç¨‹å¼è®Šæˆæœå‹™çš„å¥½æ±è¥¿-winSW/",
		"content": "ç·£ç”±\næœ¬ä¾†åœ¨Linuxä¸Šé¢è·‘çš„dockerç’°å¢ƒï¼Œ\né€™æ¬¡åœ¨å®¢æˆ¶é‚£é‚Šçªç„¶è¦è®Šæˆç”¨windowsï¼Œ\néå¸¸å¥½ï¼Œä¹‹å‰å¼„çš„æ¶æ§‹å®Œå…¨ä¸ä¸€æ¨£ã€‚\nä¸»é¡Œ\nä»Šå¤©æœ‰ä¸€å€‹ç¨‹å¼ï¼Œä½ æƒ³è®“ä»–é–‹æ©Ÿæ™‚è‡ªå·±å•Ÿå‹•ï¼Œ\nä¸æ˜¯åˆ°msconfigè¨­å®šé–‹æ©Ÿå•Ÿå‹•ï¼Œå°±æ˜¯å¼„æˆæœå‹™ã€‚\nä½†é–‹æ©Ÿå•Ÿå‹•ï¼Œå¦‚æœæ²’æœ‰é–‹æ©Ÿå°±æ²’ç”¨äº†ï¼Œ\næ‰€ä»¥å¼„æˆæœå‹™ï¼Œä¸€èˆ¬æ˜¯æœ€ç©©å®šçš„æ–¹å¼ã€‚\nç”¨nginxç‚ºç¯„ä¾‹èªªæ˜ï¼Œ\næˆ‘ä¹Ÿæ˜¯æ‰¾nginxå•Ÿå‹•æ™‚ï¼Œæ‰ç™¼ç¾é€™å€‹å¥½æ±è¥¿ã€‚\n\né¦–å…ˆï¼Œå…ˆä¸‹è¼‰winSWï¼Œ\nä¸‹è¼‰å›ä¾†çš„ç¨‹å¼ï¼Œæ”¹åæˆnginx-server.exeã€‚\n\nåŒä¸€å±¤ç›®éŒ„ä¸‹ï¼Œå»ºç«‹nginx-server.xml\n\n&lt;!-- nginx-service.xml --&gt;\n&lt;service&gt;\n&lt;id&gt;nginx&lt;/id&gt;\n&lt;name&gt;nginx&lt;/name&gt;\n&lt;description&gt;nginx&lt;/description&gt;\n&lt;logpath&gt;C:\\nginx-1.26.1\\server-logs\\&lt;/logpath&gt;\n&lt;logmode&gt;roll&lt;/logmode&gt;\n&lt;depend&gt;&lt;/depend&gt;\n&lt;executable&gt;C:\\nginx-1.26.1\\nginx.exe&lt;/executable&gt;\n&lt;stopexecutable&gt;C:\\nginx-1.26.1\\nginx.exe -s stop&lt;/stopexecutable&gt;\n&lt;/service&gt;\n\nå®‰è£\ncommandåŸ·è¡Œ nginx-server.exe install\nå¦‚æœè¦åˆªé™¤å‰‡æ˜¯ nginx-server.exe uninstall\n\né™¤éŒ¯\nnginx.confå¦‚æœå¯«éŒ¯ï¼Œå°è‡´æœå‹™ç„¡æ³•å•Ÿå‹•æ™‚ï¼Œ\nå¯åˆ°ä¸Šé¢çš„&lt;logpaht&gt;ä½ç½®æŸ¥çœ‹éŒ¯èª¤è¨Šæ¯ï¼Œ\nç…§ä¸Šé¢çš„ç¯„ä¾‹ï¼Œæ˜¯C:\\nginx-1.26.1\\server-logs\\ã€‚\nä»¥ä¸Šæ˜¯æœ€ç°¡å–®çš„ç”¨æ³•ã€‚\nref.\n\ngithubæ–‡ä»¶\nWinSW",
		"tags": [ "note","ğŸ–¼"]
},

{
		"title": "L7mp stunnerç›£æ§",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/221. L7mp stunnerç›£æ§/",
		"content": "Why\næœ‰äººæäº†ä¸€å€‹webRTC for k8sç”¨çš„å³æ™‚åª’é«”ä¸²æµæ–¹æ¡ˆï¼Œ\nç„¶å¾Œæˆ‘è¦ä¾†æ¥ç›£æ§äº†ã€‚\nL7mp\nSolution\nåƒè€ƒæ–‡ä»¶\n\nåŠ  enableMetricsEndpoint åƒæ•¸åŠ åˆ°Dataplaneè£¡é¢\n\n...\nspec:\nargs:\n- '-w'\n- '--udp-thread-num=16'\ncommand:\n- stunnerd\nenableMetricsEndpoint: true\nhostNetwork: false\nimage: docker.io/l7mp/stunnerd:0.18.0\nimagePullPolicy: Always\nreplicas: 1\nresources:\nlimits:\ncpu: 2\nmemory: 512Mi\nrequests:\ncpu: 500m\nmemory: 128Mi\nterminationGracePeriodSeconds: 3600\n\nå¼„å€‹æš«æ™‚çš„podæ¸¬è©¦çœ‹çœ‹metricsæœ‰æ²’æœ‰è³‡æ–™\n\nkubectl run alpine-pod -n istio-system --image=alpine --restart=Never -- /bin/sleep 600\n\nå…ˆå–å¾—stunnerçš„pod ipï¼Œå†ä¾†å°±çœ‹æœ‰æ²’æœ‰è³‡æ–™äº†\ncurl http://192.168.1.25:8080/metrics\n\næœ‰è³‡æ–™å¾Œå†ä¾†ä¸‹ä¸€æ­¥ã€‚\né€™é‚Šè¦æ³¨æ„ä¸€ä¸‹ï¼Œå‰›é–‹å¾Œï¼Œstunneré–‹é ­çš„æŒ‡æ¨™é€šé€šæ‰¾ä¸åˆ°ï¼Œ\nåƒæ˜¯stunner_listener_connections_totalã€stunner_listener_bytes_total...ç­‰ã€‚\næˆ‘æ”¾äº†ä¸€é™£å­(ä¸€å…©å€‹å°æ™‚ï¼Ÿ)ï¼Œå°±çªç„¶è·‘å‡ºä¾†äº†ï¼Œ\næˆ‘ä¸ç¢ºå®šç‚ºä»€éº¼ï¼Œç­‰ä¹‹å¾Œå†æ¸¬è©¦çœ‹çœ‹ã€‚\n\nprometheus è¨­å®š discover\nè©³ç´°èªªæ˜ï¼Œåƒè€ƒ<a class=\"internal-link is-unresolved\" href=\"/404\">209. k8sä¸­srsçš„å„å€‹pod metricså–å¾—</a>\n\nscrape_configs:\n- job_name: 'ome'\nscrape_interval: 10s\nkubernetes_sd_configs:\n- role: pod\nrelabel_configs:\n- source_labels: [__meta_kubernetes_pod_name]\naction: keep\nregex: tcp-gateway.*\n- source_labels: [__meta_kubernetes_pod_container_port_name]\naction: replace\ntarget_label: portname\nreplacement: 8080\n\nå»ºç«‹Grafana\n\n{\n&quot;annotations&quot;: {\n&quot;list&quot;: [\n{\n&quot;builtIn&quot;: 1,\n&quot;datasource&quot;: {\n&quot;type&quot;: &quot;grafana&quot;,\n&quot;uid&quot;: &quot;-- Grafana --&quot;\n},\n&quot;enable&quot;: true,\n&quot;hide&quot;: true,\n&quot;iconColor&quot;: &quot;rgba(0, 211, 255, 1)&quot;,\n&quot;name&quot;: &quot;Annotations &amp; Alerts&quot;,\n&quot;type&quot;: &quot;dashboard&quot;\n}\n]\n},\n&quot;editable&quot;: true,\n&quot;fiscalYearStartMonth&quot;: 0,\n&quot;graphTooltip&quot;: 0,\n&quot;id&quot;: 14,\n&quot;links&quot;: [],\n&quot;liveNow&quot;: false,\n&quot;panels&quot;: [\n{\n&quot;datasource&quot;: {\n&quot;type&quot;: &quot;prometheus&quot;,\n&quot;uid&quot;: &quot;PBFA97CFB590B2093&quot;\n},\n&quot;fieldConfig&quot;: {\n&quot;defaults&quot;: {\n&quot;color&quot;: {\n&quot;mode&quot;: &quot;palette-classic&quot;\n},\n&quot;custom&quot;: {\n&quot;axisCenteredZero&quot;: false,\n&quot;axisColorMode&quot;: &quot;text&quot;,\n&quot;axisLabel&quot;: &quot;&quot;,\n&quot;axisPlacement&quot;: &quot;auto&quot;,\n&quot;barAlignment&quot;: 0,\n&quot;drawStyle&quot;: &quot;line&quot;,\n&quot;fillOpacity&quot;: 0,\n&quot;gradientMode&quot;: &quot;none&quot;,\n&quot;hideFrom&quot;: {\n&quot;legend&quot;: false,\n&quot;tooltip&quot;: false,\n&quot;viz&quot;: false\n},\n&quot;lineInterpolation&quot;: &quot;linear&quot;,\n&quot;lineWidth&quot;: 1,\n&quot;pointSize&quot;: 5,\n&quot;scaleDistribution&quot;: {\n&quot;type&quot;: &quot;linear&quot;\n},\n&quot;showPoints&quot;: &quot;auto&quot;,\n&quot;spanNulls&quot;: false,\n&quot;stacking&quot;: {\n&quot;group&quot;: &quot;A&quot;,\n&quot;mode&quot;: &quot;none&quot;\n},\n&quot;thresholdsStyle&quot;: {\n&quot;mode&quot;: &quot;off&quot;\n}\n},\n&quot;mappings&quot;: [],\n&quot;thresholds&quot;: {\n&quot;mode&quot;: &quot;absolute&quot;,\n&quot;steps&quot;: [\n{\n&quot;color&quot;: &quot;green&quot;,\n&quot;value&quot;: null\n},\n{\n&quot;color&quot;: &quot;red&quot;,\n&quot;value&quot;: 80\n}\n]\n}\n},\n&quot;overrides&quot;: []\n},\n&quot;gridPos&quot;: {\n&quot;h&quot;: 8,\n&quot;w&quot;: 12,\n&quot;x&quot;: 0,\n&quot;y&quot;: 0\n},\n&quot;id&quot;: 3,\n&quot;options&quot;: {\n&quot;legend&quot;: {\n&quot;calcs&quot;: [],\n&quot;displayMode&quot;: &quot;list&quot;,\n&quot;placement&quot;: &quot;bottom&quot;,\n&quot;showLegend&quot;: true\n},\n&quot;tooltip&quot;: {\n&quot;mode&quot;: &quot;single&quot;,\n&quot;sort&quot;: &quot;none&quot;\n}\n},\n&quot;targets&quot;: [\n{\n&quot;datasource&quot;: {\n&quot;type&quot;: &quot;prometheus&quot;,\n&quot;uid&quot;: &quot;PBFA97CFB590B2093&quot;\n},\n&quot;editorMode&quot;: &quot;code&quot;,\n&quot;expr&quot;: &quot;stunner_listener_connections&quot;,\n&quot;legendFormat&quot;: &quot;__auto&quot;,\n&quot;range&quot;: true,\n&quot;refId&quot;: &quot;A&quot;\n}\n],\n&quot;title&quot;: &quot;stunner_listener_connections&quot;,\n&quot;type&quot;: &quot;timeseries&quot;\n},\n{\n&quot;datasource&quot;: {\n&quot;type&quot;: &quot;prometheus&quot;,\n&quot;uid&quot;: &quot;PBFA97CFB590B2093&quot;\n},\n&quot;fieldConfig&quot;: {\n&quot;defaults&quot;: {\n&quot;color&quot;: {\n&quot;mode&quot;: &quot;palette-classic&quot;\n},\n&quot;custom&quot;: {\n&quot;axisCenteredZero&quot;: false,\n&quot;axisColorMode&quot;: &quot;text&quot;,\n&quot;axisLabel&quot;: &quot;&quot;,\n&quot;axisPlacement&quot;: &quot;auto&quot;,\n&quot;barAlignment&quot;: 0,\n&quot;drawStyle&quot;: &quot;line&quot;,\n&quot;fillOpacity&quot;: 0,\n&quot;gradientMode&quot;: &quot;none&quot;,\n&quot;hideFrom&quot;: {\n&quot;legend&quot;: false,\n&quot;tooltip&quot;: false,\n&quot;viz&quot;: false\n},\n&quot;lineInterpolation&quot;: &quot;linear&quot;,\n&quot;lineWidth&quot;: 1,\n&quot;pointSize&quot;: 5,\n&quot;scaleDistribution&quot;: {\n&quot;type&quot;: &quot;linear&quot;\n},\n&quot;showPoints&quot;: &quot;auto&quot;,\n&quot;spanNulls&quot;: false,\n&quot;stacking&quot;: {\n&quot;group&quot;: &quot;A&quot;,\n&quot;mode&quot;: &quot;none&quot;\n},\n&quot;thresholdsStyle&quot;: {\n&quot;mode&quot;: &quot;off&quot;\n}\n},\n&quot;mappings&quot;: [],\n&quot;thresholds&quot;: {\n&quot;mode&quot;: &quot;absolute&quot;,\n&quot;steps&quot;: [\n{\n&quot;color&quot;: &quot;green&quot;,\n&quot;value&quot;: null\n},\n{\n&quot;color&quot;: &quot;red&quot;,\n&quot;value&quot;: 80\n}\n]\n}\n},\n&quot;overrides&quot;: [\n{\n&quot;matcher&quot;: {\n&quot;id&quot;: &quot;byName&quot;,\n&quot;options&quot;: &quot;{__name__=\\&quot;stunner_listener_connections_total\\&quot;, instance=\\&quot;192.168.58.102:8080\\&quot;, job=\\&quot;ome\\&quot;, name=\\&quot;stunner/tcp-gateway/tcp-listener\\&quot;, portname=\\&quot;8080\\&quot;}&quot;\n},\n&quot;properties&quot;: [\n{\n&quot;id&quot;: &quot;color&quot;,\n&quot;value&quot;: {\n&quot;fixedColor&quot;: &quot;dark-yellow&quot;,\n&quot;mode&quot;: &quot;fixed&quot;\n}\n}\n]\n}\n]\n},\n&quot;gridPos&quot;: {\n&quot;h&quot;: 8,\n&quot;w&quot;: 12,\n&quot;x&quot;: 12,\n&quot;y&quot;: 0\n},\n&quot;id&quot;: 1,\n&quot;options&quot;: {\n&quot;legend&quot;: {\n&quot;calcs&quot;: [],\n&quot;displayMode&quot;: &quot;list&quot;,\n&quot;placement&quot;: &quot;bottom&quot;,\n&quot;showLegend&quot;: true\n},\n&quot;tooltip&quot;: {\n&quot;mode&quot;: &quot;single&quot;,\n&quot;sort&quot;: &quot;none&quot;\n}\n},\n&quot;targets&quot;: [\n{\n&quot;datasource&quot;: {\n&quot;type&quot;: &quot;prometheus&quot;,\n&quot;uid&quot;: &quot;PBFA97CFB590B2093&quot;\n},\n&quot;editorMode&quot;: &quot;code&quot;,\n&quot;expr&quot;: &quot;rate(stunner_listener_connections_total[1m])&quot;,\n&quot;legendFormat&quot;: &quot;__auto&quot;,\n&quot;range&quot;: true,\n&quot;refId&quot;: &quot;A&quot;\n}\n],\n&quot;title&quot;: &quot;listener_connections_total&quot;,\n&quot;type&quot;: &quot;timeseries&quot;\n},\n{\n&quot;datasource&quot;: {\n&quot;type&quot;: &quot;prometheus&quot;,\n&quot;uid&quot;: &quot;PBFA97CFB590B2093&quot;\n},\n&quot;description&quot;: &quot;ç›£è½å™¨ä¸Šç™¼é€æˆ–æ¥æ”¶çš„å­—ç¯€ç¸½æ•¸ã€‚&quot;,\n&quot;fieldConfig&quot;: {\n&quot;defaults&quot;: {\n&quot;color&quot;: {\n&quot;mode&quot;: &quot;palette-classic&quot;\n},\n&quot;custom&quot;: {\n&quot;axisCenteredZero&quot;: false,\n&quot;axisColorMode&quot;: &quot;text&quot;,\n&quot;axisLabel&quot;: &quot;&quot;,\n&quot;axisPlacement&quot;: &quot;auto&quot;,\n&quot;barAlignment&quot;: 0,\n&quot;drawStyle&quot;: &quot;line&quot;,\n&quot;fillOpacity&quot;: 0,\n&quot;gradientMode&quot;: &quot;none&quot;,\n&quot;hideFrom&quot;: {\n&quot;legend&quot;: false,\n&quot;tooltip&quot;: false,\n&quot;viz&quot;: false\n},\n&quot;lineInterpolation&quot;: &quot;linear&quot;,\n&quot;lineWidth&quot;: 1,\n&quot;pointSize&quot;: 5,\n&quot;scaleDistribution&quot;: {\n&quot;type&quot;: &quot;linear&quot;\n},\n&quot;showPoints&quot;: &quot;auto&quot;,\n&quot;spanNulls&quot;: false,\n&quot;stacking&quot;: {\n&quot;group&quot;: &quot;A&quot;,\n&quot;mode&quot;: &quot;none&quot;\n},\n&quot;thresholdsStyle&quot;: {\n&quot;mode&quot;: &quot;off&quot;\n}\n},\n&quot;mappings&quot;: [],\n&quot;thresholds&quot;: {\n&quot;mode&quot;: &quot;absolute&quot;,\n&quot;steps&quot;: [\n{\n&quot;color&quot;: &quot;green&quot;,\n&quot;value&quot;: null\n},\n{\n&quot;color&quot;: &quot;red&quot;,\n&quot;value&quot;: 80\n}\n]\n},\n&quot;unit&quot;: &quot;bytes&quot;\n},\n&quot;overrides&quot;: [\n{\n&quot;matcher&quot;: {\n&quot;id&quot;: &quot;byName&quot;,\n&quot;options&quot;: &quot;{__name__=\\&quot;stunner_listener_bytes_total\\&quot;, direction=\\&quot;rx\\&quot;, instance=\\&quot;192.168.58.102:8080\\&quot;, job=\\&quot;ome\\&quot;, name=\\&quot;stunner/tcp-gateway/tcp-listener\\&quot;, portname=\\&quot;8080\\&quot;}&quot;\n},\n&quot;properties&quot;: [\n{\n&quot;id&quot;: &quot;color&quot;,\n&quot;value&quot;: {\n&quot;fixedColor&quot;: &quot;purple&quot;,\n&quot;mode&quot;: &quot;fixed&quot;\n}\n}\n]\n},\n{\n&quot;matcher&quot;: {\n&quot;id&quot;: &quot;byName&quot;,\n&quot;options&quot;: &quot;rx&quot;\n},\n&quot;properties&quot;: [\n{\n&quot;id&quot;: &quot;color&quot;,\n&quot;value&quot;: {\n&quot;fixedColor&quot;: &quot;dark-red&quot;,\n&quot;mode&quot;: &quot;fixed&quot;\n}\n}\n]\n}\n]\n},\n&quot;gridPos&quot;: {\n&quot;h&quot;: 9,\n&quot;w&quot;: 24,\n&quot;x&quot;: 0,\n&quot;y&quot;: 8\n},\n&quot;id&quot;: 2,\n&quot;options&quot;: {\n&quot;legend&quot;: {\n&quot;calcs&quot;: [],\n&quot;displayMode&quot;: &quot;list&quot;,\n&quot;placement&quot;: &quot;bottom&quot;,\n&quot;showLegend&quot;: true\n},\n&quot;tooltip&quot;: {\n&quot;mode&quot;: &quot;single&quot;,\n&quot;sort&quot;: &quot;none&quot;\n}\n},\n&quot;targets&quot;: [\n{\n&quot;datasource&quot;: {\n&quot;type&quot;: &quot;prometheus&quot;,\n&quot;uid&quot;: &quot;PBFA97CFB590B2093&quot;\n},\n&quot;editorMode&quot;: &quot;code&quot;,\n&quot;expr&quot;: &quot;sum(irate(stunner_listener_bytes_total[1m])) by (direction)&quot;,\n&quot;hide&quot;: false,\n&quot;legendFormat&quot;: &quot;__auto&quot;,\n&quot;range&quot;: true,\n&quot;refId&quot;: &quot;A&quot;\n}\n],\n&quot;title&quot;: &quot;stunner_listener_bytes_total&quot;,\n&quot;type&quot;: &quot;timeseries&quot;\n},\n{\n&quot;datasource&quot;: {\n&quot;type&quot;: &quot;prometheus&quot;,\n&quot;uid&quot;: &quot;PBFA97CFB590B2093&quot;\n},\n&quot;description&quot;: &quot;ç™¼é€åˆ°å¾Œç«¯æˆ–å¾å¾Œç«¯æ¥æ”¶çš„å­—ç¯€ç¸½æ•¸ã€‚&quot;,\n&quot;fieldConfig&quot;: {\n&quot;defaults&quot;: {\n&quot;color&quot;: {\n&quot;mode&quot;: &quot;palette-classic&quot;\n},\n&quot;custom&quot;: {\n&quot;axisCenteredZero&quot;: false,\n&quot;axisColorMode&quot;: &quot;text&quot;,\n&quot;axisLabel&quot;: &quot;&quot;,\n&quot;axisPlacement&quot;: &quot;auto&quot;,\n&quot;barAlignment&quot;: 0,\n&quot;drawStyle&quot;: &quot;line&quot;,\n&quot;fillOpacity&quot;: 0,\n&quot;gradientMode&quot;: &quot;none&quot;,\n&quot;hideFrom&quot;: {\n&quot;legend&quot;: false,\n&quot;tooltip&quot;: false,\n&quot;viz&quot;: false\n},\n&quot;lineInterpolation&quot;: &quot;linear&quot;,\n&quot;lineWidth&quot;: 1,\n&quot;pointSize&quot;: 5,\n&quot;scaleDistribution&quot;: {\n&quot;type&quot;: &quot;linear&quot;\n},\n&quot;showPoints&quot;: &quot;auto&quot;,\n&quot;spanNulls&quot;: false,\n&quot;stacking&quot;: {\n&quot;group&quot;: &quot;A&quot;,\n&quot;mode&quot;: &quot;none&quot;\n},\n&quot;thresholdsStyle&quot;: {\n&quot;mode&quot;: &quot;off&quot;\n}\n},\n&quot;mappings&quot;: [],\n&quot;thresholds&quot;: {\n&quot;mode&quot;: &quot;absolute&quot;,\n&quot;steps&quot;: [\n{\n&quot;color&quot;: &quot;green&quot;,\n&quot;value&quot;: null\n},\n{\n&quot;color&quot;: &quot;red&quot;,\n&quot;value&quot;: 80\n}\n]\n},\n&quot;unit&quot;: &quot;bytes&quot;\n},\n&quot;overrides&quot;: [\n{\n&quot;matcher&quot;: {\n&quot;id&quot;: &quot;byName&quot;,\n&quot;options&quot;: &quot;rx&quot;\n},\n&quot;properties&quot;: [\n{\n&quot;id&quot;: &quot;color&quot;,\n&quot;value&quot;: {\n&quot;fixedColor&quot;: &quot;dark-red&quot;,\n&quot;mode&quot;: &quot;fixed&quot;\n}\n}\n]\n}\n]\n},\n&quot;gridPos&quot;: {\n&quot;h&quot;: 8,\n&quot;w&quot;: 24,\n&quot;x&quot;: 0,\n&quot;y&quot;: 17\n},\n&quot;id&quot;: 4,\n&quot;options&quot;: {\n&quot;legend&quot;: {\n&quot;calcs&quot;: [],\n&quot;displayMode&quot;: &quot;list&quot;,\n&quot;placement&quot;: &quot;bottom&quot;,\n&quot;showLegend&quot;: true\n},\n&quot;tooltip&quot;: {\n&quot;mode&quot;: &quot;single&quot;,\n&quot;sort&quot;: &quot;none&quot;\n}\n},\n&quot;targets&quot;: [\n{\n&quot;datasource&quot;: {\n&quot;type&quot;: &quot;prometheus&quot;,\n&quot;uid&quot;: &quot;PBFA97CFB590B2093&quot;\n},\n&quot;editorMode&quot;: &quot;code&quot;,\n&quot;expr&quot;: &quot;sum(irate(stunner_cluster_bytes_total[1m])) by (direction)&quot;,\n&quot;legendFormat&quot;: &quot;__auto&quot;,\n&quot;range&quot;: true,\n&quot;refId&quot;: &quot;A&quot;\n}\n],\n&quot;title&quot;: &quot;stunner_cluster_bytes_total&quot;,\n&quot;type&quot;: &quot;timeseries&quot;\n}\n],\n&quot;refresh&quot;: false,\n&quot;schemaVersion&quot;: 38,\n&quot;style&quot;: &quot;dark&quot;,\n&quot;tags&quot;: [],\n&quot;templating&quot;: {\n&quot;list&quot;: []\n},\n&quot;time&quot;: {\n&quot;from&quot;: &quot;2024-06-21T01:25:08.227Z&quot;,\n&quot;to&quot;: &quot;2024-06-21T04:12:21.776Z&quot;\n},\n&quot;timepicker&quot;: {},\n&quot;timezone&quot;: &quot;&quot;,\n&quot;title&quot;: &quot;stunner&quot;,\n&quot;uid&quot;: &quot;cbd52e5c-df69-45e6-b2ba-84433a4cd6ec&quot;,\n&quot;version&quot;: 5,\n&quot;weekStart&quot;: &quot;&quot;\n}\n\nref.\n\nPromQLèšåˆæ“ä½œ\nstunner Github\nstunner Document",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "222. elastic æ•´æ‰¹åˆªé™¤indics",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/222. elastic æ•´æ‰¹åˆªé™¤indics/",
		"content": "Why\nä¸çŸ¥é“ç‚ºä»€éº¼ï¼ŒILMæ²’æœ‰å‹•ä½œï¼Œæ²’å°‡èˆŠçš„indicsåˆªé™¤ã€‚\nå°è‡´elasticç›´æ¥å ±éŒ¯ã€‚\nthis action would add [2] shards, but this cluster currently has [1000]/[1000] maximum normal shards open;\n\nç·Šæ€¥è™•ç†å…ˆå°‡nodeçš„ sharedé–‹æˆ1500\nPUT /_cluster/settings\n{\n&quot;persistent&quot;: {\n&quot;cluster.max_shards_per_node&quot;: 1500\n}\n}\n\nSolution\nå†ä¾†æ˜¯æª¢æŸ¥ç‚ºä»€éº¼æœ‰é‚£éº¼å¤šsharedæ²’åˆªé™¤ï¼Œ\nä½†ä¸€æ•´æ‰¹ï¼Œä¸€å€‹ä¸€å€‹åˆªé™¤æœƒç˜‹æ‰ã€‚\nç”¨wildcardå»æœƒç™¼ç”ŸéŒ¯èª¤ã€‚\nDELETE /qa-backend-2024.02.*\n\néŒ¯èª¤\n{\n&quot;error&quot;: {\n&quot;root_cause&quot;: [\n{\n&quot;type&quot;: &quot;illegal_argument_exception&quot;,\n&quot;reason&quot;: &quot;Wildcard expressions or all indices are not allowed&quot;\n}\n],\n&quot;type&quot;: &quot;illegal_argument_exception&quot;,\n&quot;reason&quot;: &quot;Wildcard expressions or all indices are not allowed&quot;\n},\n&quot;status&quot;: 400\n}\n\nä¸æƒ³å¯«shellscriptï¼Œä¸€å€‹ä¸€å€‹æ’ˆindexå»åˆªé™¤ï¼Œ\næ–¼æ˜¯å…ˆé–‹æ”¾wildcardå§ã€‚\nPUT _cluster/settings\n{\n&quot;transient&quot;: {\n&quot;action.destructive_requires_name&quot;: false // allow wildcards\n}\n}\n\nå†ä¾†åŸ·è¡Œ\nDELETE /qa-backend-2024.02.*\n\nçµæŸã€‚\nref. elasticsearch, how to delete multiple indexes with wildcard",
		"tags": [ "note","ğŸ—’"]
},

{
		"title": "223. æª¢æŸ¥TCP or UDPæ˜¯å¦æœ‰é€š",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/223. æª¢æŸ¥TCP or UDPæ˜¯å¦æœ‰é€š/",
		"content": "Why\næSRSçš„æ™‚å€™ï¼Œ\nè¦æ¸¬è©¦webRTCçš„åŠŸèƒ½ï¼Œ\né–‹äº†UDPä½†ä¸çŸ¥é“åˆ°åº•æœ‰æ²’æœ‰é€šã€‚\nSolution\nUDP\nnc -u YOUR_PUBLIC_IP 30000\n\né€šçš„è©±ï¼Œæ‡‰è©²æ˜¯æœƒç™¼ç¾ä½ å¯ä»¥åœ¨åº•ä¸‹æ‰“å­—ï¼Œç„¶å¾Œä¸æœƒçµæŸã€‚\n\nå¦‚æœæœ‰å¦ä¸€å°ä¼ºæœå™¨å¯ä»¥ç©çš„è©±ï¼Œ\nå¯ä»¥åšserver\nnc -ulvp 30000\n\nref.\n\nUDPé€£æ¥åŸ é€£é€šæ€§æª¢æŸ¥\n\nNetcat\nå®‰è£æ–¹å¼\nMac\nbrew install netcat\n\nLinux\napt install netcat\n\nCentOS\nyum install nc\n\nAlpine Linux\napk add netcat-openbsd\n\nDocker\napt install netcat-traditional\n\næª¢æŸ¥ç‰¹å®šçš„port æ˜¯å¦é–‹å•Ÿ\n\nnc -v 192.168.0.175 5000\n\næƒæå°æ–¹æ©Ÿå™¨çš„port\n\nnc -vnz -w 1 192.168.233.208 1-1000 2000-3000\n\nå†ä¾†é‚„æœ‰é€å‡ºhttpè«‹æ±‚ã€å¯„ä¿¡ã€ç°¡æ˜“ç¶²é ä¼ºæœå™¨...\nref. Netcatï¼ˆLinux nc æŒ‡ä»¤ï¼‰ç¶²è·¯ç®¡ç†è€…å·¥å…·å¯¦ç”¨ç¯„ä¾‹",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "224. GKEçš„ç¯€é»ä¸Šé™",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/224. GKEçš„ç¯€é»ä¸Šé™æ¡å‘è¨˜/",
		"content": "WHY\næœ€è¿‘åŒäº‹åœ¨æå£“åŠ›æ¸¬è©¦ï¼Œ\nç„¶å¾Œä»–å°±çªç„¶è·Ÿæˆ‘èªªï¼Œæ¬¸ï¼Œæˆ‘çš„podèµ·ä¸ä¾†ã€‚\nçœ‹äº†ä¸€ä¸‹ï¼Œç™¼ç¾ip æ‡‰è©²æ˜¯é‚„å¤ çš„å•Šï¼Œæ€éº¼æœƒå™´ scale.up.error.ip.space.exhausted\nHow\nå› ç‚ºGKEæœƒæ ¹æ“šæ¯å€‹nodeä¸Šï¼Œæ‰€è¨­å®šçš„æœ€å¤§podæ•¸é‡ï¼Œ\nä»¥åŠpodçš„CIDRç¯„åœï¼Œä¾†è¨ˆç®—ä½ é€™å€‹clusterå¯ä»¥é–‹åˆ°å¹¾å€‹nodeã€‚\nref.çµ„æ…‹æ¯å€‹ç¯€é»çš„ Pod æ•¸ä¸Šé™\næ–‡ç« çš„æœ€å¾Œæœ‰å¯«åˆ°ï¼Œ\n\nå¦‚æœæ‚¨å°‡é»˜èªæœ€å¤§ Pod æ•¸è¨­å®šç‚ºÂ 110Â ä¸¦å°‡ Pod çš„æ¬¡è¦ IP åœ°å€ç¯„åœè¨­å®šç‚ºÂ /21ï¼ŒKubernetes æœƒç‚ºå¢é›†ä¸­çš„ç¯€é»åˆ†é…Â /24Â CIDR ç¯„åœã€‚é€™å…è¨±å¢é›†ä¸­æœ€å¤šæœ‰2(24âˆ’21) = 23 = Â 8Â å€‹ç¯€é»ã€‚\n\næˆ‘çš„æœ€å¤§podæ•¸ç‚º110ï¼Œæ¬¡è¦IPç¯„åœä¹Ÿæ˜¯/21ï¼Œ\næ‰€ä»¥nodeé–‹åˆ°8å€‹ï¼Œå°±é”åˆ°ä¸Šé™äº†ã€‚\n\nç„¶å¾Œï¼Œç‚ºä»€éº¼kubernetesæ›¿å¢é›†çš„ç¯€é»åˆ†é…çš„ç¯„åœæ˜¯ /24ã€‚\nè¦å¾€ä¸‹çœ‹è¡¨æ ¼ã€‚\n\næ¯å€‹ç¯€é»çš„æœ€å¤§ Pod æ•¸é‡\næ¯å€‹ç¯€é»çš„ CIDR ç¯„åœ\nIP åœ°å€æ•¸é‡\n\n8\n/28\n16\n\n9 - 16\n/27\n32\n\n17 - 32\n/26\n64\n\n33 - 64\n/25\n128\n\n65 - 128\n/24\n256\n\n129 - 256\n/23\n512\n\nå‡è¨­æœ€å¤§podæ•¸æ˜¯64ï¼Œé‚£æœ€å¤§ç¯€é»æ•¸å‰‡æ˜¯ 2(25âˆ’21) = 24 = 16\nSolution\nå¾Œä¾†æ‰çŸ¥é“åŸå› ï¼Œç•¶æ™‚æœ‰å…¶ä»–æ¡ˆå­åœ¨æ‰‹ä¸­ï¼Œæ²’ç©ºæŸ¥åŸå› ã€‚\nä½†ç•¶ä¸‹ç›´æ¥åŠ å¤§æ©Ÿå™¨è¦æ ¼ï¼Œæ¸›å°‘nodeçš„æ•¸é‡ã€‚\næˆ–è€…ç›´æ¥åœ¨vpcä¸Šé¢å¢åŠ æ–°çš„pod rangeï¼Œæ‡‰è©²ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚",
		"tags": [ "note","âˆ"]
},

{
		"title": "225.  Debianå®‰è£å¾Œè¨­å®š",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/225.  Debianå®‰è£å¾Œè¨­å®š/",
		"content": "WHY\nè¢«è¦æ±‚å¯«å€‹SOPå®‰è£æœå‹™çš„æ‰‹å†Šï¼Œ\nå¾ä½œæ¥­ç³»çµ±é–‹å§‹ã€‚\nNote\n\n*** is not in the sudoers file.Â Â This incident will be reported.â€\nä¿®æ”¹sudoersæª”æ¡ˆ\n\nsu root\nchmod 777 /etc/sudoers\nvi /etc/sudoers\n\n# åœ¨ rootÂ Â Â Â ALL=(ALL:ALL) ALL ä¸‹é¢åŠ ä¸Š\nÂ &lt;user&gt; Â Â Â ALL=(ALL)ALL\n\nchmod 440 /etc/sudoers\n\né—œé–‰ä¼‘çœ æ¨¡å¼\n\nsudo systemctl mask sleep.target suspend.target hibernate.target hybrid-sleep.target\n\nåŸ·è¡Œå®Œå¾Œï¼Œéœ€é‡é–‹æ©Ÿ\n\né—œé–‰å®‰è£ä¾†æº\næœ€å¿«çš„æ–¹æ³•æ˜¯ç›´æ¥å¾æ¡Œé¢æ¨¡å¼é—œæ‰ã€‚\nç¨‹å¼ä»‹é¢æœå°‹ updateï¼Œæ‰¾åˆ°software &amp; update ï¼Œ\né€²å»å¾Œåˆ‡åˆ°Other softwareçš„é ç±¤ï¼Œå°‡é¸é …æ‹¿æ‰ã€‚\n\nå®‰è£deb\n\napt install ./anydesk_6.3.2-1_amd64.deb",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "228. Cloudsql PITRé‚„åŸ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/228. Cloudsql PITRé‚„åŸ/",
		"content": "Why\nç‚ºäº†ä¹‹å¾Œçš„æœå‹™ï¼Œè¦ä¾†é©—è­‰ä¸€ä¸‹æœ‰å“ªäº›çš„é‚„åŸæ–¹å¼ã€‚\nSolution\nç›®å‰çœ‹åˆ°çš„æ˜¯PITRï¼Œçœ‹èªªæ˜æ–‡ä»¶ï¼Œå¯ä»¥é‚„åŸåˆ°ç§’çš„æ™‚é–“ã€‚\né–‹å•“æ–¹å¼å¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶ã€‚\nä½†æœ‰ä¸€é»æ–‡ä»¶æ²’æåˆ°ï¼Œ\nä½ åªèƒ½é¸å–äº”åˆ†é˜å‰çš„æ™‚é–“ã€‚\nä¾‹å¦‚\nç¾åœ¨æ™‚é–“æ˜¯ 15:30 ï¼Œä½ é‚„åŸçš„æ™‚é–“é»ï¼Œåªèƒ½é¸æ“‡15:25ä»¥å‰ã€‚\nç•¶ç„¶é‚„æœ‰ç§’æ•¸çš„å•é¡Œï¼Œ\nå¦‚æœé¸æ“‡çš„æ™‚é–“æ˜¯ 15:25~15:30çš„è©±ï¼Œæœƒå‡ºç¾é€™å€‹éŒ¯èª¤ã€‚\n\nå¦‚æœè¦ç¢ºèªå¯ä»¥é€€çš„æ™‚é–“é»ï¼Œ\nå¯ä»¥åŸ·è¡Œä¸‹é¢æŒ‡ä»¤ã€‚\ngcloud sql instances get-latest-recovery-time &lt;instanceName&gt;\n\næœƒé¡¯ç¤º\nkind: sql#getLatestRecoveryTime\nlatestRecoveryTime: '2024-08-15T06:48:48Z'\n\nä¸‹é¢å°±æ˜¯ä½ èƒ½å¤ é‚„åŸçš„æœ€æ—©æ™‚é–“ã€‚\nref. gcloud sql instances get-latest-recovery-time",
		"tags": [ "note","ğŸ—„"]
},

{
		"title": "231. GKE node cpu limit è¨ˆç®—",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/231. GKE node cpu limit è¨ˆç®—/",
		"content": "WHY\nç·šä¸Šæœå‹™çš„podï¼ŒCPUé£†é«˜ï¼Œ\nå°è‡´æ‰€å±¬çš„nodeï¼ŒCPUä¹Ÿè·Ÿè‘—è¡é«˜ï¼Œåˆç†ã€‚\nä½†åŒä»å•äº†ä¸€å¥é‚£å€‹limitæ˜¯å•¥ã€‚\nNote\n\né‚£æ¢ç´…è‰²çš„ç·šï¼Œ\nåŸæœ¬ä»¥ç‚ºé‚£æ˜¯æŸå€‹nodeçš„cpuæœ€å¤§å€¼ï¼Œ\nä½†æˆ‘é€™å€‹nodeçš„æœ€å¤§cpuåªæœ‰4è€Œå·²ã€‚\næ‰€ä»¥æ’é™¤äº†CPUçš„ä¸Šé™ï¼Œæª¢è¦– Metrics Explorer\næŒ‡æ¨™ä¸Šé¢å¯«Limit cores\nå†æ ¹æ“š GKE system metricsï¼Œå¾—çŸ¥é€™å€‹metricsæ˜¯æŒ‡ CPU cores limit of the containerã€‚\nä½†æˆ‘åˆæ‡¶å¾—ä¸€å€‹ä¸€å€‹æŸ¥é€™å€‹nodeæœ‰å¤šå°‘limitã€‚\næ–¼æ˜¯\nkubectl get pods --all-namespaces -o wide --field-selector spec.nodeName=&lt;node name&gt; -o custom-columns=:metadata.name,:metadata.namespace --no-headers | while read -r name ns; do\necho &quot;$name and $ns&quot;\nkubectl get pod $name -n $ns -o jsonpath='{.spec.containers[*].resources.limits.cpu}' | xargs -n1 echo &quot; CPU Limit: &quot;\ndone\n\næœ¬ä¾†æ˜¯ç”¨forï¼Œä½†åœ¨åˆ‡å‰²name èˆ‡ namespaceå‡ºäº†é»å•é¡Œã€‚\næœ€å¾Œæ‰æ”¹ç”¨whileã€‚\né€™é‚Šå°‡å€¼ç¸½å’Œè¨ˆç®—å‡ºä¾†å¾Œæ˜¯6.2ï¼Œæ•¸å€¼ä¸€æ¨£ï¼Œè¬åº•è§£é–‹äº†ã€‚\nref. Command line tool (kubectl)",
		"tags": [ "note","âˆ"]
},

{
		"title": "232. GCE Observability å®‰è£agentå¤±æ•—",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/232. GCE Observability å®‰è£agentå¤±æ•—/",
		"content": "WHY\nåˆ©ç”¨terraformè£å¥½GCEå¾Œï¼Œ\nè¦ä¾†è£ä¸€ä¸‹ç›£æ§ï¼Œæ‰èƒ½æŠŠè³‡æ–™ä¸Ÿå»grafanaè£é¢çµ±ä¸€ç®¡ã€‚\nçµæœä¸€ç›´å¡åœ¨pendingã€‚\nSolution\n\nä»¥çˆ²åªæ˜¯å–®ç´”å®‰è£å¤±æ•—ï¼Œå…ˆå¼·åˆ¶é—œé–‰æ›´æ–°å¾Œå†çœ‹çœ‹ã€‚\n# é—œé–‰å®‰è£\nsudo bash add-monitoring-agent-repo.sh --remove-repo\n\né‡æ–°å•“ç”¨å¾Œé‚„æœƒå¡åœ¨pendingï¼Œ\né‚„æ˜¯åªèƒ½æŸ¥ log ï¼Œåˆ° /var/log/google-cloud-ops-agent åº•ä¸‹ï¼Œ\næŸ¥çœ‹health-checks.log ã€‚ç™¼ç¾åŸå› å‡ºç¾permission denied\nå¾Œä¾†æ‰ç™¼ç¾åŸå› ï¼Œ\næˆ‘ç”¨terraformå»ºç«‹GCEæ™‚ï¼Œæ²’æœ‰è¨­å®šçš„service accountã€‚\nå°è‡´ä»–è¦å®‰è£æ™‚æœƒå¡åœ¨é‚£é‚Šã€‚\næ‰€ä»¥ï¼Œåªè¦æŠŠæ©Ÿå™¨åœæ©Ÿï¼Œ\nå†åˆ° API and identity management é¸æ“‡ Service accountå³å¯ã€‚\n\nref. æ’æŸ¥ Ops Agent å®‰è£å’Œå•Ÿå‹•å•é¡Œ",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "233. ä¸åŒå€åŸŸ GCEèˆ‡GKE LBé€£ç·š",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/233. ä¸åŒå€åŸŸ GCEèˆ‡GKE LBé€£ç·š/",
		"content": "Why\nçªç„¶ä¾†äº†å€‹è¦æ±‚ï¼Œè¦å¾ç¾æ±çš„GCE é€£åˆ°è‡ºç£çš„GKEã€‚\nGKEçš„æ©Ÿå™¨ï¼Œæˆ‘å»ºäº†å…§éƒ¨ LB ã€‚\nä½†åªæœ‰åŒä¸€å€‹å€åŸŸçš„GCEæ©Ÿå™¨èƒ½å¤ é€£ã€‚\né€£å»GCE ç›´æ¥pingå„å€‹å€åŸŸçš„æ©Ÿå™¨ï¼Œéƒ½æ­£å¸¸ã€‚\nä½†é€£GKEçš„LB å°±ä¸é€šã€‚\nSolution\nè«®è©¢äº†é¡§å•å…¬å¸ï¼Œ\nä»–å€‘çš„å›ç­”æ˜¯VPCå…§éƒ¨çš„å­ç¶²è·¯éƒ½æ˜¯äº’é€šçš„ï¼ˆæ²’éŒ¯ï¼Œæ¸¬è©¦æœ‰é€šï¼‰ï¼Œ\nä½†è¦é€£åˆ°GKEçš„internal LBï¼Œ\nLBè¦é–‹å•“ Global access\n\nref. å®¢æˆ¶ç«¯è¨ªå•\nTroubleshoot\né€™å¹¾å¤©ç™¼ç¾å€‹å•é¡Œï¼Œ\næ‰‹å‹•æ›´æ”¹Global accesså¾Œï¼Œæœƒè‡ªå‹•è®ŠæˆDisableã€‚\né€šå ±çµ¦Googleäº†ï¼Œå¾ŒçºŒçœ‹ç‹€æ³ã€‚\nä½†æœ‰å»ºè­°èªªç›´æ¥åœ¨serverä¸Šé¢åŠ  annotations\napiVersion: v1\nkind: Service\nmetadata:\nannotations:\n# add globle access\nnetworking.gke.io/internal-load-balancer-allow-global-access: &quot;true&quot;\nnetworking.gke.io/load-balancer-type: &quot;Internal&quot;\nname: srs-source-internal\nnamespace: srs-prod\nspec:\ntype: LoadBalancer\nselector:\napp: srs-source\nports:\n- protocol: TCP\nport: 1935\ntargetPort: 1935\nname: rtmp\n\nref. Global access",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "234. Debianæ–°å¢è»Ÿé«”æº",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/234. Debianæ–°å¢è»Ÿé«”æº/",
		"content": "Cause\nå®¢æˆ¶é‚£é‚Šè¦æ–°å¢ä¸€è‡ºæ©Ÿå™¨ï¼Œ\né€£éå»è£æ™‚ï¼Œæ‰ç™¼ç¾ä»–æ²’æœ‰software repositories\nSolution\nOSï¼š Debian 10\nç·¨è¼¯ /etc/apt/sources.list ï¼Œ\næ–°å¢\ndeb http://ftp.debian.org/debian stable main contrib non-free\n\nç„¶å¾Œé–‹å•“terminalï¼ŒåŸ·è¡Œä¸‹é¢æŒ‡ä»¤ï¼Œæ”¶å·¥\napt update\n\nref. DebianRepository",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "235. Grafana Alert Template",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/235. Grafana Alert Template/",
		"content": "Why\næ–°æœå‹™è¦ä¸Šç·šäº†ï¼Œ\nè¦è¶•ç·ŠæŠŠ Observabilityåšä¸€åšï¼Œ\nä¹‹å‰çš„ç‰ˆæœ¬éƒ½æœƒæœ‰ä¸€é•·ä¸²è³‡è¨Šï¼Œ\nçœ‹äº†å°±å¾ˆç…©ï¼Œä¸èƒ½å¾ˆç›´è§€çš„çŸ¥é“æ˜¯å“ªé‚Šå‡ºå•é¡Œã€‚\nè¨Šæ¯åˆéƒ½è¦ä¸€å€‹ä¸€å€‹æ‰“ï¼Œ\næ‰€ä»¥ï¼Œæˆ‘èƒ½ä¸èƒ½å¼„æˆä¸€å€‹ç¯„æœ¬ï¼Œæ¸›å°‘æˆ‘äººå·¥çš„ä½œæ¥­ï¼Ÿ\nSolution\n\næ³¨æ„ï¼Œå› æœ‰ç‰¹æ®Šç¬¦è™Ÿï¼Œå°è‡´ç·¨è­¯å‡ºå•é¡Œã€‚\næ•…å°‡è£¡é¢çš„æ‰€æœ‰{ } æ”¹ç‚ºå…¨å½¢ï¼Œè«‹è‡ªè¡Œæ”¹ç‚ºåŠå½¢\næ•…å°‡è£¡é¢çš„æ‰€æœ‰{ } æ”¹ç‚ºå…¨å½¢ï¼Œè«‹è‡ªè¡Œæ”¹ç‚ºåŠå½¢\næ•…å°‡è£¡é¢çš„æ‰€æœ‰{ } æ”¹ç‚ºå…¨å½¢ï¼Œè«‹è‡ªè¡Œæ”¹ç‚ºåŠå½¢\n\nå¾ˆé‡è¦ï¼Œèªªä¸‰æ¬¡\nåŸå§‹çš„ç¯„æœ¬ï¼Œé€šå¸¸é•·æˆé€™æ¨£ã€‚\næœ‰å¾ˆå¤šè³‡è¨Šï¼Œä½†æœ‰äº›æ˜¯ç”¨ä¸åˆ°çš„ã€‚\n[FIRING:1] (cpu-dealer GKE Cluster normal backend)\n\nFiring\n\nValue: B=2.632\nLabels:\n- alertname = cpu-abc\n- grafana_folder = GKE Cluster\n- level = normal\n- service-type = backend\nAnnotations:\n- summary = ç’°å¢ƒï¼šProd\næ©Ÿå™¨åç¨±ï¼šdealer\nå‘Šè­¦è¨Šæ¯ï¼šCPUä½¿ç”¨é‡1core\nSource: http://localhost:3000/alerting/grafana/uRU7sCEnz/view?orgId=1\nSilence: http://localhost:3000/alerting/silence/new?alertmanager=grafana&amp;matcher=alertname%3Dcpu-dealer&amp;matcher=grafana_folder%3DGKE+Cluster&amp;matcher=level%3Dnormal&amp;matcher=service-type%3Dbackend\nDashboard: http://localhost:3000/d/2-jy90-nk?orgId=1\nPanel: http://localhost:3000/d/2-jy90-nk?orgId=1&amp;viewPanel=13\n\næœ€å¾Œçš„æˆæœ\n[FIRING:1] sftp-qa Disk Space alarm-GCE (normal sftp-qa value_percent_used_mean_aggregate)\n\nAnnotations:\n- summary: ç’°å¢ƒï¼šalarm-GCE\næ©Ÿå™¨åç¨±ï¼šsftp-qa\nå‘Šè­¦é …ç›®ï¼šsftp-qa Disk Space\nå‘Šè­¦è¨Šæ¯ï¼šç¡¬ç¢Ÿç©ºé–“ç›®å‰ 46.22% ï¼Œå·²é”ä¸Šé™ 70%\nDashboard URL:\n\n[View Dashboard](http://&lt;ip&gt;/grafana/d/f649857c-4763-442f-9919-b41c3832d5b8?orgId=1)\n\nStep 1. ç¢ºèªç‰ˆæœ¬\né¦–å…ˆç¢ºèªGrafanaçš„ç‰ˆæœ¬ï¼Œç›®å‰æˆ‘ä½¿ç”¨çš„æ˜¯Grafana v11.2.0ã€‚\nç‰ˆæœ¬ä¸ä¸€æ¨£ï¼ŒæŒ‡ä»¤å¯èƒ½æœƒä¸ä¸€æ¨£ï¼Œéœ€è¦å†å»æŸ¥æ–‡ä»¶ã€‚\nStep 2. è¨­å®šNotification Template\n\né–‹å•Ÿ Home &gt; Alerting &gt; Cotact points\nåˆ‡æ›åˆ°åˆ†é  Notification Templates ï¼Œé¸æ“‡ Add Notification Template\n\nåœ¨å·¦ä¸Šçš„Templateæ¡†æ¡†ï¼Œè¼¸å…¥ä¸‹é¢ç¨‹å¼ç¢¼ã€‚\nå¦‚æœæŒ‡ä»¤æ²’éŒ¯ï¼Œå¯ä»¥åœ¨å³é‚Šçš„previewçœ‹åˆ°çµæœã€‚\nï½›ï½› define &quot;alert_message&quot; ï½ï½\nï½›ï½› range .Alerts ï½ï½\nï½›ï½› if gt (len .Annotations) 0 ï½ï½\nAnnotations:\nï½›ï½› range $key, $value := .Annotations ï½ï½\n- **ï½›ï½› $key ï½ï½**:\nï½›ï½› $value ï½ï½\nï½›ï½› end ï½ï½\nï½›ï½› else ï½ï½\nNo Annotations found.\nï½›ï½› end ï½ï½\n\nDashboard URL:\n[View Dashboard](ï½›ï½› .DashboardURL ï½ï½)\nï½›ï½› end ï½ï½\nï½›ï½› end ï½ï½\n\né€™ç¨‹å¼æˆ‘æ˜¯å«GPTå¯«çš„ï¼Œå†ç¨å¾®å°æ”¹ä¸€ä¸‹ã€‚\nå¦‚æœæƒ³è‡ªå·±é–‹ç™¼ï¼Œè«‹åƒè€ƒConfigure notification messages\np.s. æ³¨æ„ç‰ˆæœ¬ï¼Œç‰ˆæœ¬ä¸ä¸€æ¨£å¾ç¶²é çš„ç‰ˆæœ¬è™Ÿèª¿æ•´\nStep 3. ç¶å®šnotification policy\n\nå›åˆ°Contact Pointsï¼Œ\né¸æ“‡ä½ çš„notification policy\n\né¸æ“‡å‰›å‰›æ–°å¢çš„Template\nå¯ä»¥æŒ‰ä¸€ä¸‹Testé©—è­‰ä¸€ä¸‹æœ‰æ²’æœ‰é€šã€‚\nStep 4. è¨­å®š Alert Rules\nåŸºæœ¬çš„è¨­å®šå°±åƒè€ƒAlert rules\nåœ¨Summaryå‰‡æ˜¯è¼¸å…¥\nç’°å¢ƒï¼šï½›ï½› index $labels &quot;grafana_folder&quot; ï½ï½\næ©Ÿå™¨åç¨±ï¼šï½›ï½› index $labels &quot;metadata.label.system.name&quot; ï½ï½\nå‘Šè­¦é …ç›®ï¼šï½›ï½› index $labels &quot;alertname&quot; ï½ï½\nå‘Šè­¦è¨Šæ¯ï¼šç¡¬ç¢Ÿç©ºé–“ç›®å‰ ï½›ï½› humanize (index $values &quot;B&quot;).Value ï½ï½% ï¼Œå·²é”é–¥å€¼ 70%\n\nindexæ˜¯ç”¨ä¾†é¡¯ç¤ºæ¨™ç±¤ä¸­çš„å…§å®¹ï¼Œ\nå¯ä»¥æ›´æ–¹ä¾¿å¾—åˆ°ä½ æƒ³è¦çš„æ•¸å€¼ã€‚\nå¯ä»¥åœ¨æ¸¬è©¦æ™‚ç”¨ ï½›ï½› $labels ï½ï½ çœ‹æœ‰å“ªäº›æ¨™ç±¤å¯ç”¨ã€‚\np.s ç‰ˆæœ¬ä¸ä¸€æ¨£ï¼Œå–å€¼çš„æ–¹å¼ä¹Ÿä¸ä¸€æ¨£ã€‚\nåŒæ¨£å¯ä»¥ä½¿ç”¨çš„æ˜¯ ï½›ï½› $value ï½ï½ ï¼Œé€™é‚Šæ³¨æ„åªæœ‰valueæ²’æœ‰sã€‚\nä½†åœ¨ä½¿ç”¨indexæ™‚ï¼Œéœ€è¦åŠ ä¸Š sã€‚\nref. Notification.Templates\n\nhumanize æ˜¯æ¯”è¼ƒäººæ€§åŒ–çš„formatå‡½æ•¸ã€‚\nhumanize æœƒå°‡å¤šé¤˜çš„å°æ•¸é»ä½æ•¸ç§»é™¤æˆ–æ”¹ç‚ºæ¯”è¼ƒæ˜“è®€çš„æ–¹å¼ã€‚\nhumanizePercentage å°‡å°æ•¸é»è½‰ç‚ºç™¾åˆ†æ¯”\nhumanizeDuration å°‡æ™‚é–“è½‰ç‚ºå¯è®€çš„æ™‚é–“\næ›´å¤šå¯åƒè€ƒä¸‹é¢é€£çµï¼Œè£¡é¢ä¹Ÿæœ‰å…¶ä»–functionçš„ç”¨æ³•ã€‚\nref. humanize\n\nTroubleshooting\nç•¶æœ‰ä¸€å€‹è®Šæ•¸å¯«éŒ¯æ™‚ï¼Œç™¼é€å‘Šè­¦æ™‚ï¼Œå…¨éƒ¨çš„è®Šæ•¸éƒ½ä¸æœƒé¡¯ç¤ºã€‚\næœƒè®Šæˆä¸‹é¢çš„æƒ…æ³ã€‚\n- summary:\nï½›ï½› $value ï½ï½\nç’°å¢ƒï¼šï½›ï½› index $labels &quot;grafana_folder&quot; ï½ï½\næ©Ÿå™¨åç¨±ï¼šï½›ï½› (index $values &quot;B&quot;).persistentvolumeclaim ï½ï½\nå‘Šè­¦é …ç›®ï¼šï½›ï½› index $labels &quot;alertname&quot; ï½ï½\nå‘Šè­¦è¨Šæ¯ï¼šç¡¬ç¢Ÿç©ºé–“ç›®å‰ ï½›ï½› humanizePercentage (index $values &quot;B&quot;).Value ï½ï½ ï¼Œå·²é”é–¥å€¼ 70%\n\næ­¤æ™‚å°±çœ‹ä¸€ä¸‹æ˜¯ä¸æ˜¯é‚£é‚Šè¦åŠ ç©ºæ ¼æ²’ç©ºæ ¼ï¼Œ\næˆ–æ˜¯æŒ‡å®šçš„valuesçš„æ¬„ä½æœ‰éŒ¯èª¤ã€‚\nåƒä¸Šé¢çš„éŒ¯èª¤ï¼Œæ©Ÿå™¨åç¨±çš„éƒ¨åˆ†æ‡‰è©²è¦æ”¹æˆé€™æ¨£ã€‚\næ©Ÿå™¨åç¨±ï¼šï½›ï½› (index $values &quot;B&quot;).Labels.persistentvolumeclaim ï½ï½",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "236. Telegramå‚³é€æª”æ¡ˆ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/236. Telegramå‚³é€æª”æ¡ˆ/",
		"content": "Why\nçªç„¶æƒ³è¦æ‡¶ä¸€ä¸‹ï¼Œ\nå®šæ™‚é€å€‹æª”æ¡ˆåˆ°TGä¸Šé¢ï¼Œ\næ€éº¼å‚³æ–‡å­—æˆ‘å¾ˆæ¸…æ¥šï¼Œä½†æª”æ¡ˆé‚„çœŸçš„æ²’æƒ³æ³•ã€‚\nåªæ‰“ç®—å¼„å€‹shï¼Œä¸æƒ³å¯«codeã€‚\nSolution\nå•äº†GPTå¾ˆç°¡å–®ï¼Œ\nå°±ä¸€è¡Œã€‚\n987654321 æ˜¯ chat_id\nbot123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11æ˜¯TGçš„æ©Ÿå™¨äººtoken\nbackup.zipæ˜¯æª”æ¡ˆ\nsamplefileæ˜¯é™„è¨»\ncurl -F chat_id=987654321 \\\n-F document=@/path/to/backup.zip \\\n-F caption=samplefile \\\nhttps://api.telegram.org/bot123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11/sendDocument\n\nref. sendDocument\nå°è£œå……ï¼Œæƒ³åœ¨captionä¸Šé¢æ¨™æ³¨æ—¥æœŸï¼Œæ–¹ä¾¿å°‹æ‰¾ã€‚\ntoday=$(date +%F)\ncurl -F chat_id=987654321 \\\n-F document=@/path/to/backup.zip \\\n-F caption=samplefile-${today} \\\nhttps://api.telegram.org/bot123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11/sendDocument",
		"tags": [ "note","ğŸ’»"]
},

{
		"title": "237. GCP IAMç¶GKEçš„RBAC",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/237. GCP IAMç¶GKEçš„RBAC/",
		"content": "WHY\nè¦å¼„å€‹å°ç¨‹å¼å®šæ™‚æ’ˆsecretçš„è³‡æ–™å‡ºä¾†ï¼Œ\nä½†å¢é›†æ˜¯èˆŠçš„æ²’æœ‰é–‹å•Ÿworkload Identityï¼Œ\nä¹Ÿåªèƒ½æ›IAMçš„service accountäº†ã€‚\nåªçµ¦äºˆKubernetes Engine Viewerçš„æ¬Šé™ï¼Œ\nä½†è¦æ’ˆsecretæ™‚ï¼Œæœƒé€šçŸ¥ç¼ºä¹container.secrets.getçš„æ¬Šé™ã€‚\nSolution\n\næª¢æŸ¥Kubernetes Engine Vieweræœ‰å“ªäº›æ¬Šé™\n\nç¶²é æŸ¥è©¢\nå¦ä¸€ç¨®é€éæŒ‡ä»¤çš„æ–¹å¼ï¼Œåƒè€ƒä¸Šåœ–ä¸­çš„roleå°‡å€¼å¸¶å…¥åˆ°ä¸‹é¢æŒ‡ä»¤ã€‚\ngcloud iam roles describe roles/container.viewer\n\n(æˆ‘å¾ˆæƒ³åæ§½ï¼Œæˆ‘æ€éº¼çŸ¥é“é€™å€‹åç¨±è¦ç”¨å“ªå€‹roleå»æŸ¥å•Šï¼Œé‚„ä¸æ˜¯è¦å»ç¶²é çœ‹)\nref. æŸ¥çœ‹ IAM è§’è‰²æˆäºˆçš„æ¬Šé™\næŸ¥å®Œçš„çµæœæ˜¯çœŸçš„ç¼ºä¹ container.secrets.getçš„æ¬Šé™ã€‚\né‚£ç¾åœ¨çš„å•é¡Œæ˜¯ï¼Œè¦æ€éº¼åŠ æ¬Šé™ï¼Ÿ\n\né‡æ¸…èªè­‰æ–¹å¼\nGoogle æ–‡ä»¶èªªæ˜\næ‚¨å¯ä»¥ä½¿ç”¨Â IAMÂ å’ŒÂ Kubernetes RBAC ä¾†æ§åˆ¶å° GKE å¢é›†çš„å­˜å–æ¬Šï¼š\n\nIAM ä¸¦éç‰¹å®šæ–¼ Kubernetesï¼›å®ƒç‚ºå¤šç¨® Google Cloud ç”¢å“æä¾›èº«ä»½ç®¡ç†ï¼Œä¸¦ä¸”ä¸»è¦åœ¨ Google Cloud é …ç›®ç´šå±¤é‹è¡Œã€‚\n\nKubernetes RBAC æ˜¯ Kubernetes çš„æ ¸å¿ƒçµ„æˆéƒ¨åˆ†ï¼Œå¯è®“æ‚¨é‡å°å¢é›†å…§çš„ä»»ä½•å°è±¡æˆ–å°è±¡é¡å‹å»ºç«‹å’Œæˆäºˆè§’è‰²ï¼ˆä¸€çµ„æ¬Šé™ï¼‰ã€‚\n\nç‚ºäº†æˆæ¬Šæ“ä½œï¼ŒGKE é¦–å…ˆæœƒæª¢æŸ¥æ˜¯å¦å­˜åœ¨ RBAC æ”¿ç­–ã€‚å¦‚æœä¸å­˜åœ¨ RBAC æ”¿ç­–ï¼ŒGKE æœƒæª¢æŸ¥ IAM æ¬Šé™ã€‚\n\nåœ¨ GKE ä¸­ï¼ŒIAM å’Œ Kubernetes RBAC æ•´åˆåœ¨ä¸€èµ·ï¼Œæ‚¨å¯ä»¥é€šéä»»ä¸€å·¥å…·å‘ä½¿ç”¨è€…æˆæ¬Šï¼Œä½¿å…¶æœ‰è¶³å¤ çš„æ¬Šé™åŸ·è¡Œæ“ä½œã€‚é€™å°æ–¼ GKE å¢é›†çš„å¼•å°éç¨‹è‡³é—œé‡è¦ï¼Œå› ç‚ºé»˜èªæƒ…æ³ä¸‹ï¼ŒGoogle Cloud ä½¿ç”¨è€…ä¸å…·æœ‰ä»»ä½• Kubernetes RBAC RoleBindingsã€‚\nref. ä½¿ç”¨åŸºæ–¼è§’è‰²çš„å­˜å–æ¬Šæ§åˆ¶å‘å¢é›†ä¸­çš„æ“ä½œæˆæ¬Š\næ‰€ä»¥èªªé è¨­çš„è§’è‰²æ¬Šé™å°±æ˜¯é‚£äº›ï¼Œè¦é‡å°è§’è‰²åŠ æ¬Šé™çš„è©±åªèƒ½è‡ªå·±æ–°å¢äº†ã€‚\n\næ–°å¢RBACæ¬Šé™\n\nClusterRoleBinding ä½¿ç”¨ kind: userï¼Œç¶å®šIAMçš„å¸³è™Ÿã€‚\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\nname: secret-reader\nrules:\n- apiGroups: [&quot;&quot;]\nresources: [&quot;secrets&quot;]\nverbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\nname: secret-reader-binding\nsubjects:\n- kind: User # æˆ–è€… ServiceAccount æ ¹æ“šå…·é«”çš„éœ€æ±‚\nname: get-api@project.iam.gserviceaccount.com # æ›¿æ›æˆå…·é«”çš„ä½¿ç”¨è€…æˆ–æœå‹™å¸³è™Ÿåç¨±\napiGroup: rbac.authorization.k8s.io\nroleRef:\nkind: ClusterRole\nname: secret-reader\napiGroup: rbac.authorization.k8s.io\n\né©—è­‰æ–¹å¼\n\nç¶å®Œå¾Œï¼Œå¯ä½¿ç”¨æŒ‡ä»¤çœ‹çœ‹èƒ½ä¸èƒ½æ­£å¸¸è®€å–ã€‚\nkc auth can-i get secret iplc-test-com-tls \\\n-o=jsonpath='{.data.tls\\.crt}' \\\n--as get-api@project.iam.gserviceaccount.com\n\nå¯è®€å–æœƒé¡¯ç¤º Yesï¼Œå¦å‰‡å°±æ˜¯ No\nref. Checking API access",
		"tags": [ "note","âˆ"]
},

{
		"title": "238. Steam Deckå®‰è£Cheat Engine",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/238. Steam Deckå®‰è£Cheat Engine/",
		"content": "WHY\næœ‰äº›éŠæˆ²ç”¨ç°¡æ˜“ç‰ˆçš„æœå°‹è»Ÿé«” <a class=\"internal-link\" data-note-icon=\"\" href=\"/206. steamDeck çš„ Cheat Engineæ›¿ä»£å“/\">206. steamDeck çš„ Cheat Engineæ›¿ä»£å“</a>ï¼Œ\nå°±æ˜¯æœä¸åˆ°ï¼Œ\næƒ³èªªæ˜¯ä¸æ˜¯é‚„æ˜¯è©²ç”¨CEä¾†è©¦è©¦çœ‹äº†ã€‚\nSolution\nä¸»è¦æ˜¯åƒè€ƒé€™å€‹å½±ç‰‡Cheat Tables (.CT) for Steam Deck SteamOS Cheat Engine Guide Setup Tutorial\nä¸»è¦å¹¾å€‹æ­¥é©Ÿï¼Œå‚™å¿˜ä¸€ä¸‹ã€‚\n\nä¸‹è¼‰è»Ÿé«”\n\nåˆ°æ¡Œé¢æ¨¡å¼ä¸‹ï¼Œå®‰è£ ProtonUP-Qt ä»¥åŠ Protontricks\nå¦‚æœæ²’æœ‰å¤–æ¥æ»‘é¼ çš„è©±ï¼Œ\nå³é‚Šçš„è§¸æ§ç‰ˆæ˜¯æ»‘é¼ ï¼Œ RT(R2) æ˜¯æ»‘é¼ å·¦éµï¼Œ LT(L2)æ˜¯æ»‘é¼ å³éµ\n\næ–°å¢SteamTinkerLaunch\n\né–‹å•ŸProtonUP-Qt\n\nAdd version\n\nåœ¨Compatibility toolé¸æ“‡ SteamTinkerLaunch\nç„¶å¾Œ install\nå®Œæˆå¾Œé‡æ–°å•Ÿå‹•Steam\n\næ–°å¢CEåˆ°æ”¶è—åº«\n\næ¡Œé¢æ¨¡å¼ä¸‹ï¼Œé–‹å•ŸSteamã€‚\nåˆ°ã€æ”¶è—åº«ã€ï¼Œå·¦ä¸‹æ–¹æœ‰ä¸€å€‹æ–°å¢éŠæˆ²çš„æŒ‰éˆ•ï¼Œ\né¸æ“‡ ã€æ–°å¢éSteaméŠæˆ²ã€ã€‚\næ‰¾åˆ°ä½ å‰›å‰›ä¸‹è¼‰çš„CheatEngine.exeã€‚\n\nå®‰è£CE\n\næ–°å¢å®Œæˆå¾Œï¼Œæœƒå‡ºç¾ä¸‹åœ–ï¼Œ\n\né¸æ“‡å³é‚Šçš„å…§å®¹ï¼Œ\né–‹å•Ÿç›¸å®¹æ€§ã€‚\nã€å¼·åˆ¶ä½¿ç”¨ç‰¹å®šSteam Play ç›¸å®¹æ€§å·¥å…·ã€æ‰“å‹¾ã€‚\né¸æ“‡ã€Proton Experimentalã€\nè¨­å®šå®Œå¾Œï¼Œå•Ÿå‹•ã€‚\næœƒçœ‹åˆ°å®‰è£ç•«é¢ï¼Œå°±å®‰è£å§ã€‚\næ³¨æ„ï¼Œä¸­é€”æœƒå•ä½ è¦ä¸è¦è£å…¶ä»–è»Ÿé«”ï¼Œé¸æ“‡Skip All\n\nè¤‡è£½è³‡æ–™å¤¾\næ‰¾åˆ°CEçš„è³‡æ–™å¤¾ï¼Œè¨˜å¾—å…ˆé–‹å•Ÿã€é¡¯ç¤ºéš±è—æª”ã€\n\n/home/.steam/steam/steamapps/compatdata\né€™é‚Šæœ‰å…©ç¨®æ–¹å¼ï¼Œ\nä¸€ç¨®æ˜¯æ‰¾åˆ°å»ºç«‹æ—¥æœŸæ˜¯å‰›å‰›çš„ã€‚\nå¦ä¸€ç¨®æ˜¯æ‰“é–‹Protontricks çœ‹CheatEngineçš„ç·¨è™Ÿæ˜¯å“ªä¸€å€‹ã€‚\nåƒæˆ‘çš„æ˜¯3262966842 å°±å†é€²å»\n3262966842/pfx/drive_c/Program FIles\nå®Œæ•´è·¯å¾‘æœƒåƒé€™æ¨£\n/home/.steam/steam/steamapps/compatdata/3262966842/pfx/drive_c/Program files\nå°‡Cheat Engine 7.5è³‡æ–™å¤¾æ•´å€‹è¤‡è£½ï¼Œ\nè²¼åˆ°ä½ æƒ³è¦ä¿®æ”¹çš„éŠæˆ²è³‡æ–™å¤¾ä¸Šé¢ã€‚\nå‡è¨­æˆ‘è¦ä¿®Brotatoï¼Œç·¨è™Ÿæ˜¯ 1942280ï¼ˆé–‹ProtontricksæŸ¥ï¼‰ã€‚\nå°±åƒè€ƒä¸Šé¢çš„è·¯å¾‘\n/home/.steam/steam/steamapps/compatdata/1942280/pfx/drive_c/Program files\nåˆ°é€™é‚Šå°‡Cheat Engine 7.5è³‡æ–™å¤¾ è²¼ä¸Šã€‚\n\nè¨­å®šBrotatoç”¨SteamTinkerLaunché–‹å•Ÿ\n\næ¡Œé¢æ¨¡å¼\nå…§å®¹-&gt;ç›¸å®¹æ€§-&gt;å¼·åˆ¶ä½¿ç”¨ç‰¹å®šSteam Playç›¸å®¹æ€§å·¥å…·-&gt;Steam Tinker Launch\n\nè¨­å®šGame Menu\n\næ¡Œé¢æ¨¡å¼\nç…§ä¸Šé¢çš„è¨­å®šå®Œå¾Œï¼ŒåŸ·è¡ŒéŠæˆ²ï¼Œæœƒè·³å‡ºä¸€å€‹è¦–çª—ï¼Œ\né¸æ“‡ä¸‹æ–¹çš„Main Menu-&gt; Game Menu\nUse custom command æ‰“å‹¾\nCustom command é¸æ“‡å‰›å‰›è¤‡è£½éä¾†è³‡æ–™å¤¾è£¡é¢çš„CheatEngine.exe\nFork custom command æ‰“å‹¾\n\nå•Ÿç”¨é–‹ç™¼è€…æ¨¡å¼\n\nå¯ä»¥å›åˆ°éŠæˆ²æ¨¡å¼ï¼Œ\nå…ˆæŒ‰ä¸‹SteamæŒ‰éˆ•ï¼Œç³»çµ±-&gt; å•Ÿç”¨é–‹ç™¼è€…æ¨¡å¼ã€‚\n\né–‹å§‹ä¿®æ”¹\n\nåŸ·è¡Œä½ çš„éŠæˆ²ï¼Œæ­¤æ™‚æŒ‰ä¸‹ Steam æŒ‰éˆ•ï¼Œ\næœƒçœ‹åˆ°åŒæ™‚æœ‰å…©å€‹æª”æ¡ˆåœ¨åŸ·è¡Œï¼Œ\nä¸€å€‹æ˜¯ä½ ç©å¾—éŠæˆ²ï¼Œ\nå¦ä¸€å€‹å‰‡æ˜¯CheatEngineã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ æœ‰é¸æ“‡é–‹å•Ÿå…¶ä»–è¦–çª—çš„è©±ï¼Œ\néœ€è¦å¾SteamæŒ‰éˆ•å»é¸æ“‡ä½ é–‹å•Ÿçš„å…¶ä»–è¦–çª—ã€‚\nNote\n\næŠ“åœ–çš„è©±ä½¿ç”¨å…§å»ºçš„Spectacle\nè¤‡è£½åœ–ç‰‡çš„è©±ï¼Œä½¿ç”¨ssh\n\nSteamDeck\nå¦‚æœæ²’è¨­éå¯†ç¢¼ï¼Œéœ€ä½¿ç”¨passwdå…ˆè¡Œè¨­å®š\nsystemctl enable sshd # å•Ÿç”¨sshd\nsystemctl restart sshd # é‡æ–°å•Ÿå‹•sshd\nsystemctl status sshd # æŸ¥è©¢ç‹€æ…‹\n\nip -4 addr # æŸ¥è©¢ipä½ç½®\n\nPC\nscp -r deck@192.168.1.2:/home/deck/Pictures/ .\n\nref.\n\nCheat Tables (.CT) for Steam Deck SteamOS Cheat Engine Guide Setup Tutorial\nFearLess Cheat Engine ä¸‹è¼‰CTæª”æ¡ˆçš„ç¶²ç«™",
		"tags": [ "note"]
},

{
		"title": "239.Cloudflareç™½åå–®åŠæ“·å–åœ‹åˆ¥è¨­å®š",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/239. Cloudflareç™½åå–®åŠæ“·å–åœ‹åˆ¥è¨­å®š/",
		"content": "WHY\næ¯ç•¶è¦å†è¨­å®šä¸€æ¬¡æ™‚ï¼Œ\néƒ½è¦æ‰¾ä¸€é™£å­ï¼Œæ‰æœƒç™¼ç¾åœ¨å“ªè£¡ï¼Œ\næ–¼æ˜¯æ‰ç™¼ç¾ï¼Œæˆ‘æ²’ç­†è¨˜å•Š...\nNote\nç™½åå–®è¨­å®š\nç¶²è·¯å®‰å…¨-&gt;WAF-&gt;è‡ªè¨‚è¦å‰‡\n\næ–°å¢è¦å‰‡\n\né€™é‚Šå¯é¸æ“‡è¦ç¯©é¸å“ªå€‹æ¬„ä½ã€‚\n\nå†ä¾†è¦å…è¨±é‚„æ˜¯é˜»æ“‹ã€‚\næœ€å¾Œè¨˜å¾—ã€ä½ˆç½²ã€ã€‚\nåœ‹åˆ¥header\nç¶²è·¯-&gt; IP åœ°ç†ä½ç½®\n\nä¹‹å¾Œå°±èƒ½å¾headerè£¡é¢å–å¾—é€™å€‹ä½¿ç”¨è€…æ˜¯å“ªå€‹åœ‹å®¶ã€‚\nref. Configuring IP geolocation",
		"tags": [ "note","ğŸŒ"]
},

{
		"title": "240. git log é™¤éŒ¯æŒ‡ä»¤",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/240. git log é™¤éŒ¯æŒ‡ä»¤/",
		"content": "WHY\nå‰é™£å­ï¼ŒRDåŒä»æ‰¾ä¾†ï¼Œèªªç‚ºä»€éº¼é€™æ¨£çš„CIä¸æœƒéã€‚\næŸ¥äº†ä¸€é€£ä¸²çš„LOGï¼Œç™¼ç¾æ˜¯fast-forwardçš„å•é¡Œã€‚\néç¨‹ä¸­ç”¨äº†ä¸€å †git æŒ‡ä»¤...\nç´€éŒ„å§\nNote\n\nåªé¡¯ç¤ºmergeçš„log\n\ngit log --merges\n\né¡¯ç¤ºå…¨éƒ¨Log\n\ngit log\n\né¡¯ç¤ºå–®ä¸€æäº¤çš„è©³ç´°è¨Šæ¯\n\ngit show &lt;commit&gt;\n\næŸ¥è©¢æŸå€‹ç‰¹å®šæäº¤çš„tag\n\ngit tag --points-at &lt;commit&gt;\n\nåˆ—å‡ºæ‰€æœ‰tagåŠå°æ‡‰çš„commitå€¼\n\ngit show-ref --tags\n\nä»¥åœ–å½¢åŒ–é¡¯ç¤ºlog\n\ngit log --graph\n\nå–å¾—gitçš„tagè³‡æ–™\n\n# å–é–‹é ­ç¬¬ä¸€å€‹\ngit tag --points-at &lt;commit&gt; | head -1\n# å–çµå°¾ç¬¬ä¸€å€‹\ngit tag --points-at &lt;commit&gt; | tail -1\n\nLog Mergeæ¬„ä½çš„æ„æ€\nå‡è¨­é¡¯ç¤ºçš„è³‡è¨Šå¦‚ä¸‹\n\ncommit a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t\nMerge: 1a2b3c4 5d6e7f8\nAuthor: John Doe &lt;john.doe@example.com&gt;\nDate: Tue Sep 11 14:30:00 2024 +0800\n\nMerge branch 'feature-branch' into 'develop'\n\ndevelopçš„ commitå€¼æ˜¯ 1a2b3c4\nfeature-branchçš„commitå€¼æ˜¯5d6e7f8\né€™å…©å€‹æ˜¯ non-fast-forwardåˆä½µï¼Œå› ç‚ºçœ‹å¾—åˆ°Parents commitã€‚\nå¦‚æœæ˜¯Fast-Forwardåˆä½µï¼Œåªæœƒé¡¯ç¤ºå–®å€‹æäº¤ï¼Œä¸æœƒæœ‰Mergeæ¨™è¨˜ã€‚\n\npullæ™‚ä¸ä½¿ç”¨rebaseï¼Œè€Œæ˜¯ä½¿ç”¨merge\n\ngit pull --no-rebase",
		"tags": [ "note","ğŸ’»"]
},

{
		"title": "241. MSSQLç´€éŒ„logï¼Œä½¿ç”¨QUERY_STORE",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/241. MSSQLç´€éŒ„logï¼Œä½¿ç”¨QUERY_STORE/",
		"content": "WHY\nç·šä¸Šå‡ºäº†å•é¡Œï¼Œ\nä½†æ²’æœ‰ä½œTracerï¼Œæ‰€ä»¥å°±åªèƒ½å…ˆè¿½Slow Queryçœ‹çœ‹äº†ã€‚\nNote\næœ¬ä¾†ä»¥ç‚ºåªèƒ½å¯«Triggerï¼Œç•¶è§¸ç™¼å‹•ä½œæ™‚ï¼Œè¨˜éŒ„ç•¶ä¸‹çš„Query\nå¾Œä¾†å•äº†ä¸€ä¸‹GPTï¼Œæ‰ç™¼ç¾åŸä¾†ç¾åœ¨çš„SQL serveræœ‰ä¸€å€‹æŸ¥è©¢å­˜æ”¾å€ï¼Œ\næ˜¯å°ˆé–€æ‹¿ä¾†æ”¾SQLæŒ‡ä»¤ã€‚\n\næŸ¥è©¢å­˜æ”¾å€æœƒæ”¶é›† DML é™³è¿°å¼ï¼Œä¾‹å¦‚Â SELECTã€INSERTã€UPDATEã€DELETEã€MERGEÂ å’ŒÂ BULK INSERTã€‚\n\nä½†é€™ä¹Ÿä¸æ˜¯å¾ˆæ–°çš„æ±è¥¿ï¼Œå¾SQL 2016å°±æœ‰äº†ã€‚\nä½†å¾SQL 2022é–‹å§‹ï¼Œé€™å€‹è¨­å®šå°±æœƒé è¨­æ‰“é–‹ã€‚\né–‹å•Ÿæ–¹å¼\nALTER DATABASE &lt;database_name&gt;\nSET QUERY_STORE = ON (OPERATION_MODE = READ_WRITE);\n\nç„¶å¾Œï¼Œå°±å¯ä»¥æŸ¥çœ‹çœ‹æ‰€æœ‰åŸ·è¡Œéçš„SQLäº†ã€‚\nSELECT Txt.query_text_id, Txt.query_sql_text, Pln.plan_id, Qry.*, RtSt.*\nFROM sys.query_store_plan AS Pln\nINNER JOIN sys.query_store_query AS Qry\nON Pln.query_id = Qry.query_id\nINNER JOIN sys.query_store_query_text AS Txt\nON Qry.query_text_id = Txt.query_text_id\nINNER JOIN sys.query_store_runtime_stats RtSt\nON Pln.plan_id = RtSt.plan_id;\n\nsys.query_store_queryæ¬„ä½èªªæ˜\nsys.query_store_runtime_statsæ¬„ä½èªªæ˜\n\nè¨ˆåŠƒå­˜æ”¾å€ä¸­å¯ç‚ºæŸ¥è©¢å„²å­˜çš„ä¸é‡è¤‡è¨ˆåŠƒæ•¸ç›®ï¼Œå—é™æ–¼Â max_plans_per_queryÂ çµ„æ…‹é¸é …ã€‚\n\næŸ¥è©¢ max_plans_per_queryçš„å€¼åŠå…¶ä»–åƒæ•¸\nselect *\nfrom sys.database_query_store_options\n\nsys.database_query_store_optionsæ¬„ä½èªªæ˜\n\né›–ç„¶èªªä»–çš„æœ€å¤§å€¼é è¨­æ˜¯200ï¼Œ\nä½†æˆ‘å¯¦éš›çœ‹èµ·ä¾†ï¼Œæˆ‘çš„plan_idå·²ç¶“è¶…é200äº†é‚„åœ¨å­˜ã€‚\n\nref.\n\nä½¿ç”¨æŸ¥è©¢å­˜æ”¾å€ç›£è¦–æ•ˆèƒ½\nç®¡ç†æŸ¥è©¢å­˜æ”¾å€çš„æœ€ä½³åšæ³•",
		"tags": [ "note","ğŸ—„"]
},

{
		"title": "242.  .Net core 8 ä½¿ç”¨apt install æ¬Šé™ä¸è¶³",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/242.  .Net core 8 ä½¿ç”¨apt install æ¬Šé™ä¸è¶³/",
		"content": "WHY\nä»Šå¤©æ—©ä¸Šåˆè¢«äººæŠ“ä½èªªè¦é–‹æ–°æœå‹™ï¼Œ\nçœ‹é€™å€‹æ¶æ§‹è¦æ€éº¼èª¿ã€‚\næ¸¬è©¦æ™‚ä¾†åˆ°Docker buildï¼Œç„¶å¾Œå°±æ›äº†ã€‚\nSOLUTION\nåœ¨ä½¿ç”¨apt updateçš„æ™‚å€™ï¼Œå‡ºç¾äº†Permission denied\nåœ¨Dockerfileçš„ä¸Šå±¤åŠ ä¸Š\nUSER root\n\nå°±èƒ½åŸ·è¡Œäº†ï¼Œ\nä½†ä¸çŸ¥é“ç‚ºä»€éº¼ï¼Œæˆ‘æ²’è¾¦æ³•å¾©ç¾éŒ¯èª¤ç‹€æ³ï¼Œ\nä½¿ç”¨ docker system prune -a å…¨éƒ¨æ¸…é™¤äº†ä¹Ÿæ˜¯ä¸€æ¨£ã€‚\nä½†ç•¶æ™‚ç¢ºå¯¦æœ‰ç¢°åˆ°é€™å€‹å•é¡Œã€‚\né™„ä¸Šå®Œæ•´Dockerfile\nFROM mcr.microsoft.com/dotnet/aspnet:8.0 AS base\n\nUSER root\nWORKDIR /app\n\nRUN apt update &amp;&amp; apt install -y curl python3\nRUN curl -O https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-cli-443.0.0-linux-x86_64.tar.gz \\\n&amp;&amp; tar -xf google-cloud-cli-443.0.0-linux-x86_64.tar.gz &amp;&amp; ./google-cloud-sdk/install.sh --command-completion=true --path-update=true --quiet\nCOPY gcs-download.json .\nRUN /app/google-cloud-sdk/bin/gcloud auth activate-service-account abc@abc.com --key-file=gcs-download.json\nEXPOSE 8080\nEXPOSE 8081\n\nå…¶å¯¦æ‡‰è©²ç”¨workload Identityæœƒæ¯”è¼ƒå¥½ï¼Œä½†é€™ç¨‹å¼é è¨ˆè¦æ”¾çš„ä½ç½®ï¼Œ\nè¦æ”¹çš„è©±è®Šå‹•å¤ªå¤§ã€‚\nref. # New non-root 'app' user in Linux images\n2024/12/06æ›´æ–°\né‚„æœ‰å¦ä¸€å€‹æ–¹æ³•ï¼Œ\nåœ¨deployä¸Šé¢åŠ ä¸Šä¸‹é¢æŒ‡ä»¤ï¼Œ\nè®“podä»¥rootçš„èº«åˆ†åŸ·è¡Œã€‚\ncontainers:\n\t....\nsecurityContext:\nallowPrivilegeEscalation: true\n\nsecurityContext:\n\trunAsUser: 0\n\nref. ç‚º Pod æˆ–å®¹å™¨çµ„æ…‹å®‰å…¨ä¸Šä¸‹æ–‡",
		"tags": [ "note","ğŸ³"]
},

{
		"title": "243. GCP å…¨åŸŸè² è¼‰å¹³è¡¡å™¨é€²éšè·¯ç”±è¨­å®š",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/243. GCP å…¨åŸŸè² è¼‰å¹³è¡¡å™¨é€²éšè·¯ç”±è¨­å®š/",
		"content": "WHY\næ–°çš„æœå‹™ï¼Œå°±é †ä¾¿æ”¹ä¸€ä¸‹æ–°çš„è² è¼‰å¹³è¡¡å™¨å»æ›è¼‰bucketå§ã€‚\nç„¶å¾Œæ»¿æ»¿çš„å‘ï¼ŒGCPçš„èªªæ˜ç¯„ä¾‹ä¸çŸ¥é“åœ¨å¯«å•¥ã€‚\nSolution\n\nä»¥å‰éƒ½æ˜¯é¸æ“‡å‚³çµ±ç‰ˆï¼Œ\nè¨­å®šä¹Ÿé —ç°¡å–®ã€‚\n\nä¸è¦çœ‹ä»–æ–°ç‰ˆä¸Šé¢å¯«å»ºè­°ï¼Œ\nå°±çœŸçš„ç”¨ï¼Œè‡³å°‘å…ˆå¼„å€‹å‚³çµ±çš„æŠŠä½ è¦çš„æ±è¥¿è¨­å®šå¥½ã€‚\n\nä¸Šé¢çš„è¨­å®šæ˜¯å°‡ domain/files/123.jpgï¼Œè½‰åˆ° bucketåº•ä¸‹çš„123.jpg\né€™é‚Šæä¾›ä¸€å€‹æœ€å¿«çš„è§£æ³•ã€‚\nå‡è¨­å·²ç¶“åœ¨å‚³çµ±çš„è² è¼‰å¹³è¡¡å™¨ä¸Šé¢å·²ç¶“å»ºç«‹å¥½äº†è¦å‰‡ï¼Œåç¨±ç‚º abc-qaã€‚\nä½¿ç”¨æŒ‡ä»¤æŸ¥è©¢\ngcloud compute url-maps describe abc-qa\n\nå°‡ pathMatchersåº•ä¸‹çš„æ±è¥¿æŠ„å‡ºä¾†ï¼Œæ”¹ä¸€ä¸‹ï¼Œ\n\nè²¼åˆ°ã€é€²éšå‹ä¸»æ©Ÿèˆ‡è·¯å¾‘è¦å‰‡ã€ä¸Šé¢å°±å¥½äº†ï¼ˆä¸è¦å¤ªç›¸ä¿¡ç¨‹å¼ç¢¼æŒ‡å—ï¼‰ã€‚\nçœŸçš„è¦åƒè€ƒï¼Œè«‹çœ‹åº•ä¸‹é€£çµã€‚\n\nserviceçš„éƒ¨åˆ†ï¼Œåˆ©ç”¨æŒ‡ä»¤æŸ¥è©¢ä½ çš„æœå‹™æˆ–bucketã€‚\ngcloud compute backend-buckets list --uri\nor\ngcloud compute backend-services list --uri\n\né€™æŒ‡ä»¤æœƒå¾—åˆ°é¡ä¼¼ä¸‹é¢çš„ç¶²å€ã€‚\nhttps://www.googleapis.com/compute/v1/projects/&lt;project_name&gt;/global/backendBuckets/&lt;bucket_name&gt;\n\nservice å¯ä»¥ç‚º projects/&lt;project_name&gt;/global/backendBuckets/&lt;bucket_name&gt;\næˆ–æ˜¯\nglobal/backendBuckets/&lt;bucket_name&gt;\nTroubleshooting\n\nå‡ºç¾éŒ¯èª¤ Operation type [update] failed with message &quot;Invalid resource: URL_MAP/513614964978.game-result-video-qa&quot;\n\néŒ¯èª¤çš„è¨­å®š\ndefaultService: global/backendBuckets/abc-qa\nname: matcher1\nrouteRules:\n- matchRules:\n- prefixMatch: /videos\npriority: 100\nrouteAction:\nweightedBackendServices:\n- backendService: global/backendBuckets/abc-qa\nweight: 100\n\nå•é¡§å•ï¼Œèªªä¸è¦ç”¨ weightedBackendServices ç›´æ¥æŒ‡å®šserviceã€‚\ndefaultService: global/backendBuckets/abc-qa\nname: matcher1\nrouteRules:\n- matchRules:\n- prefixMatch: /videos\npriority: 100\nservice: global/backendBuckets/abc-qa\n\nref. GCP - HTTP(S) Load Balancer L7 Backend Bucket Issue\n\nç¨‹å¼ç¢¼æŒ‡å—çš„ $[DEFAULT_SERVICE_URL]æ˜¯ä»€éº¼\n\nä½¿ç”¨æŒ‡ä»¤æŸ¥è©¢\ngcloud compute backend-buckets list --uri\nor\ngcloud compute backend-services list --uri\n\nref. What does &quot;$[DEFAULT_SERVICE_URL]&quot; refer to when setting Google Load Balancer towards a GCP Storage Bucket?\nConclusion\næ²’äº‹ä¸è¦ç”¨æ–°ç‰ˆçš„æ‡‰ç”¨ç¨‹å¼è² è¼‰å¹³è¡¡å™¨ã€‚\nå®˜æ–¹æ–‡ä»¶è¦çœ‹çš„è©±ï¼Œè«‹çœ‹ä¸‹é¢å…©å€‹é€£çµã€‚\n\nAdvanced host,Â path,Â and route rule\nURL maps overview",
		"tags": [ "note","ğŸŒ"]
},

{
		"title": "244. åœ¨GCEä½¿ç”¨filebeatå‚³åˆ°GKEçš„ECK",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/244. åœ¨GCEä½¿ç”¨filebeatå‚³åˆ°GKEçš„ECK/",
		"content": "WHY\nRDèªªä»–è¦æä¸€å°è‡ªå‹•éŒ„å½±çš„æœå‹™ï¼Œ\næœ¬ä¾†ä»¥ç‚ºåªæœ‰ä¸€å€‹æœå‹™ï¼Œé‚£å°±æ›åœ¨GKEä¸Šå°±å¥½äº†ã€‚\nä½†æ˜¯ï¼Œä»–æœ‰å…©å€‹æœå‹™Aè·ŸBï¼Œå…©é‚Šçš„è³‡æ–™è¦äº’é€šã€‚\nçœŸè¦ç”¨GKEç¡¬ä½œä¹Ÿæ˜¯å¯ä»¥ï¼Œä½†å¦‚æœé€™å€‹æœå‹™æœ¬èº«æ•ˆèƒ½å°±åƒå¾ˆå¤§ï¼Œ\né‚£ç”¨k8sä¹Ÿæ˜¯è¦å¤šé–‹ä¸€å°æ©Ÿå™¨ï¼Œé‚£ä¸å¦‚å°±ç”¨GCEå§ã€‚\nç„¶å¾Œï¼Œå•é¡Œå°±ä¾†äº†ï¼ŒLOGå’§ï¼ï¼Ÿ\nLogå‡ºå•é¡Œæ™‚è¦æŸ¥ï¼Œæœ€å¥½ä¹Ÿæ˜¯å‚³å»å…±åŒçš„ECKä¸Šé¢ï¼Œä½†ECKåœ¨GKEä¸Šé¢ã€‚\nSolution\næŠ“å–logçš„æµç¨‹ä¹Ÿè·Ÿä¸€èˆ¬çš„filebeatå·®ä¸å¤šã€‚\nfilebeatæœƒå¾ä¸»æ©Ÿä¸Šçš„ /var/lib/docker/containers/*/*.log æŠ“å–ã€‚\né€™é‚Šæ–‡å­—æª”çš„logæ˜¯docker logsçš„è³‡æ–™ï¼Œä¹Ÿå°±æ˜¯ç¨‹å¼çš„stdoutã€‚\nå®˜æ–¹ç°¡å–®èªªæ˜\nDocker-compose.yaml\næˆ‘æ˜¯ç”¨docker compose ï¼Œæ¯”è¼ƒå¥½ç®¡ç†ã€‚\nservices:\nfilebeat:\nimage: docker.elastic.co/beats/filebeat:8.15.3\nbuild: filebeat\ncontainer_name: filebeat\nuser: root\nrestart: unless-stopped\nenvironment:\n- ELASTICSEARCH_HOSTS=https://10.60.7.192:9200\n- ELASTICSEARCH_USERNAME=elastic\n- ELASTICSEARCH_PASSWORD=PASSWORD\nlabels:\nco.elastic.logs/enabled: &quot;false&quot;\nvolumes:\n- ./filebeat.yml:/usr/share/filebeat/filebeat.yml\n- /var/lib/docker/containers:/var/lib/docker/containers:ro\n- /var/run/docker.sock:/var/run/docker.sock:ro\n- ./ca.crt:/etc/pki/client/ca.crt\n- ./tls.crt:/etc/pki/client/cert.pem\n- ./tls.key:/etc/pki/client/cert.key\nlogging:\ndriver: &quot;json-file&quot;\noptions:\nmax-size: &quot;10m&quot;\nmax-file: &quot;2&quot;\nnetworks:\n- zlm_network\nnetworks:\nzlm_network:\ndriver: bridge\nname: zlm_network\n\nä¸»è¦æœƒè‘—é‡æ–¼volumeçš„éƒ¨åˆ†ã€‚\nå…¶ä»–åœ°æ–¹å¯èƒ½æœ‰é»å·®ç•°æœƒæŠ“å¹¾å€‹è¬›ã€‚\nGeneral\n\nuser: root\n\nä¸è¨­å®šçš„è©±ï¼Œåœ¨filebeat.yml çš„logging æœƒå‡ºç¾æ¬Šé™ä¸è¶³çš„éŒ¯èª¤ã€‚\n\nnetwork çš„è¨­å®šï¼Œè®“ä»–è·Ÿè¦æŠ“å–logçš„æœå‹™æ”¾åœ¨ä¸€èµ·ï¼Œæ•…åŒä¸€å€‹ç¶²è·¯åç¨±ã€‚\n\nVolume\n\nfilebeat.ymlçš„è¨­å®šæª”é€£çµï¼Œé€™éƒ¨ä»½æ²’ä»€éº¼å•é¡Œã€‚\nè£¡é¢å…§å®¹æœƒåœ¨ä¸‹é¢èªªã€‚\næŠ“å–logçš„è·¯å¾‘ /var/lib/docker/containers\næ›è¼‰SSLæ†‘è­‰\nç‚ºä»€éº¼è¦æ›è¼‰å‘¢ï¼Ÿå› ç‚ºECKåœ¨å®‰è£çš„æ™‚å€™ï¼Œé è¨­éƒ½èµ°sslï¼Œ\nä½†ECKå®‰è£æ™‚åœ¨GKEä¸Šé¢ï¼Œè€Œç›®å‰filebeatåœ¨GCEï¼Œ\næ‰€ä»¥è¦æ‹¿ECKåœ¨GKEä¸Šé¢çš„æ†‘è­‰ä¾†ç”¨ã€‚\n\né‡é»ä¾†äº†ï¼Œä½ æ€éº¼çŸ¥é“è¦æŠ“å“ªå€‹æ†‘è­‰ä¾†ç”¨ï¼Œ\næ­¤æ™‚æˆ‘å€‘å¯ä»¥å…ˆå»çœ‹ä¸€ä¸‹GKEçš„ECKè£¡é¢çš„è¨­å®šæª”ã€‚\nvolumes:\n- name: elastic-internal-http-certificates\nsecret:\nsecretName: prod-es-http-certs-internal\ndefaultMode: 420\noptional: false\n\næ­¤æ™‚ï¼Œå°±èƒ½å»decode secretäº†\nkubectl get secret prod-es-http-certs-internal -n elastic-system -o=jsonpath='{.data.ca\\.crt}' | base64 -d;echo\n\nkubectl get secret prod-es-http-certs-internal -n elastic-system -o=jsonpath='{.data.tls\\.crt}' | base64 -d;echo\n\nkubectl get secret prod-es-http-certs-internal -n elastic-system -o=jsonpath='{.data.tls\\.key}' | base64 -d;echo\n\nä¹‹å¾Œå°‡key ï¼Œæ›è¼‰è®“filebeatèƒ½å¤ è®€å–å³å¯ã€‚\nref. Run Filebeat on Docker\nFilebeat.yml\nfilebeat.inputs:\n- type: container\nenabled: true\npaths:\n- '/var/lib/docker/containers/*/*.log'\ntags: [&quot;videosokoban-qa&quot;]\n\nprocessors:\n- add_docker_metadata: ~\n- drop_event:\nwhen:\nnot:\nequals:\ncontainer.name: &quot;zlm-server&quot;\noutput.elasticsearch:\nhosts: https://prod-es-http:9200 #https://10.60.7.192:9200\nusername: &quot;elastic&quot;\npassword: &quot;PASSWORD&quot;\nssl:\ncertificate_authorities:\n- &quot;/etc/pki/client/ca.crt&quot;\ncertificate: &quot;/etc/pki/client/cert.pem&quot;\nkey: &quot;/etc/pki/client/cert.key&quot;\nindices:\n- index: &quot;videosokoban-qa-%{+yyyy.MM}&quot;\nwhen.contains:\ntags: &quot;videosokoban-qa&quot;\nlogging:\nmetrics.enabled: false\nlevel: debug\nto_stderr: true\nto_files: true\nfiles:\npath: /var/log/filebeat\nname: filebeat\nkeepfiles: 7\npermissions: 0644\n\nfilebeat.input\nè¦æ“·å–çš„logä¾†æºï¼Œ\nå·²å°‡æœ¬æ©Ÿçš„è·¯å¾‘æ›åˆ°dockerä¸Šé¢çš„è·¯å¾‘çš„ã€‚\n/var/lib/docker/containers/*/*.log\né€™å€‹è·¯å¾‘æ“æœ‰æ‰€æœ‰çš„docker logs\ntype æœ‰åˆ†æˆ containerèˆ‡ dockerã€‚\næ“šèªªæ˜¯dockeråªèƒ½ç”¨åœ¨dockerä¸Šé¢ï¼Œ\nä½†containerå¯ä»¥ç”¨åœ¨ä»»ä½•çš„å®¹å™¨æœå‹™ä¸Šé¢ã€‚\ntype: dockerçš„è¨­å®šæˆ‘æ²’æå‡ºä¾†ï¼Œæœ‰èˆˆè¶£çš„å¯ä»¥è‡ªå·±è©¦ä¸€è©¦ã€‚\nprocessors\né€™é‚Šç‰½æ‰¯åˆ°çš„éƒ¨åˆ†æ¯”è¼ƒå¤š\n\nadd_docker_metadata\nå¢åŠ ä¸€äº›æ¬„ä½åˆ°logè£¡é¢ï¼Œè©³ç´°å…§å®¹å¯åƒè€ƒ Add Docker metadata\ndrop_event ï¼Œåˆ¤æ–·ç•¶container_nameæ˜¯ zlm-serverçš„æ™‚å€™ï¼Œ\nå°±ä¸è¦ç´€éŒ„ï¼Œé€™å€‹å€¼æ˜¯å…ˆå¡è³‡æ–™é€²å»åˆ°ECKå¾Œï¼Œå†ç¯©é¸å‡ºä¾†çš„ã€‚\næ¢ä»¶åˆ¤æ–·å¯åƒè€ƒconditionsã€‚\n\nä¹‹å‰é‚„æœ‰ç”¨é drop_fileds ,add_cloud_metadataï¼Œ\nå…¶ä»–æ›´å¤šè«‹åƒè€ƒDefine processors\noutput.elasticsearch\n\nhost &amp; ssl\nè¦å°‡logä¸Ÿå»çš„ECKä¼ºæœå™¨ä½ç½®ã€‚\n\nhostsé€™é‚Šï¼Œæœ¬ä¾†æ˜¯ç”¨GKEçš„å…§éƒ¨è² è¼‰å¹³è¡¡çš„ipä½ç½®ï¼Œ\nä½†æ˜¯ç›´æ¥ä½¿ç”¨ipä½ç½®çš„è©±ï¼Œæœƒå‡ºç¾éŒ¯èª¤ã€‚\n\ncannot validate certificate for 10.60.7.192 because it doesn't contain any IP SANs\n\né€™æ˜¯å› ç‚ºä¼ºæœå™¨çš„æ†‘è­‰æ²’æœ‰åŠ éIPåœ°å€ï¼Œ\nçœ‹ä¸€ä¸‹ tls.crtï¼Œè£¡é¢çš„é€™æ®µã€‚\n\né€™è£¡ä¸¦æ²’æœ‰ipä½ç½®ï¼Œæ‰€ä»¥æ²’è¾¦æ³•é€šéé©—è­‰ã€‚\nä½†é€™å€‹æ†‘è­‰æ˜¯ECKè‡ªå‹•ç”¢ç”Ÿçš„ï¼Œ\næ‰€ä»¥æ›å€‹æƒ³æ³•ï¼Œç›´æ¥è®“æœå‹™å»å‘¼å« https://prod-es-http:9200\næ­¤æ™‚ï¼Œå°±æ˜¯åˆ°ä¸»æ©Ÿè¨­å®šä¸€ä¸‹/etc/hostsï¼Œ\næ–°å¢\n10.60.7.192 prod-es-http\n\nref. Secure communication with Elasticsearch\n\nindices\nå°‡ç‰¹å®šçš„tagç¶å®šåˆ°æŒ‡å®šçš„indicesä¸Š\n\nref.Configure the Elasticsearch output\nlogging\né™¤éŒ¯æ™‚ï¼Œ\nå¯ä»¥å…ˆå°‡to_stderr: true é–‹å•Ÿã€‚\nå¯ç›´æ¥ç”¨docker logs filebeat çœ‹ logã€‚\næ³¨æ„ï¼Œå¦‚æœè¦ç”¨ to_files, docker-compose.yaml è¨˜å¾—åŠ ä¸Š user: rootï¼Œ\nå¦å‰‡æœƒç™¼ç”Ÿæ¬Šé™ä¸è¶³çš„æƒ…æ³ã€‚\nref. Configure logging\nå®˜æ–¹çš„filebeat.yaml ï¼Œè«‹åƒè€ƒ filebeat.reference.yml",
		"tags": ["https", "note","ğŸ—’"]
},

{
		"title": "245. gcloud storageå–ä»£gsutil",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/245. gcloud storageå–ä»£gsutil/",
		"content": "WHY\nå‰›å¥½æƒ³è¦æŸ¥ä¸€ä¸‹gsutilçš„ rsyncæŒ‡ä»¤ï¼Œ\nçµæœå®˜æ–¹æ–‡ä»¶ä¸€ç›´è·‘ä¸å‡ºä¾†ï¼Œ\nç´°çœ‹æ‰ç™¼ç¾\n\né€šå¸¸ï¼Œæ‚¨æ‡‰è©²ä½¿ç”¨Â gcloud storageÂ å‘½ä»¤)è€Œä¸æ˜¯Â gsutilÂ å‘½ä»¤ï¼š\ngsutil å·¥å…·æ˜¯ä¸€å€‹èˆŠç‰ˆ Cloud Storage CLIï¼Œåƒ…é€²è¡Œæœ€ä½ç¨‹åº¦çš„ç¶­è­·ã€‚\ngsutil å·¥å…·ä¸æ”¯æ´ä½¿ç”¨è¼ƒæ–°çš„ Cloud Storage åŠŸèƒ½ï¼Œä¾‹å¦‚è»Ÿåˆªé™¤å’Œè¨—ç®¡å¼è³‡æ–™å¤¾\ngcloud storageÂ å‘½ä»¤éœ€è¦è¼ƒå°‘çš„æ‰‹å‹•æœ€ä½³åŒ–å³å¯å¯¦ç¾æœ€å¿«çš„ä¸Šå‚³å’Œä¸‹è¼‰é€Ÿç‡ã€‚\n\nçœ‹ä¾†æˆ‘è©²æ”¹ç¨‹å¼äº†ã€‚\nNote\nGsutil\n\nrsync åŒæ­¥\n\ngsutil -m rsync -r /home/user/docker-compose/VideoSokoban/MP4Final gs://abc\n\nchange\n\ngcloud storage rsync -r /home/user/docker-compose-yaml/VideoSokoban/MP4Final gs://abc\n\nref. gcloud storage rsync\n\nsignurl ä¸‹è¼‰æ¬Šé™\n\ngsutil signurl -d 30m gcs-download.json gs://backup/downloadbak/24-4-17.bak\n\nchange\n\ngcloud storage sign-url -d=30m --private-key-file=gcs-download.json gs://backup/downloadbak/24-4-17.bak\n\nä½†ç¬¬ä¸€æ¬¡åŸ·è¡Œæ™‚ï¼Œå¯èƒ½æœƒç™¼ç”ŸéŒ¯èª¤\n\nERROR: (gcloud.storage.sign-url) This command requires the pyOpenSSL library. Please install it and set the environment variable CLOUDSDK_PYTHON_SITEPACKAGES to 1 before re-running this command\n\nåŸ·è¡Œ\nexport CLOUDSDK_PYTHON_SITEPACKAGES=1\n\nref. gcloud storage sign-url\n\ndu æŸ¥bucketå¤§å°\n\ngcloud storage du gs://abc --summarize --readable-sizes\n\nref. gcloud storage du\næˆ–æ˜¯åœ¨Metrics Explorer ï¼ŒæŸ¥è©¢ Total bytes (v2) é¸æ“‡ GCS Bucketã€‚\né€™é‚Šä¹Ÿæœ‰ Total count (v2) å¯ä»¥æŸ¥è©¢åŠ ç¸½ã€‚\nfilterå¯æŒ‡å®šbucket nameã€‚\nå®Œæ•´ api storage.googleapis.com/storage/v2/total_bytes\n\ncors\n\ngsutil cors set example_cors_file.json gs://example_bucket\næ”¹\ngcloud storage buckets update gs://example_bucket --cors-file=example_cors_file.json\n\nref.\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/142.gcs corsè¨­å®š/\">142.gcs corsè¨­å®š</a>\nSet up and view CORS configurations\n\ncp è¤‡è£½\n\ngsutil cp -n gs://abc/57d51e14-6ea2-409a-9bee-07a832456cf6.jpg .\n\ngcloud storage cp -n Â gs://abc/57d51e14-6ea2-409a-9bee-07a832456cf6.jpg .\n\nref. gcloud storage cp",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "246. GCPç¶²è·¯è²»ç”¨ç²—ä¼°è¨ˆç®—",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/246. GCPç¶²è·¯è²»ç”¨ç²—ä¼°è¨ˆç®—/",
		"content": "WHY\næ˜¨å¤©çªç„¶èªªè¦å«æˆ‘ç®—ä¸€ä¸‹å½±éŸ³ä¸²æµï¼Œå¦‚æœæ¯ç§’2MBçš„è©±ï¼Œä¸€å€‹æœˆå¤šå°‘ã€‚\nSolution\nQ: ç¾åœ¨çš„é¡Œç›®ï¼Œæ¯ç§’æœ‰ 2Mbçš„ä¸²æµï¼Œæ¯æœˆæœƒæœ‰å¤šå°‘è²»ç”¨ã€‚\nå…ˆè¨ˆç®—æ¯æœˆæµé‡\n2*60*60*24*30=5184000(Mb)\nå†è½‰æˆMB\n51840000/8=648000\nå› Googleçš„è²»ç”¨å–®ä½éƒ½æ˜¯ GiB (1GB ç´„0.93GiB)ï¼Œ\næ‰€ä»¥ 648 GB = 602GiB\np.s GBæ˜¯åé€²åˆ¶ï¼ŒGiBæ˜¯äºŒé€²åˆ¶\nçµ„æˆ\nç¶²è·¯çš„è²»ç”¨åˆ†æˆå…©å¡Šï¼Œ\nData transfer(è³‡æ–™å‚³è¼¸) + data processes(è³‡æ–™è™•ç†)\nå…¥ç«™ä¸æ”¶ data transferçš„è²»ç”¨ï¼Œä½†æœƒæ”¶ data processesçš„è²»ç”¨ã€‚\nå‡ºç«™ï¼Œå…©é‚Šçš„è²»ç”¨éƒ½æœƒæ”¶ã€‚\nInbound\nprocesses dataçš„æœå‹™ æœ‰ Load Balancer ã€Cloud NAT ã€ Protocol forward\n\nå¾LB é€²å…¥çš„data processesè²»ç”¨ç‚º 602*0.008=4.816\nLBçš„è½‰ç™¼è¦å‰‡å‰äº”æ¢ï¼Œæ¯å°æ™‚ 0.025 ï¼Œæ–¼æ˜¯ 0.025*24*30=18\næ–¼æ˜¯ï¼Œinboundçš„ LB è³‡æ–™è™•ç†è²»ç”¨ç‚º 22.816 USD\nOutbound\né€™é‚Šè¨ˆç®—æ™‚ï¼Œå‹™å¿…ææ¸…æ¥š å“ªä¸€é‚Šæ˜¯client å“ªä¸€é‚Šæ˜¯ serverã€‚\nGKE Private Cluster çš„ç¶²è·¯å…¥è·Ÿå‡ºçš„IPä¸ä¸€æ¨£ï¼Œ\næ‰€ä»¥è¨ˆç®—æ–¹å¼ä¹Ÿä¸ä¸€æ¨£ã€‚\nç¬¬ä¸€ç¨®\nå®¢æˆ¶ç›´æ¥é€£ç·šåˆ°serveræŠ“å–ä¸²æµ\næ‰€ä»¥GKEæ˜¯serverï¼Œæ˜¯å¾Load Balancerå‡ºã€‚\nData processes è²»ç”¨\nè·Ÿä¸Šé¢inboundçš„è²»ç”¨ä¸€æ¨£ï¼Œéƒ½æ˜¯ æ¯GiB 0.008 ï¼Œæ‰€ä»¥æ˜¯ 22.816\nData Transfer è²»ç”¨\n&gt; 602*0.23 = 138.46\nÂ \nÂ 0.23æ˜¯å°ç£åˆ°ä¸­åœ‹çš„æ¯GBè²»ç”¨ï¼Œ\nÂ åˆ°å…¶ä»–åœ°æ–¹çš„åƒ¹æ ¼ä¸ä¸€æ¨£ã€‚\nÂ \nÂ ref. è™›æ“¬ç§äººé›²ç«¯ ç¶²éš›ç¶²è·¯è³‡æ–™ç§»è½‰é€Ÿç‡-&gt; é€²éšç´šè¨ˆåƒ¹æ¨¡å¼\næ‰€ä»¥ç¸½é‡‘é¡ç´„ç‚º 138.46+22.816 = 161.276\nç¬¬äºŒç¨®\næœå‹™ç›´æ¥å°‡ä¸²æµæ‰“åˆ°å°æ–¹çš„ä¼ºæœå™¨ä¸Š\næ‰€ä»¥GKEæ˜¯clientï¼Œæ˜¯åƒCloud NATçš„æµé‡ã€‚\nData processes è²»ç”¨\n\n(0.044*720) + (0.005*1*720)+(5184*0.045)=43.056\n\n(0.044ï¼Š720 ) : è¶…é32å€‹VM ï¼ŒNAT é–˜é“çš„æ¯å°æ™‚åƒ¹æ ¼ 0.044 ï¼Œä¸€å€‹æœˆæœ‰720å€‹å°æ™‚\n(0.005ï¼Š1ï¼Š720)ï¼šNATé–˜é“çš„IPï¼Œ1å€‹æ¯å°æ™‚0.005\n(172.8ï¼Š0.045)ï¼š æ¯è™•ç† GiB è³‡æ–™ã€å‚³å…¥èˆ‡å‚³å‡ºè³‡æ–™ç§»è½‰çš„åƒ¹æ ¼ 0.045 ï¼Œ172.8G\nData Transfer è²»ç”¨\n&gt; 602*0.23 = 138.46\nÂ \nÂ 0.23æ˜¯å°ç£åˆ°ä¸­åœ‹çš„æ¯GBè²»ç”¨ï¼Œ\nÂ åˆ°å…¶ä»–åœ°æ–¹çš„åƒ¹æ ¼ä¸ä¸€æ¨£ã€‚\næ‰€ä»¥ç¸½é‡‘é¡ç´„ç‚º 138.46+43.056 = 181.516\nref. Cloud NAT\nè£œå……\nInter-region data transfer\nå¦‚æœæ˜¯è·¨regionçš„è©±ï¼Œä¹Ÿæ˜¯è¦ç®—éŒ¢çš„ã€‚\n\nåƒè€ƒ Inter-region data transfer\nInter-zone data transfer\nå¦‚æœæ˜¯ç›¸åŒregionï¼Œä¸åŒzoneçš„è©±ï¼Œæ¯ GiB 0.01\nç›¸åŒregionï¼Œç›¸åŒzoneçš„è©±å‰‡ä¸ç®—éŒ¢ã€‚",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "247. MSSQLæŒ‡ä»¤è³¦äºˆæ¬Šé™",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/247. MSSQLæŒ‡ä»¤è³¦äºˆæ¬Šé™/",
		"content": "WHY\nå› ç‚ºä¹‹å‰RDçµ„é•·çœŸçš„å¹¹äº†å¾åˆªåº«åˆ°è·‘è·¯çš„éç¨‹ï¼Œ\né‡é»åˆªäº†é‚„æ²’è·‘è·¯ã€‚\næ–¼æ˜¯æ¯å€‹RDçš„è³‡æ–™åº«æ¬Šé™ç›´æ¥ç¸®æ¸›ã€‚\nä½†ç”±æ–¼ç¨‹å¼æ˜¯ä½¿ç”¨ORM ï¼Œæœƒè‡ªå»ºè³‡æ–™åº«ã€‚\nå°è‡´RDæ²’æœ‰æ¬Šé™å¯ä»¥é€£åˆ°æ–°å»ºçš„DBï¼Œ\næˆ‘åªèƒ½æ‰‹å‹•è³¦äºˆæ¬Šé™ï¼Œä½†æ¯æ¬¡æ–°å¢å¥½ç…©ï¼Œ\næˆ‘åˆæ²’windowï¼Œåªèƒ½ç”¨VMé–‹SSMSå‡ºä¾†ç”¨ã€‚\nSolution\nç”¨æŒ‡ä»¤ç›´æ¥è§£æ±º\n\ncreate USER bmsrd for login bmsrd\nEXEC sp_addrolemember 'db_datareader','bmsrd'\nEXEC sp_addrolemember 'db_datawriter','bmsrd'\n\nä»¥å¾Œç›´æ¥åˆ° Googleçš„ Cloud SQL Studio åŸ·è¡ŒæŒ‡ä»¤å°±å¥½ã€‚\næˆ–æ˜¯ä½¿ç”¨ Azure Data Studioå°±å¥½äº†ã€‚",
		"tags": [ "note","ğŸ—„"]
},

{
		"title": "250. findæŒ‡ä»¤ç­†è¨˜",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/250. findæŒ‡ä»¤ç­†è¨˜/",
		"content": "WHY\næœ€è¿‘åœ¨å¼„crontabçš„å•é¡Œï¼Œ\nçµæœæ‰ç™¼ç¾find åŠ ä¸Š deleteæ»¿æ»¿çš„ç´°ç¯€ã€‚\nNote\n\næœå°‹æ™‚é–“\n\né€™é‚Šè¦å…ˆçŸ¥é“ä¸€ä»¶äº‹ï¼Œatime, mtime , ctime éƒ½æ˜¯ç”¨n*24 hour\nä½œç‚ºæ™‚é–“æ¯”å°çš„ä¾æ“šï¼Œ\nåˆ¤æ–·æ–‡ä»¶è·é›¢ä¸Šæ¬¡ä¿®æ”¹æ™‚é–“å·²ç¶“éäº†å¹¾å€‹24å€‹å°æ™‚æ™‚æ®µã€‚\nfind . -mtime -1 # æ‰¾åˆ°æœ€å¾Œä¿®æ”¹æ™‚é–“ç‚ºã€Œå°‘æ–¼ 1 å¤©å‰ã€çš„æª”æ¡ˆã€‚\nfind . -mtime 1 # æ‰¾åˆ°æœ€å¾Œä¿®æ”¹æ™‚é–“ç‚ºã€Œå‰›å¥½ 1 å¤©å‰ã€çš„æª”æ¡ˆã€‚\nfind . -mtime +1 # æ‰¾åˆ°æœ€å¾Œä¿®æ”¹æ™‚é–“ç‚ºã€Œè¶…é 1 å¤©å‰ã€çš„æª”æ¡ˆã€‚\n\nå‡è¨­ç¾åœ¨æ™‚é–“ æ˜ŸæœŸå›› 14:55\n-mtime -1 æœ€å¾Œä¿®æ”¹æ™‚é–“ æ˜¯ æ˜ŸæœŸä¸‰çš„14:55åˆ°æ˜ŸæœŸå››çš„14:55ä¹‹é–“çš„æª”æ¡ˆ\n-mtime 1 æœ€å¾Œä¿®æ”¹æ™‚é–“æ˜¯ æ˜ŸæœŸäºŒ14:55åˆ° æ˜ŸæœŸä¸‰çš„14:55çš„æª”æ¡ˆ\n-mtime +1 æœ€å¾Œä¿®æ”¹æ™‚é–“æ˜¯ æ˜ŸæœŸäºŒ14:55ä¹‹å‰çš„æª”æ¡ˆ\nå…¶ä»–é‚„æœ‰é€™å…©å€‹åƒæ•¸å¯ä¾›ä½¿ç”¨\n-atime æœ€è¿‘è¨ªå•æ™‚é–“\n-ctime æœ€è¿‘ç‹€æ…‹æ”¹å‹•æ™‚é–“\né€™å¹¾å€‹æ™‚é–“éƒ½å¯ç”¨statæŸ¥çœ‹\né€™å¼µåœ–è¡¨ç¤º -5,5,+5çš„å·®åˆ¥\n\nå¦‚æœè¦æŸ¥è©¢åˆ†é˜çš„è©±ï¼Œ\nå‰‡æ˜¯ä½¿ç”¨ -amin,-mmin,-cmin ç”¨æ³•è·Ÿä¸Šé¢å·®ä¸å¤šã€‚\nref. å¾¹åº•ææ˜ç™½findå‘½ä»¤mtimeå«ç¾©å’Œç”¨æ³•\n\næŸ¥çœ‹èªªæ˜æ–‡ä»¶\n\nman find\n\næœå°‹é¡å‹\n\nfind . -type f # æœå°‹æª”æ¡ˆ\nfind . -type d # æœå°‹è³‡æ–™å¤¾\n\næœå°‹æª”æ¡ˆåç¨±\n\nfind . -iname &quot;docker&quot; # ä¸å€åˆ†å¤§å°å¯«\nfind . -name &quot;*.mp4&quot; # å‰¯æª”åç‚ºmp4\n\nåŸ·è¡Œå¾Œå†å…¶ä»–æŒ‡ä»¤\n\nfind . -iname &quot;docker&quot; -exec rm -f {} +\n\n{} ä»£è¡¨å°‡å‰é¢æœå°‹çš„çµæœå‚³åˆ°å¾Œé¢çš„åƒæ•¸ï¼Œ\n+ è¡¨ç¤ºå°‡çµæœä¸€æ¬¡å‚³é€²å»çµ¦rmï¼Œå¦ä¸€ç¨®ä½œæ³•æ˜¯ \\;ï¼Œé‡å°æ¯å€‹è³‡æ–™å¤¾éƒ½åŸ·è¡Œä¸€æ¬¡rmçš„æŒ‡ä»¤\nè¨˜å¾—\\å‰é¢çš„ç©ºæ ¼ã€‚\n\næ’é™¤ç‰¹å®šè³‡æ–™å¤¾\n\nfind . -iname &quot;docker&quot; -mindepth 1 -path /home/user/docker -prune -o -print\n\n-o åœ¨findä¸­ï¼Œä»£è¡¨ORçš„é‚è¼¯ï¼Œå…¶ä¸­ä¸€å€‹ç‚ºtrueæ‰åŸ·è¡Œï¼Œ\nåŸºæœ¬èªæ³•ç‚ºfind &lt;path&gt; &lt;condition1&gt; -o &lt;condition2&gt;\næ‰€ä»¥ -o -printçš„ç”¨æ„è­˜ï¼Œå¦‚æœä¸æ˜¯ /home/user/dockerçš„è³‡æ–™å¤¾å°±print\nref.\n\nåœ¨ Linux ä¸‹ä½¿ç”¨ find æŒ‡ä»¤æŸ¥è©¢ç›®éŒ„èˆ‡æª”æ¡ˆçš„é€ŸæŸ¥ç­†è¨˜)\nUnix/Linux çš„ find æŒ‡ä»¤ä½¿ç”¨æ•™å­¸ã€æŠ€å·§èˆ‡ç¯„ä¾‹æ•´ç†\n\nå–®ç´”ç´€éŒ„ä¸€ä¸‹éº»ç…©çš„è¦æ­»çš„cpåŠŸèƒ½ï¼Œ\nå¾Œé¢é‚„æ˜¯ç”¨glcoud storage rsyncè™•ç†æ‰ï¼ŒcpçœŸçš„å¤ªæ…¢äº†ã€‚\n#!/bin/bash\ntotal=$(find /home/user/MP4Final -type f -cmin -1 | wc -l)\nfind /home/user/MP4Final -type f -cmin -5 | while read file; do\n\n# æå–æª”æ¡ˆåç¨±\nfilename=$(basename &quot;$file&quot;)\n\n# æå–æœ€å¾Œå…©å€‹è³‡æ–™å¤¾åç¨±\nlast_two_dirs=$(echo &quot;$file&quot; | awk -F/ '{print $(NF-2) &quot;/&quot; $(NF-1)}')\n\n# ç›®æ¨™ä½ç½®\ntarget_dir=&quot;video/$last_two_dirs&quot;\n\n#echo &quot;source:$file&quot;\n#echo &quot;$target_dir/$filename&quot;\ngcloud storage cp -n &quot;$file&quot; &quot;gs://$target_dir/$filename&quot; --quiet\ndone\necho &quot;total: $total&quot;",
		"tags": ["echo", "echo", "note","ğŸ§"]
},

{
		"title": "251.  GCEä¸Šçš„dockerç›£æ§",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/251.  GCEä¸Šçš„dockerç›£æ§/",
		"content": "WHY\nä¹‹å‰å› ç‚ºæ¶æ§‹é—œä¿‚ï¼Œå»ºäº†å¹¾å€‹åœ¨GCEä¸Šçš„dockeræœå‹™ã€‚\nå¤–å±¤ä¸»æ©Ÿå¯ä»¥é€éGCPçš„metricç›£æ§ï¼Œ\nä½†è£¡é¢çš„dockerå°±ä¸çŸ¥é“äº†ã€‚\nSolution\næŸ¥äº†ä¸€ä¸‹ï¼Œ\næŠŠcAdvisorè£èµ·ä¾†å°±å¥½äº†ã€‚\né€™æ˜¯ä¸€å€‹å°ˆé–€ç”¨åœ¨ç›£æ§VMä¸»æ©Ÿä¸Šçš„dockerã€‚\ncAdvisor\ndocker-compose.yaml\nservices:\ncadvisor:\ncontainer_name: cadvisor\nimage: gcr.io/cadvisor/cadvisor:latest\npull_policy: if_not_present\nrestart: always\nprivileged: true\nvolumes:\n- /:/rootfs:ro\n- /var/run:/var/run:ro\n- /sys:/sys:ro\n- /var/lib/docker/:/var/lib/docker:ro\n- /dev/disk/:/dev/disk:ro\nports:\n- 8888:8080\nnetworks:\n- zlm_network\nnetworks:\nzlm_network:\nname: zlm_network\ndriver: bridge\n\nè¨˜å¾—æ”¹ç”¨ gcr.io/cadvisor/cadvisor:latest\nå¦‚æœä½ æŸ¥åˆ°çš„æ–‡ç« æœ‰äººç”¨ google/cadvisor:latest\né€™ç¨®åœ¨å»ºåˆ¶æ™‚æœƒç™¼ç”ŸéŒ¯èª¤\n\nFailed to create a Container Manager: mountpoint for cpu not found\n\næ¶å¥½å¾Œï¼Œå¯ä½¿ç”¨ä¸‹é¢æ–¹æ³•æ¸¬è©¦\ncurl http://127.0.0.1:8888/metrics\n\nprometheus\nè¦å»ºä¸€å€‹æ–°çš„æˆ–æ˜¯æ‹¿èˆŠçš„å¥—ç”¨éƒ½å¯ä»¥ã€‚\né‡é»æ˜¯configï¼Œ\nå› æˆ‘çš„prometheusæ›åœ¨GKEä¸Šé¢ï¼Œ\næ‰€ä»¥ç›´æ¥è®“prometheuså»å–å¾—GCEçš„metricsã€‚\n- job_name: 'game-result-stage'\nscrape_interval: 15s\nstatic_configs:\n- targets:\n- '&lt;ip&gt;:8888'\n\nGrafana\nå¯ç›´æ¥åŒ¯å…¥ 11600 é€™å€‹dashboardã€‚\nref.\n\nMonitoring Servers and Docker Containers using Prometheus with Grafana",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "252. k8sä¸­çš„podå‘¼å«",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/252. k8sä¸­çš„podå‘¼å«/",
		"content": "WHY\nå…¶å¯¦å¦‚æœæ¶æ§‹å¯ä»¥ï¼Œ\næ‡‰è©²æ˜¯ä¸éœ€è¦ç”¨åˆ°é€™å€‹åŠŸèƒ½ã€‚\nç”¨é€™å€‹ä¹Ÿæœ‰å‰æï¼Œå¿…é ˆè¦æ˜¯statefulsetã€‚\nSolution\npodæœ¬èº«çš„nameæ˜¯éš¨æ©Ÿçš„ï¼Œ\næ‰€ä»¥ä¸å¤ªå¯èƒ½ç”¨ç¨‹å¼å¯«æ­»å»å‘¼å«ä»–ï¼Œ\nç•¶ç„¶ï¼ŒçœŸçš„è¦ç¡¬å¹¹é‚„æ˜¯å¯ä»¥ã€‚\nstatefulSetï¼Œä»–çš„podæ˜¯å¾0é–‹å§‹å¾€å¾Œï¼Œ\nå¾k8sçš„æ–‡ä»¶çœ‹ï¼Œå‘¼å«å–®å€‹podçš„æ–¹å¼ï¼Œ\n&lt;podname&gt;.&lt;servicename&gt;.&lt;namespace&gt;.svc.cluster.local\nref. Stable Network ID\nä½†æ˜¯ï¼ï¼ï¼æˆ‘åœ¨æ¸¬è©¦æ™‚ï¼Œå°±è«åå…¶å¦™ä¸€ç›´å¡é—œã€‚\nåˆ°æœ€å¾Œé‚„ç›´æ¥å»æŸ¥kube-dnsçš„å€¼ï¼Œçœ‹æ˜¯æ€éº¼è§£æçš„ã€‚\næ¸¬è©¦çš„statefulsetæ˜¯rabbitMQï¼Œ\n\nå¾ä¸Šåœ–å¯ä»¥çµ„æˆä¸‹é¢çš„ç¶²å€\ncurl http://qa-rabbitmq-server-1.qa-rabbitmq.rabbitmq-system.svc.cluster.local:15692/metrics\n\næ¸¬è©¦æ™‚ï¼Œä¸€ç›´å‡ºç¾éŒ¯èª¤ï¼Œæ‰¾ä¸åˆ°æœå‹™ã€‚\nä½†ç”¨pod IPå¯ä»¥æ‰¾åˆ°è³‡æ–™ã€‚\næœ€å¾Œæ°£åˆ°ï¼Œç›´æ¥è£äº†nslookupï¼ŒåæŸ¥dnsåç¨±äº†ã€‚\napt-get install dnsutils\n\nor\n\nyum install bind-utils\n\nè¦æŸ¥è©¢ä¹‹å‰ï¼Œæœ€å¥½å…ˆæ‰¾åˆ°ä½ çš„kube-dns çš„pod ipï¼Œ\nä¸éå…¶å¯¦é è¨­çš„dnsæ‡‰è©²å°±æ˜¯kube-dnsçš„ipäº†\nä½†ç‚ºäº†è¬ä¸€ï¼Œæˆ‘é‚„æ˜¯å¼·åˆ¶æŒ‡å®šä¸€ä¸‹ï¼Œå¦‚æœæœ‰å¤šå€‹podï¼Œéš¨ä¾¿æŠ“ä¸€å€‹å°±å¥½ï¼Œ\nkube-dnsçš„ip 192.168.24.157\n\nåˆ©ç”¨rabbitMQçš„ip åæŸ¥domain\nçµæœ..ipè¨»å†Šçš„domainæ˜¯\nqa-rabbitmq-server-1.qa-rabbitmq-nodes.rabbitmq-system.svc.cluster.local\nç…§æ ¼å¼ä¾†è¬›æ²’éŒ¯ï¼Œä½†ä»–ç”¨çš„æ˜¯å¦ä¸€å€‹service nameï¼Œ\nç‚ºä»€éº¼æˆ‘åˆ°ç¾åœ¨é‚„æ˜¯ä¸æ¸…æ¥šã€‚",
		"tags": [ "note","âˆ"]
},

{
		"title": "253. dockerå…§æœå‹™ç‹€æ…‹åˆ¤æ–·",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/253. dockerå…§ç›£æ§æœå‹™ç‹€æ…‹/",
		"content": "WHY\nä¸Šä¸€ç¯‡ <a class=\"internal-link is-unresolved\" href=\"/404\">251. GCEä¸Šçš„dockerç›£æ§</a> ï¼Œ\nèƒ½å–å¾—æœå‹™æœ¬èº«çš„CPUã€Memory..ç­‰ï¼Œ\nä½†å¦‚æœè¦åˆ¤æ–·æœå‹™æœ‰æ²’æœ‰æ­£å¸¸ï¼Œ\né‚„çœŸçš„ä¸çŸ¥å¾ä½•è‘—æ‰‹ã€‚\nSolution\nä½¿ç”¨ container_last_seen é…ä¸Š absentå–çµ•å°å€¼\nabsent(container_last_seen{name=~&quot;filebeat&quot;}) OR vector(0)\n\nç‚ºä»€éº¼è¦åŠ ä¸Š or vector(0)çš„åŸå› æ˜¯\nç•¶promQLåˆ¤æ–·æœå‹™ filebeaté‚„æ´»è‘—çš„è©±ï¼Œ\nä¸æœƒæœ‰ä»»ä½•è³‡æ–™ã€‚\n\nç•¶æœå‹™æ²’å•Ÿå‹•æ™‚ï¼Œæ‰æœƒé¡¯ç¤º 1\næ–¼æ˜¯åŠ ä¸Šå¾Œé¢ OR vector(0)\nç•¶æ²’æœ‰æŸ¥è©¢çµæœæ™‚ï¼Œé è¨­æœƒé¡¯ç¤º 0 ï¼Œæ–¹ä¾¿å‘Šè­¦å¾©æ­¸ã€‚\nref. What container_last_seen use for",
		"tags": [ "note","ğŸ³"]
},

{
		"title": "256. å–å¾—requestçš„header",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/256. httpbinå–å¾—requestçš„header/",
		"content": "WHY\né€™å¹¾å¤©åœ¨GKEå¹«äººæ¶srs origin+edge +zlm ï¼Œ\nç„¶å¾Œåˆ°æœ‰æ²’æœ‰ä¾†æºIPçš„headerå¯ä¾›ä½¿ç”¨ï¼Œ\næˆ‘è¨˜å¾—æœ‰ï¼Œä½†å¿˜è¨˜åç¨±ï¼Œ\nç¾åœ¨åªæœ‰å…©æ¢è·¯ ï¼Œä¸€æ¢æ˜¯è‡ªå·±å¯«å€‹å¾Œç«¯å›å‚³headerçš„æœå‹™ã€‚\nå¦ä¸€å€‹å°±æ˜¯æ‰¾åˆ¥äººå¯«å¥½çš„ï¼Œé‚„å¥½æœ‰æ‰¾åˆ°ï¼ˆæˆ‘å°±è¨˜å¾—æˆ‘çœ‹éï¼‰ï¼Œ\nä¸ç„¶çœŸçš„è¦è‡ªå·±å¯«äº†ã€‚\nSolution\næœ‰è«‹ï¼Œ Httpbin ï¼Œ\nè¦åƒè€ƒç”¨å“ªäº›pathçš„è©±ï¼Œå¯ä»¥å…ˆåˆ°å®˜æ–¹æ–‡ä»¶çœ‹ä¸€ä¸‹ã€‚\næˆ‘å°±ç›´æ¥æ›è¼‰æˆdeployå’Œserviceäº†ã€‚\napiVersion: v1\nkind: Namespace\nmetadata:\nname: xff\nlabels:\nistio-injection: enabled\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: httpbin\nnamespace: xff\nlabels:\ngroup: srs\napp: httpbin\nspec:\nreplicas: 1\nrevisionHistoryLimit: 5\nprogressDeadlineSeconds: 30\nselector:\nmatchLabels:\ngroup: srs\napp: httpbin\nstrategy:\nrollingUpdate:\nmaxSurge: 25%\nmaxUnavailable: 25%\ntype: RollingUpdate\ntemplate:\nmetadata:\nlabels:\ngroup: srs\napp: httpbin\nspec:\ncontainers:\n- name: srs\nimage: kennethreitz/httpbin\nimagePullPolicy: IfNotPresent # IfNotPresent, Always, Never\nports:\n- name: http-web\ncontainerPort: 80\nprotocol: TCP\ndnsPolicy: ClusterFirst\nrestartPolicy: Always\nterminationGracePeriodSeconds: 30\n---\napiVersion: v1\nkind: Service\nmetadata:\nname: httpbin\nnamespace: xff\nspec:\ntype: LoadBalancer\nselector:\ngroup: srs\napp: httpbin\nports:\n- name: http-web\nprotocol: TCP\nport: 80\ntargetPort: 80\n- name: https\nprotocol: TCP\nport: 443\ntargetPort: 80\n\nç„¶å¾Œï¼Œcloudflareæ›ipï¼Œé–‹å•Ÿproxyã€‚\nç”¨è‡ªå·±çš„é›»è…¦å‘¼å«è‡ªå·±è¨­å®šçš„domainã€‚\ncurl -X Get https://video-httpbin.abc.com/get\n\né€™æ¨£å°±çœ‹å¾—åˆ°headersè£¡é¢çš„ Cf-Connecting-Ip å°±æ˜¯ä¾†æºIPã€‚",
		"tags": [ "note","âˆ"]
},

{
		"title": "257. istio-proxy Readiness probe failed",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/257. istio-proxy Readiness probe failed/",
		"content": "WHY\næœ€è¿‘åŒäº‹åœ¨å£“æ¸¬æœå‹™ï¼Œ\nç„¶å¾Œç™¼ç¾ä»–çš„podå¸¸å¸¸ç„¡æ•…é‡å•Ÿï¼Œ\nä¸æ˜¯restartï¼Œè€Œæ˜¯æ•´å€‹podé‡å»ºã€‚\nSolution\n2024/12/13æ›´æ–°\næ‰¾çš„æ–¹å‘éŒ¯èª¤ï¼Œç›®å‰æ˜¯é€™å€‹NodePoolåªè¦æ›ä¸ŠTaintå¾Œï¼Œ\nå£“æ¸¬æ™‚ï¼Œå°±æœƒå°è‡´Istio-proxyçš„readines æ¯å°æ™‚é‡é–‹ä¸€æ¬¡ã€‚\nçœ‹eventäº‹ä»¶ï¼Œç™¼ç¾é€™å€‹éŒ¯èª¤ã€‚\nçœ‹ä¾†æ˜¯istio-proxyæœ¬èº«çš„Readinesså°è‡´ã€‚\n\nç„¶å¾Œæª¢æŸ¥istio-proxyæœ¬èº«çš„resource ä¹Ÿæœ‰è¨­å®šlimitã€‚\nå…ˆæ”¹å€‹limitè¨­å®šè©¦è©¦ã€‚\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: gameservice\ngroup: gameservice\ntemplate:\nmetadata:\nannotations:\nsidecar.istio.io/proxyCPU: 200m\nsidecar.istio.io/proxyCPULimit: 2000m\nsidecar.istio.io/proxyMemory: 128Mi\nsidecar.istio.io/proxyMemoryLimit: 2Gi\nspec:\ncontainers:\n....\n\né€™å€‹å¯ä»¥æŒ‡å®šå–®å€‹podä½¿ç”¨æ­¤è¨­å®šï¼Œ\nå¦‚æœè¦è¨­æˆå…¨åŸŸï¼Œåƒè€ƒsetting-global-resource-requests-for-sidecar-proxy\nä½†æ˜¯ï¼Œé€™æƒ…æ³ä»ç„¶æœƒç™¼ç”Ÿã€‚\nçŒœæ¸¬å¯èƒ½æ˜¯å£“ç­–æ™‚ï¼Œå¤§é‡çš„è«‹æ±‚å¡åˆ°istio-proxyè£¡é¢å°è‡´ç„¡æ³•è² è·ã€‚\nå¦ä¸€ç¨®æ˜¯ç›´æ¥ åœç”¨readinessäº† ã€‚\nä¸‹é¢çš„æ–¹æ³•ï¼Œæ˜¯æ”¹å¯«ä¸æ˜¯åœç”¨ï¼Œ\nç›®å‰é‚„æ²’æ‰¾åˆ°åœç”¨çš„æ–¹æ³•ã€‚\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: gameservice\ngroup: gameservice\ntemplate:\nmetadata:\nannotations:\n\t\tsidecar.istio.io/rewriteAppHTTPProbers: &quot;false&quot;\nspec:\ncontainers:\n....\n\nref.\n\nIstio æœå‹™çš„å¥åº·æª¢æŸ¥\nResource Annotations\nWorkload Group",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "258. GCPè²»ç”¨è©¦ç®—",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/258. GCPè²»ç”¨è©¦ç®—/",
		"content": "WHY\nä¹‹å‰è½ä¸Šé¢çš„èªªï¼Œä»–å€‘æœ‰è²·GCPçš„è²»ç”¨æŠ˜æ‰£ã€‚\nç›´åˆ°æœ€è¿‘æˆ‘é–‹å§‹ç”³è«‹è²»ç”¨è¡¨å–®ï¼Œ\næ‰ç™¼ç¾ç”³è«‹çš„é‡‘é¡èˆ‡GCPä¸Šé¢çš„è²»ç”¨ä¸€è‡´ï¼Œ\næä¸æ‡‚æ€éº¼ä¸€å›äº‹ã€‚\nNote\né¦–å…ˆï¼Œè¦å…ˆåˆ° Billingè£¡é¢çš„Pricingï¼ŒæŸ¥çœ‹SKUçš„æŠ˜æ‰£ã€‚\né€™é‚Šå¾ˆå¤šé¸é …ï¼Œ\nå»ºè­°æ˜¯å…ˆåˆ°Reportè£¡é¢ç›´æ¥æ‹¿SKU IDæœå°‹ï¼ŒGroup byé¸æ“‡ SKUã€‚\næˆ–æ˜¯åˆ° Google Cloud Platform SKUs æœå°‹ SKU IDã€‚\n\næœ€å¾Œï¼Œåˆ°pricingè²¼ä¸Š SKU ID\n\nå°±èƒ½æŸ¥åˆ° Effective discountã€‚\nå†ä¾†ä»¥å‰ä¸‰é«˜çš„é‡‘é¡è©¦ç®—\n\nä»¥ç¶²è·¯è²»ç”¨(Network Inter Region Data Transfer Out from Americas to APAC):12587.22Gï¼Œ\nä»¥GCP è¨ˆç®—æ©Ÿè¨ˆç®—ç‚º $1006.9ï¼ŒæŠ˜æ‰£ 22% ï¼Œæ•… 785.382ï¼Œèˆ‡è²»ç”¨æ˜ç´°ä¸€è‡´ã€‚\nè¨ˆç®—æ©Ÿè¨ˆç®—æ™‚ï¼Œè¦åˆ†æ¸…æ¥šæ˜¯å“ªä¸€é‚Šã€‚\nä»¥è²»ç”¨åç¨±ä¾†çœ‹æ˜¯å±¬æ–¼ Inter Region çš„è³‡æ–™è¼¸å‡ºï¼Œ\næ•…é¸æ“‡ä¸‹é¢çš„ Inter-Regionã€‚\n\nGCPç¶²ç«™ä¸Šï¼Œä»¥CPUï¼šC2D ä½¿ç”¨æ™‚é–“ 36248.56ï¼Œæ¯å°æ™‚ 0.034231ï¼Œç‚º1240.82 ï¼ŒæŠ˜æ‰£ 26% æ•…é‡‘é¡ç‚º 918 ã€‚\nèˆ‡è²»ç”¨æ˜ç´°ä¸Šä½¿ç”¨æ™‚é–“ç‚º 35281 hours ï¼Œé‡‘é¡ç‚º 893ã€‚è¦–ç‚ºä¸€è‡´ã€‚\b\n\nä»¥CPU:E2 Custom è¨ˆç®—ï¼Œä½¿ç”¨æ™‚é–“ç‚º 30550.16ï¼Œ æ¯å°æ™‚ 0.02651815ï¼Œç‚º810.133ï¼ŒæŠ˜æ‰£ 31.33% æ•…é‡‘é¡ç‚º 556.3188ï¼Œ\nèˆ‡è²»ç”¨æ˜ç´°æ‹†æˆå…©ç­†ï¼Œä½¿ç”¨æ™‚é–“ç‚º11567.12+18983.043ï¼Œè²»ç”¨ç‚º 345.66+210.63 = 556.29ï¼Œè¦–ç‚ºä¸€è‡´ã€‚\n(E2 çš„ç¶²ç«™è²»ç”¨æœ‰åˆ†æˆ Customèˆ‡ä¸€èˆ¬çš„ï¼Œæ¯å°æ™‚è²»ç”¨ä¸ä¸€æ¨£ã€‚)",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "259. Lokiä¸Šæ‰‹é«”é©—",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/259. Lokiå¿«é€Ÿä¸Šæ‰‹é«”é©—/",
		"content": "WHY\næ–°çš„æœå‹™åˆæ›ä¸Šå»äº†ï¼Œ\næœ¬ä¾†æƒ³ç¹¼çºŒæ›EFKçµ¦äººç”¨ï¼Œ\nä½†çœ‹äº†ä¸€ä¸‹ï¼Œå¦‚æœç›£æ§çš„åŒæ™‚å¯ä»¥é †ä¾¿çœ‹Logå¥½åƒä¹Ÿä¸éŒ¯ã€‚\nç›£æ§æ˜¯grafanaï¼Œé‚£logåªèƒ½æ˜¯ lokiäº†ã€‚\nNote\nå…ˆä¾†çœ‹ä¸€ä¸‹æˆæœã€‚\n\n1. éƒ¨å±¬ Loki\næˆ‘æ˜¯ç›´æ¥å¾istio(1.21.1)ï¼Œå°‡loki.yamlç›´æ¥æ‹¿å‡ºä¾†éƒ¨å±¬ã€‚\nè·¯å¾‘åœ¨istio-1.21.1/samples/addons/loki.yaml\ngithub\nåŸæœ¬çš„æ²’æœ‰namespaceï¼Œéœ€è¦çš„è‡ªè¡Œå¢åŠ ï¼Œ\nå¦å‰‡ç›´æ¥éƒ¨å±¬å³å¯ã€‚\n2. éƒ¨å±¬ Promtail\nå†ä¾†ï¼Œéƒ¨å±¬Promtailå°‡ pod logä¸Ÿåˆ°lokiè£¡é¢ã€‚\nk8sçš„è©±å»ºè­°ä½¿ç”¨ DaemonSetçš„æ–¹æ³•å»ºã€‚\nå¦‚æœæƒ³ç”¨å…¶ä»–æ–¹å¼ï¼Œè«‹æ´½install-promtail\né€™é‚Šå”¯ä¸€è¦æ”¹çš„æ˜¯Lokiçš„ä½ç½®ï¼Œ\nConfigmapï¼špromtail-config\nåº•ä¸‹çš„ data.clients.url æ”¹ç‚ºä½ çš„loki ipã€‚\nå»ºç«‹loki svcæ™‚çš„portç‚º3100ï¼Œ\næ–¼æ˜¯ http://loki.istio-system.svc.cluster.local/loki/api/v1/push\nä¸€é–‹å§‹æ¸¬è©¦æ™‚ï¼Œå¯ä»¥å…ˆåˆ°ä»»ä¸€podè£¡é¢ï¼Œå‘¼å« readyçš„apiï¼Œ\næ­£å¸¸çš„è©±æœƒå›å¾©ä¸€å€‹readyçš„å­—ä¸²ã€‚\ncurl http://loki.istio-system.svc.cluster.local/ready\n\nref.Loki HTTP API\n--- # Daemonset.yaml\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\nname: promtail-daemonset\nspec:\nselector:\nmatchLabels:\nname: promtail\ntemplate:\nmetadata:\nlabels:\nname: promtail\nspec:\nserviceAccount: promtail-serviceaccount\ncontainers:\n- name: promtail-container\nimage: grafana/promtail\nargs:\n- -config.file=/etc/promtail/promtail.yaml\nenv:\n- name: 'HOSTNAME' # needed when using kubernetes_sd_configs\nvalueFrom:\nfieldRef:\nfieldPath: 'spec.nodeName'\nvolumeMounts:\n- name: logs\nmountPath: /var/log\n- name: promtail-config\nmountPath: /etc/promtail\n- mountPath: /var/lib/docker/containers\nname: varlibdockercontainers\nreadOnly: true\nvolumes:\n- name: logs\nhostPath:\npath: /var/log\n- name: varlibdockercontainers\nhostPath:\npath: /var/lib/docker/containers\n- name: promtail-config\nconfigMap:\nname: promtail-config\n--- # configmap.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\nname: promtail-config\ndata:\npromtail.yaml: |\nserver:\nhttp_listen_port: 9080\ngrpc_listen_port: 0\n\nclients:\n- url: https://{YOUR_LOKI_ENDPOINT}/loki/api/v1/push\n\npositions:\nfilename: /tmp/positions.yaml\ntarget_config:\nsync_period: 10s\nscrape_configs:\n- job_name: pod-logs\nkubernetes_sd_configs:\n- role: pod\npipeline_stages:\n- docker: {}\nrelabel_configs:\n- source_labels:\n- __meta_kubernetes_pod_node_name\ntarget_label: __host__\n- action: labelmap\nregex: __meta_kubernetes_pod_label_(.+)\n- action: replace\nreplacement: $1\nseparator: /\nsource_labels:\n- __meta_kubernetes_namespace\n- __meta_kubernetes_pod_name\ntarget_label: job\n- action: replace\nsource_labels:\n- __meta_kubernetes_namespace\ntarget_label: namespace\n- action: replace\nsource_labels:\n- __meta_kubernetes_pod_name\ntarget_label: pod\n- action: replace\nsource_labels:\n- __meta_kubernetes_pod_container_name\ntarget_label: container\n- replacement: /var/log/pods/*$1/*.log\nseparator: /\nsource_labels:\n- __meta_kubernetes_pod_uid\n- __meta_kubernetes_pod_container_name\ntarget_label: __path__\n\n--- # Clusterrole.yaml\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\nname: promtail-clusterrole\nrules:\n- apiGroups: [&quot;&quot;]\nresources:\n- nodes\n- services\n- pods\nverbs:\n- get\n- watch\n- list\n\n--- # ServiceAccount.yaml\napiVersion: v1\nkind: ServiceAccount\nmetadata:\nname: promtail-serviceaccount\n\n--- # Rolebinding.yaml\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\nname: promtail-clusterrolebinding\nsubjects:\n- kind: ServiceAccount\nname: promtail-serviceaccount\nnamespace: default\nroleRef:\nkind: ClusterRole\nname: promtail-clusterrole\napiGroup: rbac.authorization.k8s.io\n\n3. çœ‹Log\nå…ˆåˆ°Promtailçš„podçœ‹æœ‰æ²’æœ‰éŒ¯èª¤ï¼Œ\næ²’æœ‰çš„è©±åˆ°grafanaè£¡é¢ï¼Œ\nå¦‚æœä½ çš„grafanaä¹Ÿæ˜¯istioè£¡é¢çš„yamlå®‰è£èµ·ä¾†çš„è©±ï¼Œ\né è¨­å°±æœƒæœ‰lokiçš„datasourceï¼Œ\nä¸ç”¨å†é¡å¤–è¨­å®šã€‚\né–‹å•Ÿgrafanaï¼Œé–‹å•Ÿé¸å–®çš„explorerã€‚\n\ndatasourceé¸ Loki\n\nä¸€é–‹å§‹å¯ä»¥ç”¨labelé¸æ“‡ï¼Œé€™é‚Šçš„appæ˜¯æˆ‘å»ºç«‹æœå‹™æ™‚æ‰€ç”¨çš„labelã€‚\nä¹Ÿå¯ä»¥ç”¨deployæˆ–namespaceé¸æ“‡ã€‚\n\næœ€å¾ŒæŒ‰ä¸‹å³ä¸Šçš„Run Queryã€‚\n\né€™æ¨£å°±è¡¨ç¤ºæœ‰è³‡æ–™äº†ã€‚\næ­¤æ™‚ï¼Œä¹Ÿå¯ä»¥æŒ‰å³ä¸Šçš„Add dashboardï¼Œ\nå¥—ç”¨åˆ°ç¾æœ‰çš„dashboardæˆ–æ˜¯å»ºç«‹ä¸€å€‹éƒ½å¯ä»¥ã€‚",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "260. Grafana Variablesé€£å‹•",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/260. Grafana è®Šæ•¸é€£å‹•/",
		"content": "WHY\nå»¶çºŒä¸Šä¸€ç¯‡ <a class=\"internal-link\" data-note-icon=\"\" href=\"/259. Lokiå¿«é€Ÿä¸Šæ‰‹é«”é©—/\">259. Lokiå¿«é€Ÿä¸Šæ‰‹é«”é©—</a> çš„æ•ˆæœã€‚\nè¦è®“logæ›´å¥½ç”¨çš„è©±ï¼Œéœ€è¦å¹¾å€‹è®Šæ•¸ï¼Œ\nåŸæœ¬æ˜¯æƒ³åšåˆ°ç•¶æŒ‰ä¸‹Labelæ™‚ï¼Œå¯ä»¥ç›´æ¥é€£å‹•è®Šæ•¸ï¼Œ\nå¯æƒœé‚„æ²’æœ‰æ‰¾åˆ°ç›¸é—œè³‡æ–™ï¼Œåªå¥½å…ˆç”¨ä¸‹æ‹‰é¸å–®åšé€£å‹•è®Šæ•¸ã€‚\nSolution\né€£å‹•è®Šæ•¸ï¼Œé¦–å…ˆé‡å°çš„éƒ½æ˜¯æœ‰ç¬¬ä¸€å€‹ä¾†æºï¼Œ\nç¬¬äºŒå€‹æ‰èƒ½æ ¹æ“šç¬¬ä¸€å€‹çš„é¸æ“‡å»ä½œæŸ¥è©¢ã€‚\n\nç¬¬ä¸€å€‹æ˜¯namespaceï¼Œç¬¬äºŒå€‹deploymentå°±æ˜¯filter namespaceçš„å€¼ã€‚\nä¾†æºæ˜¯Prometheusï¼Œ\nå› ç‚ºå¦‚æœé¸Lokiçš„è©±ï¼Œæ²’æœ‰è¾¦æ³•ç”¨Query Resultå»åšï¼Œ\nåªèƒ½ç”¨label nameæˆ– label valueã€‚\n\nåœ–ç‰‡ä¸­é–“çš„Regexçš„æ„æ€æ˜¯ï¼Œ\nå–å¾— kube_deployment_labelsåº•ä¸‹ deploymentçš„å€¼ã€‚\n\nç¬¬ä¸‰å±¤åŒæ¨£çš„æ–¹æ³•ã€‚\nè‡³æ–¼ç‚ºä»€éº¼æœƒåˆ°ä¸‰å±¤ï¼Œå› ç‚ºå¯¦å‹™ä¸Šæœ‰ç¢°åˆ°ï¼Œç•¶å¤šå€‹podçš„æ™‚å€™ï¼Œ\nä½ æœƒéœ€è¦çœ‹ç‰¹å®špodçš„logã€‚\næœ€å¾Œ dashboardçš„metricsï¼ŒPanelé¸æ“‡Logsã€‚\n{namespace=&quot;$namespace&quot;, pod=~&quot;.*$Deploy.*&quot;, pod=~&quot;$Pod&quot;} |= ``\n\né¸æ“‡Lokièˆ‡Grafanaçš„å¥½è™•åœ¨æ–¼ï¼Œ\nç•¶ä½ çœ‹åˆ°ç•°å¸¸é«˜å³°çš„metricsæ™‚ï¼Œ\nå¯ä»¥ç›´æ¥çœ‹åˆ°logï¼Œä¸ç”¨å†è·‘å»å¦ä¸€å€‹åœ°æ–¹æŸ¥ï¼Œ\nä¹Ÿå¯ä»¥èªªæ˜¯ æ‡¶äººçš„ä½œæ³•",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "README",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/",
		"content": "åº¦ä¼°è¨˜äº‹æœ¬\nåº§å³éŠ˜\n\næ‡¶äººï¼Œå§‹çµ‚ç›¸ä¿¡ç§‘æŠ€å§‹çµ‚ä¾†è‡ªæ–¼äººé¡çš„æƒ°æ€§ã€‚\næ‡¶æ˜¯ä¸€ç¨®æ–¹å¼ï¼Œå»ä¸æ˜¯ä¸€ç¨®æ…‹åº¦ã€‚\nä½ å¦‚æœæƒ³è¦æœ‰æ›´å¤šçš„æ™‚é–“å·æ‡¶ï¼Œå°±ä¸€å®šè¦æœ‰æœ€é«˜çš„æ•ˆç‡ã€‚\n\næœ€æ–°æ–‡ç« \n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/256. httpbinå–å¾—requestçš„header/\">256. httpbinå–å¾—requestçš„header</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/257. istio-proxy Readiness probe failed/\">257. istio-proxy Readiness probe failed</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/258. GCPè²»ç”¨è©¦ç®—/\">258. GCPè²»ç”¨è©¦ç®—</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/259. Lokiå¿«é€Ÿä¸Šæ‰‹é«”é©—/\">259. Lokiå¿«é€Ÿä¸Šæ‰‹é«”é©—</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/260. Grafana è®Šæ•¸é€£å‹•/\">260. Grafana è®Šæ•¸é€£å‹•</a>\n\nç”¨Obsidianç™¼ä½ˆåˆ°Github\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/193. Obsidianç™¼ä½ˆåˆ°github.ioå€‹äººç¶²ç«™/\">193. Obsidianç™¼ä½ˆåˆ°github.ioå€‹äººç¶²ç«™</a>\né›»å½±è©•åˆ†è¡¨\nåšå¥½ç©çš„ é›»å½±è©•åˆ†è¡¨\n\nTagåˆ—è¡¨\nğŸ’¡ï¼šMap Of Content\nğŸ’»ï¼š<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ’» Code/0.Code MOC/\">0.Code MOC</a>\nğŸ³ï¼š<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ³ Container/0.Container MOC/\">Container MOC</a>\nğŸ—„ï¼š<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—„ Database/0.Database MOC/\">0.Database MOC</a>\nâ±ï¼š<a class=\"internal-link\" data-note-icon=\"\" href=\"/â± Drone/0.Drone MOC/\">0.Drone MOC</a>\nğŸ—’ï¼š<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/0.EFK MOC/\">EFK MOC</a>\nâ˜ï¸ï¼š<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/0.GCP MOC/\">GCP MOC</a>\nğŸ“¥ï¼šinbox\nâ›µï¸ï¼š<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/0.istio MOC/\">istio MOC</a>\nâˆï¼š<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/0.K8s MOC/\">k8s MOC</a>\nğŸ§ï¼š<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/0.Linux MOC/\">Linux MOC</a>\nğŸï¼šApple\nğŸŒï¼š<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸŒ Network/0.Network MOC/\">Network MOC</a>\nğŸ‘ï¼š<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ‘ Observability/0.Observability MOC/\">0.Observability MOC</a>\nğŸ®ï¼šGame\nğŸ†’ï¼šSide Project\n\nWhat is MOC ?\nç•¶å–®ä¸€ç­†è¨˜çš„æ•¸é‡è¶Šä¾†è¶Šå¤šæ™‚ï¼Œå°±èƒ½å¤ æ§‹æˆä¸€å€‹MOC(Map of Contens)\nè©³ç´°è«‹åƒè€ƒä¸‹é¢é€£çµï¼Œ\næ•¸ä½ç­†è¨˜å¤ªå¤šå¾ˆå‡Œäº‚æ€éº¼è¾¦ï¼Ÿä½¿ç”¨ MOC æ¶æ§‹æœ‰ç³»çµ±åœ°ç®¡ç†æ•¸ç™¾å‰‡çš„æ•¸ä½ç­†è¨˜\næŠ€è¡“æ–‡ç« å¯«æ³•è¦é»\næ–‡ç« æ¡ç”¨å–®ç·šçµæ§‹\nä¸€é»æ¥ç€ä¸€é»ï¼Œå°±æ˜¯ä¸€å¼µå¡ç‰‡æ¥ç€ä¸€å€‹å¡ç‰‡ï¼Œ\næŠŠå•é¡Œæ‹†æˆå¤šç¯‡æ–‡ç« ï¼Œ\nè®“æ–‡ç« ä¸€ç¯‡å°±åªæœ‰ä¸€å€‹è¦é»ã€‚\nref. # ç§‘æŠ€æ„›å¥½è€…é€±åˆŠï¼ˆç¬¬ 288 æœŸï¼‰ï¼šæŠ€è¡“å¯«ä½œçš„é¦–è¦è¨£ç«…\n\nèˆŠç­†è¨˜\n2021å¹´ä»¥å‰æ–‡ç« è«‹è‡³ åº¦ä¼°è¨˜äº‹æœ¬ æŸ¥è©¢",
		"tags": [ "note","gardenEntry"]
},

{
		"title": " âˆ K8s MOC",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/0.K8s MOC/",
		"content": "åŸºæœ¬æ¦‚å¿µ\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/27.K8sçš„ç¯€é»é¸æ“‡èˆ‡æ±¡æŸ“/\">27.K8sçš„ç¯€é»é¸æ“‡èˆ‡æ±¡æŸ“</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/GKE/41.GKEç¯€é»ç„¡æ³•è‡ªå‹•ç¸®å°/\">41.GKEç¯€é»ç„¡æ³•è‡ªå‹•ç¸®å°</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/42.k8s PDBï¼ˆpodä¸­æ–·é ç®—ï¼‰/\">42.k8s PDBï¼ˆpodä¸­æ–·é ç®—ï¼‰</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/105. linuxç³»çµ±æ™‚é–“èˆ‡k8s/\">105. linuxç³»çµ±æ™‚é–“èˆ‡k8s</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/123.Helm ä½¿ç”¨æ–¹å¼/\">123.Helm ä½¿ç”¨æ–¹å¼</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/172. è‡ªå»ºk8sç‰ˆæœ¬å‡ç´š/\">172. è‡ªå»ºk8sç‰ˆæœ¬å‡ç´š</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/192. è‡ªå»ºçš„k8sæ‹‰å–private registry/\">192. è‡ªå»ºçš„k8sæ‹‰å–private registry</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/194. pod debugæ–¹å¼/\">194. pod debugæ–¹å¼</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/196. httpå¥åº·åº¦åµæ¸¬/\">196. httpå¥åº·åº¦åµæ¸¬</a>\n\nTerraform\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Terraform/82. Terraform vs Ansible/\">82. Terraform vs Ansible</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Terraform/147. ç”¨chatGPTå­¸Terraform/\">147. ç”¨chatGPTå­¸Terraform</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Terraform/148. Terraformçš„åŸºæœ¬æ¦‚å¿µ/\">148. Terraformçš„åŸºæœ¬æ¦‚å¿µ</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Terraform/149. terraform éƒ¨ç½²VMï¼Œå•“å‹•dockerå®‰è£metadata_startup_script/\">149. terraform éƒ¨ç½²VMï¼Œå•“å‹•dockerå®‰è£metadata_startup_script</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Terraform/189. å°å…¥Terraform/\">189. å°å…¥Terraform</a>\n\nTools\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/118. kubernetes Dashboard/\">118. kubernetes Dashboard</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/137. kubecolor ç›´è§€çš„kubectl/\">137. kubecolor ç›´è§€çš„kubectl</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/139. openlens add pod shell or logs button/\">139. openlens add pod shell or logs button</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/162.æŸ¥è©¢å·²æ£„ç”¨çš„API/\">162.æŸ¥è©¢å·²æ£„ç”¨çš„API</a>\n\nyaml\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Yaml/2. k8s yamlæ’°å¯« volume è¸©å‘ç¯‡/\">2. k8s yamlæ’°å¯« volume è¸©å‘ç¯‡</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Yaml/12. k8s YAML å°ç´°ç¯€/\">12. k8s YAML å°ç´°ç¯€</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Yaml/85. gke-cronjobç­†è¨˜/\">85. gke-cronjobç­†è¨˜</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Yaml/87.kustomize å…±ç”¨label(optionalï¼‰/\">87.kustomize å…±ç”¨label(optionalï¼‰</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Yaml/94. k8s ç´°ç¯€è£œå……/\">94. k8s ç´°ç¯€è£œå……</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Yaml/98. k8sä¸­çš„commandèˆ‡dockerfileçš„ CMD/\">98. k8sä¸­çš„commandèˆ‡dockerfileçš„ CMD</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Yaml/136. ä¸€æ­¥æ­¥ç¯©é¸k8sçš„deployå…§å®¹/\">136. ä¸€æ­¥æ­¥ç¯©é¸k8sçš„deployå…§å®¹</a>\n\nGKE\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/GKE/4. GKEä½¿ç”¨GPU/\">4. GKEä½¿ç”¨GPU</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/GKE/37.SolrCloud on GKE/\">37.SolrCloud on GKE</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/GKE/39.solrCloudçš„åˆé«”é©—/\">39.solrCloudçš„åˆé«”é©—</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/GKE/44.srs å½±éŸ³ä¸²æµ on GKE/\">44.srs å½±éŸ³ä¸²æµ on GKE</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/GKE/50.GKE workload Identity å¯¦åœ°æ¼”ç·´/\">50.GKE workload Identity å¯¦åœ°æ¼”ç·´</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/GKE/56. GKEè¨˜éŒ„ nginx log/\">56. GKEè¨˜éŒ„ nginx log</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/GKE/70. GKE pvcé‚„åŸ/\">70. GKE pvcé‚„åŸ</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/GKE/71.gitlab on GKE ç½å®³é‚„åŸç­†è¨˜/\">71.gitlab on GKE ç½å®³é‚„åŸç­†è¨˜</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/101. æ‰¹æ¬¡ä¿®æ”¹hpa/\">101. æ‰¹æ¬¡ä¿®æ”¹hpa</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/104. rabbitmq operatorå®‰è£/\">104. rabbitmq operatorå®‰è£</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/43.è‡ªå»ºECK on GKE/\">43.è‡ªå»ºECK on GKE</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/190. cert-managerå®‰è£/\">190. cert-managerå®‰è£</a>\n\nTroubleshooting\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Yaml/74. kubernetes æ‰¹æ¬¡æª¢æŸ¥yamlç‰¹å®šå­—å…ƒ/\">74. kubernetes æ‰¹æ¬¡æª¢æŸ¥yamlç‰¹å®šå­—å…ƒ</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/76. k8s error,The node was low on resource../\">76. k8s error,The node was low on resource..</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/144. k8s çš„sercretè¤‡è£½/\">144. k8s çš„sercretè¤‡è£½</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/151. kubeadmé‡æ–°ç”¢ç”Ÿé©—è­‰/\">151. kubeadmé‡æ–°ç”¢ç”Ÿé©—è­‰</a>",
		"tags": [ "note","âˆ"]
},

{
		"title": "æ‰¹æ¬¡ä¿®æ”¹hpa",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/101. æ‰¹æ¬¡ä¿®æ”¹hpa/",
		"content": "å‰è¨€\né€™åˆæ˜¯å› ç‚ºæ‡¶æƒ°è€Œè¡ç”Ÿå‡ºä¾†çš„ä¸€ç¯‡ï¼Œ\næ‡¶å¾—ä¸€å€‹ä¸€å€‹é»é€²å»æ”¹HPAçš„æ•¸é‡ï¼Œ\nå°±å¯«shæå®šå§ã€‚\næ­£æ–‡\nåƒè€ƒ <a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/88.æ‰¹æ¬¡ä¿®æ”¹GCPçš„label/\">88.æ‰¹æ¬¡ä¿®æ”¹GCPçš„label</a>ï¼Œå»ºç«‹ä¸€å€‹æ–‡å­—æª” hpa.txtï¼Œ\nå…ˆç”¨æŒ‡ä»¤ï¼Œå°‡hpaçš„nameå–å‡ºå­˜åˆ°æ–‡å­—æª”å…§ï¼Œå› ç‚ºæ˜¯é‡å°ç‰¹å®šå¹¾å€‹ä¿®æ”¹ï¼Œæ‰€ä»¥ä¸¦æ²’æœ‰å…¨æ‹‰ã€‚\nkubectl get hpa;\n\næ–‡å­—æª”å…§å®¹å¦‚ä¸‹\nistio-yabo-api-prod-external\nistio-yabo-api-prod-internal\nistio-yabo-frontend-external-demo\nistio-yabo-frontend-internal-demo\nistio-yabo-frontend-prod-external\nistio-yabo-frontend-prod-internal\nistio-yabo-frontpage-external-prod\nistio-yabo-frontpage-internal-prod\nistio-yabo-huanggua-external-beta\nistio-yabo-huanggua-external-prod\nistio-yabo-huanggua-internal-beta\nistio-yabo-huanggua-internal-prod\nistio-yabo-landingpage-external-demo\nistio-yabo-landingpage-external-prod\nistio-yabo-landingpage-internal-demo\nistio-yabo-landingpage-internal-prod\nistio-yabo-pwa-external-prod\nistio-yabo-pwa-internal-prod\n\nä¸»è¦æ˜¯ kubectl patch hpa åšä¿®æ”¹ã€‚\npatché€™åŠŸèƒ½çœ‹ä¾†é —å¼·å¤§ï¼Œç¬¬ä¸€æ¬¡è¦‹åˆ°ï¼Œ\næ”¹å¤©å¯ç ”ç©¶çœ‹çœ‹ã€‚\nwhile read p; do\necho &quot;$p&quot;; kubectl patch hpa -p '{&quot;spec&quot;:{&quot;minReplicas&quot;: 2}}' -n istio-system $p; echo &quot;done&quot;;\ndone &lt;hpa.txt\n\nref.\n- Kubenetes: change hpa min-replica\n- ä½¿ç”¨ kubectl patch æ›´æ–° API å°è±¡",
		"tags": [ "note","âˆ"]
},

{
		"title": "rabbitmq operatorå®‰è£",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/104. rabbitmq operatorå®‰è£/",
		"content": "å‰è¨€\næ¥åˆ°åŒäº‹èªªè¦è£rabbitmqï¼Œ\nèªªä¹‹å‰åœ¨devæœ‰è£éï¼Œä½†åœ¨k8sä¸Šé¢æ²’çœ‹åˆ°ï¼Œ\nç”¨ä¹‹å‰ç•™ä¸‹çš„yamlï¼Œæœƒè£ä¸èµ·ä¾†ï¼Œåªå¥½å¾é ­ä¾†äº†ã€‚\næ­£æ–‡\n\næœ¬ä¾†æ˜¯æƒ³åƒè€ƒä»–çš„é€™ç¯‡ï¼Œçµæœçœ‹åˆ°ç¬¬ä¸€æ®µèªª\nStop! There is a Better Way!\næ‰çŸ¥é“rabbitmqæœ‰å‡ºäº†operatorå¯ä¾›å®‰è£ã€‚\nå®‰è£rabbitmq operator\n\nkubectl apply -f &quot;https://github.com/rabbitmq/cluster-operator/releases/latest/download/cluster-operator.yml&quot;\n\nref. Installing RabbitMQ Cluster Operator in a Kubernetes Cluster\n\néƒ¨ç½²yaml\n\napiVersion: rabbitmq.com/v1beta1\nkind: RabbitmqCluster\nmetadata:\nname: dev-rabbitmq\nspec:\nreplicas: 3\nrabbitmq:\nadditionalConfig: |\ndefault_user=admin\ndefault_pass=abc123\nservice:\ntype: NodePort\n\nå› ç‚ºæ˜¯è‡ªå»ºçš„k8sï¼Œæ²’æœ‰lbï¼Œæ‰€ä»¥å°±ç”¨NodePortäº†ã€‚\næ›´è©³ç´°çš„åƒæ•¸è«‹åƒè€ƒä¸‹é¢é€£çµã€‚\nref. Using RabbitMQ Cluster Kubernetes Operator\nå•é¡Œæ’é™¤\nä¸­é–“æœ‰ç™¼ç”Ÿå°æ’æ›²ï¼Œk8så…§æ²’æœ‰é è¨­çš„storeageClass\nå°è‡´å»ºç«‹pvcæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œ\né›–ç„¶åœ¨ä¸Šé¢çš„yamlä¸Šé¢èƒ½å¤ æŒ‡å®šï¼Œ\nä½†å¯èƒ½æ˜¯æ ¼å¼æ²’å¯«å¥½ï¼Œå°è‡´æ²’æœ‰ç”¢ç”ŸstatefuleSet çš„pvcã€‚\næœ€å¾Œå…ˆæŒ‡å®šç›®å‰çš„storageClassç‚ºé è¨­çš„ã€‚\nkubectl patch storageclass &lt;your_storageclass_name&gt; -p '{&quot;metadata&quot;: {&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;}}}'\n\nref.\n\ninstall RabbitMQ in kubernetes\nRabbitMQã€‘äº”åˆ†é˜è¼•é¬†ç­è§£ RabbitMQ é‹ä½œ",
		"tags": [ "note","âˆ"]
},

{
		"title": "linuxç³»çµ±æ™‚é–“èˆ‡k8s",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/105. linuxç³»çµ±æ™‚é–“èˆ‡k8s/",
		"content": "å‰è¨€\næœ€è¿‘å¼„ä¹‹å‰çš„äººè‡ªå»ºçš„k8sï¼Œ\næ‰ç¢°åˆ°ä¸€å †å•é¡Œï¼Œ\næˆ‘çš„linuxæœç„¶éœ€è¦åŠ å¼·orz\næ­£æ–‡\nä¸€èˆ¬çš„linuxå…§çš„æ™‚é–“é¡¯ç¤º\ntimedatectl\n\nLocal time ï¼šæœ¬æ©Ÿæ™‚é–“\nUniversal time ï¼š UTCæ™‚é–“\nRTC timeï¼š ç¡¬é«”æ™‚é–“\nNTP service : è‡ªå‹•æ•ˆæ™‚\nTime Zone: æ™‚å€\nç•¶æ™‚é–“ä¸å°æ™‚ï¼Œå¯ä»¥è¨­å®šæ™‚é–“çš„è‡ªå‹•æ•ˆæ­£\ntimedatectl set-ntp yes\n\nè¨­å®šå®Œå¾Œï¼Œç­‰ä¸€ä¸‹ï¼ˆå¤šä¹…ä¸ç¢ºå®šï¼Œä½†ä¸æœƒç«‹å³ï¼‰ï¼Œ\nUTCçš„æ™‚é–“æ‡‰è©²å°±æœƒè‡ªå·±æ•ˆå°ã€‚\nNTPä¼ºæœå™¨ï¼ˆæœ‰éœ€è¦å†è¨­å®šï¼‰\n\ntime.google.com\n\næŸ¥è©¢å„æ™‚å€\ntimedatectl list-timezones\n\nè¨­å®šæ™‚å€\ntimedatectl set-timezone Asia/Taipei\n\nref. Ubuntu Linux ä½¿ç”¨ timedatectl æ ¡æ­£æ™‚é–“ã€æ™‚å€æ•™å­¸èˆ‡ç¯„ä¾‹\nPodçš„æ™‚å€è¨­å®š\npodçš„æ™‚é–“æœƒè·Ÿä»–æ‰€åœ¨çš„nodeæ™‚é–“ä¸€è‡´ï¼Œ\næ‰€ä»¥ç•¶ä½ çš„node ä¸»æ©Ÿæ™‚é–“éŒ¯æ™‚ï¼Œ\npodçš„æ™‚é–“ä¹Ÿæœƒè·Ÿç€éŒ¯ã€‚\nä½†åŸºæœ¬ä¸Šéƒ½æ˜¯UTCï¼Œ\nå¦‚æœè¦æŒ‡å®šæ™‚å€çš„è©±ï¼Œ\nå¯ä»¥ç”¨volumeæ›è¼‰æˆç‰¹å®šåœ°å€ã€‚\næˆ–æ˜¯ç›´æ¥åœ¨build imageæ™‚ï¼Œä¸€ä½µæ›´æ”¹ã€‚\n\npvc æ›è¼‰\næ™‚å€æª”æ¡ˆçš„ä½ç½®\n\napiVersion: v1\nkind: Pod\nmetadata:\nname: busybox-sleep\nspec:\ncontainers:\n- name: busybox\nimage: busybox\nargs:\n- sleep\n- &quot;1000000&quot;\nvolumeMounts:\n- name: tz-config\nmountPath: /etc/localtime\nvolumes:\n- name: tz-config\nhostPath:\npath: /usr/share/zoneinfo/Europe/Prague\ntype: File\n\nDockerfileæ›´æ”¹\n\nRUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\\n\t\t &amp;&amp; echo &quot;Asia/Shanghai&quot; &gt; /etc/timezone\n\nref.\n\nk8sç’°å¢ƒä¸‹è™•ç†å®¹å™¨æ™‚é–“å•é¡Œçš„å¤šç¨®å§¿å‹¢\ndate and time synchronization among the pods and host in kubernetes",
		"tags": [ "note","âˆ"]
},

{
		"title": "kubenetesç°¡æ˜“ä»‹é¢",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/118. kubernetes Dashboard/",
		"content": "ç¢ç¢å¿µ\nä»¥å‰GKEç”¨ç¿’æ…£äº†ï¼Œç¾åœ¨è®Šæˆè‡ªå»ºçš„k8sï¼Œåªèƒ½ç”¨lensç®¡ï¼Œ\né›–ç„¶èªªä¸ä¸Šæœ‰å“ªä¸è¶³ï¼Œä½†ç¸½æ˜¯æ€ªæ€ªçš„ã€‚\nä»Šå¤©æŸ¥è³‡æ–™çœ‹åˆ°æœ‰é€™å€‹UIï¼Œå°±æ¶ä¾†çœ‹çœ‹äº†ã€‚\næ­£æ–‡\næœ¬æ©Ÿè¨ªå•\nå®˜æ–¹æ–‡ä»¶ï¼Œå®‰è£ä¸‹å»å°±å¥½äº†\nkubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.6.1/aio/deploy/recommended.yaml\n\nåŸ·è¡Œè½‰ç™¼ä¾†é€£åˆ°dashboard\nkubectl proxy\n\nkubectl æœƒä½¿å¾— Dashboard å¯ä»¥é€šéÂ http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/Â è¨ªå•ã€‚\nç™»å…¥ç•«é¢å¦‚ä¸‹\n\nå†ä¾†å°±éœ€è¦ç”¢ç”Ÿä¸€çµ„tokenä¾†åšç™»å…¥äº†ã€‚\né¦–å…ˆå»ºç«‹ä¸€çµ„serviceAccount\ncat &lt;&lt;EOF | kubectl create -f -\napiVersion: v1\nkind: ServiceAccount\nmetadata:\nname: admin\nnamespace: kube-system\nEOF\n\nç¶å®šserviceAccount èˆ‡ è§’è‰²\ncat &lt;&lt;EOF | kubectl create -f -\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\nname: admin-user\nroleRef:\napiGroup: rbac.authorization.k8s.io\nkind: ClusterRole\nname: cluster-admin\nsubjects:\n- kind: ServiceAccount\nname: admin\nnamespace: kube-system\nEOF\n\nService Accountå»ºç«‹å®Œå¾Œï¼ŒKubernetes Token Controller å°±æœƒè‡ªå‹•çš„ç‚ºå…¶ç”¢ç”Ÿä¸€å€‹Â secretÂ resource(åç¨±ç‚ºÂ [SERVICE_ACCOUNT_NAME]-token-[RANDOM_STRING])\nkubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin | awk '{print $1}')\n\né€™é‚Šå–å¾—çš„tokenå³å¯åœ¨ Dashboard ä¸Šç™»å…¥ã€‚\nref. ä½ˆç½² &amp; å­˜å– Kubernetes Dashboard\nå¤–éƒ¨è¨ªå•\næ›´æ”¹service å…§çš„ kubernetes-dashboard.kubenetes-dashboards\nå°‡clusteræ”¹æˆNodePort ï¼Œç„¶å¾Œçœ‹å°æ‡‰çš„portå¤šå°‘å°±èƒ½ç™»å…¥äº†ã€‚\nè¨˜å¾—ç”¨https\n\nref. accessing-dashboard",
		"tags": [ "note","âˆ"]
},

{
		"title": "Helm ä½¿ç”¨æ–¹å¼",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/123.Helm ä½¿ç”¨æ–¹å¼/",
		"content": "ç¡ç¡å¿µ\næœ€è¿‘è¦ç”¨coturnï¼Œçœ‹åˆ°æœ‰äººç”¨helm æ¶åœ¨k8sä¸Šé¢ï¼Œå°±é †ä¾¿ä¾†è©¦è©¦äº†ã€‚\nä¹‹å‰å‰›é–‹å§‹æ¥è§¸k8sï¼Œç¢°åˆ°helmä¸€å †éŒ¯èª¤ï¼Œç„¡æ³•åŸ·è¡Œã€‚\nç¾åœ¨æƒ³æ‡‰è©²æ˜¯è£é¢æœ‰äº›è¨­å®šè¦ä¿®æ”¹çš„é—œä¿‚ï¼Œ\nç¾åœ¨æ‡‰è©²æœƒæ¯”è¼ƒå¥½äº†å§ï¼ï¼Ÿ\næ­£æ–‡\næ¶æ§‹\nhelmçš„æ¶æ§‹ï¼Œå¯å…ˆç”¢ç”Ÿä¸€å€‹ç¯„ä¾‹æª”ï¼Œ\nçœ‹æœ‰å“ªäº›æ±è¥¿ã€‚\nhelm create ezio\n\nåœ¨Helmè£é¢ï¼Œå°‡kubernetesçš„æ‡‰ç”¨ç¨‹å¼ç¨±ç‚ºChart\n\ntree ezio\n\nezio\nâ”œâ”€â”€ Chart.yaml\nâ”œâ”€â”€ charts\nâ”œâ”€â”€ templates\nâ”‚Â Â  â”œâ”€â”€ NOTES.txt\nâ”‚Â Â  â”œâ”€â”€ _helpers.tpl\nâ”‚Â Â  â”œâ”€â”€ deployment.yaml\nâ”‚Â Â  â”œâ”€â”€ hpa.yaml\nâ”‚Â Â  â”œâ”€â”€ ingress.yaml\nâ”‚Â Â  â”œâ”€â”€ service.yaml\nâ”‚Â Â  â”œâ”€â”€ serviceaccount.yaml\nâ”‚Â Â  â””â”€â”€ tests\nâ”‚Â Â  â””â”€â”€ test-connection.yaml\nâ””â”€â”€ values.yaml\n\nChart.yaml ï¼šåŒ…å«äº†chartçš„å…§å®¹æè¿°\ncharts(folder) ï¼šæ­¤ç›®éŒ„å¯èƒ½åŒ…å«äº†å…¶ä»–ä¸åŒçš„ chartï¼Œä¹Ÿå¯ç¨±ç‚ºÂ subcharts\ntemplates(folder)ï¼šæ­¤ç›®éŒ„ç‚ºè¦éƒ¨ç½²çš„æ‰€æœ‰é¡å‹ç¯„æœ¬\nvalues.yaml ï¼š åƒæ•¸è¨­å®šæª”ï¼Œæ‰€æœ‰çš„è®Šæ•¸éƒ½å¯«åœ¨é€™ã€‚\n\ntemplateså…§å¯«çš„åƒæ•¸ï¼Œé€šå¸¸ç‚º\n.Values.replicasï¼šè¡¨ç¤ºvalues.yamlè£é¢çš„replicasåƒæ•¸\nå…¶ä»–évaluesçš„å–å¾—æ–¹å¼ï¼Œåƒè€ƒ Built-in Objects\ntemplateæœ‰ä¸€äº›å¯èƒ½æœƒç”¨åˆ°çš„å‡½æ•¸ï¼Œ\nä¸»è¦æœ‰\n\npipeline ( linux è£é¢å¸¸è¦‹åˆ°çš„ | )\nif/else\nwithï¼ˆé¡ä¼¼vb.net çš„withï¼‰\nrange(for loop)\n\nCheatsheet\ndry-run\nå…ˆæŸ¥çœ‹helmæ‰€ç”¢ç”Ÿçš„yaml\nhelm install --dry-run coturn ./coturn\n\nè¨­å®šåƒæ•¸\nhelm install coturn ./conturn --set certificate.enabled=false\n\næŒ‡å®švalues.yaml\nhelm install coturn ./conturn -f myval.yaml\n\næŒ‡å®šnamespace\nhelm install coturn ./conturn -n tools\n\nçœ‹helmåˆ—è¡¨\nhelm ls\n\næ›´æ–°chart\nhelm upgrade coturn ./coturn\n\nç§»é™¤chart\nhelm uninstall coturn\n\nref.\n- [Helm] Helm v3 ä½¿ç”¨ç°¡ä»‹\n- Helmä»‹ç´¹",
		"tags": [ "note","âˆ"]
},

{
		"title": "kubecolor ç›´è§€çš„kubectl",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/137. kubecolor ç›´è§€çš„kubectl/",
		"content": "ç¡ç¡å¿µ\nå‰›å¥½çœ‹åˆ°æœ‰äººçš„æ–‡ç« èªª kubecolorç¾ç¾çš„kubectlå°±ä¾†è©¦ç”¨äº†XD\næ­£æ–‡\nmac or linux å®‰è£\nbrew install hidetatz/tap/kubecolor\n\nç›´æ¥ä½¿ç”¨\nkubecolor get pod\n\nä½†æˆ‘å¹³å¸¸æ‰“kubectlæ‰“ç¿’æ…£äº†ï¼Œçªç„¶è¦æ”¹ç”¨é‚£å€‹è¦ºå¾—å¥½éº»ç…©ï¼Œ\næ”¹åˆ¥åå§\næ–°å¢åˆ¥å\nalias kubectl=&quot;kubecolor&quot;\n\nç§»é™¤åˆ¥å\nunalias kubectl\n\nä½†é€™å€‹åªæœ‰æš«æ™‚ï¼Œè¦æ°¸ä¹…çš„è©±ï¼Œéœ€è¦åˆ°.bash_profileè¨­å®š\nmac æ˜¯åœ¨ å€‹äººç›®éŒ„åº•ä¸‹\nvim ~/.bash_profile\n\næ²’æœ‰çš„è©±ï¼Œå°±æ–°å»ºæª”æ¡ˆï¼Œç„¶å¾Œè¼¸å…¥\nalias kubectl=&quot;kubecolor&quot;\n\np.s mac çš„ç’°å¢ƒè®Šæ•¸è¼‰å…¥é †åºç‚º\n\n/etc/profile -&gt; /etc/paths -&gt; ~/.bash_profile -&gt; ~/.bash_login -&gt; ~/.profile -&gt; ~/.bashrc\n\nref\n\nkubecolor\nmac çµ„æ…‹ç’°å¢ƒè®Šæ•¸ï¼Œè¬›çš„å¤ªä»”ç´°äº†ï¼Œéå¸¸æ£’",
		"tags": [ "note","âˆ"]
},

{
		"title": "openlenså¢åŠ shellå’Œlogs æŒ‰éˆ•",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/139. openlens add pod shell or logs button/",
		"content": "ç¡ç¡å¿µ\nlenåœ¨6.Xç‰ˆæœ¬å¾Œï¼Œè¦ç™»å…¥æ‰èƒ½ç”¨ã€‚\né‚£å€‹æ™‚å€™ä¹Ÿæ­£å¥½è·³å»openlensï¼Œåœ¨é‚£ä¹‹å‰éƒ½å¯ä»¥å¾podå³ä¸Šè§’çš„æŒ‰éˆ•ï¼Œ\nå¿«é€Ÿé€²å…¥åˆ°podè£é¢ï¼Œæˆ–æ˜¯æŸ¥pod logï¼Œä½†åœ¨6.2.4ä¹‹å¾Œå°±æ¶ˆå¤±äº†ã€‚\nç›´åˆ°ç¾åœ¨6.4.10(å¯«é€™ç¯‡æ™‚çš„ç‰ˆæœ¬)ï¼Œé‚„æ˜¯æ²’æœ‰ã€‚\næœ€å¾Œå¾—çŸ¥æ˜¯å› ç‚ºLensæ‰æŠŠé‚£æ®µç§»æ‰ã€‚\næ­£æ–‡\nå®‰è£æ–¹å¼\nåˆ° Extensions ç›´æ¥è²¼ä¸Šä¸‹é¢çš„ä¾†æº\n@alebcay/openlens-node-pod-menu\n\nä¾†æº\nä¸»è¦æ˜¯æ¡†èµ·ä¾†çš„åŠŸèƒ½ï¼Œ\nå°æ–¼æ¯”è¼ƒä¸ç†Ÿæ‚‰çš„kubectlæŒ‡ä»¤çš„äººä¾†èªªï¼Œéå¸¸å¯¦ç”¨ã€‚\n\næ‰€ä»¥ç•¶åˆæ²’æœ‰çš„æ™‚å€™ï¼Œåè€Œæ˜¯æˆ‘åŒäº‹ç„¡æ³•æ¥å—ã€‚\nè‡³å°‘æˆ‘é‚„èƒ½ç”¨æŒ‡ä»¤çš„æ–¹å¼æŸ¥æˆ‘è¦çš„æ±è¥¿ã€‚\nkubectl exec -it pod_name bash\nkubectl logs pod_name\n...\n\nä»Šå¤©å¿ƒè¡€ä¾†æ½®æŸ¥æŸ¥çœ‹æœ‰æ²’æœ‰ç›¸é—œå•é¡Œï¼Œæ˜¯bugé‚„æ˜¯å·²ç§»é™¤ã€‚\næ‰çŸ¥é“äº†ï¼ŒåŸä¾†æ˜¯LensæŠŠå®ƒå¾openLensç§»é™¤ï¼Œ\nè©³ç´°å¯åƒè€ƒä¸‹é¢é€£çµ\nhttps://github.com/lensapp/lens/issues/6819\nOpenLens 6.3.0 - No Logs or Shell buttons\nä¹‹å¾Œå†è©¦è©¦å…¶ä»–çš„ devtron æˆ– Monokle",
		"tags": [ "note","âˆ"]
},

{
		"title": "k8så–å¾—ç™»å…¥æ†‘è­‰",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/143. k8så–å¾—ç™»å…¥æ†‘è­‰/",
		"content": "ç¡ç¡å¿µ\nå¹«åŒäº‹æ–°å»ºä¸€çµ„drone è‡ªå‹•éƒ¨ç½²çš„æ–°å°ˆæ¡ˆï¼Œ\nè¦ç™¼ç‰ˆåˆ°è‡ªå»ºçš„k8sä¸Šé¢ï¼Œ\nçµ‚æ–¼ç¢°åˆ°æˆ‘ä¸æƒ³é¢å°çš„æ±è¥¿äº†ã€‚\nkube_ca ï¼Œkube_token ï¼Œæˆ‘å“ªçŸ¥é“é€™å…©å€‹æ±è¥¿åœ¨å“ªè£é˜¿\næ­£æ–‡\nå¾ Drone Kuberneteså¯ä»¥çŸ¥é“ï¼Œä¸€å€‹æ˜¯ä½¿ç”¨è€…ï¼Œä¸€å€‹æ˜¯caèªè­‰çš„keyï¼Œ\nä½†æˆ‘é‚„ä¸çŸ¥é“å»å“ªç”Ÿé€™å…©å€‹æ±è¥¿å‡ºä¾†ã€‚\nKUBE_TOKENÂ This plugin has one authentication method and that is to use the token to authorize the user.\nKUBE_CAÂ This should be the base64 encoding of your certificate authority. You can get this string by running the command:\nè·‘å»å•äº†ä¸€ä¸‹chatGPTï¼Œå¾—åˆ°ç­”æ¡ˆã€‚\nåŸ·è¡ŒæŒ‡ä»¤å‰ï¼Œå¿…é ˆå…ˆé€£åˆ°ä½ è¦å–å¾—çš„clusterä¸Šã€‚\nkubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep cluster-admin | awk '{print $1}')\n\næˆ‘çš„åˆ—å‡ºæœ‰å¾ˆå¤šå€‹ï¼Œå°±æ‹¿ç¬¬ä¸€å€‹çœ‹èµ·ä¾†ä¹Ÿæœ€åƒçš„ä¾†ç”¨äº†ã€‚\nadmin-user-token-tm7g4\n\né€™é‚Šå°±æœƒçœ‹åˆ°tokenã€‚\nå†ä¾†æ˜¯ca\nkubectl config view --raw --minify --flatten -o jsonpath='{.clusters[].cluster.certificate-authority-data}'\n\næ”¾åˆ°droneä¸Šé¢ï¼Œé©—è­‰ï¼Œæ”¶å·¥ã€‚\n\nref. ä½¿ç”¨è€…èªè­‰",
		"tags": [ "note","âˆ"]
},

{
		"title": "k8s çš„sercretè¤‡è£½",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/144. k8s çš„sercretè¤‡è£½/",
		"content": "ç¡ç¡å¿µ\næœ¬åœ°çš„k8sæ©Ÿå™¨ï¼Œè¦å»google artifact registry pull image ï¼Œç™¼ç¾æ²’æ¬Šé™ã€‚\nä»¥å‰çš„æ¬Šé™åœ¨namespaceçš„ defaultä¸Šé¢ï¼Œ\ndefaultå¤ªè‚¥äº†ï¼Œå¯¦åœ¨ä¸æƒ³å†å¾€é‚£é‚Šå¡ï¼Œ\nè¦éº»è‡ªå·±å‰µå€‹SAå†æŠŠjsonä¸Ÿå»é©—è­‰ï¼Œ\nä¸ç„¶çœ‹èƒ½ä¸èƒ½æŠŠèˆŠçš„æ‹¿ä¾†ç”¨ã€‚\næ­£æ–‡\nè¤‡è£½\nåƒè€ƒ Kubernetes: copying a secret from one namespace to another\nkubectl get secret my-tlssecret --namespace=default -o yaml | sed 's/namespace: .*/namespace: gameservice/' | kubectl apply -f -\n\næœ¬ä¾†my-tlssecret åœ¨ defaulä¸Š ï¼Œè¦æ”¹åˆ°gamerservice\né€™æ¨£å°±ä¸ç”¨å†ç”³è«‹ä¸€å€‹saå¸³è™Ÿæèªè­‰äº†ï¼Œ\nå¦‚æœè¦å¾é ­é–‹å§‹çš„è©±ï¼Œ\nåƒè€ƒgoogleå®˜æ–¹æ–‡ä»¶\nç‚º Docker è¨­å®šèº«ä»½é©—è­‰\nè§£å¯†\nkubectl get secret test-grafana -n monitoring -o jsonpath='{.data.admin-user}' |base64 --decode; echo",
		"tags": [ "note","âˆ"]
},

{
		"title": "kubeadmé‡æ–°ç”¢ç”Ÿé©—è­‰",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/151. kubeadmé‡æ–°ç”¢ç”Ÿé©—è­‰/",
		"content": "ç¡ç¡å¿µ\näº‹æƒ…ç™¼ç”Ÿåœ¨æŸä¸€å¤©ï¼Œ\nçªç„¶æœ‰å€‹äººè·‘ä¾†è·Ÿæˆ‘èªªï¼Œä»–è©²æ€éº¼é€£æ¨“ä¸Šè‡ªå»ºçš„k8sï¼Œ\né‚£æ™‚åœ¨è™•ç†å…¶ä»–æ±è¥¿ï¼Œå°±èªªæˆ‘ç­‰ç­‰çµ¦ä½ ã€‚\nå†ä¾†ï¼Œçªç„¶ç™¼ç¾æˆ‘è‡ªå·±é€£ä¸ä¸Šå»ï¼Œä¸€ç›´è·³éŒ¯èª¤ã€‚\nunable to connect to server: x509: certificate has expired or is not yet valid\næ­£æ–‡\nä½¿ç”¨openLené€£ç·šæ™‚ï¼Œå‡ºç¾éŒ¯èª¤ã€‚ç•¶ä¸‹èªçˆ²æ‡‰è©²æ˜¯é‡‘é‘°æœ‰å•é¡Œï¼Œ\nä½†é‚£è‡ºæ©Ÿå™¨æ‡‰è©²å¾ˆä¹…æ²’å‹•äº†ï¼Œç•¶åˆk8sä¹Ÿä¸æ˜¯æˆ‘æ¶èµ·ä¾†çš„ï¼Œ\né ­ç—›é˜¿ã€‚\n\nproxy_server.go:147 Error while proxying request: x509: certificate has expired or is not yet valid\n\nå¾é€™ç¯‡K8Sè‡ªå»ºå¢é›†æ›´æ›è­‰æ›¸çŸ¥é“äº†ä¸€ä»¶äº‹æƒ…\n\né€šékubeadmè‡ªå»ºçš„å¢é›†ï¼Œåˆå§‹åŒ–å¾Œæœƒç”Ÿæˆä¸€å¹´çš„è­‰æ›¸ï¼Œç°½ç™¼çš„CAè­‰æ›¸æœ‰æ•ˆæœŸé»˜èªæ˜¯10å¹´ï¼Œç°½ç™¼çš„apiserverè­‰æ›¸æœ‰æ•ˆæœŸé»˜èªæ˜¯1å¹´\n\nå†å•ä¸€ä¸‹å…¶ä»–å–®ä½çš„åŒäº‹ï¼Œé‚£å€‹ç’°å¢ƒæ˜¯ä¸æ˜¯å·²ç¶“æ¶ä¸€å¹´äº†ï¼Ÿ\nçµæœå‡ºä¾†ï¼Œå·®ä¸å¤šä¸€å¹´äº†ï¼Œé‚£å¯ä»¥åˆ¤æ–·æ˜¯é‡‘é‘°éæœŸï¼Œä½†é‚„æ˜¯å¿…é ˆåˆ°æ©Ÿå™¨è£é¢æª¢æŸ¥ä¸€ä¸‹ã€‚\nç”¨sshæˆ–ä»»æ„æ–¹å¼é€£åˆ°masterä¸»æ©Ÿä¸Šï¼Œ\nè¦–æ¬Šé™è®Šæ›´ä½¿ç”¨è€…ï¼Œ\næˆ‘åœ¨åŸ·è¡Œkubeadmçš„æ™‚å€™ï¼Œå…¨ç¨‹ä½¿ç”¨rootçš„å¸³è™Ÿ\næª¢æŸ¥æ†‘è­‰åˆ°æœŸæ—¥\nkubeadm certs check-expiration\n\nç™¼ç¾çœŸçš„éæœŸäº†ï¼Œé‡å»ºå§ã€‚\nåƒè€ƒä¸‹é¢é€£çµç™¼ç¾æœ‰é»å•é¡Œï¼Œå¯èƒ½æ˜¯å› ç‚ºç‰ˆæœ¬æœ‰æ›´æ–°ã€‚\nref. è§£æ±ºkubernetesè­‰æ›¸éæœŸå•é¡Œ\nkubeadm certs renew # é€™æ¨£æœ‰å•é¡Œï¼Œæœƒç™¼ç”ŸéŒ¯èª¤\n\nkubeadm missing subcommand; &quot;renew&quot; is not meant to be run on its own\n\næŸ¥è©¢å®˜æ–¹æ–‡ä»¶\nkubeadm certs renew all\n\nåŸ·è¡Œå®Œæˆå¾Œï¼Œåœ¨æª¢æŸ¥ä¸€æ¬¡åˆ°æœŸæ—¥ï¼Œæ˜¯å¦å·²ç¶“è®Šæ›´ã€‚\nkubeadm certs check-expiration\n\nä½†æ­¤æ™‚é‚„æ˜¯æ²’è¾¦æ³•é€£ç·šï¼Œéœ€æ›´æ–°kube configï¼Œ\né€™é‚Šä½¿ç”¨ä¸€èˆ¬ä½¿ç”¨è€…å¸³è™Ÿ\nmv config config.old cp -i /etc/kubernetes/admin.conf $HOME/.kube/config chown $(id -u):$(id -g) $HOME/.kube/config sudo chmod 644 $HOME/.kube/config\n\np.s ä¸Šé¢çš„æ–‡ç« èªªè¦é‡å•Ÿkube-apiserver,kube-controller,kube-scheduler,etcd é€™å››å€‹å®¹å™¨ï¼Œä½†æˆ‘æ²’é‡å•“ï¼Œå› ç‚ºæˆ‘é€™å°masterä¸»æ©Ÿæ ¹æœ¬æ²’æ‰¾åˆ°dockerï¼Œé€™éƒ¨åˆ†æˆ‘ä¹Ÿå¾ˆç–‘æƒ‘ã€‚\nä½†ä¸€åˆ‡éƒ½æ­£å¸¸äº†ï¼Œå°±å…ˆé€™æ¨£å§ã€‚\n\nçµå°¾\nå¦‚æœè¦å¾å…¶ä»–åœ°æ–¹é€£åˆ°k8s masterï¼Œæª”æ¡ˆå°±åœ¨/etc/kubernetes/admin.confè£é¢äº†ã€‚\nä¸éå®˜æ–¹å¼·çƒˆå»ºè­°ï¼Œä¸è¦å°‡admin.confèˆ‡å…¶ä»–äººå…±äº«ã€‚\næœ€å¥½æ˜¯å¦å¤–é–‹ä¸€å€‹ä½¿ç”¨è€…ï¼Œ\né€™éƒ¨åˆ†æˆ‘ç ”ç©¶ä¸‹ï¼Œæ”¹å¤©åœ¨å¯«ç¯‡æ–‡ç« äº†å§\nç›¸é—œè³‡è¨Šï¼š\n\nä½¿ç”¨ kubeadm é€²è¡Œæ†‘è­‰ç®¡ç†\nPKI è­‰æ›¸å’Œè¦æ±‚",
		"tags": [ "note","âˆ"]
},

{
		"title": "æŸ¥è©¢GKEå·²æ£„ç”¨çš„API",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/162.æŸ¥è©¢å·²æ£„ç”¨çš„API/",
		"content": "å‰è¨€\né€™ä»¶äº‹èªªä¾†çªç„¶ï¼Œ\næŸä¸€å¤©æˆ‘å°±ç™¼ç¾åœ¨GKEä¸Šé¢å‡ºç¾äº†è­¦å‘Šè¨Šæ¯ï¼Œ\nèªªæˆ‘çš„GKEä»åœ¨ä½¿ç”¨å·²æ£„ç”¨çš„APIï¼Œ\nä½†æˆ‘æ¬åˆ°1.25ç‰ˆæœ¬å·²ç¶“æ˜¯ä¸€å€‹å¤šæœˆå‰çš„äº‹æƒ…äº†ï¼Œ\nä¹Ÿæ²’è½åˆ°æœ‰äººåœ¨èªªæœå‹™æ›æ‰ï¼Œ\nç™¾æ€ä¸å¾—å…¶è§£ã€‚\næ­£æ–‡\n\nå†ä¾†ä½¿ç”¨äº† kubent ï¼Œä¾†å°‹æ‰¾åˆ°åº•æ˜¯å“ªä¸€å€‹æœå‹™å¡ä½ï¼Œ\nä½†å¾ˆéºæ†¾çš„éƒ½æ²’æœ‰æœå°‹åˆ°ã€‚\néäº†å¹¾å¤©å¾Œï¼Œç™¼ç¾ä¹‹å‰æ‹¿ä¾†æ¸¬è©¦çš„QAç’°å¢ƒï¼Œ\nä¹Ÿè·³å‡ºä¾†äº†å·²æ£„ç”¨APIè­¦å‘Šé€šçŸ¥ã€‚\n\nç™¼ç¾GKEå°±æœ‰æç¤ºæ˜¯ä»€éº¼å‘¼å«çš„äº†ï¼Œ\nåœ¨QAç’°å¢ƒå¾ˆæ¸…æ¥šçš„å¯«ç€kubentï¼Œ\nä½†æœ¬ä¾†çš„é‚£å€‹å‘¢ï¼Ÿ\nåªæœ‰ v2.1.0 ï¼Œ\næ–¼æ˜¯æ ¹æ“šé€™å€‹é—œéµå­—å»æ‰¾å“ªå€‹imageæœ‰é€™å€‹ç‰ˆæœ¬è™Ÿã€‚\nåœ¨kube-state-metricä¸Šé¢æ‰¾åˆ°äº†é€™å€‹é—œéµå­—ï¼Œ\né€™ä¹Ÿç¬¦åˆç‚ºä»€éº¼å‡ºéŒ¯äº†æ²’äººçŸ¥é“ï¼Œ\nå› çˆ²æ²’äººçœ‹ï¼ˆï¼Ÿï¼‰\nä½†å› çˆ²metricä¾†æºæœ‰è‡³å°‘ä¸‰å¥—ï¼Œæ‰€ä»¥ä¸å¥½ç™¼ç¾ã€‚\nä¸éé€™å€‹å‰ä»»å»ºç½®çš„ä¹Ÿæœ‰é»å¥‡æ€ªï¼Œ\næˆ‘æŸ¥äº†å®˜æ–¹çš„kube-state-metricsï¼Œ\næ²’æ‰¾åˆ°æœ‰ç”¨stså»ºç«‹éçš„æ–¹å¼ï¼Œ\næœ‰é»ç¥å¥‡ã€‚\n\nå…ˆæ‹¿QAä¾†é©—è­‰æ”¹æ”¹çœ‹äº†ï¼Œ\nçœ‹å¾ŒçºŒæœƒä¸æœƒå†è·³å‡ºä¾†è­¦å‘Š",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "è‡ªå»ºk8sç‰ˆæœ¬å‡ç´š",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/172. è‡ªå»ºk8sç‰ˆæœ¬å‡ç´š/",
		"content": "ç¡ç¡å”¸\næœ‰äººèªªä»–è¦æ¸¬è©¦OME(OverMediaEngine)ï¼Œä¸²æµç›´æ’­è»Ÿé«”ï¼Œèªªæ¯”SRSå¥½ä¸€äº›ï¼Œä½†è‡ªå»ºçš„k8sç‰ˆæœ¬ä¸å¤ ï¼Œä¸èƒ½ä¸Šgateway APIï¼Œæ‰€ä»¥å‡ç´šå§ã€‚\næ­£æ–‡\næ›´æ–°å‰è«‹å…ˆç¢ºèªç‰ˆæœ¬æ›´æ–°å¾Œï¼Œä½ çš„æœå‹™ä¸æœƒæ›æ‰ã€‚\næ›´æ–°å¤§ç‰ˆæœ¬æ™‚ï¼Œæœƒæœ‰APIæ£„ç”¨çš„ç‹€æ³ï¼Œ <a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/162.æŸ¥è©¢å·²æ£„ç”¨çš„API/\">162.æŸ¥è©¢å·²æ£„ç”¨çš„API</a>\nç›®æ¨™\næ›´æ–°k8sçš„masterä¸€è‡ºèˆ‡nodeå…©è‡ºçš„ç‰ˆæœ¬\næ­¥é©Ÿ\n\næŸ¥è©¢ç›®å‰çš„ç‰ˆæœ¬\n\nkuberctl version\n\nï¼ˆé€™æ˜¯ç›®å‰ç‰ˆæœ¬ï¼Œå‡ç´šç•¶æ™‚çš„ç‰ˆæœ¬ç‚º1.22.?)\nserverçš„ç‰ˆæœ¬ç‚º1.25.14\n\nServer Version: version.Info\n\nå‡ç´škubeadm\n\n# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„kubeadmçš„ç‰ˆæœ¬\nyum list --showduplicates kubeadm --disableexcludes=kubernetes\n# ç„¶å¾Œå‡ç´škubeadmçš„ç‰ˆæœ¬åˆ°1.23.0\nyum install -y kubeadm-1.23.0-0 --disableexcludes=kubernetes\n# æŸ¥çœ‹kubeadmç‰ˆæœ¬\nkubeadm version\n\nå‡ç´šmasteræ§åˆ¶\n\nkubeadm upgrade plan\n\né€™é‚Šç¢°åˆ°ä¸€å€‹å•é¡Œï¼Œæˆ‘æœ¬ä¾†åªæƒ³å‡ç´šåˆ°1.23.0ï¼Œ\nä½†ä¸Šé¢é€™å¼µåœ–ï¼Œä»–è¦æ±‚ç›´æ¥åˆ°1.23.17ï¼Œ\nä¸ç…§åšè¡Œä¸è¡Œï¼Œã€ä¸è¡Œã€ï¼Œå‡ç´šæœƒå‡ºéŒ¯ã€‚\næ‰€ä»¥å›åˆ°ç¬¬äºŒæ­¥ï¼Œå†åº¦æ›´æ–°kubeadmåˆ°1.23.17\nå†ä¾†ä¸€æ¬¡kubeam upgrade plan\né€™æ¬¡æ²’å‡ºç¾è­¦å‘Šäº†\n\nåŸ·è¡Œä¸Šé¢åŸ·è¡Œå®Œupgrade planæä¾›å‡ç´šæŒ‡ä»¤\nkubeadm upgrade apply v1.23.17\n\nå®Œæˆå¾Œæœƒçœ‹åˆ°\n\nSUCCESS! Your cluster was upgraded to &quot;v1.23.17&quot;. Enjoy!\n\nå‡ç´škubectl èˆ‡ kubelet\n\næŸ¥çœ‹ç›®å‰ç¯€é»ç‰ˆæœ¬\nkubectl get node -o wide\n\né©…é€ç•¶ä¸‹ç¯€é»çš„podï¼ˆé€™æ®µèˆ‡åƒè€ƒä¾†æºçš„æŒ‡ä»¤ä¸ä¸€æ¨£ï¼Œé€™å€‹æ¯”è¼ƒæš´åŠ›ï¼‰\n$masterç‚ºç¯€é»çš„åç¨±\nkubectl drain --force --ignore-daemonsets --delete-local-data --grace-period=10 &quot;$master&quot;\n\nç­‰é©…é€å®Œå¾Œï¼Œç¢ºèªnodeç‚ºSchedulingDisabledç‹€æ…‹ï¼Œå°±å¯å·²é–‹å§‹å‡ç´šäº†ã€‚\nyum install -y kubelet-1.23.17-0 kubectl-1.23.17-0 --disableexcludes=kubernetes\n# é‡å•“æœå‹™\nsudo systemctl daemon-reload\nsudo systemctl restart kubelet\n\næŸ¥è©¢nodeç‰ˆæœ¬æ˜¯å¦å·²ç¶“æ›´æ–°ï¼Œç„¶å¾Œè§£é™¤å°é–ã€‚\nkubectl uncordon $node\n\nå‡ç´šnodeçš„ç‰ˆæœ¬\né‡è¤‡ç¬¬å››æ­¥é©Ÿï¼Œåªæœ‰æ›´æ–°é‚£ä¸€æ®µyum install....éœ€è¦åˆ°ç›®æ¨™çš„nodeæ©Ÿå™¨ä¸Šåšã€‚\n\næ‰€ä»¥æŒ‡ä»¤å¦‚ä¸‹\n$nodeç‚ºè¦æ›´æ–°çš„nodeä¸»æ©Ÿ\n# masterä¸»æ©Ÿ\nkubectl drain --force --ignore-daemonsets --delete-local-data --grace-period=10 &quot;$node&quot;\n# nodeä¸»æ©Ÿ\nyum install -y kubelet-1.23.17-0 kubectl-1.23.17-0 --disableexcludes=kubernetes\n# é‡å•“æœå‹™\nsudo systemctl daemon-reload\nsudo systemctl restart kubelet\n# masterä¸»æ©Ÿ\nkubectl uncordon $node\n\nref.\n\nk8sç³»åˆ—12-kubeadmå‡ç´šk8så¢é›†Â \nUpgrading kubeadm clusters",
		"tags": [ "note","âˆ"]
},

{
		"title": "cert-managerå®‰è£",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/190. cert-managerå®‰è£/",
		"content": "å‰è¨€\nä¸Šæ¬¡é–‹æ–°å°ˆæ¡ˆçš„å»¶ä¼¸ï¼Œ\nè¨­å®šdomainæ™‚ï¼Œå°æ–¼cloudflareä¸å¤ ç†Ÿï¼Œ\né‚„å¥½æœ‰å€‹å‰ç«¯åŒäº‹ï¼Œç†Ÿæ­¤é–€è·¯ï¼Œå› çˆ²ä»–ä¹Ÿè¸©éã€‚\næ­£æ–‡\nå®‰è£cert-manager\nåƒç…§å®˜ç¶²èªªæ˜ã€‚\nä¸‹é¢èªæ³•ä¸ä¸€å®šæ˜¯æœ€æ–°çš„\nkubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.3/cert-manager.yaml\n\nå†ä¾†å°±æ˜¯å»ºç«‹ ClusterIssuer è·Ÿ Certificate\nåœ¨æ­¤ä¹‹å‰ï¼Œè¦å…ˆåˆ°cloudflareç”¢ç”Ÿä¸€çµ„tokenï¼Œ\næ‰æœ‰æ¬Šé™å°é€™å€‹domainåšé©—è­‰ã€‚\næˆ‘çš„domainæ˜¯åœ¨cloud domainè³¼è²·ï¼Œç„¶å¾Œå†cloudflareè¨—ç®¡ã€‚\nç‚ºä»€éº¼ä¸ç›´æ¥åœ¨google cloudè¨—ç®¡ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œä¹‹å‰å°±é€™æ¨£äº†ã€‚\n\nUser Profile &gt; API Tokens &gt; API Tokens.\n\nåƒç…§å®˜æ–¹æ–‡ä»¶ï¼Œè¨­å®šæ¬Šé™ï¼Œå–å¾—token\n\nå°‡tokenå­˜åˆ° secret\napiVersion: v1\nkind: Secret\nmetadata:\nname: cloudflare-api-token-ezio-com\nnamespace: cert-manager\ntype: Opaque\nstringData:\napi-token: &lt;token&gt;\n---\napiVersion: cert-manager.io/v1\nkind: ClusterIssuer\nmetadata:\nname: cloudflare-issuer-ezio-com\nspec:\nacme:\nserver: https://acme-v02.api.letsencrypt.org/directory\nprivateKeySecretRef:\nname: cloudflare-issuer-ezio-com\nsolvers:\n- dns01:\ncloudflare:\nemail: ezio@abc.com\napiTokenSecretRef:\nname: cloudflare-api-token-ezio-com\nkey: api-token\n---\napiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\nname: ezio-com-tls\nnamespace: istio-system\nspec:\nsecretName: ezio-com-tls\nissuerRef:\nname: cloudflare-issuer-ezio-com\nkind: ClusterIssuer\ncommonName: &quot;*.ezio.com&quot;\ndnsNames:\n- &quot;*.ezio.com&quot;\n\né€™é‚Šæ³¨æ„ä¸€ä¸‹ï¼Œæª”æ¡ˆä¹‹é–“çš„é—œè¯æ€§ã€‚\nä¸Šé¢å¯«çš„ç¯„ä¾‹domainæ˜¯ *.ezio.com ï¼Œè«‹æ”¹çˆ²è‡ªå·±å¯¦éš›ä½¿ç”¨çš„ã€‚\néƒ¨ç½²ä¸Šå»å¾Œï¼Œæª¢æŸ¥ç‹€æ…‹ï¼Œæœ‰æ²’æœ‰Readyï¼Œé€šå¸¸ä¸æœƒè¶…é5åˆ†é˜ã€‚\nkubectl get certificate -A\n\nå¦‚æœå•“å‹•å¤±æ•—çš„è©±ï¼Œä½¿ç”¨ä¸‹é¢æŒ‡ä»¤æª¢æŸ¥log\nkubectl describe certificate ezio-com-tls\n\nå¦‚æœæ˜¯ä¸‹é¢é€™å€‹å¤±æ•—è¨Šæ¯ï¼Œ\n\nFound no Zones for domain _acme-challenge.aplusmanagex.com. (neither in the sub-domain nor in the SLD) please make sure your domain-entries in the config are correct and the API key is correctly setup with Zone.read rights.\n\nè¡¨ç¤ºä½ çš„tokenæ²’æœ‰ç›¸é—œæ¬Šé™ï¼Œé€™å€‹å‘æˆ‘è¸©å®Œäº†orzã€‚\nref.\n\nCloudflare\nkubectl apply",
		"tags": [ "note"]
},

{
		"title": "192. è‡ªå»ºçš„k8sæ‹‰å–private registry",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/192. è‡ªå»ºçš„k8sæ‹‰å–private registry/",
		"content": "å‰è¨€\né–‹ç™¼ç’°å¢ƒä¸Šï¼Œä¹‹å‰æ‹‰å¾—éƒ½æ˜¯å¦ä¸€å€‹å°ˆæ¡ˆçš„registryï¼Œ\nç¾åœ¨æœ‰å€‹å…¨æ–°çš„å°ˆæ¡ˆï¼Œç†æ‰€ç•¶ç„¶imageæ‡‰è©²æ‹‰å»å¦ä¸€å€‹åœ°æ–¹çš„GARã€‚\næ­£æ–‡\n\né¦–å…ˆåˆ°IAMè£é¢ï¼Œç”³è«‹ä¸€å€‹ServiceAccountï¼Œ\nç„¶å¾Œçµ¦æ¬Šé™ï¼Œå¯ä»¥åªçµ¦ Artifact Registryè®€å–è€…å°±å¥½ã€‚\nç„¶å¾Œç”¢ç”Ÿé‡‘é‘°ï¼Œåç¨±ç‚ºgar-push-bms.jsonã€‚\n\nå»ºç«‹screctï¼Œåç¨±å–åçˆ²gar-pull\nstackoverflowçš„èªªæ˜æŒ‡å‡ºï¼Œè©²emailæ˜¯æ²’åœ¨ç”¨çš„ï¼Œæ‰€ä»¥å¯ä»¥éš¨ä¾¿æ‰“ã€‚\n\nkubectl create secret docker-registry gar-pull \\\n--docker-server &quot;https://asia-east1-docker.pkg.dev&quot; \\\n--docker-username _json_key \\\n--docker-email gar-pull@.iam.gserviceaccount.com \\\n--docker-password=&quot;$(cat gar-push-bms.json)&quot;\n\ndeploymentçš„yamlè¨­å®š\n\nimagePullSecrets:\n- name: gar-pull\n\nè¨˜å¾—ï¼Œå¦‚æœåœ¨ä¸åŒçš„namespaceï¼Œéœ€é‡æ–°å»ºç«‹æ–°çš„secretã€‚\nref.\n\nCreating image pull secret for google container registry that doesn't expire?\nç‚º Docker è¨­å®šèº«ä»½é©—è­‰",
		"tags": [ "note","âˆ"]
},

{
		"title": "pod debugæ–¹å¼",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/194. pod debugæ–¹å¼/",
		"content": "å‰è¨€\né€™é™£å­å»ºäº†ä¸€å€‹æ–°ç’°å¢ƒï¼Œ\nç„¶å¾Œpodåœ¨ç¬¬ä¸€æ¬¡å•“å‹•æ™‚ï¼Œéƒ½æœƒé‡å•“ï¼Œ\nä½†ä¸€æ—¦é‡å•“å°±çœ‹ä¸åˆ°ä¹‹å‰çš„logã€‚\næ­£æ–‡\nçœ‹ä¸Šä¸€æ¬¡çš„logè¨˜éŒ„\nkubectl logs {PODNAME} --previous\n\nå…¶ä»–ç”¨æ³•\n# Return snapshot logs from pod nginx with only one container\nkubectl logs nginx\n\n# Return snapshot of previous terminated ruby container logs from pod web-1\nkubectl logs -p -c ruby web-1\n\n# Begin streaming the logs of the ruby container in pod web-1\nkubectl logs -f -c ruby web-1\n\n# Display only the most recent 20 lines of output in pod nginx\nkubectl logs --tail=20 nginx\n\n# Show all logs from pod nginx written in the last hour\nkubectl logs --since=1h nginx\n\nref .\n\nK8så¦‚ä½•æ–¹ä¾¿å°‹æ‰¾äº‹ä»¶ç™¼ç”Ÿæˆ–æ˜¯å–å¾—å·²æ¶ˆé€çš„LOGç´€éŒ„\nkubectl logs\n\né€£é€²å»podè£é¢ç›£æ§\næœ‰æ™‚æœƒç¢°åˆ°é€™å€‹podæ²’æœ‰æ¬Šé™å¯ä»¥å®‰è£htopæˆ– topç­‰ç­‰ï¼Œ\né€™äº›çœ‹ç³»çµ±æ•ˆèƒ½çš„æ±è¥¿ï¼Œ\næ­¤æ™‚å¯ä»¥é€éé€™ç¨®æ–¹å¼ï¼Œç›´æ¥å¤–æ›ä¸€å€‹debugçš„imageï¼Œ\nå°±èƒ½éš¨ä¾¿ä½ äº‚æäº†ï¼Œé‚„ä¸æ€•æœƒå½±éŸ¿åˆ°æ­£åœ¨åŸ·è¡Œçš„podã€‚\nä¸‹é¢æŒ‡ä»¤çš„æ„æ€æ˜¯ï¼Œé€£å» filebeatçš„podã€‚\nå¦‚æœè¦æŒ‡å®šcontainerçš„è©±ï¼Œå¢åŠ  --target=filebeatçš„æŒ‡ä»¤ã€‚\nkubectl debug -it \\\n--container=debug-container \\\n--image=alpine \\\nfilebeat-beat-filebeat-bcb666b79-vm6dt\n\nref.\n- Debugging Running Pods on Kubernetes",
		"tags": [ "note","âˆ"]
},

{
		"title": "httpå¥åº·åº¦åµæ¸¬",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/196. httpå¥åº·åº¦åµæ¸¬/",
		"content": "å‰è¨€\næœ€è¿‘ç¢°åˆ°ä¸€å€‹æ€ªå•é¡Œï¼Œpodæ´»å¾—å¥½å¥½çš„ï¼Œä½†è£é¢çš„æœå‹™å°±æ›äº†ã€‚\nå› ç‚ºæˆ‘é‚„èƒ½é€£é€²å»podè£é¢ï¼Œè£ä¸€å †æ±è¥¿ï¼Œä½†æœå‹™å°±çœŸçš„æ²’è¾¦æ³•äº†ã€‚\nåªå¥½ï¼Œè·Ÿé–‹ç™¼æºé€šï¼Œä¸ç„¶å°±å¼„å€‹å¥åº·åº¦åµæ¸¬å§ï¼Œ\nä½†è¦æ³¨æ„ï¼Œä¸€å®šè¦éå¸¸ç¢ºå®šé€™å€‹æœå‹™éš¨æ™‚é‡å•“æ²’é—œä¿‚ã€‚\næ­£æ–‡\nlivenessProbe:\nhttpGet:\npath: /Info/LivenessCheck\nport: 80\nscheme: HTTP\ninitialDelaySeconds: 120\ntimeoutSeconds: 1\nperiodSeconds: 5\nsuccessThreshold: 1\nfailureThreshold: 2\n\nç•¶http å›æ‡‰çš„ç‹€æ…‹ç¢¼æ˜¯ 200~400 çš„è©±ï¼Œé»˜èªç‚ºæ­£å¸¸ã€‚\nä¸æ˜¯é€™å€‹ä»¥å¤–çš„ï¼Œå°±èªçˆ²å¤±æ•—ã€‚\nä¸Šé¢çš„åƒæ•¸\n\ninitialDelaySeconds: podå•“å‹•å¾Œå¹¾ç§’æ‰é–‹å§‹åŸ·è¡Œ\ntimeoutSeconds: timeoutæ™‚é–“\nperiodSeconds: é–“éš”å¹¾ç§’å‘¼å«ä¸€æ¬¡\nsuccessThreshold: åœ¨æª¢æŸ¥å¤±æ•—å¾Œ, æ¥ä¸‹ä¾†è¦å¤šå°‘æ¬¡é€£çºŒåˆ¤å®šæˆåŠŸæ‰ç®—æˆåŠŸ\nfailureThreshold: å¤±æ•—æ¬¡æ•¸\n\nref.\n\nKubernetes â€” å¥åº·æª¢æŸ¥\nçµ„æ…‹å­˜æ´»ã€å°±ç·’å’Œå•Ÿå‹•æ¢é‡",
		"tags": [ "note","âˆ"]
},

{
		"title": "254. StatefulSetå‘¼å«podçš„æ–¹æ³•",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/254. StatefulSetå‘¼å«podçš„æ–¹æ³•/",
		"content": "WHY\nå»¶çºŒä¸Šç¯‡ <a class=\"internal-link\" data-note-icon=\"\" href=\"/252. k8sä¸­çš„podå‘¼å«/\">252. k8sä¸­çš„podå‘¼å«</a> ï¼Œé‚£ç¯‡æ–‡ç« ä¸­ï¼Œ\nè¦ç›´æ¥å»call statefulSetçš„podï¼Œ\né€éipåæŸ¥ï¼Œæ‰¾åˆ°DNSï¼Œ\nä½†å¦‚æœIPåæŸ¥ä¹Ÿæ‰¾ä¸åˆ°DNSå‘¢ï¼Ÿ\nSolution\nåœ¨å»ºç«‹srsæœå‹™æ™‚ï¼Œ\næ ¹æ“šä¹‹å‰çš„æ¸¬è©¦æ–¹å¼ï¼Œæä¾›RD æºé€šçš„ç¶²å€ï¼Œ\nä½†ä¸Šç·šæ™‚ï¼Œä¸€æŸ¥ é€™å€‹ç¶²å€æ²’æœ‰æŒ‡å®šï¼Œ\nIPä¹Ÿæ²’æœ‰å°æ‡‰çš„FQDNã€‚\næ–¼æ˜¯ï¼Œæ‰ç™¼ç¾æ˜¯sts(StatefulSetçš„ç¸®å¯«ï¼‰çš„è¨­å®šå•é¡Œã€‚\nå¦‚æœè¦ç›´æ¥è·Ÿstsçš„podé€£ç·šæ™‚ï¼Œéœ€è¦ä½¿ç”¨headless serviceã€‚\n\nç„¡é ­ Service ä¸ä½¿ç”¨è™›æ“¬ IP åœ°å€å’Œä»£ç†Â çµ„æ…‹è·¯ç”±å’Œå°åŒ…è½‰ç™¼ï¼›ç›¸åï¼Œç„¡é ­ Service é€šéå…§éƒ¨ DNS è¨˜éŒ„å ±å‘Šå„å€‹ Pod çš„ç«¯é» IP åœ°å€ï¼Œé€™äº› DNS è¨˜éŒ„æ˜¯ç”±å¢é›†çš„Â DNS æœå‹™æ‰€æä¾›çš„ã€‚\n\nè¦ä½¿ç”¨Headless serviceçš„è©±ï¼Œå‰‡éœ€è¨­å®š clusterIP: none\nä½† stsæŒ‡å®šçš„service nameè¦æŒ‡å®šæ˜¯æœ‰è¨­å®š Headless serviceçš„serviceã€‚\nsts.yaml\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\nname: srs-edge\nnamespace: srs-qa\nspec:\nreplicas: 2\nserviceName: srs-edge\nselector:\nmatchLabels:\napp: srs-edge\n\nservice.yaml\napiVersion: v1\nkind: Service\nmetadata:\nname: srs-edge\nnamespace: srs-qa\nspec:\nclusterIP: None\nselector:\napp: srs-edge\n\né€™æ¨£å°±èƒ½å¤ ä½¿ç”¨ &lt;podName&gt;.&lt;serviceName&gt;.&lt;nameSpace&gt;.svc.cluster.local å»å‘¼å«podäº†ã€‚\nä¸æ”¾å¿ƒï¼Œå¯ä»¥åƒè€ƒä¸Šä¸€ç¯‡<a class=\"internal-link\" data-note-icon=\"\" href=\"/252. k8sä¸­çš„podå‘¼å«/\">252. k8sä¸­çš„podå‘¼å«</a>ç”¨nslookupé©—è­‰FQDN\nref. StatefulSet",
		"tags": [ "note","âˆ"]
},

{
		"title": "k8sçš„ç¯€é»é¸æ“‡èˆ‡æ±¡æŸ“",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/27.K8sçš„ç¯€é»é¸æ“‡èˆ‡æ±¡æŸ“/",
		"content": "å‰è¨€\næœ€è¿‘ç¢°åˆ°çš„å•é¡Œï¼Œèµ·å› æ˜¯å–®å°çš„å°å¤–é€£ç·šæ•¸éå¤§ï¼Œå°è‡´ç¨‹å¼ç™¼ç”Ÿå•é¡Œï¼Œç„¡æ³•å†é€£ç·šåˆ°å¤–éƒ¨ç¶²è·¯ã€‚\næ­£æ–‡\nåœ¨ GCPç¶²è·¯å°å¤–çš„æ–¹å¼è£¡é¢æœ‰æåˆ°ï¼Œå°å¤–é€£ç·šæ™‚ï¼Œå¦‚æœæ˜¯ç§æœ‰å¢é›†æœƒä½¿ç”¨Cloud NATï¼Œ\næœ¬æ¬¡çš„æƒ…å½¢ï¼Œæ˜¯å› ç‚ºå†è©²ç¯€é»å…§ï¼ŒæŸä¸€å€‹deployç–‘ä¼¼å°‡é€£ç·šæ•¸åƒæ»¿ï¼Œæœ€è¿‘æƒ³é€šäº†ï¼Œæ‡‰è©²æ˜¯ç¯€é»æ•¸é‡çš„å•é¡Œã€‚\nnodeSelector\næ‰€ä»¥è¦å°‡æŸä¸€å€‹æœå‹™ï¼Œç¨ç«‹æ›åœ¨å–®ä¸€çš„ç¯€é»æ± ä¸Šé¢ã€‚\næœ€ç°¡å–®çš„ç”¨æ³•æ˜¯ nodeSelectorï¼Œåœ¨ spec.template.spec çš„ä¸‹ä¸€å±¤ã€‚\napp : websocket é€™å€‹æ˜¯label åœ¨å»ºç«‹nodepoolæ™‚ï¼Œä¸€ä½µå»ºç«‹çš„ã€‚\nä¹Ÿå¯åœ¨å»ºç«‹nodepoolå¾Œï¼Œåœ¨æ‰‹å‹•æ–°å¢labelã€‚ç•¶ç„¶ä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šgoogleè³¦äºˆçš„labelã€‚\n\næŸ¥è©¢label\nkubectl get nodes --show-label\næ–°å¢label\nkubectl label node &lt;node name&gt; &lt;label&gt;=&lt;value&gt;\n\nref.\nKubernetes åˆ†æ´¾ Pod åˆ°æŒ‡å®šç¯€é»\ndeployçš„ç¯„ä¾‹\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: deployabc\nspec:\nreplicas: 10\ntemplate:\nspec:\n.......\nnodeSelector:\napp: websocket\n\nref.\nå°‡ Pod éƒ¨ç½²åˆ°ç‰¹å®šç¯€é»æ± \nå°‡ Pod åˆ†é…çµ¦ç¯€é»\nç¯€é»æ±¡é»\nå‰›ä¸Šé¢æœ‰æåˆ°ï¼Œdeployå¯ä»¥æŒ‡å®špodåˆ°ç‰¹å®šçš„ç¯€é»ï¼Œä½†æ˜¯ç•¶å‰é¢çš„ç¯€é»æ»¿äº†å¾Œï¼Œå…¶ä»–çš„deployé‚„æ˜¯æœ‰å¯èƒ½æœƒåˆ°ç‰¹å®šçš„ç¯€é»ä¸Šã€‚\nk8så¯ä»¥è¨­å®šç¯€é»ç‚º æ±¡é»(Taint)ï¼Œä½¿æ­¤æ±¡æŸ“çš„ç¯€é»ï¼Œåªèƒ½æ¥å—æœ‰å®¹å¿åº¦çš„podã€‚\næ±¡é»çš„è¨­å®šä¸èƒ½äº‹å¾Œæ›´æ–°ï¼Œæ‰€ä»¥è¦åœ¨ä¸€é–‹å§‹å»ºç«‹æ™‚å°±è¨­å®šå¥½ã€‚è«‹æ³¨æ„(fig.2)çš„Taintã€‚\nå¦å¤–å»ºè­°çµ±ä¸€ç”±GKEçš„ç¯€é»æ±¡é»ï¼Œå¾æ§åˆ¶å°å»ºç«‹æˆ–ä½¿ç”¨æŒ‡ä»¤å»ºç«‹ã€‚\nå¦å‰‡ç•¶nodeè‡ªå‹•æ–°å¢æ™‚ï¼Œè©²ç¯€é»ä¸¦ä¸æœƒç”¢ç”Ÿ Taits\nè¨­å®šæ™‚ï¼Œè¦æŒ‡å®š key èˆ‡ value ä»¥åŠ æ•ˆæœã€‚\n\næ•ˆæœæœ‰ä»¥ä¸‹ä¸‰ç¨®ï¼š\n- NoScheduleï¼šä¸èƒ½å®¹å¿æ­¤æ±¡é»çš„ Pod ä¸æœƒè¢«èª¿åº¦åˆ°ç¯€é»ä¸Šï¼›ç¾æœ‰ Pod ä¸æœƒå¾ç¯€é»ä¸­é€å‡ºã€‚\n- PreferNoScheduleï¼šKubernetes æœƒé¿å…å°‡ä¸èƒ½å®¹å¿æ­¤æ±¡é»çš„ Pod å®‰æ’åˆ°ç¯€é»ä¸Šã€‚\n- NoExecuteï¼šå¦‚æœ Pod å·²åœ¨ç¯€é»ä¸Šé‹è¡Œï¼Œå‰‡æœƒå°‡è©² Pod å¾ç¯€é»ä¸­é€å‡ºï¼›å¦‚æœå°šæœªåœ¨ç¯€é»ä¸Šé‹è¡Œï¼Œå‰‡ä¸æœƒå°‡å…¶å®‰æ’åˆ°ç¯€é»ä¸Šã€‚\nref.ç”¨ç¯€é»æ±¡é»æ§åˆ¶èª¿åº¦\nä¹‹å¾Œåœ¨deployä¸Šé¢å»ºç«‹å®¹å¿(toleration)æ±¡é»ï¼Œ åœ¨ spec.template.spec çš„ä¸‹ä¸€å±¤\nå…¶ä¸­ key èˆ‡ value ç‚ºè‡ªè¨‚ï¼Œæ•ˆæœè«‹åƒè€ƒä¸Šé¢é¸æ“‡ã€‚\napiVersion: apps/v1\nkind: pod\nmetadata:\nname: deployabc\nspec:\nreplicas: 10\ntemplate:\nspec:\n\t\tcontainer:\n\t .......\n\t\ttolerations:\n\t\t- key: &quot;visible&quot;\n\t\t operator: &quot;Equal&quot;\n\t\t value: &quot;private&quot;\n\t\t effect: &quot;NoExecute&quot;\n\t\t tolerationSeconds: 3600\n\nè£œå……ï¼Œå¦‚æœæ˜¯èˆŠçš„ç¯€é»é›†å€ï¼Œåœ¨GKEä¸Šé¢ï¼Œå¯ä»¥æ”¹ä½¿ç”¨é€™å€‹labelå»é¸æ“‡ã€‚\ncloud.google.com/gke-nodepool: &lt;ç¯€é»æ± çš„åç¨±&gt;\n\nref.\næ±¡é»å’Œå®¹å¿åº¦\nk8sé€²éšç¯‡ï¼ˆå››ï¼‰ï¼šAffinity and Anti-Affinityã€Taints and Tolerations",
		"tags": [ "note","âˆ"]
},

{
		"title": "k8s PDBï¼ˆpodä¸­æ–·é ç®—ï¼‰",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/42.k8s PDBï¼ˆpodä¸­æ–·é ç®—ï¼‰/",
		"content": "å‰è¨€\nK8SçœŸæ˜¯ TXDåšå¤§ç²¾æ·±......ï¼Œ\næ²’æƒ³åˆ°å†è¿½<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/GKE/41.GKEç¯€é»ç„¡æ³•è‡ªå‹•ç¸®å°/\">41.GKEç¯€é»ç„¡æ³•è‡ªå‹•ç¸®å°</a>çš„æ™‚å€™ï¼Œæœƒåˆ°é€™é‚Šä¾†ã€‚\næ­£æ–‡\nç°¡å–®ä¾†èªªï¼Œé€™å€‹è¨­å®šæ˜¯ç”¨ä¾†é¿å…podè¢«ç„¡é è­¦çš„åˆªé™¤ã€‚\nç•¶ç™¼ç”Ÿè‡ªé¡˜ä¸­æ–·çš„æ™‚å€™ï¼Œè®“æ­¤podä¸æœƒå› ç‚ºpodçš„æ•¸é‡éå°‘ï¼Œ\nè€Œå°è‡´æœå‹™ä¸­æ–·ã€‚\né€™å€‹è·Ÿ HPAæœ‰é»åƒï¼Œä½†HPAæ˜¯æ ¹æ“šè¨­å®šï¼Œä¾†æ±ºå®špodè¦ä¸è¦å¢åŠ æˆ–æ¸›å°‘ã€‚\nè‡ªé¡˜ä¸­æ–·é€šå¸¸æ˜¯ä¸‹é¢ä¸‰ç¨®ï¼š\n\næ’ç©ºï¼ˆdrainï¼‰ç¯€é»é€²è¡Œä¿®å¾©æˆ–å‡ç´š\nå¾é›†ç¾¤ä¸­æ’ç©ºç¯€é»ä»¥ç¸®å°é›†ç¾¤ï¼ˆç­è§£é›†ç¾¤è‡ªå‹•æ“´ç¸®ï¼‰ã€‚\nå¾ç¯€é»ä¸­ç§»é™¤ä¸€å€‹ Podï¼Œä»¥å…è¨±å…¶ä»– Pod ä½¿ç”¨è©²ç¯€é»ã€‚\n\næˆ‘å€‘ä¸€èˆ¬ç›´æ¥ä¸‹æŒ‡ä»¤çœ‹æœ‰å“ªäº›pdbåœ¨ç³»çµ±å…§\nkubectl get pdb -A\n\n(fig.1)\nå»ºç«‹pdbï¼Œä¸»è¦æœ‰å…©å€‹åƒæ•¸ çœ‹æ˜¯è¦è¨­å®š minAvailable (æœ€å°å¯ç”¨)æˆ– maxUnavailable(æœ€å¤§ä¸å¯ç”¨)ã€‚\nå»ºå®Œå¾Œï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ALLOWED DISRUPTIONS é€™å€‹æ¬„ä½ï¼Œ\né€™å€‹æ¬„ä½è¡¨ç¤ºç›®å‰è©²podå¯ä»¥è¢«ä¸­æ–·çš„podæ•¸é‡ã€‚\næ‰€ä»¥å¦‚æœç‚º0çš„è©±ï¼Œæ‚¨çš„è‡ªé¡˜ä¸­æ–·é‚£äº›æ“ä½œï¼Œ\næ˜¯ä¸æœƒå‹•ä½œçš„ï¼Œæœƒä¸€ç›´waitingï¼Œç›´åˆ°é€™å€‹å€¼ä¸ç‚º0ã€‚\nref.\n\nå¹²æ“¾(Disruptions)\nç‚ºæ‡‰ç”¨ç¨‹åºè¨­ç½®å¹²æ“¾é ç®—(Disruption Budget)\nkubernetesä¹‹PDB\nkubernetesä¹‹PDB",
		"tags": [ "note","âˆ"]
},

{
		"title": "k8s error,The node was low on resource..",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/76. k8s error,The node was low on resource../",
		"content": "å‰è¨€\nä¹‹å‰ç™¼ç”Ÿéçš„ï¼Œ\nprometheusæœƒé€™æ¨£ã€gitlabæœ€è¿‘åœ¨å¼„æ–°ç‰ˆçš„CI/CDä¹Ÿè·‘é€™å€‹å‡ºä¾†ã€‚\næœ¬ä¾†æƒ³è¦ä¹‹å¾Œæœ‰ç©ºå†è§£æ±ºï¼Œä½†æœ€è¿‘è¢«DDOSæ”»æ“Šæ™‚ï¼Œ\nç™¼ç¾ç›£æ§çš„grafanaæœƒå¡ä½ï¼Œå› ç‚ºä»–çš„prometheus ramçˆ†äº†~~\næ­£æ–‡\n\nå¾å­—é¢ä¸Šçœ‹ä¾†ï¼Œå…¶å¯¦è »å¥½ç†è§£çš„ï¼Œ\n\nThe node was low on resource: memory. Container web was using 4236080Ki, which exceeds its request of 0.\n\nnodeçš„è³‡æºä¸å¤ äº†ï¼Œcontainer ä½¿ç”¨é‡é”åˆ°ä¸Šé™ã€‚\næœ€ç›´è¦ºçš„æ–¹å¼å°±æ˜¯ï¼Œè³‡æºä¸å¤ ï¼Œé‚£å°±åŠ é–‹è³‡æºé˜¿ã€‚\nä½†é–‹è³‡æºå‰è¦å…ˆæƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘é–‹äº†ï¼Œé‚£æœªä¾†è³‡æºå°±ä¸€å®šå¤ å—ï¼Ÿ\né–‹çš„è³‡æºåˆä¸ä¸€å®šæ˜¯å®Œå…¨çµ¦prometheusç”¨ï¼Œä»–ä¾›æ‡‰çš„æ˜¯å…¨é«”çš„podã€‚\næ‰€ä»¥è¦å…ˆåšçš„æ˜¯ï¼ŒæŠŠ resources request çš„åŠ é€²å» podè£¡é¢ã€‚\n\u001f\ntemplate:\nmetadata:\ncreationTimestamp: null\nlabels:\napp: webhook\nversion: v1\nspec:\ncontainers:\n- image: prom/prometheus:v2.28.0\nimagePullPolicy: Always\nname: prometheus\nports:\n- containerPort: 80\nprotocol: TCP\nresources:\nrequests:\ncpu: 30m\nmemory: 30Mi\nlimits:\nmemory: &quot;128Mi&quot;\ncpu: &quot;500m&quot;\n\né€™é‚Šè¦ç‰¹åˆ¥æ³¨æ„ limitï¼Œç•¶limitè¸©åˆ°ä¸Šé™æ™‚ï¼Œé€™å€‹podå°±æœƒè¢«çµ‚æ­¢\nï¼Œä¸¦å¼•ç™¼è¨˜æ†¶é«”ä¸è¶³(OOM)çš„éŒ¯èª¤ã€‚\næ‰€ä»¥ limit è¦è¨­å—ï¼Ÿï¼Ÿ\né€™é‚Šè¦å¾æ›è¼‰çš„æœå‹™å»æ±ºå®šï¼Œ\nå¦‚æœä»Šå¤©æ›è¼‰çš„æœå‹™ ramçš„ä½¿ç”¨é‡é€šå¸¸ä¸å¤šï¼Œ\né‚£çªç„¶é”åˆ°ä¸Šé™ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥åˆ¤æ–·é€™å€‹æœå‹™æœ‰å•é¡Œäº†ï¼Œå¿…é ˆè¦é‡å•Ÿã€‚\nä½†å¦‚æœæ˜¯ä½¿ç”¨prometheusï¼Œè¨˜æ†¶é«”çš„é‡æœ¬ä¾†å°±æœƒéš¨ç€metricçš„é‡è€Œå¢åŠ ï¼Œ\né‚£å°±ä¸é©åˆåŠ ä¸Šå»äº†ï¼Œä¸ç„¶åªæœƒä¸€ç›´çœ‹åˆ° è¨˜æ†¶é«”ä¸è¶³çš„éŒ¯èª¤ã€‚\nå¾Œé¢çš„å–®ä½ï¼Œå¯è¨­å®š Ki, Mi ,Gi...\nè£œå……ï¼Œ\nç•¶nodeè³‡æºä¸è¶³æ™‚ï¼Œåˆªé™¤podçš„å…ˆå¾Œé †åºç‚ºï¼Œ\n\næ²’æœ‰è¨­å®š request è·Ÿ limitçš„ pod\nåªè¦æœ‰podè¨­å®š request æˆ– limit ï¼Œä½†ä½¿ç”¨çš„è³‡æºæ˜¯æ¯”åœ¨è³‡æºä¸Šè¨­ç½®çš„è«‹æ±‚é‚„å¤šã€‚\nåªè¦æœ‰podè¨­å®š request æˆ– limit ï¼Œä½†ä½¿ç”¨çš„è³‡æºæ˜¯æ¯”åœ¨è³‡æºä¸Šè¨­ç½®çš„è«‹æ±‚é‚„å°‘ã€‚\n\nçµè«–\nå…ˆè¨­å®š request ï¼Œå› nodeæ©Ÿå™¨çš„æ“´å±•ï¼Œæ˜¯æ ¹æ“š requestçš„å€¼ï¼Œ\nä¾†åˆ¤æ–·è¦ä¸è¦å¢åŠ nodeæ•¸é‡ï¼Œå¦‚æœæ²’è¨­å®šrequestï¼Œ\nç³»çµ±æœƒèªçˆ²ï¼Œæ²’æœ‰æ“´å±•çš„å¿…è¦ã€‚å°±æœƒå°è‡´å‰é¢çš„å•é¡Œã€‚\nref.\n\nWhy my pods are evicted on Kubernetes?\nç¯€é»å£“åŠ›é©…é€\nç‚ºå®¹å™¨ç®¡ç†è³‡æº\nHow does scale-up work?",
		"tags": [ "note","âˆ"]
},

{
		"title": "GKEä¸Šæ¶è¨­SolrCloud",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/GKE/37.SolrCloud on GKE/",
		"content": "æ­£æ–‡\nSolrçš„æ¶æ§‹\nref. æ·ºè«‡Solrå¢é›†æ¶æ§‹\nå®Œæ•´æ¶æ§‹\n\nSolrCloudæ˜¯åŸºæ–¼ Solr èˆ‡ <a class=\"internal-link is-unresolved\" href=\"/404\">blog.36.åˆ†ä½ˆå¼ç³»çµ±-Zookeeper</a>æœå°‹æ–¹æ¡ˆã€‚\nç‰¹è‰²åŠŸèƒ½æœ‰\n\né›†ä¸­å¼çš„é…ç½®è³‡è¨Š\nè‡ªå‹•å®¹éŒ¯\nè¿‘å¯¦æ™‚æœå°‹\næŸ¥è©¢æ™‚è‡ªå‹•è² è¼‰å¹³è¡¡\nè‡ªå‹•åˆ†ç™¼\næ—¥èªŒè·Ÿè¹¤\n\nsolrCloudçš„æ¶æ§‹ï¼Œå¯ä»¥çœ‹çœ‹ä»¥ä¸‹å¹¾ç¯‡ã€‚\nref.\n\nExploring the Apache Solr Operator v0.3.0 on GKE\nSolrCloudåˆ†ä½ˆå¼ä¼æ¥­æœç´¢å¼•æ“æ¶æ§‹åŸç†è§£æ\nsolrCloudæ¶æ§‹\nSolrCloudé›†ç¾¤æ¶æ§‹\n\né€™é‚Šç›´æ¥é–‹å§‹å®‰è£å§ã€‚\né¦–å…ˆç¢ºå®šä½ çš„é›»è…¦æœ‰helm ï¼Œæˆ‘è©¦è‘—æ‰¾æœ‰æ²’æœ‰å–®ç´”å¯ä»¥ç”¨ kubectl applyçš„æ–¹å¼å®‰è£ï¼Œä½†æ²’æ‰¾åˆ°ã€‚æ‰€ä»¥ï¼Œç”¨helmå§ã€‚\nref.solr-operator\n\nå…ˆå¢åŠ solrçš„å€‰åº«\n\n\thelm repo add apache-solr https://solr.apache.org/charts\n\n\thelm repo update\t\n\nå®‰è£ solr-operatorï¼ŒæŒ‡å®šå®‰è£åœ¨ solrçš„ namespaceï¼Œé¿å…istioçš„istio-proxyå®‰è£é€²å»\n\n\tkubectl create -f https://solr.apache.org/operator/downloads/crds/v0.3.0/all-with-dependencies.yaml\n\n\thelm install solr-operator apache-solr/solr-operator \\\n--version 0.3.0 --namespace solr\n\noperator å®‰è£å®Œæˆ (fig.1)\n\n(fig.1)\n3. solrCloud.yaml\napiVersion: solr.apache.org/v1beta1\nkind: SolrCloud\nmetadata:\nname: video\nnamespace: solr\nspec:\ncustomSolrKubeOptions:\npodOptions:\nresources:\nlimits:\nmemory: 3Gi\nrequests:\ncpu: 700m\nmemory: 3Gi\ndataStorage:\npersistent:\npvcTemplate:\nspec:\nresources:\nrequests:\nstorage: 2Gi\nreclaimPolicy: Delete\nreplicas: 3\nsolrImage:\nrepository: solr\ntag: 8.8.2\nsolrJavaMem: -Xms500M -Xmx500M\nupdateStrategy:\nmethod: StatefulSet\nzookeeperRef:\nprovided:\nchroot: /explore\nimage:\npullPolicy: IfNotPresent\nrepository: pravega/zookeeper\ntag: 0.2.9\npersistence:\nreclaimPolicy: Delete\nspec:\naccessModes:\n- ReadWriteOnce\nresources:\nrequests:\nstorage: 2Gi\nreplicas: 3\nzookeeperPodPolicy:\nresources:\nlimits:\nmemory: 500Mi\nrequests:\ncpu: 250m\nmemory: 500Mi\n\nä½ˆç½² solrCloud.yamlï¼Œé€™é‚Šçš„ç³»çµ±è³‡æºè¦æ±‚é —é«˜ï¼Œè³‡æºä¸å¤ è«‹å¤šé–‹ä¸€äº›cpu æˆ– memoryã€‚\n\n\tkubectl apply -f solrCloud.yaml\n\nç”±æ–¼æˆ‘æ˜¯ç›´æ¥ä½ˆç½²åœ¨istioä¸Šé¢ï¼Œæ‰€ä»¥é–‹å•Ÿç¶²é çš„è©±ï¼Œæˆ‘æ˜¯ç›´æ¥æ–°å¢ virtualServiceçš„è¨­å®šã€‚\n\nkind: VirtualService\nmetadata:\nname: istio-virtualservice-tools\nnamespace: tools\nspec:\nhosts:\n- &quot;*&quot;\ngateways:\n- istio-gateway-tools.istio-system.svc.cluster.local\nhttp:\n- match:\n- uri:\nexact: /\n- uri:\nprefix: /solr\nname: solr\nroute:\n- destination:\nhost: video-solrcloud-common.solr.svc.cluster.local\nport:\nnumber: 80\n\nä¹Ÿå¯ä»¥ç›´æ¥åœ¨æœ¬æ©Ÿä¸Šä½¿ç”¨port-forwardè½‰ç™¼é–‹å•Ÿç¶²é ã€‚å¦‚ä»¥ä¸‹æŒ‡ä»¤ï¼Œé–‹å•Ÿ ç¶²é  http://localhost:8080 (fig.2)\n\tkubectl port-forward service/video-solrcloud-common -n solr 8080:80\n\nç›£æ§ solrCloud\næœ¬ä¾†çš„solrCloudèˆŠæœ‰ç°¡æ˜“çš„ç›£æ§ç•«é¢äº†ï¼Œ\né€™éƒ¨åˆ†æ˜¯çœ‹è¨˜æ†¶é«”çš„ä½¿ç”¨é‡ã€‚\n\nä½†å¯æœ‰ç™¼ç¾è³‡æ–™ä¸¦ä¸æ˜¯éå¸¸å¾—å¤šã€‚\nä¹‹å‰åœ¨GKEçš„å¢é›†ä¸Šå·²ç¶“æœ‰æ¶è¨­prometheusäº†ï¼Œ\næ‰€ä»¥é€™æ¬¡ä¹Ÿè¦å°‡è³‡æ–™ä¸Ÿé€²å»prometheusè£¡é¢ã€‚\né€™é‚Šè¦å…ˆexport solrçš„metricï¼Œ\nå®˜æ–¹ githubä¸Šé¢æœ‰å»ºè­°çš„æ–¹æ³• ï¼Œä½†éœ€å®‰è£ prometheus operatorã€‚å¦‚æœæ²’æœ‰å®‰è£ï¼Œprometheus åœ¨æ¢ç´¢metricsæ™‚ï¼Œæ˜¯æ‰¾ä¸åˆ°é€™å€‹exporterçš„ã€‚\nref.Deploy Prometheus Exporter for Solr Metricsï¼Œ\napiVersion: solr.apache.org/v1beta1\nkind: SolrPrometheusExporter\nmetadata:\nlabels:\ncontroller-tools.k8s.io: &quot;1.0&quot;\nname: explore-prom-exporter\nnamespace: solr\nspec:\ncustomKubeOptions:\npodOptions:\nresources:\nrequests:\ncpu: 300m\nmemory: 800Mi\nsolrReference:\ncloud:\nname: &quot;video&quot;\nnumThreads: 6\nimage:\nrepository: solr\ntag: 8.8.2\n---\napiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\nname: solr-metrics\nlabels:\nrelease: prometheus-stack\nspec:\nselector:\nmatchLabels:\nsolr-prometheus-exporter: explore-prom-exporter\nnamespaceSelector:\nmatchNames:\n- solr\nendpoints:\n- port: solr-metrics\ninterval: 15s\n\nå› ç‚ºæˆ‘ä¸æƒ³è£ prometheus operatorï¼Œæ‰€ä»¥è¤‡è£½ä¸Šé¢å®‰è£çš„deploy yamlï¼Œè‡ªå·±ç”¢ç”Ÿä¸€å€‹solr exporter çš„deployè·Ÿ serviceçµ¦ prometheusæŠ“è³‡æ–™ã€‚\næˆ–è¨±æœ‰äººæœƒå•ï¼Œç‚ºä»€éº¼ä¸åˆ©ç”¨ä¸Šé¢çš„éƒ¨å±¬å®Œå¾Œå»ä¿®æ”¹service.yamlæŠŠ\nprometheus.io/port: &quot;80&quot;\næ”¹æˆ\nprometheus.io/port: &quot;8080&quot;\nå°±å¥½äº†ã€‚\nå› ç‚ºï¼Œæ”¹äº†å¾Œä»–æœƒä¸€ç›´é‚„åŸæˆèˆŠçš„ç‹€æ…‹ã€‚\né€™æ‡‰è©²æ˜¯ solrOperatorçš„é—œä¿‚ï¼Œæœƒä¸€ç›´è¦†è“‹æ‰‹å‹•ä¿®æ”¹çš„è¨­å®šï¼Œå› ç‚ºæˆ‘ä¹Ÿæ‰¾ä¸åˆ°å»ä¿®æ”¹å¢åŠ solrOperatorçš„è¨­å®šï¼Œè®“80æ”¹æˆ8080ï¼Œæ‰€ä»¥æ‡‰è©²é€éä¸Šé¢çš„ ServiceMonitor ä¾†è®“prometheuså¯ä»¥å–å¾—è³‡æ–™ã€‚\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nnamespace: solr\nname: explore-prom-exporter\nannotations:\ndeployment.kubernetes.io/revision: &quot;1&quot;\n# generation: 1\nlabels:\ncontroller-tools.k8s.io: &quot;1.0&quot;\nsolr-prometheus-exporter: explore-prom-exporter\ntechnology: solr-prometheus-exporter\nspec:\nprogressDeadlineSeconds: 600\nreplicas: 1\nrevisionHistoryLimit: 10\nselector:\nmatchLabels:\nsolr-prometheus-exporter: explore-prom-exporter\ntechnology: solr-prometheus-exporter\nstrategy:\nrollingUpdate:\nmaxSurge: 25%\nmaxUnavailable: 25%\ntype: RollingUpdate\ntemplate:\nmetadata:\ncreationTimestamp: null\nlabels:\ncontroller-tools.k8s.io: &quot;1.0&quot;\nsolr-prometheus-exporter: explore-prom-exporter\ntechnology: solr-prometheus-exporter\nspec:\ncontainers:\n- args:\n- -p\n- &quot;8080&quot;\n- -n\n- &quot;6&quot;\n- -z\n- video-solrcloud-zookeeper-0.video-solrcloud-zookeeper-headless.solr.svc.cluster.local:2181,video-solrcloud-zookeeper-1.video-solrcloud-zookeeper-headless.solr.svc.cluster.local:2181,video-solrcloud-zookeeper-2.video-solrcloud-zookeeper-headless.solr.svc.cluster.local:2181/explore\n- -f\n- /opt/solr/contrib/prometheus-exporter/conf/solr-exporter-config.xml\ncommand:\n- /opt/solr/contrib/prometheus-exporter/bin/solr-exporter\nimage: solr:8.8.2\nimagePullPolicy: IfNotPresent\nlivenessProbe:\nfailureThreshold: 3\nhttpGet:\npath: /metrics\nport: 8080\nscheme: HTTP\ninitialDelaySeconds: 20\nperiodSeconds: 10\nsuccessThreshold: 1\ntimeoutSeconds: 1\nname: solr-prometheus-exporter\nports:\n- containerPort: 8080\nname: solr-metrics\nprotocol: TCP\nresources:\nrequests:\ncpu: 300m\nmemory: 800Mi\nterminationMessagePath: /dev/termination-log\nterminationMessagePolicy: File\ndnsPolicy: ClusterFirst\nrestartPolicy: Always\nschedulerName: default-scheduler\nsecurityContext:\nfsGroup: 8080\nterminationGracePeriodSeconds: 10\n\n---\n\napiVersion: v1\nkind: Service\nmetadata:\nnamespace: solr\nname: explore-prom-exporter\nannotations:\nprometheus.io/path: /metrics\nprometheus.io/port: &quot;8080&quot;\nprometheus.io/scheme: http\nprometheus.io/scrape: &quot;true&quot;\ncreationTimestamp: &quot;2021-09-03T05:52:23Z&quot;\nlabels:\ncontroller-tools.k8s.io: &quot;1.0&quot;\nservice-type: metrics\nsolr-prometheus-exporter: explore-prom-exporter\nspec:\nports:\n- name: solr-metrics\nport: 80\nprotocol: TCP\ntargetPort: 8080\nselector:\nsolr-prometheus-exporter: explore-prom-exporter\ntechnology: solr-prometheus-exporter\nsessionAffinity: None\ntype: ClusterIP\n\næœ€å¾Œåˆ°prometheusçœ‹ä¸€ä¸‹æœ‰æ²’æœ‰é—œæ–¼solrçš„è³‡æ–™(fig.4)\n\n(fig.4)\næœ‰è³‡æ–™äº†ï¼Œä½†æˆ‘å€‘ä¸çŸ¥é“è¦æ‹¿å“ªäº›metricsä¾†ä½œçˆ²ç›£æ§çš„è³‡æ–™ï¼Œå°±å…ˆå»grafana dashboardæ‰¾æ‰¾å§ã€‚\nSolr Dashboard\nä¸‹è¼‰ï¼ŒåŒ¯å…¥grafanaæ”¶å·¥ã€‚\nref. Solr Prometheus Exporter\nçµå°¾\nå†ä¾†å°±æ˜¯ï¼Œå¯¦éš›æ“ä½œ <a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/GKE/39.solrCloudçš„åˆé«”é©—/\">39.solrCloudçš„åˆé«”é©—</a>äº†\né¡å¤–åƒè€ƒï¼Œé›–ç„¶æ­¤é€£çµå·²ç¶“ä¸é©ç”¨ï¼Œä½†åŸºæœ¬çš„å®‰è£æ–¹å¼æ˜¯å¯ä»¥åƒè€ƒã€‚\nRunning Solr on Kubernetes",
		"tags": [ "note","âˆ"]
},

{
		"title": "solrCloudçš„åˆé«”é©—",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/GKE/39.solrCloudçš„åˆé«”é©—/",
		"content": "æ­£æ–‡\nå‚»ç“œæ“ä½œï¼Œéƒ½æ˜¯åœ¨UIä¸Šé¢åŸ·è¡Œã€‚\nä½†solréƒ½æ˜¯ä½¿ç”¨apiçš„æ–¹å¼åšå‹•ä½œã€‚\næ‰€ä»¥ä¸‹é¢çš„æ“ä½œæ”¹æˆapiæ˜¯ä¹Ÿå¯è¡Œçš„ã€‚\nåŸºæœ¬ç¯‡\n\næ–°å¢è³‡æ–™\n\næŸ¥è©¢è³‡æ–™\n\nåŸºæœ¬çš„æŸ¥è©¢æ–¹å¼ï¼Œ\nå¦‚æœè¦æŸ¥ç­†æ•¸çš„è©±ï¼Œå°‡rows æ”¹æˆ 0 ï¼Œå°±æœƒåˆ—å‡ºæ‰€æœ‰ç­†æ•¸ã€‚\nä½†ä¸æœƒé¡¯ç¤ºä»»ä½•è³‡æ–™ã€‚\nåˆªé™¤æ‰€æœ‰è³‡æ–™\nå¦‚æœè¦åˆªé™¤å–®ç­†ï¼Œåªè¦ä¿®æ”¹æ¢ä»¶å³å¯\nå°‡ : æ”¹æˆè¦æœå°‹çš„æ¢ä»¶ï¼Œ\n(e.g. videoId: 28748)\n\n\t&lt;delete&gt;&lt;query&gt;*:*&lt;/query&gt;&lt;/delete&gt;\n\t&lt;commit/&gt;\n\nref.\nsolråˆªé™¤è³‡æ–™çš„å››ç¨®æ–¹æ³•\nSolrå®˜æ–¹æ–‡æª”\né€²éšç¯‡\n\næŸ¥è©¢æŒ‡ä»¤\n\nref.\nSolr æŸ¥è©¢åƒæ•¸\nsolræœå°‹è©³è§£\nSolræŸ¥è©¢ç•Œé¢\n\næŸ¥çœ‹collectionçš„æ¶æ§‹\n\n\thttp http://&lt;host&gt;:&lt;port&gt;/solr/&lt;collectionName&gt;/schema/fields\n\nref. Schema API\n\næœå°‹ä¸­æ–‡å­—ï¼Œæ¬„ä½çµæ§‹ text_general vs string\n\nä¸€èˆ¬æˆ‘å€‘æœå°‹ä¸­æ–‡è¦é¡å¤–å®‰è£ä¸­æ–‡åˆ†è©ï¼Œé€™æ¨£æœå°‹é—œéµå­—çš„æ™‚å€™ï¼Œæ‰æœƒæ­£ç¢ºã€‚\næ²’è£çš„è©±ï¼Œæœƒæœ‰ä¸‹é¢çš„æƒ…æ³ã€‚\nä¾‹å¦‚ï¼Œæœå°‹ ã€ä¸­æ–‡ã€ ï¼Œä½†é€™æ¨£æœƒå°‡æ¬„ä½è£¡é¢é™¤äº†æœ‰ã€ä¸­æ–‡ã€çš„è³‡æ–™æ’ˆå‡ºä¾†ä»¥å¤–ï¼Œé‚„æœƒå°‡è³‡æ–™ä¸­æœ‰ã€ä¸­ã€çš„å­—å–å‡ºã€‚\nä½†å¾Œä¾†åŒäº‹æœ‰ç™¼ç¾å¦ä¸€ç¨®è§£æ³•ï¼Œå»ºç«‹çµæ§‹çš„æ™‚å€™ï¼Œä¸èƒ½é¸æ“‡ text_generalï¼Œå¿…é ˆè¦é¸ stringã€‚\nå¦‚æœä½¿ç”¨stringçš„è©±ï¼Œè¦æ³¨æ„çš„æ˜¯åªæ¥å—å®Œæ•´çš„æ–‡å­—æœå°‹ã€‚ä¹Ÿå°±æ˜¯ä¸€ä¸²æ–‡å­—ä¸­ï¼Œæœå°‹çš„é—œéµå­—è¦å®Œå…¨ç¬¦åˆæ‰æœƒé¡¯ç¤ºã€‚\nè€Œtext_generalï¼Œå¯æ¥å—éƒ¨åˆ†çš„æ–‡å­—æœå°‹ï¼Œä½†ç¼ºé»å°±æ˜¯æœå°‹ä¸­æ–‡æ™‚ï¼Œæœƒæœ‰ä¸Šé¢çš„ç‹€æ³ã€‚\nçµæ§‹ä½¿ç”¨stringçš„è©±ï¼Œå¦‚æœæ”¹ä½¿ç”¨\n\t*ä¸­æ–‡*\n\né€™ç¨®æœå°‹æ–¹å¼ï¼Œå°±åªæœƒæœå°‹è³‡æ–™ä¸­æœ‰ã€ä¸­æ–‡ã€é—œéµå­—çš„è³‡æ–™ï¼Œå­—ä¸²ä¸æœƒè¢«æ‹†é–‹æŸ¥è©¢ã€‚\næœ¬ä¾†æ˜¯è¦ä½¿ç”¨ä¸­æ–‡åˆ†è©ï¼Œä½†å¾Œä¾†ä¹Ÿä¸ç”¨äº†ã€‚\n\nsolrçš„å¤–æ›å¥—ä»¶\n\næœ¬ä¾†å®˜æ–¹æ˜¯æä¾›blob store APIå®‰è£å¥—ä»¶ï¼Œ\nä½†åœ¨ solrCloud 8.4 ï¼Œæœ‰å¤šå‡ºäº†ä¸€å€‹åŠŸèƒ½ package managr\nå¯ä½¿ç”¨ç°¡å–®ä¸”å¿«é€Ÿçš„æ–¹å¼å®‰è£pluginã€‚\nä½†å› ç‚ºä¸Šé¢çš„ç¬¬ä¸‰é»ï¼Œæ‰€ä»¥ä¹Ÿä¸ç”¨ç ”ç©¶é€™å¡Šäº†ã€‚\nç•™ä¸‹ä¸€äº›åƒè€ƒç¶²å€ï¼Œç•™ç€ä»¥å¾ŒæŸ¥è©¢ã€‚\nåˆæ­¥çœ‹éƒ½æ˜¯åœ¨solr å•Ÿå‹•æ™‚è¦åŠ ä¸€å€‹æŒ‡ä»¤\n-Denable.packages=true\n\né€™å€‹æ‡‰è©²æ˜¯åœ¨yamlä½ˆç½²çš„æ™‚å€™ï¼Œå°±è¦åŠ ä¸Šå»äº†ã€‚\nyamlä½ˆç½²æ™‚ï¼Œç‚ºå®¹å™¨è¨­ç½®å•Ÿå‹•æ™‚è¦åŸ·è¡Œçš„å‘½ä»¤å’Œåƒæ•¸\nä¹Ÿæœ‰åœ¨çŒœæ¸¬ï¼Œæœªä¾†æ‡‰è©²æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨ solr operatorå®‰è£çš„æ™‚å€™ä¸€ä¸¦è¨­å®šï¼Œä½†ç›®å‰åƒæ•¸æ²’æœ‰çœ‹åˆ°ï¼Œçœ‹æœªä¾†æœƒä¸æœƒæ–°å¢ã€‚Solr Operator\nref.\n\nPackage Management\nSolr 8.4.0 â€“ Plugin Management\nWorking with Solr Plugins System\nåœ¨SolrCloudæ¨¡å¼ä¸‹æ·»åŠ è‡ªå®šç¾©æ’ä»¶",
		"tags": [ "note","âˆ"]
},

{
		"title": "GKEä½¿ç”¨GPU",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/GKE/4. GKEä½¿ç”¨GPU/",
		"content": "å‰è¨€\næ¥äº†ä¸€å€‹å·¥ä½œï¼Œè¦å¹«äººåœ¨GKEä¸Šé¢ç”Ÿä¸€å€‹èƒ½å¤ ä½¿ç”¨GPUçš„å¢é›†ï¼Œä¸¦ä¸”ä½ˆç½²ã€‚\næ­£æ–‡\nè¦ä½¿ç”¨Googleä¸Šé¢çš„ GPUï¼ŒGKEç‰ˆæœ¬è¦åˆ°1.9ä»¥ä¸Šï¼Œ\nç¯€é»æ± è¦åˆ°1.11.3ä»¥ä¸Šã€‚\nå¦å¤–ï¼ŒGPUåªæ”¯æ´é€šç”¨N1çš„æ©Ÿå™¨æ”¯æ´ï¼Œå…¶ä»–ç´°é … è«‹è©³é–± Google é‹è¡Œ GPU\nå¯ç”¨æ€§å»ºè­°å…ˆç”¨\ngcloud compute accelerator-types list\nçœ‹ä¸€ä¸‹ä½ çš„å€åŸŸæ”¯æ´å“ªäº›é¡¯å¡ï¼Œ\nåƒæˆ‘é€™é‚Šçš„æ˜¯ asia-east1-a ï¼Œå°±åªæ”¯æ´ç‰¹å®šé¡¯å¡ã€‚\n\nåˆ° å®‰è£ NVIDIA GPU è¨­å‚™é©…å‹•ç¨‹åºï¼Œé€™é‚ŠåŸºæœ¬ä¸Šéƒ½æ²’å•é¡Œã€‚\nkubectl apply -f https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/master/nvidia-driver-installer/cos/daemonset-preloaded.yaml\né€™ä¸»è¦æœƒè£åœ¨æ¯å€‹ç¯€é»ä¸Šçš„Daemonsetï¼Œç•¶podèµ·ä¾†å¾Œï¼Œæœƒè‡ªå‹•åœ¨podä¸Šé¢å®‰è£é©…å‹•ç¨‹å¼ã€‚\næ‰€ä»¥å¿…é ˆæª¢æŸ¥ä¸€ä¸‹ï¼Œçœ‹podæ˜¯å¦æœ‰èµ·ä¾†ã€‚\n\nä¹Ÿå¯ä»¥åŸ·è¡Œ\nkubectl describe node -l cloud.google.com/gke-accelerator | grep nvidia.com/gpu\nçœ‹é¡¯å¡çš„ä½¿ç”¨æƒ…æ³\nç•¶åŸ·è¡Œä¸‹ä¸€æ­¥é©Ÿé…ç½® Pod ä»¥ä½¿ç”¨ GPUæ™‚ï¼Œé€™é‚Šå°±æœƒæœ‰å•é¡Œäº†ã€‚\nä»–çš„image(nvidia/cuda:10.0-runtime-ubuntu18.04)æœƒç„¡æ³•å•Ÿå‹•ï¼Œä¸€ç›´åœ¨crashLoopbackoffã€‚\næ›´æ–°\nåœ¨12/24æœ‰é–‹å·¥å–®è©¢å•ï¼Œä»–å€‘é‚£é‚Šçµ¦å‡ºäº†è§£æ³•ã€‚å¾ŒçºŒæ‡‰è©²æœƒæ”¹ä»–å€‘çš„æ–‡ä»¶ã€‚\n\ngoogleçš„å›è¦†å¦‚ä¸‹\næŒ‰ç…§æ–‡æª”ç°¡å–®ä½¿ç”¨â€œcommand: [&quot;/bin/bash&quot;]â€æ¸¬è©¦ã€‚æ­¤æ™‚bashåŸ·è¡Œå¾Œç«‹åˆ»é€€å‡ºï¼Œæ•…podè¢«é‡å•Ÿã€‚\nä½ å€‘å¯ä»¥å˜—è©¦ä½¿ç”¨ä»¥ä¸‹æ­»å¾ªç’°é¿å…é€™å€‹å•é¡Œï¼š\ncommand: [ &quot;/bin/sh&quot;, &quot;-c&quot;, &quot;--&quot; ]\nargs: [ &quot;while true; do sleep 600; done;&quot; ]\n\næ‰€ä»¥ï¼Œå¯ä»¥æ”¹æˆä¸‹é¢çš„YAMLï¼Œå°±èƒ½æ­£å¸¸åŸ·è¡Œäº†ã€‚\napiVersion: v1\nkind: Pod\nmetadata:\nname: gpu-pod\nspec:\ncontainers:\n\nname: digits-container\nimage: nvidia/cuda:10.0-runtime-ubuntu18.04\ncommand: [ &quot;/bin/sh&quot;, &quot;-c&quot;, &quot;--&quot; ]\nargs: [ &quot;while true; do sleep 600; done;&quot; ]\nresources:\nlimits:\nnvidia.com/gpu: 1\n\nä»¥ä¸‹ä¹Ÿå¯ä»¥ä½¿ç”¨\næœ€å¾Œçš„è§£æ³•æ˜¯ï¼Œä¸è¦ç”¨ä»–çš„imageã€‚\nå®Œæ•´ YAML\napiVersion: v1\nkind: Pod\nmetadata:\nname: gpu-pod\nspec:\ncontainers:\n- name: digits-container\nimage: nvidia/digits:6.0\nresources:\nlimits:\nnvidia.com/gpu: 1\nä½ˆç½²å®Œå¾Œï¼ŒåŸ·è¡Œ\nkubectl exec gpu-pod -- nvidia-smi\né€™æ®µè©±çš„æ„æ€æ˜¯ï¼Œåœ¨gpu-podè£¡é¢åŸ·è¡Œ nvidia-smiçš„æŒ‡ä»¤\næ­£å¸¸çš„è©±ï¼Œæœƒé¡¯ç¤ºå¦‚ä¸‹\n\nä¸‹é¢åƒè€ƒçš„æ–‡ä»¶ï¼Œå¯ä»¥çœ‹çœ‹ï¼Œä½†ç›®å‰åªéœ€è¦åšåˆ°ä¸Šé¢é‚£æ®µã€å®‰è£ NVIDIA GPU è¨­å‚™é©…å‹•ç¨‹åºã€çš„æŒ‡ä»¤å³å¯\nref.\nCrashLoopBackOff message wen running GPU Jobs example and others\nGPU Sharing on GKE DaemonSet\nInstall GPU in GKE(Google Kubernetes Engine)ï¼ˆä¸­ï¼‰\næŸ¥è©¢å„æœ‰å“ªäº›VMä½¿ç”¨GPUçš„æŒ‡ä»¤\ngcloud compute instances list --format=&quot;table(guestAccelerators.acceleratorCount, name)&quot;",
		"tags": [ "note","âˆ"]
},

{
		"title": "GKEç¯€é»ç„¡æ³•è‡ªå‹•ç¸®å°ï¼ŒæŸ¥éŒ¯ä¹‹æ—…",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/GKE/41.GKEç¯€é»ç„¡æ³•è‡ªå‹•ç¸®å°/",
		"content": "å‰è¨€\næœç„¶æ±è¥¿ç©©å®šä¹‹å¾Œï¼Œä¸Šé¢çš„éƒ½æœƒæƒ³è¦costDownï¼Œ\nä¸éé€™ä¹Ÿç®—æ˜¯ç•¶åˆå»ºç«‹çš„äººæ²’è¨­å®šå¥½ï¼Œ\næœƒç™¼ç”Ÿé€™å€‹æƒ…æ³ï¼Œå¾ŒçºŒä¹ŸæŸ¥æ˜äº†ï¼Œç•¶åˆåœ¨æ¯å€‹ç¯€é»ä¸Šåªå…è¨±æ”¾64å€‹podï¼Œ\næ‰€ä»¥å°±ç®—æ”¾æ»¿ï¼Œä¹Ÿåƒä¸åˆ°é‚£éº¼å¤šã€‚\nä½†æ²’æœ‰è‡ªå‹•ç¸®å°ï¼Œé€™å…¶å¯¦ä¹Ÿæ˜¯å€‹å•é¡Œï¼Œä½†è¦è‡ªå‹•ç¸®å°ï¼Œ\né‚„è¦çœ‹é€™å€‹æœå‹™æ˜¯å¦åˆé©...ã€‚\nåæ­£æˆ‘ä¹‹å¾Œåè€Œæ²’åœ¨ç³¾çµé€™å€‹ç‹€æ³äº†ã€‚\næ­£æ–‡\næœ€è¿‘ç™¼ç¾ä¸€å€‹æ±è¥¿ï¼Œåœ¨GKEä¸Šé¢çš„ç¯€é»ï¼Œcpuåˆ†é…å¾ˆå¥‡æ€ªã€‚\n\n(fig.1)\næ¯å€‹nodeçš„ç¯€é»éƒ½åªä½”äº†ä¸€åŠçš„CPUå°±å»é–‹æ–°çš„ç¯€é»äº†ã€‚\næœ¬ä¾†æ‡·ç–‘æ˜¯è‡ªå‹•æ“´å±•æœ‰å•é¡Œï¼Œ\nå¾Œä¾†ç™¼ç¾æ‡‰è©²æ˜¯è‡ªå‹•ç¸®å°æœ‰å•é¡Œã€‚\né€™å€‹ç‹€æ³åœ¨æ–°å»ºä¸€å€‹å¢é›†ï¼Œç„¶å¾Œè¨­å®šç¯€é»è‡ªå‹•ä¼¸ç¸®å°±æœƒç™¼ç”Ÿäº†ã€‚\nä¸€èˆ¬ä¾†èªªï¼Œç¯€é»åªè¦æ²’æœ‰podåœ¨è£¡é¢ï¼Œå¤§ç´„åªè¦ååˆ†é˜å°±æœƒæŠŠå¤šé¤˜çš„ç¯€é»ç§»é™¤äº†ã€‚\nref. é›†ç¾¤è‡ªå‹•æ“´ç¸®ç¨‹åºçš„å·¥ä½œåŸç†\nä½†æ–°å»ºäº†ä¸€å€‹ç¯€é»æ± ï¼Œè£¡é¢éƒ½ç©ºçš„ã€‚ä»–ä¸¦æ²’æœ‰ç¸®å°åˆ°æœ€å°ç¯€é»ã€‚\nè©¢å•å¾Œå¾—çŸ¥ï¼Œé ˆå…ˆçœ‹ä¸€ä¸‹logæ‰èƒ½çŸ¥é“ç‚ºä»€éº¼æ²’æœ‰è‡ªå‹•ç¸®å°ã€‚\né¦–å…ˆé–‹å•Ÿ GCPçš„æ—¥èªŒæŸ¥çœ‹å™¨ï¼Œ\na. è³‡æºé¸æ“‡ Kubernetes Cluster\nb. æ—¥èªŒé¡å‹åˆ—è¡¨é¸æ“‡\ncontainer.googleapis.com/cluster-autoscaler-visibility\n\nc. å†é¸æ“‡è¦æŸ¥çœ‹çš„cluster name\n\n(fig.2)\nd. å±•é–‹ noDecisionStatus\n\n(fig.3)\nçœ‹åˆ°éŒ¯èª¤äº†ï¼Œå°±æ˜¯é€™å€‹å®³å¾—podç„¡æ³•è‡ªå‹•ç¸®æ¸›ã€‚\né€™é‚Šçš„éŒ¯èª¤è¨Šæ¯æ˜¯\nnode.pod.has.local.storageï¼Œ\næ–°å»ºç¯€é»ç„¡æ³•ç¸®æ¸›æœƒå‡ºç¾çš„éŒ¯èª¤è¨Šæ¯é€šå¸¸æ˜¯\nnode.kube.system.unmovable\n\n(fig.4)\nç¢°åˆ° node.pod.has.local.storageçš„è§£æ³•æ˜¯åœ¨deployçš„yamlä¸Šé¢åŠ ä¸Šè¨»é‡‹ï¼Œä½ç½®ä½æ–¼ metadataåº•ä¸‹\nannotations:\n\tcluster-autoscaler.kubernetes.io/safe-to-evict: &quot;true&quot;\n\n(fig.5)\nref.\n\né›†ç¾¤æœªç¸±å‘ç¸®å®¹\nHow to make sure Kubernetes autoscaler not deleting the nodes which runs specific pod\n\nè‡³æ–¼ç¢°åˆ° node.kube.system.unmovable çš„è§£æ³•ï¼Œ\néœ€å»ºç«‹ PDB ï¼Œè®“åœ¨ namespace çš„ kube-systemå¯ä»¥è¢«é©…é€ã€‚PDBæ˜¯ä»€éº¼å¯åƒè€ƒ <a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/42.k8s PDBï¼ˆpodä¸­æ–·é ç®—ï¼‰/\">42.k8s PDBï¼ˆpodä¸­æ–·é ç®—ï¼‰</a>ã€‚\nkubectl create poddisruptionbudget &lt;pdb name&gt; --namespace=kube-system --selector app=&lt;app name&gt; --max-unavailable 1\n\nè¦æ³¨æ„ï¼Œselectorçš„labelä¸ä¸€å®šæ˜¯appé–‹é ­ï¼Œ\nè¦çœ‹å„deployè£¡é¢çš„è¨­å®šã€‚\næœ€è¿‘ç¢°åˆ°åœ¨GKEçš„kube-systemè£¡é¢pod labelï¼Œ\nåè€Œæ˜¯å« k8s-app:kube-dnsï¼Œselectorå¯ä»¥éš¨æ„é¸æ“‡ï¼Œåªè¦æœ‰è¾¦æ³•å°åˆ°deployå³å¯\n\n(fig.6)\nHow to set PDBs to enable CA to move kube-system pods?\nä½†å¾Œä¾†æœ‰ç™¼ç¾ä¸€å€‹å•é¡Œï¼Œç•¶è§£äº†ä¸€å€‹ node.kube.system.unmovable ï¼Œå¾ŒçºŒå¯èƒ½æœƒå‡ºç¾ node.pod.has.local.storageçš„å•é¡Œï¼Œ\né€™æ¨£æœƒè®Šæˆå¿…é ˆé‡å°æ¯å€‹deployéƒ½é¡å¤–åšè¨­å®šã€‚\næ‰€ä»¥æœ€å¾Œæˆ‘é¸æ“‡äº†ï¼Œç›´æ¥æ‰‹å‹•é©…é€ç¯€é»å…§çš„podï¼Œ\nä½†pdbçš„è¨­å®šè¦å…ˆçœ‹ä¸€ä¸‹ï¼Œ\nistioåœ¨å®‰è£æ™‚ï¼ŒingressgatewayæœƒåŒæ™‚è¨­å®špdbï¼Œ\nç•¶podåªæœ‰1å€‹çš„æ™‚å€™ï¼Œæ˜¯æ²’è¾¦æ³•é©…é€çš„ï¼Œ\næ‰€ä»¥æœ€å¥½æ˜¯é è¨­ingressgateway ç‚º 2å€‹podï¼Œé€™æ¨£æ‰èƒ½é¿å…pdbçš„å¹²æ“¾ï¼Œè€Œå°è‡´ç„¡æ³•é©…é€ã€‚\nkubectl drain [node-name] --force --ignore-daemonsets --delete-local-data\n\ndrainçš„åƒæ•¸\n--force\nç•¶ä¸€äº›podä¸æ˜¯ç¶“ ReplicationController, ReplicaSet, Job, DaemonSet æˆ–è€… StatefulSet ç®¡ç†æ™‚\nå°±éœ€è¦ç”¨--forceä¾†å¼·åˆ¶åŸ·è¡Œ (ä¾‹å¦‚:kube-proxy)\n--ignore-daemonsets\nç„¡è¦–DaemonSetç®¡ç†ä¸‹çš„Pod\n--delete-local-data\nå¦‚æœæœ‰mount local volumnçš„podï¼Œæœƒå¼·åˆ¶æ®ºæ‰è©²podä¸¦æŠŠè³‡æ–™æ¸…é™¤æ‰\nå¦å¤–å¦‚æœè·Ÿæœ¬èº«çš„é…ç½®è¨Šæ¯æœ‰è¡çªæ™‚ï¼Œdrainå°±ä¸æœƒåŸ·è¡Œ\nref.\n\nKubernetesä¸­æ¸…ç©ºä¸€å€‹nodeçš„æ‰€æœ‰pod\næ–‡ä»¶-é·ç§»å·¥ä½œè² è¼‰",
		"tags": [ "note","âˆ"]
},

{
		"title": "srs å½±éŸ³ä¸²æµ on GKE",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/GKE/44.srs å½±éŸ³ä¸²æµ on GKE/",
		"content": "å‰è¨€\né¦–å…ˆä»‹ç´¹ä¸€ä¸‹srsï¼Œé€™å€‹å°±æ˜¯ä¸€å€‹å½±éŸ³ä¸²æµï¼Œ\næœ¬ä¾†æ˜¯ä¹–ä¹–å†ç”¨EFK on GKEï¼Œç„¶å¾Œèªªç¶²è·¯æœ‰å•é¡Œï¼Œ\nå°±åˆè¢«æŠ“å»å”åŠ©äº†ï¼Œæƒ³è£æ­»é‚„ä¸è¡Œ T_T ï¼Œ\næˆ‘çš„æ±è¥¿é‚„ä¸å¤ å¤šå— (â•¯â€µâ–¡â€²)â•¯ï¸µâ”´â”€â”´\næ­£æ–‡\né€™æ¬¡ä¸»è¦æ˜¯å”åŠ©é™¤éŒ¯ï¼Œ\næ‰€ä»¥ä¸‹é¢å°±ç›´æ¥åˆ—å‡ºç¢°åˆ°çš„å•é¡Œé»ã€‚\nç”±æ–¼æˆ‘æ²’ç©éç›´æ’¥ï¼Œæœ‰äº›æ¦‚å¿µæ˜¯å¾Œä¾†æ‰çŸ¥é“çš„ã€‚\nä¹Ÿæœƒé †ä¾¿åˆ—åœ¨ä¸‹é¢ã€‚\n\nwebrtcæ¨æµæ™‚ï¼Œå‡ºç¾ getUserMedia error\n\néœ€è¦åˆ°chromeä¸Šé¢ä¿®æ”¹è¨­å®šã€‚\n\nref.è§£æ±º â€˜GETUSERMEDIAâ€™ OF UNDEFINED å•é¡Œ\n\nrtmp æ¨æ‹‰\n\nèµ°TCPçš„å”å®š\nä½¿ç”¨rtmpæ’­æ”¾çš„è©±ï¼Œæ‰€æœ‰çš„é€£ç·šéƒ½æœƒåœ¨ä¼ºæœå™¨ä¸Šé¢ç•™ä¸€ä»½ã€‚\n\nwebrtcæ’­æ”¾\n\néœ€è¦åˆ°srs 4.0.14ä»¥å¾Œçš„ç‰ˆæœ¬\næœ‰TCPè·Ÿ UDPçš„å”å®šï¼Œ\nä¼ºæœå™¨åªè² è²¬å° ç›´æ’¥è€…è·Ÿè§€çœ‹è€…åšé©—è­‰ï¼Œ\nwebrtcï¼Œæ˜¯ç›´æ’¥è€…è·Ÿè§€çœ‹è€…ç›´æ¥é€£ç·šï¼Œä¹Ÿå°±æ˜¯é»å°é»çš„é€£æ¥æ–¹å¼ã€‚\nref. ä½•è¬‚WebRTC\n\nwebrtcè§€çœ‹æ–¹å¼\n\nä¹Ÿæ˜¯é€™ä¸€éƒ¨åˆ†çš„ç¶²è·¯æ¶æ§‹ï¼Œå°è‡´æˆ‘ä¸å¾—ä¸è·³ä¸‹å»å”åŠ©è™•ç†ã€‚\nå› ç‚ºGKEçš„service è² è¼‰å¹³è¡¡ç›®å‰é‚„ä¸æ”¯æ´æ··åˆçš„ç¶²è·¯æ¶æ§‹ï¼Œ\nä¹Ÿå°±æ˜¯TCPè·Ÿ UDP æ··åˆä½¿ç”¨ã€‚åªèƒ½ä½¿ç”¨å–®ä¸€å€‹å”å®šã€‚\næ‰€ä»¥æ²’è¾¦æ³•åƒå‚³çµ±æ©Ÿå™¨ä¸€æ¨£ï¼Œç›´æ¥ä¸€å€‹ipï¼ŒåŒæ™‚é–‹å•ŸTCPè·ŸUDPçš„ç¶²è·¯å”å®šã€‚\næ‰€ä»¥æœƒè®Šæˆ TCP ä¸€å€‹IPï¼ŒUDPåˆæ˜¯ä¸€å€‹IP(fig.1)ï¼Œ\n\næ­¤æ™‚åœ¨SRSä¸Šé¢çš„ Candidate ï¼Œå¿…é ˆè¦è¨­å®š *\nç„¶å¾Œå†æ¨æµçš„æ™‚å€™ï¼Œæ¨æµç¶²å€è¦æ›´æ”¹æˆ\nwebrtc://35.2.3.1/live/ray123?eip=35.3.3.50\n\n35.2.3.1 æ˜¯ åªé–‹TCPçš„å¤–ç¶²ä½ç½®ã€‚\n35.3.3.50 æ˜¯ åªé–‹UDPçš„å¤–ç¶²ä½ç½®ã€‚\nref.\nv4_CN_WebRTC\n[SRS+docker]å¯¦ç¾ç›´æ’­æœå‹™å™¨ 3 åŸºæ–¼webRTCå”è­°çš„srsä½å»¶é²ç›´æ’­ç ”ç©¶_wltsystermçš„åšå®¢-ç¨‹åºå“¡ç§˜å¯†\n\nå…¶ä»–åƒè€ƒæ–‡ä»¶\n\nç•¶ç„¶æœ€å¥½çš„æ–¹å¼ï¼Œæ˜¯æŠŠè£¡é¢çš„æ–‡ä»¶å¤§ç´„æƒéä¸€ä¸‹ã€‚\nä½†é€™è³‡æ–™æœ‰é»å¤šï¼Œæˆ‘ä¹ŸåªæŒ‘äº†å¹¾å€‹é‡é»çœ‹ã€‚\nref.\n\nv4_CN_K8S\nç•¶SRSé‡åˆ°K8sï¼šå¦‚ä½•å¯¦ç¾é«˜å¯ç”¨ã€å›æ»¾èˆ‡ç°åº¦ç™¼å¸ƒï¼Ÿ\nä½¿ç”¨ Linux nc æ¸¬è©¦UDPæœ‰æ²’æœ‰é€š\nSRSå…¨æ–‡ä»¶\nSRS full.conf",
		"tags": [ "note","âˆ"]
},

{
		"title": "GKE workload Identity å¯¦åœ°æ¼”ç·´",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/GKE/50.GKE workload Identity å¯¦åœ°æ¼”ç·´/",
		"content": "å‰è¨€\næŸä½å¤§ç¥èªªï¼ŒGKEä½¿ç”¨ IAMçš„è§’è‰²èªè­‰å®‰å…¨æ€§ä¸å¤ªå¤ ï¼Œ\næ‰€ä»¥å¸Œæœ›æœªä¾†éƒ½æ”¹ç”¨é€™ç¨®ï¼Œworkload Ideneityï¼Œ\nå°±é–‹å§‹äº†æ¡å‘ä¹‹æ—…ï¼Œæ˜¯èªªé€™å€‹å‘æ²’æƒ³åƒä¸­çš„æ·±ã€‚\næ­£æ–‡\næŸ¥è©¢clusteræ˜¯å¦æœ‰ workload Identity\ngcloud container clusters describe yaboxxx-test -z asia-east1-b\n\nå»ºè­°æœ€å¥½ç›´æ¥åŠ ä¸Šåœ°å€ï¼Œä¸ç„¶çœ‹éŒ¯èª¤è¨Šæ¯ä¹Ÿæ˜¯å¯ä»¥ã€‚\næœƒèªªåœ¨æŸå€‹åœ°å€æ‰¾ä¸åˆ°æ­¤cluster\nä¿®æ”¹cluster ï¼Œå•Ÿç”¨ Workload Identity\ngcloud container clusters update istio-test -z asia-east1-b \\Â  Â  --workload-pool=rd7-project.svc.id.goog\n\nä¿®æ”¹ node-pool\ngcloud container node-pools update defaultpool -z asia-east1-b \\Â  Â  --cluster=istio-test \\Â  Â  --workload-metadata=GKE_METADATA\n\nå¦‚æœæˆåŠŸçš„è©±ï¼Œæœƒçœ‹åˆ°\nGKE ä¸­ç¹¼è³‡æ–™ä¼ºæœå™¨ ï¼š å·²å•Ÿç”¨\n\nå»ºç«‹ns\nkubectl create ns token-proxy\n\nå»ºç«‹kubernetes å¸³è™Ÿ\nkubectl create serviceaccount -n token-proxy proxy-user\n\nç”³è«‹ Google service accoutçš„ IAM æœå‹™å¸³è™Ÿï¼Œ\nç„¶å¾Œç¶å®š kubernetes service account èˆ‡ Google service account ã€‚\ngcloud iam service-accounts add-iam-policy-binding \\Â  Â  --role roles/iam.workloadIdentityUser \\Â  Â  --member &quot;serviceAccount: project.svc.id.goog[token-proxy/proxy-user]&quot; \\Â  Â  token-proxy@rd7-project.iam.gserviceaccount.com\n\nåœ¨ kubernet service accountä¸Šé¢ï¼Œå¢åŠ è¨»é‡‹\nkubectl annotate serviceaccount \\Â  Â  --namespace token-proxy proxy-user \\Â  Â  iam.gke.io/gcp-service-account=token-proxy@rd7-project.iam.gserviceaccount.com\n\nref.\nä½¿ç”¨ Workload Identity",
		"tags": [ "note","âˆ"]
},

{
		"title": "GKEè¨˜éŒ„ nginx log",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/GKE/56. GKEè¨˜éŒ„ nginx log/",
		"content": "å‰è¨€\nå› å‰é™£å­è¢«äººç”¨DDOSæ”»æ“Šï¼Œ\nç„¶å¾Œå…¬å¸æœ‰ä¸€å€‹å–®ä½å°±è·‘å‡ºä¾†äº†ï¼Œèªªä»–å€‘è¦nginxçš„logï¼Œ\nç™¼ç”Ÿç•¶ä¸‹æ‰èƒ½ä½œç‚ºåˆ†æç”¨é€”ã€‚\næ­£æ–‡\nnginx ç‰ˆæœ¬ 1.21.4\næ›´æ”¹nginx config ï¼Œ\nå°‡\naccess_log /dev/stdout main;\nerror_log /dev/stderr;\n\næ”¾åœ¨ http åº•ä¸‹çš„ serviceå…§ã€‚\né€™æ¨£å°±æœƒæŠŠlog è¨Šæ¯ï¼Œä½¿ç”¨æ¨™æº–è¼¸å‡ºçš„æ–¹å¼åˆ—å°åˆ°æ©Ÿå™¨ä¸Šã€‚\nGKEå°±èƒ½æŠ“åˆ°è¨˜éŒ„äº†ã€‚\nç„¶å¾Œä½¿ç”¨ ECKçš„filebeat ï¼Œé è¨­æ˜¯æœƒå»æŠ“å„å€‹logçš„è³‡æ–™ã€‚\nä½†å‰ææ˜¯è¦æœ‰æ¨™æº–è¼¸å‡ºï¼Œæ‰€ä»¥é€™é‚Šå°±ä¸ç”¨è¨­å®šäº†ã€‚\nå®Œæ•´config å¦‚ä¸‹\n\n#user nobody;\nworker_processes 1;\n\nerror_log /var/log/nginx/error.log warn;\npid /var/run/nginx.pid;\n\nevents {\nworker_connections 1024;\n}\n\nhttp {\ninclude /etc/nginx/mime.types;\ndefault_type application/octet-stream;\n\nlog_format main '$remote_addr - $remote_user [$time_local] , '\n'http-host: &quot;$http_host&quot; , URL: &quot;$request&quot; , request-status : &quot;$status&quot; , '\n'body-byte: $body_bytes_sent ,http-referer: &quot;$http_referer&quot; ,'\n'user-agent: &quot;$http_user_agent&quot; , X-Forwarded-For : &quot;$http_x_forwarded_for&quot; , '\n' request-time: &quot;$request_time&quot; , response_time : &quot;$upstream_response_time&quot; ';\n\nsendfile on;\n#tcp_nopush on;\n\nkeepalive_timeout 65;\n\n#gzip on;\n\nserver {\nlisten 80;\nlisten [::]:80;\nroot /app;\nlisten 443 ssl;\nlisten [::]:443 ssl;\n\nserver_name _;\n\nssl off;\nssl_certificate /etc/nginx/nginxssl.crt;\nssl_certificate_key /etc/nginx/nginxssl.key;\n\nssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;\nssl_protocols TLSv1 TLSv1.1 TLSv1.2;\nssl_prefer_server_ciphers on;\n\naccess_log /dev/stdout main;\nerror_log /dev/stderr;\n\nlocation / {\ntry_files $uri /index.php$is_args$query_string;\n}\n\nlocation ~ \\.php$ {\nfastcgi_pass 127.0.0.1:9000;\nfastcgi_index index.php;\nfastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\ninclude fastcgi_params;\n}\n}\n\n}\n\nref.\n\nNginxé…ç½®ä¸­çš„log_format\nLinux â€“ Nginx log æ ¼å¼\ndockeré‹è¡Œnginxç‚ºä»€éº¼è¦ä½¿ç”¨ daemon off\nHave nginx access_log and error_log log to STDOUT and STDERR of master process",
		"tags": ["user", "tcp_nopush", "gzip", "note","âˆ"]
},

{
		"title": "GKE pvcé‚„åŸ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/GKE/70. GKE pvcé‚„åŸ/",
		"content": "å‰è¨€\nä¹‹å‰çš„Gitlabå»ºåœ¨GKEçš„å…¬é–‹å¢é›†ä¸Šï¼Œ\né›–ç„¶æœ‰é™å®šIPè¨ªå•ï¼Œä¸€ç›´è¦æ”¹åˆ°ç§æœ‰å¢é›†ä¸Šï¼Œ\nä½†ä¸€ç›´æ²’æ™‚é–“å‹•ï¼Œç¾åœ¨çµ‚æ–¼æœ‰ç©ºå¼„äº†ï¼Œé¦–å…ˆè¦è§£æ±ºçš„æ˜¯è³‡æ–™é‚„åŸçš„å•é¡Œã€‚\næ­£æ–‡\né¦–å…ˆåœ¨GCEä¸Šé¢è¤‡è£½ä¸€å€‹ç£ç¢Ÿï¼Œ\nå¯ä»¥å…ˆå¾GKEä¸Šé¢çš„podæ‰¾åˆ°ç•¶åˆå»ºç«‹çš„pvcåç¨±ï¼Œ\nå†æ ¹æ“šé€™å€‹åç¨±å»æ‰¾ã€‚\n\nå†ä¾†å°±å»ºç«‹pv è·Ÿ pvcäº†ã€‚\napiVersion: v1\nkind: PersistentVolume\nmetadata:\nname: test-pv\nnamespace: default\nspec:\n# persistentVolumeReclaimPolicy: Delete\nstorageClassName: &quot;standard&quot;\ncapacity:\nstorage: 300G\naccessModes:\n- ReadWriteOnce\nclaimRef:\nnamespace: default\nname: test-upload\ngcePersistentDisk:\npdName: test-upload\nfsType: ext4\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\nname: test-upload\nnamespace: default\nspec:\nstorageClassName: &quot;standard&quot;\naccessModes:\n- ReadWriteOnce\nresources:\nrequests:\nstorage: 300G\n\npvçš„ gcePersistentDisk ï¼Œæ˜¯å‰›å‰›è¤‡è£½çš„ç¡¬ç¢Ÿåç¨±ã€‚\nå°‡è£¡é¢çš„åƒæ•¸æ”¹ä¸€æ”¹ï¼Œ\nè¦å»ºç«‹çš„ name,namespace,storage, claimRef ï¼Œ\nçµæŸã€‚\ndeploymentä½¿ç”¨æ­£å¸¸æ–¹å¼ç›´æ¥æ›è¼‰å³å¯ã€‚\ntemplate:\nmetadata:\ncreationTimestamp: null\nlabels:\napp: video-admin\nversion: v1\nspec:\ncontainers:\n- name: video\n...\nvolumeMounts:\n- mountPath: /upload\nname: source\ndnsPolicy: ClusterFirst\nrestartPolicy: Always\nterminationGracePeriodSeconds: 30\nvolumes:\n- name: source\npersistentVolumeClaim:\nclaimName: test-upload\n\nå¦‚æœæ˜¯statefuleSetçš„è©±ï¼Œ\npvçš„åç¨±éœ€è¦æ”¹æˆ statefulSetçš„å‘½åè¦å‰‡ã€‚\nstatefulSetä¸æœƒç”¨åˆ°pvcã€‚\nVC_TEMPLATE_NAME-STATEFULSET_NAME-REPLICA_INDEX\n\nVC_TEMPLATE_NAMEï¼šæ–° PersistentVolumeClaim æ¨¡æ¿çš„åç¨±ã€‚\nSTATEFULSET_NAMEï¼šæ–° StatefulSet çš„åç¨±ã€‚\nREPLICA_INDEXï¼šStatefulSet å‰¯æœ¬çš„ç´¢å¼•ã€‚æ­¤ç¤ºä¾‹ä½¿ç”¨çš„æ˜¯ 0 å’Œ 1ã€‚\n\næ³¨æ„ï¼Œåˆªé™¤pvcæ™‚ï¼Œæœ€å¥½å°‡pvä¹Ÿåˆªé™¤ï¼Œé¿å…ç™¼ç”ŸæœªçŸ¥æƒ…æ³ã€‚\nå¦‚ç¢°åˆ°ä¸‹åœ–æƒ…æ³ï¼Œè¡¨ç¤ºpvæœ‰å•é¡Œï¼Œè«‹åˆªé™¤é‡å»ºã€‚\n\nref.\n\nå°‡åŸæœ‰æ°¸ä¹…æ€§ç£ç›¤ç”¨ä½œ PersistentVolume\næ°¸ä¹…æ€§å·å’Œå‹•æ…‹é é…",
		"tags": [ "note","âˆ"]
},

{
		"title": "gitlab on GKE ç½å®³é‚„åŸç­†è¨˜",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/GKE/71.gitlab on GKE ç½å®³é‚„åŸç­†è¨˜/",
		"content": "å‰è¨€\nä¹‹å‰ä¸€ç›´æ²’å¯«çš„gitlab yamlï¼Œå†æ–‡ç« çš„æœ€ä¸‹æ–¹ã€‚\næœ¬ç‰‡æ–‡ç« éƒ½æ˜¯ä½¿ç”¨é€™å€‹yamlåšå»ºç«‹åŠä½ˆç½²ã€‚\næ­£æ–‡\nStep 0.\nä¹‹å‰ä¸€ç›´æ²’å¯«çš„gitlab yamlï¼Œå†æ–‡ç« çš„æœ€ä¸‹æ–¹ã€‚\næœ¬ç‰‡æ–‡ç« éƒ½æ˜¯ä½¿ç”¨é€™å€‹yamlåšå»ºç«‹åŠä½ˆç½²ã€‚\nStep 1.\nå…ˆåƒè€ƒä¸Šç¯‡ <a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/GKE/70. GKE pvcé‚„åŸ/\">70. GKE pvcé‚„åŸ</a>ï¼Œå»ºç«‹å¥½PVCã€‚\nä¸»è¦è¤‡è£½Gitlabçš„ä½ç½®ç‚º\n- name: config\nmountPath: /etc/gitlab\n- name: gitlab-data\nmountPath: /var/opt/gitlab/git-data\n- name: postgres-data\nmountPath: /var/opt/gitlab/postgresql\n\nç”±æ–¼æˆ‘ä¹‹å‰å»ºç«‹çš„imageç‚º lastç‰ˆæœ¬ï¼ˆæ‡‰è©²æ˜¯å¿«ä¸€å¹´å‰çš„äº‹ï¼‰ï¼Œ\né€™æ¬¡æˆ‘ç”¨lastç‰ˆæœ¬çš„è©±ï¼Œç‰ˆæœ¬è¶…å‰å¤ªå¤šï¼Œå°è‡´ä¸€ç›´é‡é–‹æ©Ÿã€‚\nå¾Œä¾†æŸ¥æˆ‘çš„gitlabç‰ˆæœ¬ç‚º 14.0.1ï¼Œ\nä½†è£ä¸Šå»å¾Œä¸€ç›´ç¢°åˆ°é€™å€‹éŒ¯èª¤\n\nrelation &quot;services&quot; does not exist after upgrade to 14.2.0\n\nè§£æ±ºæ–¹å¼ï¼š\nå¾Œä¾†å°‡ç‰ˆæœ¬å‡ç´šåˆ° 14.1.1 å¾Œå°±å¥½äº†ã€‚\nref.\n\nERROR: relation &quot;services&quot; does not exist after upgrade to 14.2.0\n\nStep 2.\nç”¨æœ¬ä¾†çš„å¸³è™Ÿå¯†ç¢¼èƒ½ç™»å…¥ï¼Œæ²’å•é¡Œã€‚\nå¢åŠ æ–°çš„git remote ä½ç½®ï¼Œ\nç„¶å¾Œè©¦è‘—æ¨ä¸€å€‹ç‰ˆæœ¬ä¸Šå»æ™‚ï¼Œåˆå‡ºç¾éŒ¯èª¤äº†ã€‚é€™æ¬¡æ¯”è¼ƒå¥½ç†è§£ã€‚\n\nremote: HTTP Basic: Access denied\n\nè§£æ±ºæ–¹å¼ï¼š\nè·‘å»å¦ä¸€å€‹ç©ºç›®éŒ„ï¼Œgit clone ï¼Œæœƒè¦è¼¸å…¥å¸³è™Ÿå¯†ç¢¼ï¼Œè¼¸å…¥å¾Œå°±å¥½äº†ã€‚\nStep 3.\nå¦‚æœçœ‹éä¹‹å‰çš„æ–‡ç« ï¼Œå¯èƒ½çŸ¥é“æˆ‘æœ‰åœ¨ç”¨istioï¼Œ\næœƒç¢°åˆ°è¦ç”¨ä¸€å€‹ipæš´éœ²ä¸åŒçš„æœå‹™ã€‚\nè§£æ±ºæ–¹å¼ï¼š\nexternal_url &quot;http://{ip}/gitlab&quot;\nvirtualserviceç›´æ¥æ”¹\nspec:\nhosts: []\nhttp:\n- match:\n- uri:\nprefix: /gitlab\nname: gitlab\nroute:\n- destination:\nhost: gitlab-svc.default.svc.cluster.local\nport:\nnumber: 80\n\nref.\n\nConfigure a relative URL for GitLab\n\nGitlab yaml\nç¾åœ¨ä¹Ÿæœ‰gitlab operatorè·Ÿ helm å¯ä»¥åšï¼Œæœ‰èˆˆè¶£çš„å¯ä»¥åƒè€ƒä¸€ä¸‹å®˜æ–¹æ–‡ä»¶ã€‚\napiVersion: v1\nkind: Service\nmetadata:\nname: gitlab-svc\nspec:\nports:\n- name: &quot;web&quot;\nport: 80\ntargetPort: 80\n- name: &quot;ssh&quot;\nport: 22\ntargetPort: 22\n- name: &quot;ssl&quot;\nport: 443\ntargetPort: 443\nselector:\nio.kompose.service: web\ndrone: gitlab\ntype: LoadBalancer\nloadBalancerIP: 123.123.123.123\nloadBalancerSourceRanges:\n- 192.168.0.0/16\n- 172.16.0.0/12\n- 10.0.0.0/8\n\n---\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: gitlab\nlabels:\nio.kompose.service: web\nspec:\nreplicas: 1\nselector:\nmatchLabels:\nio.kompose.service: web\ntemplate:\nmetadata:\nlabels:\nio.kompose.service: web\nspec:\ncontainers:\n- env:\n- name: GITLAB_TIMEZONE\nvalue: Taipei\n- name: GITLAB_OMNIBUS_CONFIG\nvalue: |\nexternal_url &quot;http://123.123.123.123/gitlab&quot;\ngitlab_rails['gitlab_default_projects_features_builds'] = false\nimage: gitlab/gitlab-ce:14.1.1-ce.0\nname: web\nports:\n- containerPort: 80\nresources: {}\nvolumeMounts:\n- name: config\nmountPath: /etc/gitlab\n- name: gitlab-data\nmountPath: /var/opt/gitlab/git-data\n- name: postgres-data\nmountPath: /var/opt/gitlab/postgresql\nrestartPolicy: Always\nserviceAccountName: &quot;&quot;\nvolumes:\n- name: config\npersistentVolumeClaim:\nclaimName: gke-drone-web-claim0\n- name: gitlab-data\npersistentVolumeClaim:\nclaimName: gke-drone-repository-data\n- name: postgres-data\npersistentVolumeClaim:\nclaimName: gke-drone-gitlab-postgresql\n\nPVCçš„å»ºç«‹ï¼Œè«‹åƒè€ƒ<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/GKE/70. GKE pvcé‚„åŸ/\">70. GKE pvcé‚„åŸ</a>ï¼Œå¦‚è¦å»ºç«‹ç©ºçš„ï¼Œ\nåƒè€ƒä¸‹æ–¹yaml\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\ncreationTimestamp: null\nlabels:\nio.kompose.service: web-claim0\nname: gke-drone-web-claim0\nspec:\naccessModes:\n- ReadWriteOnce\nresources:\nrequests:\nstorage: 20Gi\nstatus: {}\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\nlabels:\ngitlab-data: gitlab\nname: gke-drone-repository-data\nspec:\naccessModes:\n- ReadWriteOnce\nresources:\nrequests:\nstorage: 100Gi\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\nlabels:\ngitlab-data: postgresql\nname: gke-drone-gitlab-postgresql\nspec:\naccessModes:\n- ReadWriteOnce\nresources:\nrequests:\nstorage: 100Gi",
		"tags": [ "note","âˆ"]
},

{
		"title": "ç”¨chatGPTå­¸Terraform",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/Terraform/147. ç”¨chatGPTå­¸Terraform/",
		"content": "ç¡ç¡å¿µ\nçµ‚æ–¼è¦ä¾†è©¦è©¦çœ‹terraormäº†ï¼Œ\nç¾åœ¨å…¬å¸å¥½åƒå¾ˆå°‘å…¨éƒ¨k8sï¼Œ\nå¤§éƒ¨åˆ†é‚„æ˜¯ç”¨è™›æ“¬æ©Ÿï¼Œé€™æ¨£è®Šæˆé‚„æ˜¯è¦æŠŠterraformå­¸ä¸€ä¸‹ã€‚\næ­£æ–‡\nTerraformè·Ÿansibleçš„å·®ç•°\n\nå·®ç•°é»\nTerraform\nAnsible\n\nçµ„æ…‹æª”æ¡ˆç®¡ç† vs çµ„æ…‹\nTerraformä½¿ç”¨çµ„æ…‹æª”æ¡ˆç®¡ç†åŸºç¤è¨­æ–½ï¼Œæè¿°å…¶ç‹€æ…‹ï¼Œè€Œä¸æ˜¯é…ç½®ã€‚\nAnsibleåŸºæ–¼ä¸»æ©Ÿçš„ç®¡ç†ï¼Œç›´æ¥é…ç½®åŸºç¤è¨­æ–½ã€‚\n\nå¯è®ŠåŸºç¤è¨­æ–½ vs ä¸å¯è®ŠåŸºç¤è¨­æ–½\nTerraformä»¥å¯è®Šçš„æ–¹å¼ç®¡ç†åŸºç¤è¨­æ–½ï¼Œå¯ä»¥å°åŸºç¤è¨­æ–½é€²è¡Œæ›´æ”¹ã€‚\nAnsibleé€šå¸¸å°‡åŸºç¤è¨­æ–½è¦–ç‚ºä¸å¯è®Šçš„ï¼Œä¸€æ—¦é…ç½®ï¼Œå®ƒå€‘å°±ä¸å†æ›´æ”¹ã€‚\n\néç¨‹å¼çš„ vs è²æ˜å¼çš„\nTerraformæ˜¯éç¨‹å¼çš„ï¼Œæœƒå¾ªåºæ¼¸é€²åœ°åŸ·è¡Œå‰µå»ºã€ä¿®æ”¹å’Œåˆªé™¤æ“ä½œã€‚\nAnsibleæ˜¯è²æ˜å¼çš„ï¼Œæè¿°äº†æœŸæœ›çš„æœ€çµ‚ç‹€æ…‹ï¼Œè€Œä¸æ˜¯åŸ·è¡Œä¸€ç³»åˆ—æ­¥é©Ÿä¾†å¯¦ç¾å®ƒã€‚\n\nMaster vs Masterless\nTerraformé€šå¸¸ä½¿ç”¨å–®ä¸€ä¸»ç¯€é»ç®¡ç†åŸºç¤è¨­æ–½ç‹€æ…‹ã€‚\nAnsibleå¯ä»¥åœ¨ä¸»ç¯€é»å’Œç„¡ä¸»ç¯€é»ï¼ˆå³agentlessï¼‰æ¨¡å¼ä¸‹é‹è¡Œã€‚\n\nAgent vs Agentless\nTerraformä¸éœ€è¦åœ¨ç›®æ¨™åŸºç¤è¨­æ–½ä¸Šå®‰è£ä»»ä½•ä»£ç†ã€‚\nAnsibleéœ€è¦åœ¨ç›®æ¨™åŸºç¤è¨­æ–½ä¸Šå®‰è£ä¸€å€‹ä»£ç†ã€‚\n\næˆç†Ÿ vs å‰æ²¿\nTerraformæ˜¯æˆç†Ÿçš„åŸºç¤è¨­æ–½è‡ªå‹•åŒ–å·¥å…·ï¼Œå·²è¢«å»£æ³›ä½¿ç”¨ã€‚\nAnsibleæ˜¯ä¸€å€‹æ–°èˆˆçš„åŸºç¤è¨­æ–½è‡ªå‹•åŒ–å·¥å…·ï¼Œä¸¦ä¸”æ­£åœ¨ç©æ¥µç™¼å±•ã€‚\n\nç¶œåˆä½¿ç”¨å¤šç¨®å·¥å…·\nTerraformèˆ‡å…¶ä»–å·¥å…·é›†æˆï¼Œå¦‚Packerã€Dockerå’ŒAWS CloudFormationç­‰ã€‚\nAnsibleèˆ‡å…¶ä»–å·¥å…·é›†æˆï¼Œå¦‚Jenkinsã€Dockerå’ŒKubernetesç­‰ã€‚\n\nå®‰è£\nå®˜ç¶²å®‰è£æœ€å¿«äº†ï¼Œä¸Šé¢æœ‰å„å€‹å¹³è‡ºçš„å®‰è£æ–¹å¼ã€‚\nè© å”±\næˆ‘å…ˆå•äº†ä¸€ä¸‹chatGPTæ€éº¼å­¸Terraformï¼Œç„¶å¾Œçµ¦äº†æˆ‘å¾ˆæ¨™æº–çš„ç­”æ¡ˆã€‚\n\né–±è®€Terraformå®˜æ–¹æ–‡æª”ï¼Œç†Ÿæ‚‰å…¶åŸºç¤çµæ§‹ã€åŠŸèƒ½å’Œæ¦‚å¿µã€‚\nå®‰è£Terraformï¼Œä¸¦å­¸ç¿’å¦‚ä½•ä½¿ç”¨å®ƒä¾†å‰µå»ºåŸºç¤è¨­æ–½ã€‚\né–‹å§‹ä½¿ç”¨Terraformçš„ç¤ºä¾‹é …ç›®ï¼Œä¸¦å˜—è©¦ä½¿ç”¨å®ƒå€‘å‰µå»ºç°¡å–®çš„åŸºç¤è¨­æ–½ã€‚\nå­¸ç¿’å¦‚ä½•ä½¿ç”¨Terraformç®¡ç†ä¸åŒçš„åŸºç¤è¨­æ–½æä¾›è€…ï¼Œå¦‚AWSã€Azureã€Google Cloudç­‰ã€‚\né–±è®€Terraformçš„æ¨¡å¡ŠåŒ–æ–‡æª”ï¼Œä¸¦å­¸ç¿’å¦‚ä½•ä½¿ç”¨æ¨¡å¡ŠåŒ–è¨­è¨ˆä¾†ç®¡ç†è¤‡é›œçš„åŸºç¤è¨­æ–½ã€‚\nå­¸ç¿’å¦‚ä½•ä½¿ç”¨Terraformå‘½ä»¤åˆ—å·¥å…·ä¾†æ¸¬è©¦å’Œèª¿è©¦åŸºç¤è¨­æ–½ä»£ç¢¼ã€‚\nç ”ç©¶Terraformçš„æœ€ä½³å¯¦è¸ï¼ŒåŒ…æ‹¬å¦‚ä½•ç®¡ç†æ©Ÿå¯†ã€ç·¨å¯«å¯é‡ç”¨çš„ä»£ç¢¼å’Œè¨­è¨ˆå¯æ“´å±•çš„åŸºç¤è¨­æ–½ã€‚\n\næˆ‘é‚„æ˜¯ç›´æ¥å¾å¯¦éš›æ¡ˆä¾‹ä¾†çœ‹å¥½äº†ï¼Œ\nQ: å¹«æˆ‘å»ºç«‹ä¸€å€‹éƒ¨ç½²deploymentçš„terrformç¨‹å¼ç¢¼\nA:\n# å®šç¾©Kubernetes provider\nprovider &quot;kubernetes&quot; {\nconfig_context_cluster = &quot;my-cluster&quot;\n}\n\n# å®šç¾©deployment\nresource &quot;kubernetes_deployment&quot; &quot;my_deployment&quot; {\nmetadata {\nname = &quot;my-deployment&quot;\nlabels = {\napp = &quot;my-app&quot;\n}\n}\n\nspec {\nreplicas = 3\n\nselector {\nmatch_labels = {\napp = &quot;my-app&quot;\n}\n}\n\ntemplate {\nmetadata {\nlabels = {\napp = &quot;my-app&quot;\n}\n}\n\nspec {\ncontainer {\nimage = &quot;my-image:latest&quot;\nname = &quot;my-container&quot;\n}\n}\n}\n}\n}\n\nçœ‹äº†ä¸€ä¸‹ä»–æä¾›çš„ç¨‹å¼ç¢¼ï¼Œæœ‰é»å•é¡Œï¼Œç„¶å¾Œæ¥ç€å•\nQï¼šresouce å®£å‘Š kubernetes_deployment my_deployment æ˜¯è¦è·Ÿdeploymentçš„nameä¸€æ¨£å—\nA:\n\næ˜¯çš„ï¼Œkubernetes_deploymentçš„metadataå€å¡Šä¸­çš„nameå±¬æ€§æœƒå®šç¾©Kubernetes deploymentçš„åç¨±ï¼Œæ‚¨éœ€è¦å°‡å…¶è¨­å®šç‚ºèˆ‡å¯¦éš›çš„deploymentåç¨±ç›¸åŒã€‚\n\nç„¶å¾Œåœ¨å¾ŒçºŒçš„å°è«‡éç¨‹ä¸­ï¼Œç™¼ç¾å¦ä¸€å€‹æŒ‡ä»¤ã€‚\nterraform import\n\nå†ç·Šæ¥ç€å•ï¼Œé€™å€‹çš„åŠŸç”¨æ˜¯ä»€éº¼ã€‚\nA:\nterraform importæ˜¯Terraformæä¾›çš„ä¸€å€‹å‘½ä»¤ï¼Œç”¨æ–¼å°‡ç¾æœ‰çš„è³‡æºå¼•å…¥Terraformç®¡ç†çš„ç‹€æ…‹ä¸­ã€‚ä½¿ç”¨terraform importå¯ä»¥è®“Terraformç­è§£ç¾æœ‰è³‡æºçš„ç‹€æ…‹ï¼Œä¸¦å…è¨±ä½ ä½¿ç”¨Terraformç®¡ç†é€™äº›è³‡æºï¼Œä¸¦åœ¨éœ€è¦æ™‚é€²è¡Œæ›´æ”¹ã€‚\né€šå¸¸æƒ…æ³ä¸‹ï¼ŒTerraformæœƒå¾é ­é–‹å§‹å‰µå»ºå’Œç®¡ç†æ‰€æœ‰è³‡æºã€‚ç„¶è€Œï¼Œåœ¨å¯¦éš›ç’°å¢ƒä¸­ï¼Œæœ‰æ™‚å€™æœƒå­˜åœ¨ä¸€äº›å·²ç¶“å­˜åœ¨çš„è³‡æºï¼Œé€™äº›è³‡æºå¯èƒ½æ˜¯æ‰‹å‹•å‰µå»ºçš„ï¼Œæˆ–è€…æ˜¯ç”±å…¶ä»–å·¥å…·å‰µå»ºçš„ã€‚é€™äº›è³‡æºå¯èƒ½åŒ…æ‹¬Kubernetes deploymentã€AWS EC2å¯¦ä¾‹ã€GCPè™›æ“¬æ©Ÿç­‰ç­‰ã€‚åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œä½¿ç”¨terraform importå‘½ä»¤å¯ä»¥å°‡é€™äº›ç¾æœ‰è³‡æºå¼•å…¥åˆ°Terraformç®¡ç†çš„ç‹€æ…‹ä¸­ï¼Œä»¥ä¾¿Terraformèƒ½å¤ ç®¡ç†å®ƒå€‘ã€‚\nä½¿ç”¨terraform importå‘½ä»¤æ™‚ï¼Œéœ€è¦æŒ‡å®šè¦å¼•å…¥çš„è³‡æºçš„é¡å‹å’ŒIDï¼Œä»¥åŠè¦å°æ‡‰åˆ°Terraformçš„å“ªå€‹è³‡æºã€‚Terraformå°‡ä½¿ç”¨æä¾›çš„è³‡æºé¡å‹å’ŒIDå°‹æ‰¾ç¾æœ‰è³‡æºçš„ç‹€æ…‹ï¼Œä¸¦å°‡å…¶å°æ‡‰åˆ°Terraformçµ„æ…‹æª”æ¡ˆä¸­çš„ç›¸æ‡‰è³‡æºã€‚ä¸€æ—¦è³‡æºæˆåŠŸè¢«å¼•å…¥ï¼ŒTerraformå°±å¯ä»¥é–‹å§‹ç®¡ç†å®ƒå€‘ï¼Œä¸¦å°‡å®ƒå€‘çš„ç‹€æ…‹ä¿å­˜åˆ°ç‹€æ…‹æª”æ¡ˆä¸­ï¼Œé€™æ¨£å°±å¯ä»¥ä½¿ç”¨terraform planã€terraform applyç­‰å‘½ä»¤é€²è¡Œæ›´æ”¹ã€‚\nå¦‚æœä¸çŸ¥é“æ€éº¼ç”¨æ²’é—œä¿‚ï¼Œ\nå†å•ä¸€ä¸‹ï¼Œ\nQï¼šè©²æ€éº¼ä½¿ç”¨terraform import\nAï¼š\nä½¿ç”¨terraform importå‘½ä»¤å¼•å…¥ç¾æœ‰è³‡æºåˆ°Terraformç®¡ç†çš„ç‹€æ…‹ä¸­ï¼Œé€šå¸¸éœ€è¦ä»¥ä¸‹æ­¥é©Ÿï¼š\n\nåœ¨Terraformçµ„æ…‹æª”æ¡ˆä¸­å®šç¾©è³‡æºçš„çµ„æ…‹ï¼Œä¾‹å¦‚ä½¿ç”¨kubernetes_deploymentå®šç¾©Kubernetes deploymentçš„çµ„æ…‹ã€‚\nåŸ·è¡Œterraform initåˆå§‹åŒ–Terraformï¼Œä»¥è¨­ç½®Terraformçš„å·¥ä½œç›®éŒ„å’Œç›¸é—œå¤–æ›ã€‚\nåŸ·è¡Œterraform importå‘½ä»¤å¼•å…¥ç¾æœ‰è³‡æºã€‚ä¾‹å¦‚ï¼Œè¦å¼•å…¥Kubernetes deploymentï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\n\nterraform import kubernetes_deployment.systemservice deployment2k7\n\né€™è£¡çš„kubernetes_deployment.systemserviceæŒ‡çš„æ˜¯åœ¨Terraformçµ„æ…‹æª”æ¡ˆä¸­å®šç¾©çš„Kubernetes deploymentè³‡æºï¼Œdeployment2k7å‰‡æ˜¯ç¾æœ‰Kubernetes deploymentçš„åç¨±æˆ–IDã€‚é€šéé€™æ¨£çš„æ–¹å¼ï¼ŒTerraformå°±æœƒå°‡ç¾æœ‰çš„Kubernetes deploymentå¼•å…¥åˆ°Terraformç®¡ç†çš„ç‹€æ…‹ä¸­ã€‚\n\næª¢æŸ¥Terraformçš„ç‹€æ…‹ï¼Œä½¿ç”¨terraform state listå‘½ä»¤å¯ä»¥åˆ—å‡ºTerraformç›®å‰ç®¡ç†çš„æ‰€æœ‰è³‡æºï¼Œå¯ä»¥ç¢ºèªå¼•å…¥çš„è³‡æºæ˜¯å¦å·²ç¶“è¢«æˆåŠŸç®¡ç†ã€‚\næ›´æ–°Terraformçµ„æ…‹æª”æ¡ˆï¼Œé€šéterraform planå’Œterraform applyå‘½ä»¤å°è³‡æºé€²è¡Œæ›´æ”¹ã€‚ç•¶Terraformç®¡ç†ç¾æœ‰è³‡æºæ™‚ï¼Œå®ƒæœƒæ¯”è¼ƒTerraformçµ„æ…‹æª”æ¡ˆå’Œç¾æœ‰è³‡æºçš„ç‹€æ…‹ï¼Œä¸¦ç”Ÿæˆä¸€å€‹è¨ˆåŠƒï¼Œé¡¯ç¤ºè¦å°‡è³‡æºå¸¶åˆ°Terraformæ‰€éœ€çš„æ›´æ”¹ã€‚é€šéåŸ·è¡Œterraform applyå‘½ä»¤ï¼ŒTerraformå°±å¯ä»¥å°‡é€™äº›æ›´æ”¹æ‡‰ç”¨åˆ°ç¾æœ‰çš„è³‡æºä¸­ã€‚\n\nçµè«–\nå…‰çœ‹æ²’æœ‰ç”¨ï¼Œæœ€é‡è¦çš„é‚„æ˜¯å¯¦ä½œï¼Œ\nä¸€é–‹å§‹æ²’ç¢°terraformæ˜¯ä¸çŸ¥é“å¯«å£äº†ï¼Œæœƒä¸æœƒå½±éŸ¿ç·šä¸Šçš„æœå‹™ï¼Œ\nç¾åœ¨æˆ‘èƒ½å¤ å…ˆimportï¼Œçœ‹ç›®å‰æœå‹™å»ºè¨­çš„ç¨‹å¼å¾Œï¼Œå†ä¾†ä¿®æ”¹ã€‚\næ„Ÿæƒ³\nå¯¦ä½œå¾Œå®Œå…¨å´©æ‰ï¼Œæœ‰å¾ˆå¤šæ±è¥¿é‚„æ˜¯è¦å¾é ­é–‹å§‹çœ‹ä¸€ä¸‹ã€‚\nåƒæ˜¯ï¼Œ terraform çš„backend ï¼Œè·Ÿtfstate é€™äº›è§€å¿µã€‚\nä¸Šé¢ä¹Ÿæœ‰æåˆ°å¼•å…¥è³‡æºï¼Œä½†å¯¦éš›ä¸Šå¯èƒ½è·Ÿä½ æƒ³å¾—ä¸å¤ªä¸€æ¨£ï¼Œ\nå¼•å…¥å¾Œæ˜¯è®Šæˆä¸€å€‹tfstateï¼Œè€Œä¸æ˜¯tfï¼Œ\né‚£tf è·Ÿ tfstateåˆæœ‰ä»€éº¼ä¸åŒå‘¢ï¼Ÿ\næˆ‘å€‘é‚„æ˜¯çœ‹ä¸‹ä¸€ç¯‡ï¼Œå¾é ­ä¾†éå§ã€‚\nref.\n\nç‚ºä»€éº¼æˆ‘å€‘ä½¿ç”¨Terraform è€Œä¸ä½¿ç”¨Puppet, Ansible",
		"tags": [ "note","âˆ"]
},

{
		"title": "Terraformçš„åŸºæœ¬æ¦‚å¿µ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/Terraform/148. Terraformçš„åŸºæœ¬æ¦‚å¿µ/",
		"content": "ç¡ç¡å¿µ\nç¶“æ­·ä¸Šä¸€ç¯‡çš„å¤±æ•—ï¼Œ\né‚„æ˜¯å…ˆå¾åŸºæœ¬è§€å¿µé–‹å§‹å§ã€‚\næ­£æ–‡\ntfåŸºæœ¬çµ„æˆ\nä¸‹é¢æŒ‡ä»¤è¼¸å…¥æ™‚ï¼Œæœƒç”¨tfå–ä»£terraform\nå®£å‘Š\n\nterraform\nå®£å‘Šterraformä»¥åŠç’°å¢ƒçš„ç‰ˆæœ¬\n\nterraform {\nrequired_version = &quot;~&gt;0.13.5&quot;\nrequired_providers {\nucloud = {\nsource = &quot;ucloud/ucloud&quot;\nversion = &quot;~&gt;1.22.0&quot;\n}\n}\n}\n\nprovider\nå‘¼å«è©²ç’°å¢ƒapiæ™‚éœ€è¦çš„åƒæ•¸\nk8s\n\nprovider &quot;kubernetes&quot; {\nconfig_path = &quot;~/.kube/config&quot;\n}\n\nucloud\nprovider &quot;ucloud&quot; {\npublic_key = &quot;JInqRnkSY8eAmxKFRxW9kVANYThg1pcvjD2Aw5f5p&quot;\nprivate_key = &quot;IlJn6GlmanYI1iDVEtrPyt5R9noAGz41B8q5TML7abqD8e4YjVdylwaKWdY61J5TcA&quot;\nproject_id = &quot;org-tgqbvi&quot;\nregion = &quot;cn-bj2&quot;\n}\n\nå®šç¾©\n\ndata\nå–å¾—terraformä»¥å¤–çš„è³‡è¨Šï¼Œä¸åŒçš„proivderæä¾›ä¸åŒçš„data sourcesã€‚\nprovider åˆ—è¡¨\n\ndata &quot;ucloud_security_groups&quot; &quot;default&quot; {\ntype = &quot;recommend_web&quot;\n}\n\nresource\nè¦å»ºç«‹çš„è³‡æº\n\n\tresource &quot;ucloud_eip&quot; &quot;web-eip&quot; {\n\t internet_type = &quot;bgp&quot;\n\t charge_mode = &quot;bandwidth&quot;\n\t charge_type = &quot;dynamic&quot;\n\t name = &quot;web-eip&quot;\n\t}\n\noutput\nè¼¸å‡º\n\n\t\toutput &quot;eip&quot; {\n\t\t value = ucloud_eip.web-eip.public_ip\n\t\t}\n\nç‹€æ…‹æª”æ¡ˆ(tfstate)\nç•¶terrformè¦åŸ·è¡Œè®Šæ›´æ™‚ï¼Œæœƒç”¢ç”Ÿtfstateçš„æª”æ¡ˆï¼Œ\nä¸Šé¢è¨˜è¼‰äº†ç›®å‰é›²ä¸Šçš„è³‡æºç‹€æ…‹ï¼Œæ­¤æª”æ¡ˆä¸å»ºè­°ç·¨è¼¯ï¼Œ\nç•¶æœ‰ä»»ä½•è³‡æºè®Šæ›´æ™‚ï¼ŒæœƒåŒæ­¥åˆ¤æ–·ç›®å‰é›²ä¸Šçš„è³‡æºç‹€æ…‹æ˜¯å¦ä¸€è‡´ã€‚\nå¯ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤ï¼ŒåŒ¯å…¥ç›®å‰é›²ç«¯ä¸Šçš„è³‡æºç‹€æ…‹\nterraform import kubernetes_deployment.websocketclient default/websocketclient\n\nkubernetes_deployment.websocketclient ç‚ºtfçš„è³‡æºåç¨±\ndefault/websocketclient æ˜¯é›²ä¸Šçš„è³‡æº\næ­¤tfstateçš„æª”æ¡ˆæ˜¯æ˜ç¢¼ï¼Œä¸”å¤šäººä½¿ç”¨æœƒé€ æˆç°½å…¥æ™‚ç™¼ç”Ÿè¡çªï¼Œ\næ‰€ä»¥è¦é€ébackendä¾†è§£æ±ºé€™å€‹å•é¡Œ\næª”æ¡ˆè£é¢æœƒçœ‹åˆ°ä¸€äº›ç‹€æ…‹ï¼Œä»£è¡¨çš„æ„æ€å¦‚ä¸‹\n\n+ ä»£è¡¨æ–°å¢çš„è³‡æº (Resource added)\n- ä»£è¡¨åˆªé™¤çš„è³‡æº (Resource deleted)\n~ ä»£è¡¨ä¿®æ”¹çš„è³‡æº (Resource modified)\n= ä»£è¡¨è³‡æºåƒæ•¸çš„å€¼æ²’æœ‰æ”¹è®Šï¼Œåªæ˜¯èª¿æ•´äº†æ’åº (Resource parameter unchanged, only ordering changed)\n-/+ åŒæ™‚å‡ºç¾ï¼Œè¡¨ç¤ºæ¯€å£æ€§è®Šæ›´ï¼Œå…ˆåˆªé™¤å¾Œå»ºç«‹\n\nref. ä½¿ç”¨åŸºç¤æ¶æ§‹å³ç¨‹å¼ç¢¼å·¥å…· Terraform\n\né ç«¯ç‹€æ…‹å„²å­˜æ©Ÿåˆ¶(Backend)\nTerraform Remote Backendåˆ†ç‚ºå…©ç¨®ï¼š\n\næ¨™æº–ï¼šæ”¯æ´é ç«¯ç‹€æ…‹å„²å­˜èˆ‡ç‹€æ…‹é–\n\nç‹€æ…‹é–æ˜¯æŒ‡ï¼Œç•¶é‡å°ä¸€å€‹tfstateé€²è¡Œè®Šæ›´æ“ä½œæ™‚ï¼Œå¯ä»¥é‡å°è©²ç‹€æ…‹æª”æ¡ˆæ–°å¢ä¸€æŠŠå…¨åŸŸé–ï¼Œç¢ºä¿åŒä¸€æ™‚é–“åªèƒ½æœ‰ä¸€å€‹è®Šæ›´è¢«åŸ·è¡Œã€‚\n\nå¢å¼·ï¼šåœ¨æ¨™æº–çš„åŸºç¤ä¸Šæ”¯æ´é ç«¯æ“ä½œ(åœ¨é ç«¯ä¼ºæœå™¨ä¸ŠåŸ·è¡Œplanã€applyç­‰æ“ä½œ)\n\nåªå­˜åœ¨æ–¼Terraform Cloud\n\nç›®å‰æ”¯æ´çš„backend list\n\nè¦å…±ç”¨ backendçš„è©±ï¼Œ\nå…ˆå»ºç«‹ä¸€å€‹ backend.hcl\nè£é¢è¼¸å…¥\nbucket = &quot;98c2c8-terraform-backend&quot;\nprefix = &quot;terraform/state&quot;\n\nä¸Šé¢çš„prefixä»£è¡¨çš„æ„æ€ç‚º\n\nGCS prefix inside the bucket. Named states for workspaces are stored in an object calledÂ &lt;prefix&gt;/&lt;name&gt;.tfstate\n\nåœ¨main.tfçš„required_providerså¾Œé¢å¡«ä¸Š backend &quot;gcs&quot; { }ï¼Œ\næ ¼å¼å¦‚ä¸‹\nterraform {\nrequired_providers {\ngoogle = {\nsource = &quot;hashicorp/google&quot;\nversion = &quot;4.63.1&quot;\n}\n}\nbackend &quot;gcs&quot; {\n\n}\n}\n\nç„¶å¾Œåœ¨åˆå§‹åŒ–çš„æ™‚å€™ï¼Œè¼¸å…¥\nterraform init -backend-config=backend.hcl\n\nref.\n\nBackendçµ„æ…‹çš„å‹•æ…‹è³¦å€¼\ntf-gcs\n\nå»ºç«‹workspace\nç›¸æ¯”èµ·å¤šè³‡æ–™å¤¾éš”é›¢çš„æ–¹å¼ä¾†èªªï¼ŒåŸºæ–¼Workspaceçš„éš”é›¢æ›´åŠ ç°¡å–®ï¼Œåªéœ€è¦ä¿å­˜ä¸€ä»½ç¨‹å¼ç¢¼ï¼Œåœ¨ç¨‹å¼ç¢¼ä¸­ä¸éœ€è¦ç‚ºWorkspaceç·¨å¯«é¡å¤–ç¨‹å¼ç¢¼ï¼Œç”¨å‘½ä»¤åˆ—å°±å¯ä»¥åœ¨ä¸åŒå·¥ä½œå€ä¹‹é–“ä¾†å›åˆ‡æ›ã€‚\nä¸‹åˆ—æŒ‡ä»¤åˆ†åˆ¥çˆ²ï¼Œå»ºç«‹ã€åˆ—è¡¨ã€é¸æ“‡åŠé¡¯ç¤ºç›®å‰çš„workspace\nterraform workspace new qa\nterraform workspace list\nterraform workspace select qa\nterraform worspace show\n\nref. ç‹€æ…‹ç®¡ç†\n\næª¢æŸ¥terraform çš„è¨ˆåŠƒ\nterraform plan -out=out.tfplan\n\n-outçš„æŒ‡å®šè¨ˆç•«çš„è¼¸å‡ºæª”ï¼Œç¢ºä¿æ‚¨æ‰€æª¢é–±çš„æ–¹æ¡ˆå°±æ˜¯æ‰€å¥—ç”¨çš„æ–¹æ¡ˆã€‚\nä¹‹å¾Œä½¿ç”¨applyåŸ·è¡Œ\nterraform apply out.tfplan\n\nå»ºç«‹å®Œæˆå¾Œï¼Œä½¿ç”¨showçœ‹ç›®å‰ç‹€æ…‹\nterraform show\n\ncount\n\nèˆ‰ä¾‹ä¾†èªª, å…©å€‹VMæ˜¯ä¸€éš»ç‹—ä¸€éš»è²“ï¼Œé‚£å°±æ˜¯dog.tf cat.tf\nå¦‚æœæ˜¯å…©éš»ç‹— å°±å¯ä»¥å¯«ä¸€å€‹ dog.tf\nè£¡é¢ç”¨\nresources ec2\nCount = 2\né€™æ¨£\n\nconsole\nåŸ·è¡Œ console ï¼Œçœ‹ç¨‹å¼åŸ·è¡Œçµæœ\nterraform console\n\ncidrsubnet å¾Œé¢çš„ç¬¬äºŒå€‹åƒæ•¸è¡¨ç¤ºäºŒé€²ä½è¦ä½ç§»å¤šå°‘ï¼Œç¬¬ä¸‰å€‹åƒæ•¸è¡¨ç¤ºï¼Œè¦è¨­å®šä½ç§»çš„æ•¸å­—ç‚ºå¤šå°‘ã€‚\nä¾‹å¦‚ 10 = 1010\nä½ç§»4bitï¼Œæ‰€ä»¥æ˜¯ 1010 0000 = 160\n6 = 0110\nä½ç§»4bit ï¼Œæ‰€ä»¥æ˜¯ 0110 0000 = 96\ntf console\n&gt; cidrsubnet(&quot;10.1.0.0/24&quot;,4,0)\n&quot;10.1.0.0/28&quot;\n&gt; cidrsubnet(&quot;10.1.0.0/24&quot;,4,10)\n&quot;10.1.0.160/28&quot;\n&gt; cidrsubnet(&quot;10.1.0.0/24&quot;,4,6)\n&quot;10.1.0.96/28&quot;\n&gt; cidrsubnet(&quot;10.1.0.0/24&quot;,4,12)\n&quot;10.1.0.192/28&quot;\n\nref. How cidrsubnet works in Terraform\n\nvariableè®Šæ•¸å®£å‘Š\nå…ˆçŸ¥é“è®Šæ•¸çš„ç¹¼æ‰¿é †åºï¼Œ\n\nç¨®é¡\næè¿°\nç¯„ä¾‹\nå„ªå…ˆ\nå»ºè­°ä½¿ç”¨\n\nå‘½ä»¤åˆ—åƒæ•¸\nè¼¸å…¥å‘½ä»¤æ™‚ï¼ŒæŒ‡å®šè®Šæ•¸\ntf apply -var=&quot;gcp_region=asia-east&quot;\n1\nç‰¹æ®Šæƒ…æ³\n\nç’°å¢ƒè®Šæ•¸\nä½¿ç”¨ TF_VAR_ ç’°å¢ƒè®Šæ•¸å®šç¾©\nTF_VAR_gcp_region=asia_east2\n2\n\nè®Šæ•¸æ–‡ä»¶\nä½¿ç”¨tfvarsè®Šæ•¸æ–‡ä»¶å®šç¾©\ngcp_region=asia_east2\n3\né–‹ç™¼è€…\n\nè¨­å®šæ–‡ä»¶\nä½¿ç”¨variableså€å¡Šå®šç¾©\nvariable &quot;gcp_region&quot; {default = &quot;asia-east1&quot;}\n4\nç¨‹å¼ç¢¼\n\ntfçš„è®Šæ•¸è¦å…ˆå®£å‘Šï¼Œ\nvariable &quot;gcp_region&quot; {\ndefault = &quot;asia-east1&quot;\n}\n\nå¦‚æœå¾ŒçºŒè¦æ”¹å€¼ï¼Œå¯ä»¥æ”¹æˆ\ngcp_region = &quot;asia-east2&quot;\n\nå¦‚æœè¦æ¸¬è©¦ï¼Œå¯ä»¥åŸ·è¡Œ terraform console\nå†è¼¸å…¥è®Šæ•¸åç¨±é©—è­‰ã€‚\nè®Šæ•¸æ–‡ä»¶è¼‰å…¥æ–¹å¼\n\næª”æ¡ˆåç¨±ç‚ºÂ terraform.tfvarsÂ orÂ terraform.tfvars.json\nå‰¯æª”åç‚ºÂ .auto.tfvarsÂ orÂ .auto.tfvars\n\nå¿…é ˆåœ¨åŒä¸€å€‹tf initçš„è³‡æ–™å¤¾å…§ã€‚\n\né‚„æœ‰å…¶ä»–è¼‰å…¥æ–¹å¼ï¼Œåœ¨apply æ™‚è¼‰å…¥è®Šæ•¸æª”ï¼Œæˆ–æ˜¯ç’°å¢ƒè®Šæ•¸è¼‰å…¥ã€‚\nè©³ç´°åƒè€ƒ\n\n[Terraform] Input Variables\nTerraform è®Šæ•¸\n(Youtube)Terraform å¾é›¶é–‹å§‹ åŸºç¤ | 9-Variablesï¼ˆè®Šæ•¸ï¼‰çš„ç¨®é¡èˆ‡ä½¿ç”¨é †åº\n\nå¸¸ç”¨æŒ‡ä»¤\n\ntf console å¯ä»¥ç¶“ç”±é€™é‚Šå»é©—è­‰è®Šæ•¸\n\ntf fmt æ ¼å¼åŒ–main.tf\n\ntf validate é©—è­‰terraform",
		"tags": [ "note","âˆ"]
},

{
		"title": "terraform éƒ¨ç½²VMï¼Œå•“å‹•dockerå®‰è£metadata_startup_script",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/Terraform/149. terraform éƒ¨ç½²VMï¼Œå•“å‹•dockerå®‰è£metadata_startup_script/",
		"content": "ç¡ç¡å¿µ\nç”±æ–¼å‰äººå¼„å‘Let's encrypt ç”³è«‹çš„sslæ†‘è­‰ï¼Œå¶çˆ¾æœƒå‡ºå•é¡Œï¼Œ\næ­¥é©Ÿç¹ç‘£ï¼Œå¸¸å¸¸æ”¹äº†é€™å€‹ï¼Œå¿˜è¨˜è¦é‡å•“é‚£å€‹ï¼Œé‚£å°±é‡æ–°åšä¸€å¥—å§ã€‚\nç‚ºäº†æˆ‘æƒ³å·æ‡¶..(^__^)\nä½†åœ¨é‚£ä¹‹å‰ï¼Œå…ˆç”Ÿå€‹æ©Ÿå™¨ä¾†æ¸¬è©¦çœ‹çœ‹ã€‚\næ­£æ–‡\nç¬¬ä¸€æ¬¡ç”¨terraforméƒ¨ç½²vmæ©Ÿå™¨ï¼Œ\né€™é‚Šè¦æ³¨æ„çš„æ˜¯ backend &quot;gcs&quot;ï¼Œ\næˆ‘ç›´æ¥å°‡tfstateå‚³åˆ°gcsä¸Šé¢äº†ï¼Œå¯ä»¥åƒè€ƒä¸Šä¸€ç¯‡<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Terraform/148. Terraformçš„åŸºæœ¬æ¦‚å¿µ/\">148. Terraformçš„åŸºæœ¬æ¦‚å¿µ</a>ã€‚\nåº•ä¸‹çš„metadata_startup_scriptï¼Œ\næŒ‡ä»¤å¾ˆé•·ï¼Œå°è‡´æˆ‘ä¸æƒ³æ”¾åœ¨åŒä¸€è¡Œï¼Œ\nè·‘å»å•äº†ä¸‹chatGPTï¼Œèƒ½ä½¿ç”¨\n&lt;&lt;-EOT\nEOT\n\né€™ç¨®æ–¹å¼å°‡ç¨‹å¼ç¢¼åŒ…åœ¨ä¸€èµ·ï¼Œå°±æ¯”è¼ƒæ–¹ä¾¿é–±è®€äº†\nterraform {\nrequired_providers {\ngoogle = {\nsource = &quot;hashicorp/google&quot;\nversion = &quot;4.63.1&quot;\n}\n}\nbackend &quot;gcs&quot; {\n\n}\n}\n\nprovider &quot;google&quot; {\nproject = &quot;abc&quot;\n}\n\nresource &quot;google_compute_instance&quot; &quot;certificate-vm&quot; {\nname = &quot;ca-service&quot;\nmachine_type = &quot;f1-micro&quot;\nzone = &quot;asia-east1-b&quot;\ntags = [&quot;allow-admin-ip&quot;]\n\nboot_disk {\ninitialize_params {\nimage = &quot;debian-cloud/debian-11&quot;\n}\n}\n\n# Install Docker\nmetadata_startup_script = &lt;&lt;-EOT\nsudo apt-get update; sudo apt-get install ca-certificates curl gnupg;\nsudo install -m 0755 -d /etc/apt/keyrings;\ncurl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg;\nsudo chmod a+r /etc/apt/keyrings/docker.gpg;\necho &quot;deb [arch=&quot;$(dpkg --print-architecture)&quot; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian \\\n&quot;$(. /etc/os-release &amp;&amp; echo &quot;$VERSION_CODENAME&quot;)&quot; stable&quot; | \\\nsudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null ;\nsudo apt-get update;\nsudo apt-get -y install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin;\nEOT\n\nnetwork_interface {\n# subnetwork = google_compute_subnetwork.default.id\nsubnetwork = &quot;default&quot;\naccess_config {\n# Include this section to give the VM an external IP address\n}\n}\n}\n\ntroubleshooting\nå¦‚æœåŸ·è¡Œäº†startup-scriptï¼Œä½†æ²’è·‘ï¼Œè©²æ€éº¼é™¤éŒ¯ï¼Ÿ\nåˆ°vmè£é¢åŸ·è¡Œä¸‹é¢æŒ‡ä»¤ï¼Œå°±å¯ä»¥æŸ¥logäº†\nsudo journalctl -u google-startup-scripts.service\n\nref. Install Docker Engine on Debian",
		"tags": [ "note","âˆ"]
},

{
		"title": "Terrafrom å»ºç«‹private cluster",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/Terraform/183. Terrafrom å»ºç«‹private cluster/",
		"content": "å‰è¨€\nè¦é‡å»ºä¸€å€‹æ–°çš„projectï¼Œç„¶å¾ŒæŠŠèˆŠçš„æœå‹™æ¬éå»ã€‚\nåˆæ­¥ä¼°è¨ˆå°±ä¸€å †æ±è¥¿ï¼Œæ­£å¥½æ‹¿ä¾†ç·´ä¸€ä¸‹terraformäº†\næ­£æ–‡\n\næœå‹™åˆ—è¡¨\n\nCreate Project\n\nCreate Cluster\n\nCreate VPC\n\nCreate CLoudSQL\n\nCreate Memorystore\n\nCreate CloudStorage\n\nCopy file to CloudStorage\n\nå¾Œç«¯ä¿®æ”¹config&amp;publish\n\nCreaet RabbitMQ\n\nCreate Nginx ingress\n\nå‰ç«¯æœå‹™éƒ¨ç½²&amp;æ¸¬è©¦\n\nå¾Œç«¯æœå‹™éƒ¨ç½²&amp;æ¸¬è©¦\n\nNetwork policy\n\nObserbility service\n\nEFK logs\n\nå‰å¾Œç«¯ CI/CD ä¿®æ”¹ &amp; IAMæ¬Šé™\n\nProjectæ²’è¾¦æ³•ç”¨terraformï¼Œå› çˆ²é‚£ä¸æ˜¯æˆ‘æ“ä½œçš„ã€‚\nä¹Ÿä¸çŸ¥é“é‚£å€‹èƒ½ä¸èƒ½ç”¨terraform ã€‚\né€™ç¯‡æœƒå»ºç«‹ä¸€å€‹bucketã€vpc ã€private clusterä»¥åŠcloud NATã€‚\nä¸‹é¢æœƒç”¨tf ä¾†ç¨±å‘¼terraform\n\nå»ºç«‹bucket\nå› çˆ²ç‹€æ…‹é—œä¿‚ï¼Œå°±ä¹¾è„†ç”¨gcsçµ±ä¸€ç‹€æ…‹äº†ï¼Œå¯åƒè€ƒ<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Terraform/148. Terraformçš„åŸºæœ¬æ¦‚å¿µ/\">148. Terraformçš„åŸºæœ¬æ¦‚å¿µ</a>\nnew\\gcs\\main.tf\n\nterraform {\nrequired_providers {\ngoogle = {\nsource = &quot;hashicorp/google&quot;\nversion = &quot;4.63.1&quot;\n}\n}\n}\n\nprovider &quot;google&quot; {\nproject = &quot;ezio-sms-o&quot;\n}\n\nresource &quot;random_id&quot; &quot;bucket_prefix&quot; {\nbyte_length = 3\n}\n\nresource &quot;google_storage_bucket&quot; &quot;tfstate_bucket&quot; {\nname = &quot;${random_id.bucket_prefix.hex}-terraform-devops&quot;\nforce_destroy = false\nlocation = &quot;asia-east1&quot;\nstorage_class = &quot;Nearline&quot;\n\n//ç‰©ä»¶ç‰ˆæœ¬ç®¡ç†\nversioning {\nenabled = false\n}\n}\n\noutput &quot;bucket_name&quot;{\ndescription = &quot;get bucket name&quot;\nvalue = google_storage_bucket.tfstate_bucket.name\n}\n\nè¨˜ä¸‹bucket nameèˆ‡é è¨ˆè¦ç”¨çš„å‰ç¶´ï¼Œç„¶å¾Œå¯«åœ¨backend.hclï¼Œ\nç­‰ç­‰ä¸‹é¢æœƒç”¨åˆ°ã€‚\nnew\\backend.hcl\nbucket = &quot;cb0392-terraform-devops&quot;\nprefix = &quot;terraform/state&quot;\n\nå»ºvpc èˆ‡cloudNAT\nnew\\gke\\main.tf\n\nterraform {\nrequired_providers {\ngoogle = {\nsource = &quot;hashicorp/google&quot;\nversion = &quot;5.4.0&quot;\n}\n}\nbackend &quot;gcs&quot; {\n\n}\n}\n\nprovider &quot;google&quot; {\nproject = &quot;ezio-sms-o&quot;\nzone = &quot;asia-east1-b&quot;\n}\n\n# VPC\nresource &quot;google_compute_network&quot; &quot;basic&quot; {\nname = &quot;basic&quot;\nauto_create_subnetworks = false\n# delete_default_routes_on_create = false\nrouting_mode = &quot;REGIONAL&quot;\n}\n\nresource &quot;google_compute_subnetwork&quot; &quot;basic&quot; {\nname = &quot;basic-subnet&quot;\nip_cidr_range = var.subnet_cidr\nregion = var.gcp_region\nnetwork = google_compute_network.basic.id\nprivate_ip_google_access = true\n\nsecondary_ip_range {\nrange_name = &quot;gke-pod-range&quot;\nip_cidr_range = var.pod_cidr\n}\nsecondary_ip_range {\nrange_name = &quot;gke-service-range&quot;\nip_cidr_range = var.service_cidr\n}\n}\n\n# Cloud NAT\nresource &quot;google_compute_router&quot; &quot;default_cloudnat&quot; {\nname = &quot;default-nat&quot;\nregion = var.gcp_region\nnetwork = google_compute_network.basic.id\n}\n\nresource &quot;google_compute_router_nat&quot; &quot;default_cloudnat&quot; {\nname = &quot;nat&quot;\nrouter = google_compute_router.default_cloudnat.name\nregion = var.gcp_region\n\nsource_subnetwork_ip_ranges_to_nat = &quot;LIST_OF_SUBNETWORKS&quot;\nnat_ip_allocate_option = &quot;MANUAL_ONLY&quot;\n\nsubnetwork {\nname = google_compute_subnetwork.basic.id\nsource_ip_ranges_to_nat = [&quot;ALL_IP_RANGES&quot;]\n}\n\nnat_ips = [google_compute_address.nat.self_link]\n}\n\nresource &quot;google_compute_address&quot; &quot;nat&quot; {\nname = &quot;nat&quot;\naddress_type = &quot;EXTERNAL&quot;\nnetwork_tier = &quot;PREMIUM&quot;\nregion = var.gcp_region\n\n}\n\nè®Šæ•¸çš„è¨­å®šï¼Œä¹Ÿè«‹åƒè€ƒ<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Terraform/148. Terraformçš„åŸºæœ¬æ¦‚å¿µ/\">148. Terraformçš„åŸºæœ¬æ¦‚å¿µ</a>\nnew\\gke\\terraform.tf\nvariable &quot;project_id&quot; {\ndefault = &quot;ezio-sms-o&quot;\n}\nvariable &quot;gcp_region&quot; {\ndefault = &quot;asia-east1&quot;\n}\nvariable &quot;gcp_zone&quot; {\ntype = list(string)\ndefault = [&quot;asia-east1-b&quot;]\n}\nvariable &quot;gke_name&quot; {\ndefault = &quot;fixed&quot;\n}\n\nvariable &quot;subnet_cidr&quot; {\ndefault = &quot;10.10.0.0/16&quot;\n}\n\nvariable &quot;pod_cidr&quot; {\ndefault = &quot;192.168.8.0/21&quot;\n}\n\nvariable &quot;service_cidr&quot; {\ndefault = &quot;192.168.16.0/21&quot;\n}\n\nvariable &quot;master_cidr&quot; {\ndefault = &quot;10.0.2.0/28&quot;\n}\n\nref.\n\né€é Terraform å»ºç«‹ç§æœ‰ GKE Cluster\n# ä½¿ç”¨åŸºç¤æ¶æ§‹å³ç¨‹å¼ç¢¼å·¥å…· Terraform\ngoogle_compute_network\n\nå»ºç«‹GKE\n\né€™éƒ¨åˆ†ç®—æ˜¯æŸ¥æœ€ä¹…çš„ï¼Œç”¨åˆ°äº†terraformçš„moduleæ¦‚å¿µã€‚\nå¯ä»¥å…ˆçœ‹é€™ç¯‡ [Terraform] å…¥é–€å­¸ç¿’ç­†è¨˜ï¼Œç­è§£ä¸€ä¸‹ä»€éº¼æ˜¯moduleã€‚\nç„¶å¾Œå†ä¾†å°±æ˜¯çœ‹å®˜æ–¹æ–‡ä»¶äº†ã€‚\nnew\\gke\\main.tf\næ²’éŒ¯è·Ÿä¸Šé¢vpcçš„æª”æ¡ˆä¸€æ¨£ï¼Œå› çˆ²æ˜¯åŒä¸€ä»½æ–‡ä»¶ã€‚\n# GKE\nmodule &quot;gke&quot; {\nsource = &quot;terraform-google-modules/kubernetes-engine/google//modules/private-cluster&quot;\nversion = &quot;29.0.0&quot;\nproject_id = var.project_id\nname = var.gke_name\n# å€åŸŸæ€§\nregional = false\nregion = var.gcp_region\nzones = var.gcp_zone\nnetwork = google_compute_network.basic.name\nsubnetwork = google_compute_subnetwork.basic.name\nip_range_pods = google_compute_subnetwork.basic.secondary_ip_range[0].range_name\nip_range_services = google_compute_subnetwork.basic.secondary_ip_range[1].range_name\nhttp_load_balancing = true\nnetwork_policy = false\nhorizontal_pod_autoscaling = true\nfilestore_csi_driver = false\n# private cluster\nenable_private_endpoint = false\nenable_private_nodes = true\nmaster_global_access_enabled = false\nmaster_ipv4_cidr_block = &quot;10.0.0.0/28&quot;\n# gke version\nrelease_channel = &quot;UNSPECIFIED&quot;\nremove_default_node_pool = true\n# log record\nlogging_enabled_components = [&quot;SYSTEM_COMPONENTS&quot;]\ncreate_service_account = false\n\nnode_pools = [\n{\nautoscaling = false\nnode_count = 2\nname = &quot;default-node-pool&quot;\nmachine_type = &quot;e2-custom-4-12288&quot;\nlocal_ssd_count = 0\nspot = false\ndisk_size_gb = 100\ndisk_type = &quot;pd-standard&quot;\nimage_type = &quot;COS_CONTAINERD&quot;\nenable_gcfs = false\nenable_gvnic = false\nlogging_variant = &quot;DEFAULT&quot;\nauto_repair = true\nauto_upgrade = false\npreemptible = false\ninitial_node_count = 80\n},\n]\n\nnode_pools_oauth_scopes = {\nall = [\n\t\t&quot;https://www.googleapis.com/auth/logging.write&quot;,\n\t\t&quot;https://www.googleapis.com/auth/monitoring&quot;,\n\t\t&quot;https://www.googleapis.com/auth/devstorage.read_only&quot;,\n\t\t&quot;https://www.googleapis.com/auth/service.management.readonly&quot;,\n\t\t&quot;https://www.googleapis.com/auth/servicecontrol&quot;,\n\t\t&quot;https://www.googleapis.com/auth/trace.append&quot;\n]\n}\n\nnode_pools_labels = {\nall = {}\n\ndefault-node-pool = {\ndefault-node-pool = true\n}\n}\n\nnode_pools_metadata = {\nall = {}\n\ndefault-node-pool = {\nnode-pool-metadata-custom-value = &quot;fixed-node-pool&quot;\n}\n}\n\nnode_pools_taints = {\nall = []\n\ndefault-node-pool = [\n{\nkey = &quot;default-node-pool&quot;\nvalue = true\neffect = &quot;PREFER_NO_SCHEDULE&quot;\n},\n]\n}\n\nnode_pools_tags = {\nall = []\n\ndefault-node-pool = [\n&quot;default-node-pool&quot;,\n]\n}\n}\n\nç°¡å–®èªªä¸€ä¸‹moduleçš„ç”¨æ³•ï¼Œ\nç•¶ç¬¬ä¸€æ¬¡ç”¨moduleæ™‚ï¼Œéœ€è¦åˆå§‹åŒ–ï¼ŒåŠ ä¸ŠæŒ‡å®šgcså„²å­˜tfstat\ntf init -backend-config=../backend.hcl\n\nä¹‹å¾Œè¦ä½¿ç”¨submoduleçš„è©±ï¼Œä¸ç”¨å†åˆå§‹åŒ–ï¼Œåªè¦get\ntf get\n\nè¦å»ºç«‹private clusterçš„è©±ï¼Œéœ€è¦ä½¿ç”¨submoduleï¼Œ\nå¯å¾kubernetes-engine åˆ° submoduleçš„ private-clusterï¼Œ\næœ‰äº›åƒæ•¸ä¸çŸ¥é“æ˜¯å»ºç«‹GKEçš„å“ªå€‹è¨­å®šï¼Œ\nå¯ä»¥å¤šåˆ©ç”¨tf validate é©—è­‰ï¼Œ\nä½†æœ‰æ™‚æ˜¯éƒ¨ç½²æ™‚æ‰æœƒç™¼ç”ŸéŒ¯èª¤ã€‚\næˆ‘å¾Œä¾†æ˜¯ç›´æ¥æ‰‹å‹•æŠŠclusterç æ‰ï¼Œå†tf applyæ¯”è¼ƒå¿«ã€‚\næœ¬ä¾†ä¹Ÿæœ‰æƒ³éä¸è¦ç”¨moduleï¼Œç›´æ¥å¯¦ä½œã€‚\nä½†çœ‹äº†å®˜æ–¹æ–‡ä»¶ Using GKE with Terraformï¼Œ\n\nAdditionally, you may consider using Google'sÂ kubernetes-engineÂ module, which implements many of these practices for you\nå°±è©¦è©¦çœ‹äº†ã€‚\n\næ³¨æ„ï¼Œsubmoduleèˆ‡ä¸»è¦moduleçš„sourceä¸ä¸€æ¨£ï¼Œæœ‰äº›åƒæ•¸åœ¨ä¸»moduleæ˜¯æ²’æœ‰çš„ã€‚\nTroubleshooting\néƒ¨ç½²GKEæ™‚ï¼Œç™¼ç¾æˆ‘æ²’è¾¦æ³•å¾Google Artifact Registry ä¸‹è¼‰imageã€‚\næœ€å¾Œç™¼ç¾æ˜¯ æ²’æœ‰è¨­å®š å­˜å–æ¬Šç¯„åœï¼ŒAccess scopes in GKEã€‚\n\né€™å€‹éœ€è¦åœ¨ node_pools_oauth_scopes è£é¢è£œä¸Šå…è¨±çš„apiç¶²å€ã€‚",
		"tags": [ "note","âˆ"]
},

{
		"title": "å°å…¥Terraform",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/Terraform/189. å°å…¥Terraform/",
		"content": "å‰è¨€\nå‰é¢æœ‰ç¨å¾®æåˆ°å¹¾ç¯‡æ˜¯terraformçš„ä½¿ç”¨æ–¹å¼ï¼Œ\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Terraform/148. Terraformçš„åŸºæœ¬æ¦‚å¿µ/\">148. Terraformçš„åŸºæœ¬æ¦‚å¿µ</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Terraform/149. terraform éƒ¨ç½²VMï¼Œå•“å‹•dockerå®‰è£metadata_startup_script/\">149. terraform éƒ¨ç½²VMï¼Œå•“å‹•dockerå®‰è£metadata_startup_script</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/Terraform/183. Terrafrom å»ºç«‹private cluster/\">183. Terrafrom å»ºç«‹private cluster</a>\nå†ä¾†æŠŠå‰©ä¸‹ç¢°åˆ°çš„è£œä¸€è£œäº†ã€‚\næ­£æ–‡\n\nå»ºç«‹å®Œäº†private clusterï¼Œå¾ŒçºŒè¦å»ºç«‹SQL è·Ÿ redisçš„è©±ï¼Œè©²æ€éº¼å»ºï¼Ÿ\n\nå¦å¤–é–‹ä¸€å€‹è³‡æ–™å¤¾ï¼Œé‡æ–°terraform initï¼Œä½†è¦æ³¨æ„ï¼Œ\nä½ çš„backend.hclæ˜¯æ€éº¼å¯«çš„ã€‚\nèˆ‰ä¾‹ä¾†èªªï¼Œ\nprivate clusterçš„bucket.hclæ˜¯é€™æ¨£\nbucket = &quot;terraform-devops&quot;\nprefix = &quot;terraform/state&quot;\n\nå¦‚æœï¼Œå¦ä¸€å€‹è³‡æ–™å¤¾è£é¢çš„bucket.hclä¹Ÿç›¸åŒï¼Œ\né‚£åœ¨ç”¢ç”Ÿè¨ˆåŠƒæ™‚ï¼Œå°±æœƒæŠŠä½ å‰›å‰›å»ºå¥½çš„private clusterçµ¦åˆªé™¤ï¼Œ\nå› çˆ²ä»–æª¢æŸ¥çš„æ˜¯tfstateè·Ÿä½ ç›®å‰è¨ˆåŠƒæœ‰å“ªäº›å·®åˆ¥ã€‚\næ‰€ä»¥ï¼Œéœ€è¦æ›´æ”¹prefix\nbucket = &quot;terraform-devops&quot;\nprefix = &quot;terraform/other&quot;\n\né€™æ¨£åœ¨bucketè£é¢ï¼Œå°±æœƒå­˜æˆå…©å€‹ä¸åŒçš„tfstate\n\nterrafromä½¿ç”¨è¿´åœˆï¼Œæ¸›å°‘é‡è¤‡çš„ç¨‹å¼ç¢¼\n\nå»ºç«‹å…©å€‹bucketï¼Œä¸¦é–‹å•“allUser read\nvariable &quot;bucket_names&quot; {\ntype = list(string)\ndefault = [&quot;A-legacy&quot;, &quot;B-legacy&quot;]\n}\nresource &quot;google_storage_bucket&quot; &quot;frontend_bucket&quot; {\nuniform_bucket_level_access = true\nfor_each = { for name in toset(var.bucket_names) : name =&gt; name }\nname = each.value\nforce_destroy = false\nlocation = &quot;asia-east1&quot;\nstorage_class = &quot;STANDARD&quot;\n# public_access_prevention = &quot;inherited&quot;\n\n//ç‰©ä»¶ç‰ˆæœ¬ç®¡ç†\nversioning {\nenabled = false\n}\n}\nresource &quot;google_storage_bucket_iam_binding&quot; &quot;binding&quot; {\nfor_each = google_storage_bucket.frontend_bucket\n\nbucket = each.value.name\nrole = &quot;roles/storage.legacyObjectReader&quot;\nmembers = [\n&quot;allUsers&quot;,\n]\n}\n\nref.\n\nThe for_each Meta-Argument\nç¦æ­¢å…¬é–‹è¨ªå•\nIAM policy for Cloud Storage Bucket\n\nè®€å–ä¹‹å‰çš„è¨­å®š\n\nåœ¨å»ºç«‹private clusterçš„æ™‚å€™ï¼Œå°±å·²ç¶“å»ºå¥½äº†vpc ï¼Œ\nç›¸åŒçš„ç¶²è·¯ï¼Œæˆ‘æƒ³åœ¨å»ºç«‹mssql æ™‚ä½¿ç”¨ï¼Œ\nä½¿ç”¨dataå‘¼å«é€™å€‹VPCã€‚\né€™å€‹ç¯„ä¾‹æ˜¯æ‹¿ä¾†å»ºç«‹vpcè£é¢çš„ç§äººæœå‹™é€£ç·šçš„ä½ç½®ã€‚\ndata &quot;google_compute_network&quot; &quot;private-network&quot; {\nname = &quot;basic&quot;\n}\n\nresource &quot;google_compute_global_address&quot; &quot;private_ip_address&quot; {\ndepends_on = [ google_project_service.project ]\nname = &quot;private-ip-address&quot;\npurpose = &quot;VPC_PEERING&quot;\naddress_type = &quot;INTERNAL&quot;\nprefix_length = 16\nnetwork = data.google_compute_network.private-network.id\n}\nresource &quot;google_service_networking_connection&quot; &quot;private_vpc_connection&quot; {\n\nnetwork = data.google_compute_network.private-network.id\nservice = &quot;servicenetworking.googleapis.com&quot;\nreserved_peering_ranges = [google_compute_global_address.private_ip_address.name]\n}\n\nè¨­å®š.gitignore\n\n# Local .terraform directories\n**/.terraform/*\n\n# .tfstate files\n*.tfstate\n*.tfstate.*\n\n# Crash log files\ncrash.log\ncrash.*.log\n\n# Exclude all .tfvars files, which are likely to contain sensitive data, such as\n# password, private keys, and other secrets. These should not be part of version\n# control as they are data points which are potentially sensitive and subject\n# to change depending on the environment.\n# *.tfvars\n# *.tfvars.json\n\n# Ignore override files as they are usually used to override resources locally and so\n# are not checked in\noverride.tf\noverride.tf.json\n*_override.tf\n*_override.tf.json\n\n# Include override files you do wish to add to version control using negated pattern\n# !example_override.tf\n\n# Include tfplan files to ignore the plan output of command: terraform plan -out=tfplan\n# example: *tfplan*\n\n# Ignore CLI configuration files\n.terraformrc\nterraform.rc\n\nref. gitignore\nçµå°¾\nåŸºç¤æ¦‚å¿µä»‹ç´¹\n\nTerraformåŸºç¤æ¦‚å¿µâ€”â€”Provider\nGCP-ä½¿ç”¨ Terraform çš„æœ€ä½³å¯¦è¸\nå¤§å®¶éƒ½åœ¨ç”¨ Terraform å¯¦ä½œ IaC ç‚ºä»€éº¼ä¸å°‡ç¨‹å¼å¯«å¾—æ›´ç°¡æ½”æ˜“è®€å‘¢ï¼Ÿ\nLocals",
		"tags": [ "note","âˆ"]
},

{
		"title": "Terraform vs Ansible",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/Terraform/82. Terraform vs Ansible/",
		"content": "å‰è¨€\næœ¬ä¾†æƒ³ç›´æ¥ç”¨è¡¨æ ¼é—¡è¿°å…©é‚Šä¸åŒçš„åœ°æ–¹ï¼Œ\nä½†ç™¼ç¾æˆ‘ä¸çŸ¥é“å¾ä½•ä¸‹æ‰‹ã€‚\nåªå¥½å…ˆç”¨æ¢åˆ—ä»£æ›¿äº†ï¼Œ\né€™å…©å¥—æˆ‘éƒ½æ²’ç”¨éï¼Œå› ç‚º...æˆ‘ç›´æ¥å¾GKEé–‹å§‹XDã€‚\næ­£æ–‡\nTerraform\n\nè²æ˜æ€§ä»£ç¢¼ï¼šç¨‹å¼ç¢¼çš„çµæœå°±æ˜¯æœ€çµ‚ç‹€æ…‹\nå”ä½œ(Orchestration)ï¼šç¢ºä¿ç’°å¢ƒæŒçºŒè™•æ–¼ã€ç†æƒ³ç‹€æ…‹ã€ï¼Œç•¶æœå‹™ä¸èƒ½ç”¨æ™‚ï¼Œæœƒç æ‰é‡å»ºã€‚\n\nAnsible\n\nç¨‹å¼æ€§ä»£ç¢¼ï¼šæ¯ä¸€æ¬¡çš„ç‹€æ…‹éƒ½æ˜¯ç¨ç«‹çš„\né…ç½®ç®¡ç†å·¥å…·(Configuration Management)ï¼š æ˜¯ä¸€å¥—æµç¨‹å’Œç¨‹åºï¼ŒåŸ·è¡Œæ™‚ä¸æœƒé‡ç½®ç³»çµ±ï¼Œæœƒåœ¨æ©Ÿå™¨ä¸Šä¿®å¾©å•é¡Œæˆ–å‡ç´šæœå‹™ã€‚\n\nçµè«–\nç›®å‰çœ‹èµ·ä¾†ï¼Œ\nAnsibleä¸»è¦åå‘è‡ªå‹•åŒ–ç®¡ç†å·¥å…·ä½†åŒæ™‚å…·å‚™ä¸€å®šç¨‹åº¦ä¸Šçš„ç’°å¢ƒã€€å»ºç«‹ã€‚\nTerraform å°±æ˜¯å–®ç´”çš„ ç’°å¢ƒå»ºç«‹å·¥å…·\nå¦‚æœèµ°å‘k8sæœå‹™çš„è©±ï¼Œå­¸TerraFormå°±å¥½äº†ã€‚\nç”¨ä¾†å»ºç«‹clusterã€loadbalancer...ã€‚\nç”±æ–¼ k8sçš„æœå‹™éƒ½å·²ç¶“å®¹å™¨åŒ–äº†ï¼Œä½¿ç”¨Ansibleä¹Ÿæ²’ä»€éº¼æ„ç¾©ï¼Œ\né‡é–‹æœå‹™åˆæ¶ˆå¤±äº†ã€‚\nref.\n\nTerraform vs Ansible: What's the difference and which one you should use?\nAnsible vs Terraform vs Puppetå·®ç•°æ¯”è¼ƒï¼šæœ‰ä»€éº¼å€åˆ¥ï¼Ÿé¸æ“‡å“ªå€‹ï¼Ÿ\næ¶æ§‹ç¨‹å¼ç¢¼çš„å¯¦æ–½å·¥å…·\n[DevOpsç³»åˆ—] ç‚ºä»€éº¼æˆ‘å€‘ä½¿ç”¨Terraform è€Œä¸ä½¿ç”¨Puppet, Ansible\nTerraform vs. Ansible : Key Differences and Comparison of Toolsï¼Œæ„Ÿè¦ºé€™ç¯‡å¯«çš„æœ€å¥½ï¼Œä½†çµè«–å°±...",
		"tags": [ "note","âˆ"]
},

{
		"title": "k8s YAML å°ç´°ç¯€",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/Yaml/12. k8s YAML å°ç´°ç¯€/",
		"content": "å‰è¨€\næœ€è¿‘å¯«yamlï¼Œæœ‰æ™‚å¸¸æœƒå¿˜è¨˜é€™å€‹çš„åŠŸèƒ½æ˜¯ä»€éº¼ï¼Œå°±è¨˜ä¸€ä¸‹å§\næ­£æ–‡\n\nService çš„PortåŠŸèƒ½\nPort exposes the Kubernetes service on the specified port within the cluster. Other pods within the cluster can communicate with this server on the specified port.\n\nTargetPort is the port on which the service will send requests to, that your pod will be listening on. Your application in the container will need to be listening on this port also.\nNodePort exposes a service externally to the cluster by means of the target nodes IP address and the NodePort. NodePort is the default setting if the port field is not specified.\n\næ¢é‡æª¢æŸ¥\n\nlivenessProbe:\ninitialDelaySeconds: 10\nperiodSeconds: 10\nsuccessThreshold: 1\nfailureThreshold: 3\ntcpSocket:\nport: 80\nreadinessProbe:\ninitialDelaySeconds: 30\nperiodSeconds: 10\nsuccessThreshold: 1\nfailureThreshold: 3\ntcpSocket:\nport: 80\n\npull image èªè­‰\nå¦‚æœè¦ä½ˆç½²çš„imageæ˜¯å±¬æ–¼ ç§å¯†çš„ï¼Œ\néœ€è¦åŠ ä¸Š\n\nimagePullSecrets:\n- name: regcred\n\nè¦å…ˆæ³¨å…¥Secred\nkubectl create secret generic regcred --from-file=./username.txt\n\nService æœå‹™é¡å‹\n\nClusterIP\n\nä¸€å€‹é›†ç¾¤å…§çš„æœå‹™ï¼Œé›†ç¾¤å…§çš„å…¶å®ƒæ‡‰ç”¨éƒ½å¯ä»¥è¨ªå•è©²æœå‹™ã€‚é›†ç¾¤å¤–éƒ¨ç„¡æ³•è¨ªå•å®ƒã€‚ é€™ä¹Ÿæ˜¯é»˜èªçš„ ServiceTypeã€‚\nå¯ä»¥ä½¿ç”¨proxy çš„æœ¬æ©Ÿ portè½‰ç§»ï¼Œä¾†è¨ªå•æœå‹™ã€‚åƒ (Fig.1)\n[[12.fig-1.jpg]]\n\nNodePort\n\nåœ¨æ‰€æœ‰ç¯€é»ï¼ˆè™›æ“¬æ©Ÿï¼‰ä¸Šé–‹æ”¾ä¸€å€‹ç‰¹å®šç«¯å£ï¼Œä»»ä½•ç™¼é€åˆ°è©²ç«¯å£çš„æµé‡éƒ½è¢«è½‰ç™¼åˆ°å°æ‡‰æœå‹™ã€‚\nåœ¨ 1 çš„service portï¼Œå°±æ˜¯æŒ‡é€™å€‹éƒ¨åˆ†ã€‚\néœ€ä½¿ç”¨K8sçš„å¢é›†ä¸»æ©ŸåŠ ä¸Športï¼Œå»è¨ªå•æœå‹™ã€‚ (Fig.2)\n[[12.fig-2.jpg]]\n\nLoadBalancer\n\nLoadBalancer æœå‹™æ˜¯æš´éœ²æœå‹™åˆ° internet çš„æ¨™æº–æ–¹å¼ã€‚åœ¨ GKE ä¸Šï¼Œé€™ç¨®æ–¹å¼æœƒå•Ÿå‹•ä¸€å€‹ Network Load Balancerï¼Œå®ƒå°‡çµ¦ä½ ä¸€å€‹å–®ç¨çš„ IP åœ°å€ï¼Œè½‰ç™¼æ‰€æœ‰æµé‡åˆ°ä½ çš„æœå‹™ã€‚\nä¸€å€‹å¤–éƒ¨ipï¼Œç›´æ¥è¨ªå•å³å¯ï¼Œæœ‰æ™‚éœ€æ³¨æ„é˜²ç«ç‰†æœ‰æ²’æœ‰æ“‹ä½ã€‚\n\nref.\nKubernetesçš„ä¸‰ç¨®å¤–éƒ¨è¨ªå•æ–¹å¼ï¼šNodePortã€LoadBalancer å’Œ Ingress\nKubernetes æœå‹™\n\nkube dns\n\nPod DNS record\n[[12.fig-3.jpg]]\n172-17-0-6.default.pod.cluster.local\n\n172-17-0-6: Pod IP\ndefault: Namespace Name\n\nService DNS record\n[[12.fig-4.jpg]]\nnginx.default.svc.cluster.local\n\nnginx: Service Name\ndefault: Namespace Name\n\nService Discovery\n[[12.fig-5.jpg]]\nweb-0.nginx.default.svc.cluster.local\n\nweb-0: Pod Name\nnginx: Service Name\ndefault: Namespace Name\n\nAuto Scalingï¼ˆè‡ªå‹•æ“´å±•ï¼‰\nåœ¨Auto Scaling è£¡é¢ï¼Œæœ‰ä¸€å€‹è¨­å®šæ˜¯æ ¹æ“šcpuçš„ä½¿ç”¨é‡å¤§å°å»å¢åŠ Podï¼Œ\nå‡è¨­\ntargetCPUUtilizationPercentage:10\nåœ¨deploy è£¡çš„request CPU è¨­å®š 200m\nè¡¨ç¤ºï¼Œç•¶cpuçš„ä½¿ç”¨ç‡åœ¨ 20m(200m * 10% = 20m )æ™‚ï¼Œæœƒè‡ªå‹•æ“´å±•\n\nå¦‚æœè¦ä½¿ç”¨å…¶ä»–çš„æŒ‡æ¨™ï¼Œapi éœ€æ”¹ç”¨ autoscaling/v2beta2\né€™é‚Šé‚„æ²’æ¸¬è©¦éï¼Œæœ‰éœ€è¦çš„å¯è‡³ç›¸é—œç¶²é æŸ¥è©¢\nref.\nKubernetes é‚£äº›äº‹ â€” Auto Scaling\nKubernetes--k8s--é€²éš--å…¨é¢ç­è§£HPA--éƒ¨ç½²HPAå¯¦ç¾é«˜å¯ç”¨å’Œæˆæœ¬æ§åˆ¶\nKubernetes 1.8: Now with 100% Daily Value of Custom Metrics",
		"tags": [ "note","âˆ"]
},

{
		"title": "ä¸€æ­¥æ­¥ç¯©é¸k8sçš„deployå…§å®¹",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/Yaml/136. ä¸€æ­¥æ­¥ç¯©é¸k8sçš„deployå…§å®¹/",
		"content": "ç¡ç¡å¿µ\nè¦æŠ“ä¸€ä¸‹ï¼Œç›®å‰ingressè£é¢çš„æ‰€æœ‰ç™½åå–®è³‡è¨Šï¼Œ\nä½†ä¸€å€‹ä¸€å€‹é–‹èµ·ä¾†çœ‹åˆå¾ˆéº»ç…©ï¼Œ\nå°±å¯«code filterå§\næ­£æ–‡\n\nå…ˆå–å¾—jsonï¼Œå…ˆæŒ‡å®šä¸€å€‹æœå‹™ï¼Œä¸ç„¶æœƒå¤ªäº‚\n\nkubectl get ingress websocketclient -o json\n\nç„¶å¾Œé–‹å§‹çœ‹json æ ¼å¼é–‹å§‹æ‹†è§£ï¼Œé€™æ¬¡ç›®çš„æ˜¯è¦å–å¾—\nnginx.ingress.kubernetes.io/whitelist-source-rangeçš„å€¼ï¼Œ\né€™é‚Šæœƒç¢°åˆ°ä¸€å€‹å•é¡Œï¼Œå› ç‚ºæœ‰ç‰¹æ®Šç¬¦è™Ÿ . è·Ÿ / ï¼Œæ‰€ä»¥è¦ç”¨ \\ ï¼Œå°‡å®ƒè¦–çˆ²ä¸€å€‹æ•´é«”ã€‚\n\nkubectl get ingress -n default -o=jsonpath='{range .items[*]}{&quot;\\n&quot;}{.metadata.name}{&quot;\\t&quot;}{.metadata.annotations.nginx\\.ingress\\.kubernetes\\.io\\/whitelist-source-range}{end}'\n\nref.\n\nJSONPath Support\nExtract information of kubernetes annotations with jsonpath",
		"tags": [ "note","âˆ"]
},

{
		"title": "k8s yamlæ’°å¯« volume è¸©å‘ç¯‡",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/Yaml/2. k8s yamlæ’°å¯« volume è¸©å‘ç¯‡/",
		"content": "å‰è¨€\næ˜¨å¤©æ¥åˆ°ä¸€å€‹ä»»å‹™ï¼Œè¦æŠŠä¸€å€‹ç´”htmlï¼Œæ”¾åˆ°nginxä¸Šé¢ã€‚\nç„¶å¾Œå°±é–‹å§‹è¸©å‘ä¹‹æ—…äº†\næ­£æ–‡\né€™é‚Šå¯«çš„éƒ½æ˜¯GKE çš„ä½ˆç½²æ–¹å¼ï¼Œ\né—œæ–¼GKE æ–‡ç« å¯¦åœ¨å¤ªå¤šäº†ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä½•å¹´ä½•æœˆä½•æ—¥æ‰æœ‰é‚£å€‹æŠ€è¡“å­˜é‡å¯ä»¥æŠŠå®ƒå¯«æˆæ–‡ç« ã€‚\nç›®å‰ä½¿ç”¨çš„æ˜¯ kustomizeçš„æ–¹å¼ä½ˆç½²ç¶²ç«™ï¼Œ\nç›®å‰ä¹Ÿåœ¨æ¶è¨­droneï¼Œæ—¥å¾Œèµ°çš„æ˜¯è‡ªå‹•ä½ˆç½²ï¼Œ\nä½†æ˜¯ç¬¬ä¸€æ¬¡ä½ˆç½²é‚„æ˜¯è¦è‡ªå·±ä¾†çš„ã€‚\nåŸºæœ¬çš„æµç¨‹æ˜¯ï¼Œå°‡ç¶²é åŒ…æˆä¸€å€‹ docker imageï¼Œ\n(ä¸è«–æ˜¯php æˆ–æ˜¯ htmlï¼Œ Go å‰‡æ˜¯æœ¬èº«æœ‰æœå‹™å¯ä»¥æ›è¼‰ï¼Œæ¯”è¼ƒç°¡å–®é»ã€‚)\nå†å°‡æ­¤imageè¨­å®šæˆ initContainers ï¼Œ\nå°‡æ­¤imageçš„è³‡æ–™å¤¾ï¼Œæ›è¼‰æˆvolumeï¼Œè®“nginxå¯ä»¥ç›´æ¥æ›è¼‰æ­¤è³‡æ–™å¤¾ã€‚\né€™æ¬¡è¸©çš„å‘æœ‰å…©å€‹ï¼Œ\n\nç¶²ç«™ç¨‹å¼ï¼Œæ˜¯åˆ¥äººå‚³çµ¦æˆ‘çš„ï¼Œæ‰€ä»¥æª”æ¡ˆæ¬Šé™ï¼Œeveryoneéƒ½æ˜¯ ç„¡æ³•å­˜å–ã€‚\næ‰€ä»¥è¦æŠŠè£¡é¢çš„æ‰€æœ‰æª”æ¡ˆæ”¹æˆ 755 rwxr-xr-x ï¼Œnginxåœ–ç‰‡æ‰èƒ½å¤ è®€å–ã€‚\næˆ‘æ‡¶çš„ä¸€å€‹ä¸€å€‹æ”¹ï¼Œæ‰€ä»¥ä¸‹æŒ‡ä»¤ä¸€æ¬¡æŠŠæ•´å€‹è³‡æ–™å¤¾å…§å®¹éƒ½æ”¹æ‰ï¼Œç•¶åˆå®‰å…¨é»æ˜¯è¨­å®š777\n\nchmod -R 755 resource\n\n(ref. https://www.jianshu.com/p/6c52260b1ff3)\n\nåœ¨å¯«yamlçš„æ™‚å€™ï¼Œæ²’æœ‰ææ¸…æ¥š volumeçš„ç”¨é€”\nå°è‡´ä¸€ç›´å‡ºç¾rsyncçš„éŒ¯èª¤ã€‚\n\ninitContainers:\n- command:\n- sh\n- -c\n- |\nrsync -avrh --delete /source/* /app\nimage: gcr.io/project/busybox-web:v2.7\nimagePullPolicy: Always\nname: source\nvolumeMounts:\n- mountPath: /app\nname: source\nvolumes:\n- emptyDir: {}\nname: source\n\nvolumeMounts: é€™æ®µçš„æ„æ€æ˜¯ å®šç¾©ä¸€å€‹å« soureçš„æ–°ç£å€ï¼Œæ›è¼‰åœ¨ busybox-webå®¹å™¨è£¡çš„ /app çš„pathä¸Šé¢ã€‚\nvolumes: çš„æ„æ€æ˜¯å®šç¾©ç£ç¢Ÿå€ï¼ŒemptyDiræ˜¯ä¼´éš¨è‘—podçš„ç”Ÿå‘½ï¼Œç•¶podæ¶ˆå¤±è³‡æ–™ä¹Ÿæœƒè·Ÿè‘—æ¶ˆå¤±\n\nnginx.conf æ”¹å®Œå¾Œï¼Œè¦é‡å•Ÿpod ï¼Œå› ç‚ºnginx.conf æ˜¯å¯«åœ¨ k8sçš„ configMapGeneratorï¼Œ\næ‰€ä»¥æ›´æ”¹è£¡é¢çš„è¨­å®šå¾Œï¼Œä¸æœƒé‡å•Ÿpod ï¼Œè£¡é¢çš„æœå‹™å°±ä¸æœƒé‡æ–°æŠ“å–confã€‚",
		"tags": [ "note","âˆ"]
},

{
		"title": "kubernetes æ‰¹æ¬¡æª¢æŸ¥yamlç‰¹å®šå­—å…ƒ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/Yaml/74. kubernetes æ‰¹æ¬¡æª¢æŸ¥yamlç‰¹å®šå­—å…ƒ/",
		"content": "å‰è¨€\nå› ç‚ºdockershimçš„å•é¡Œï¼Œ\né€™æ¬¡è¦æ¬clusterçš„nodeäº†ã€‚\nä½†æˆ‘æ ¹æœ¬å¿˜è¨˜æœ‰å“ªå€‹yamlæœ‰å¯«åˆ° nodeSelectoräº†ï¼Œ\nä¸€å€‹ä¸€å€‹çœ‹åˆå¥½æ‡¶...æ€éº¼è¾¦ï¼Ÿ\næ­£æ–‡\næƒ³èµ·ä¾†ä¹‹å‰åœ¨æª¢æŸ¥ docker.sockçš„æ™‚å€™ï¼Œæœ‰ç”¨æŒ‡ä»¤æª¢æŸ¥éé€™å€‹yaml (1)è£¡é¢ï¼Œ\næœ‰æ²’æœ‰ /docker.sock\nkubectl get pods --all-namespaces \\\n-o=jsonpath='{range .items[*]}{&quot;\\n&quot;}{.metadata.namespace}{&quot;:\\t&quot;}{.metadata.name}{&quot;:\\t&quot;}{range .spec.volumes[*]}{.hostPath.path}{&quot;, &quot;}{end}{end}' \\\n| sort \\\n| grep '/var/run/docker.sock'\n\né€™æ®µæœ€å¾Œé¢å…©å€‹å°±ä¸ç”¨çœ‹äº†ï¼Œsort è·Ÿ grep æ˜¯ linuxçš„æŒ‡ä»¤ã€‚\nä¸»è¦é‡å° -o jsonpath ä¾†çœ‹ï¼Œè©³ç´°æŒ‡ä»¤ã€€ åƒè€ƒ(2)\nç•¶è¦å–å¾—è¤‡æ•¸è³‡æ–™æ™‚ï¼Œç”¨ range ä¾†å–è³‡æ–™ã€‚\nç„¶å¾Œ...åƒè€ƒ podçš„yamlçœ‹è¦å–å¾—å“ªäº›æ¬„ä½ä¾†ç”¨å§ã€‚\nä¸‹é¢ç¯„ä¾‹ç‚ºå–å¾— å…¨éƒ¨çš„ nodeSelectord\nkubectl get pods -Aã€€ \\\n-o=jsonpath='{range .items[*]}{&quot;\\n&quot;}{.metadata.namespace}{&quot;:\\t&quot;}{.metadata.name}{&quot;:\\t&quot;}{.spec.nodeSelector}{end}'\n\nå†æ’åºä¸€ä¸‹ï¼Œå°±å¯ä»¥å¾ˆå¿«çš„çŸ¥é“æœ‰å“ªäº›yamlæœ‰ç”¨åˆ° nodeSelectoräº†ã€‚\nref.\n1. å¾ dockershim é·ç§»é™æ¸¬å’Œå®‰å…¨ä»£ç†\n2. JSONpath å¹«åŠ©",
		"tags": [ "note","âˆ"]
},

{
		"title": "gke-cronjobç­†è¨˜",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/Yaml/85. gke-cronjobç­†è¨˜/",
		"content": "å‰è¨€\nä¹‹å‰åŒäº‹æ˜¯ç›´æ¥è‡ªå·±åœŸç‚®ç”¨golangå¯«timerï¼Œ\nä¸éå¦‚æœç¢°åˆ°åŸ·è¡Œæ™‚é–“éé•·ï¼Œé‡è¤‡åŸ·è¡Œçš„è©±ï¼Œ\nå°±è¦åˆ¤æ–·ä¸€å †ç‹€æ…‹ï¼Œæ±ºå®šè¦ä¸è¦åšï¼Œ\né‚£å°±æ”¹ç”¨k8sçš„cronJobäº†å§ã€‚\næ­£æ–‡\næ–‡ä»¶çœ‹ä¸€çœ‹(1) (2)ï¼Œå¥½åƒå°±å·®ä¸å¤šäº†ã€‚\nä¸‹é¢æ˜¯æ¸¬è©¦ï¼Œæ¯å…©åˆ†é˜åŸ·è¡Œä¸€æ¬¡ï¼Œ\nä½†å¦‚æœåŸ·è¡Œæ™‚é–“éé•·ï¼Œæ˜¯ä¸æ˜¯æœƒåœ¨åŸ·è¡Œã€‚\né€™é‚Šé—œæ‰çš„æ˜¯ä½µç™¼ä»¥åŠ æš«åœå¾ŒçºŒåŸ·è¡Œï¼Œ\nå¦å¤–æ³¨æ„ï¼Œgcpçš„cronjobæ˜¯æ¯10ç§’æª¢æŸ¥ä¸€æ¬¡ç‹€æ…‹ã€‚\napiVersion: batch/v1beta1 # k8s after version 1.21 ,apiVersion: batch/v1\nkind: CronJob\nmetadata:\nname: hello\nspec:\nschedule: &quot;*/2 * * * *&quot; # min hour day Mon week\nconcurrencyPolicy: Forbid # ä¸¦ç™¼æ”¿ç­–\nstartingDeadlineSeconds: 60 # æˆªæ­¢æ™‚é™\nsuspend: true # æš«åœå¾ŒçºŒåŸ·è¡Œ\nsuccessfulJobsHistoryLimit: 3 # æ­·å²é™åˆ¶: ä¿å­˜æˆåŠŸçš„æ•¸é‡\nfailedJobsHistoryLimit: 1 # æ­·å²é™åˆ¶ï¼š ä¿å­˜å¤±æ•—çš„æ•¸é‡\njobTemplate:\nspec:\ntemplate:\nspec:\ncontainers:\n- name: hello\nimage: busybox\nargs:\n- /bin/sh\n- -c\n- echo &quot;start&quot;; date; echo &quot;Hello, World! Sleep 150s&quot;; sleep 150s; date;\nrestartPolicy: OnFailure\n\nref.\n1. GCP-CronJob\n2. k8s-CronJob",
		"tags": [ "note","âˆ"]
},

{
		"title": "kustomize å…±ç”¨label(optionalï¼‰",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/Yaml/87.kustomize å…±ç”¨label(optionalï¼‰/",
		"content": "å‰è¨€\nè¦æŠŠåˆ¥äººå¯«çš„yamlæ‹†é–‹ï¼Œç„¶å¾Œæ•´ä½µåˆ°è‡ªå·±çš„imageï¼Œ\næ‰ç™¼ç¾serviceçš„ base æ€éº¼æ²’å¯«selector ï¼Œ\nä½†ä½ˆç½²æ™‚å»æœ‰mappingåˆ°ã€‚\næ­£æ–‡\nåŸå› åœ¨kustomizeçš„ å…±ç”¨å±¬æ€§\ncommonLabels:\napp: token-proxy\n\né€™å€‹æœƒè‡ªå‹•åœ¨å„å€‹resourceä¸Šé¢å¢åŠ labelï¼Œ\nå¦‚æœé€™é‚Šæ‹”æ‰çš„è©±ï¼Œ\néœ€è¦åœ¨Deploymentä»¥åŠserviceä¸Šé¢å¢åŠ labelã€‚\nä½†åœ¨ä¸€äº›æ–‡ç« ä¹Ÿæœ‰äººè¨è«–åˆ°é€™å€‹å•é¡Œï¼Œ\nå¦‚æœæˆ‘ä¸è¦è®“ä»–å¼·åˆ¶å¢åŠ çš„è©±ï¼Œ\nè©²æ€éº¼åšï¼Ÿ\nkustomizeæœ‰æ–°çš„åƒæ•¸å¯ä¾›è¨­å®š(1)ã€‚\ncommonLabels:\n- path: metadata/labels\ncreate: true\n\n- path: spec/selector\ncreate: true\nversion: v1\nkind: Service\n\n- path: spec/selector/matchLabels\ncreate: true\nkind: Deployment\n\nå¦å¤–ï¼Œé‚„æœ‰ ä¸‹åˆ—æ–°å¢çš„å¯ä¾›åƒè€ƒã€‚\n\nannotations\nimages\nlabels\nname reference\nnamespace\nprefix/suffix\nvariable reference\n\nref.\n1 .transformerconfigs",
		"tags": [ "note","âˆ"]
},

{
		"title": "k8s ç´°ç¯€è£œå……",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/Yaml/94. k8s ç´°ç¯€è£œå……/",
		"content": "å‰è¨€\næœ€è¿‘å¹«å…¶ä»–çµ„çš„åŒäº‹çœ‹å•é¡Œæ™‚ï¼Œ\nç™¼ç¾æœ‰äº›æ±è¥¿æ˜¯æˆ‘æ²’çœ‹éçš„ï¼Œ\nå°±æ•´åˆå†ä¸€èµ·ï¼Œå¯«èµ·ä¾†ç•¶å‚™å¿˜æ‹‰ã€‚\næ­£æ–‡\n\ndeployment çš„ lifecycle\npostStart åœ¨containerå‰µå»ºå¾Œï¼Œç«‹å³ç™¼é€postStartäº‹ä»¶ã€‚\npreStop åœ¨ containerçµæŸå‰ï¼Œç«‹å³ç™¼é€preStopäº‹ä»¶ã€‚\n\napiVersion: v1\nkind: Pod\nmetadata:\nname: lifecycle-demo\nspec:\ncontainers:\n- name: lifecycle-demo-container\nimage: nginx\nlifecycle:\npostStart:\nexec:\ncommand: [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;echo Hello from the postStart handler &gt; /usr/share/message&quot;]\npreStop:\nexec:\ncommand: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;nginx -s quit; while killall -0 nginx; do sleep 1; done&quot;]\n\nref. ç‚ºå®¹å™¨çš„ç”Ÿå‘½é€±æœŸäº‹ä»¶è¨­ç½®è™•ç†å‡½æ•¸\n\npodçš„çµ‚æ­¢\né€šå¸¸æƒ…æ³ä¸‹ï¼Œcontaineræœƒç™¼é€TERMä¿¡è™Ÿåˆ°æ¯å€‹containerä¸­ï¼Œ\nç•¶è¶…å‡ºäº†æ­£å¸¸çµ‚æ­¢æœŸé™ï¼Œå‰‡æœƒå‘å…¶ä»–çš„processorç™¼é€KILLä¿¡è™Ÿ\nref. Pod çš„çµ‚æ­¢\n\næ¢é‡\nlivenessProbe ï¼šåˆ¤æ–·containeræ˜¯å¦æ­£å¸¸\nreadinessProbeï¼šåˆ¤æ–·æœå‹™æ˜¯å¦æ­£å¸¸\n\næŸ¥è©¢kubectl resouce ç°¡å¯«\n\nkubectl api-resources\n\né¡ä¼¼ä¸‹åˆ—è³‡æºéƒ½å¯ç”¨ç¸®å¯«\nconfigmap = cm\ndeployment=deploy\npod = po\npersistentvolumeclaims = pvc\nref .ã€å¾é¡Œç›®ä¸­å­¸ç¿’k8sã€‘-ã€Day8ã€‘K8så¸¸ç”¨æŒ‡ä»¤ (Cheat Sheet)&amp;è§£é¡ŒæŠ€å·§\n\nk8sçš„ command ï¼Œbash -c æ„æ€\n\ncommand: [&quot;/bin/bash&quot;,&quot;-c&quot;]\nargs: [ &quot;service cron start; while true; do sleep 30; done;&quot; ]\n\nå¾ˆå¸¸çœ‹åˆ° bash -c ï¼Œé€™å€‹è¡¨ç¤ºå¾å¾Œé¢çš„å­—ä¸²ä¸­ è®€å–å‘½ä»¤ä¾†ä½¿ç”¨ã€‚\nps. bash è·Ÿ sh ä¸ä¸€æ¨£ï¼Œshé€šå¸¸æ˜¯æŒ‡dashã€‚\nå¯ç”¨ä¸‹åˆ—æŒ‡ä»¤ï¼ŒæŸ¥çœ‹ç›®å‰ä½¿ç”¨çš„shell\necho $SHELL\nor\nls -l /bin/sh\n\nref.\n- The bash shell\n- ã€Bashã€‘ä»€éº¼æ˜¯ #!/bin/bash, #!/bin/shï¼Œç‚ºä»€éº¼è¦åŠ åœ¨ script å‰é¢ (å•é¡Œè§£æ±ºï¼šsh, bash çš„ä¸åŒ)\n\nä½¿ç”¨æŒ‡ä»¤å»ºç«‹åŸºæœ¬çš„ yaml\n\nkubectl run nginx-kusc00101 --image=nginx --restart=Never --dry-run=client -o yaml&gt; q1.pod\n\næœ‰åŸºæœ¬æŒ‡ä»¤å¾Œå†å»è£¡é¢ä¿®ä¿®æ”¹æ”¹ã€‚\nå¦‚æœè¦ç›´æ¥å–å¾—ç¾æœ‰çš„yaml\nkubectl get deploy yiyuan-landingpage-qa -n istio-yiyuan -o yaml &gt; yiyuan.yaml",
		"tags": [ "note","âˆ"]
},

{
		"title": "k8sä¸­çš„commandèˆ‡dockerfileçš„ CMD",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/âˆ k8s/Yaml/98. k8sä¸­çš„commandèˆ‡dockerfileçš„ CMD/",
		"content": "å‰è¨€\nå¿˜è¨˜æ˜¯ä»€éº¼åŸå› ï¼Œ\nè®“æˆ‘è·‘å»æŸ¥é€™å…©å€‹çš„å·®ç•°\næ­£æ–‡\ndockerfileä¸­çš„æŒ‡ä»¤\nCMD ã€ ENTRYPOINT\nk8s ä¸­çš„yaml ä¸­ä¹Ÿæœ‰\ncommand ã€args\nå…ˆä¾†åˆ†è¾¨ CMD èˆ‡ ENTRYPOINTçš„å·®åˆ¥\nCMD\nå…ˆä¸Šå€‹Dockerfile\nFROM golang:1.16-alpine AS build-env\n\nCMD [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;echo $HOME&quot;]\n\né€™å€‹buildå®Œå¾Œï¼Œç›´æ¥åŸ·è¡Œæœƒé¡¯ç¤º /rootï¼Œå¦‚æœç”¨\ndocker run golang:1.16 /bin/sh -c &quot;echo $SHELL&quot;\n\nï¼Œæœƒç›´æ¥åŸ·è¡Œå‰›å‰›çš„æŒ‡ä»¤ã€‚\nåŸå› æ˜¯ï¼ŒCMD è·Ÿ å¤–é¢æ¥å—çš„æŒ‡ä»¤æœƒäº’ç›¸è¦†è“‹ã€‚\n\nENTRYPOINT\nDockerfile\nFROM golang:1.16-alpine AS build-env\n\nENTRYPOINT [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;echo $HOME&quot;]\n\nåŒæ¨£ä¹Ÿç›´æ¥åŸ·è¡Œæœƒé¡¯ç¤º /root ï¼Œ\nå¦‚æœç”¨\ndocker run golang:1.17 /bin/sh -c &quot;echo $SHELL&quot;\n\né‚„æ˜¯é¡¯ç¤º /root\nåŸå› æ˜¯ï¼Œä½¿ç”¨entrypointçš„è©±ï¼ŒæŒ‡ä»¤ä¸æœƒäº’ç›¸è¦†è“‹ã€‚\nåè€Œæ˜¯è¢«ç•¶æˆåƒæ•¸åŠ åœ¨å¾Œé¢ã€‚\nref. Docker CMD èˆ‡ ENTRYPOINT èªªæ˜è©³è§£\nå…©è€…äº’å‹•è¡¨\n\nNo ENTRYPOINT\nENTRYPOINT exec_entry p1_entry\nENTRYPOINT [â€œexec_entryâ€, â€œp1_entryâ€]\n\nNo CMD\nerror, not allowed\n/bin/sh -c exec_entry p1_entry\nexec_entry p1_entry\n\nCMD [â€œexec_cmdâ€, â€œp1_cmdâ€]\nexec_cmd p1_cmd\n/bin/sh -c exec_entry p1_entry\nexec_entry p1_entry exec_cmd p1_cmd\n\nCMD exec_cmd p1_cmd\n/bin/sh -c exec_cmd p1_cmd\n/bin/sh -c exec_entry p1_entry\nexec_entry p1_entry /bin/sh -c exec_cmd p1_cmd\n\nref.\n\nUnderstand how CMD and ENTRYPOINT interact\nDocker CMD èˆ‡ ENTRYPOINT èªªæ˜è©³è§£\n\nK8S yaml command\nä½ˆç½²å€‹cronJobä¾†æ¸¬è©¦\né€™æ¬¡æ›è¼‰çš„æ˜ åƒæª”æ˜¯ä½¿ç”¨ dockerfileã€commandã€çš„æ˜ åƒæª”\nè·Ÿä¸Šé¢æ¸¬è©¦æ–¹æ³•ä¸€æ¨£ï¼Œå…ˆä¸åŠ commandçœ‹çµæœæ˜¯ä»€éº¼\nåŠ äº†å¾Œçµæœåˆæœƒæ˜¯ä»€éº¼ã€‚\nspec:\ncontainers:\n- command:\n- /bin/sh\n- -c\n- echo $PATH\n\n11:57 é‚£å€‹æ²’æœ‰åŠ commandï¼Œæ‰€ä»¥æœƒçœ‹åˆ°é¡¯ç¤ºroot\n12:03 åŠ äº†ä¸Šé¢çš„commandï¼ŒæŒ‡ä»¤è¦†è“‹ï¼Œæ‰€ä»¥é¡¯ç¤º$PATHçš„å…§å®¹\np.s å¦‚æœä¸ç”¨commandæ”¹ç”¨argsï¼ŒæŒ‡ä»¤è¦†è“‹ã€‚\nK8S yaml args\né€™æ¬¡æ›è¼‰çš„æ˜ åƒæª”æ˜¯ä½¿ç”¨ dockerfileã€ENTRYPOINTã€çš„æ˜ åƒæª”\nspec:\ncontainers:\n- args:\n- /bin/sh\n- -c\n- echo $PATH\n\n13:44 ä¸åŠ ä»»ä½•åƒæ•¸ï¼Œé¡¯ç¤º /root\n13:45 åŠ äº†argsï¼Œé‚„æ˜¯é¡¯ç¤º/rootï¼ŒæŒ‡ä»¤ç„¡è¦†è“‹\nargsçš„ä¸»è¦ç”¨é€”æ˜¯ï¼Œç•¶dockerfile ç‚º ENTRYPOINTæ™‚ï¼Œ\nä½¿ç”¨argsæœƒå°‡å…¶è¦–çˆ²åƒæ•¸å‚³å…¥åˆ°imageå…§ã€‚\nps. å¦‚æœæ”¹ä½¿ç”¨ command ï¼Œå‰‡è¦†è“‹\nref. k8s command, args, entrypoint, cmd å€åˆ¥\nçµè«–\nDocker\nENTRYPOINT ä¸»è¦æ˜¯å°‡æ•´å€‹containerç•¶åšå¯åŸ·è¡Œæª”ä¾†ç”¨ã€‚\nCMD å‰‡æ¯”è¼ƒé¡ä¼¼ä¸€å°VM\nK8S\ncommand ï¼š æŒ‡ä»¤éƒ½æ˜¯è¦†è“‹\nargs ï¼š å¤–åŠ çš„åƒæ•¸ï¼Œå¯èˆ‡commandä¸€èµ·ä½¿ç”¨ï¼Œ\nspec:\ncontainers:\n- args:\n- -a\ncommand:\n- /bin/sh\n- -c\n- uname",
		"tags": [ "note","âˆ"]
},

{
		"title": " â± Drone MOC  ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â± Drone/0.Drone MOC/",
		"content": "å»ºç½®\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â± Drone/72. drone on GKE å»ºç«‹/\">72. drone on GKE å»ºç«‹</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â± Drone/10.drone ä½¿ç”¨ é¨°è¨Šé›² K8SåŠ å®¹å™¨é¡åƒæœå‹™/\">10.drone ä½¿ç”¨ é¨°è¨Šé›² K8SåŠ å®¹å™¨é¡åƒæœå‹™</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â± Drone/77. drone build Open Source Edition/\">77. drone build Open Source Edition</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â± Drone/78. drone k8s-runner é€²éšè¨­å®š/\">78. drone k8s-runner é€²éšè¨­å®š</a>\n\nç·¨å¯«\n\n<a class=\"internal-link is-unresolved\" href=\"/404\">3. æ’°å¯«drone.yml ç­†è¨˜ç¯‡</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â± Drone/109. drone jsonnet å„ç¨®æ€ªæ‹›/\">109. drone jsonnet å„ç¨®æ€ªæ‹›</a>\n<a class=\"internal-link is-unresolved\" href=\"/404\">119. Drone plugin-Drone-docker ä¿®æ”¹åŸå§‹æª”</a>",
		"tags": [ "note","â±"]
},

{
		"title": "drone ä½¿ç”¨ é¨°è¨Šé›² K8SåŠ å®¹å™¨é¡åƒæœå‹™",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â± Drone/10.drone ä½¿ç”¨ é¨°è¨Šé›² K8SåŠ å®¹å™¨é¡åƒæœå‹™/",
		"content": "å‰è¨€\nç§‘æŠ€å§‹çµ‚ä¾†è‡ªæ–¼äººæ€§ï¼Œç¾åœ¨è¦è®“è‡ªå‹•ä½ˆç½²å¯ä»¥æ”¯æ´åˆ°é¨°è¨Šé›²\næ­£æ–‡\n1.ç™¼ä½ˆimageåˆ°é¨°è¨Šé›²çš„å®¹å™¨é¡åƒæœå‹™\nç›´æ¥å…ˆçµ¦ drone.yml\n- name: push2TCR\nimage: plugins/docker\nsettings:\nusername:\nfrom_secret: TCR_user\npassword:\nfrom_secret: TCR_PW\nbuild_args:\n- website=qa\n- location=tke\nrepo: tcr.tencentcloudcr.com/project/abc\nregistry: tcr.tencentcloudcr.com\ntags:\n- latest\n- ${DRONE_COMMIT}\n\né€™é‚Šä½¿ç”¨çš„docker image è«‹åƒè€ƒ Docker\nè¦æ³¨æ„çš„åœ°æ–¹åœ¨ï¼Œå¦‚æœç›´æ¥æŠŠusernameè·Ÿ password æ‰“åœ¨ä¸Šé¢çš„è©±ï¼Œ\næœƒç™¼ç”Ÿé©—è­‰å¤±æ•—ã€‚\néœ€è¦å°‡å¸³è™Ÿå¯†ç¢¼æ”¾åˆ°droneè£¡é¢çš„ Secretsï¼Œ\nä¸€é–‹å§‹ä¹Ÿå¯ä»¥ä½¿ç”¨ command ç›´æ¥çœ‹æœ‰æ²’æœ‰æˆåŠŸç™»å…¥ã€‚\n- name: push2TCR\nimage: plugins/docker\ncommands:\n- docker login tcr.tencentcloudcr.com --username 123456789 --password token\n\nå¦å¤–ï¼Œç•¶åˆåœ¨è¨­å®šçš„æ™‚å€™ï¼Œæœ‰é™å®šipæ‰èƒ½é€£ç·šï¼Œé€™éƒ¨åˆ†è¨˜å¾—è¦æ‰“é–‹\nï¼Œå¦‚æœæ²’æœ‰å°±ä¸ç”¨åœ¨æ„äº†ã€‚\n\n2.ä½ˆç½²åˆ°é¨°è¨Šé›²\nkind: pipeline\nname: TKEPipeline(QA)\n\nplatform:\nos: linux\narch: amd64\n\nsteps:\n\n- name: deploy2TKE-QA\nimage: danielgormly/drone-plugin-kube:0.0.2\nsettings:\ntemplate: tke.yml\nserver: https://loud.com\nca:\nfrom_secret: TKE_CA\ntoken:\nfrom_secret: TKE_TOKEN\nnamespace: demo\n\nserver è·Ÿ ca tokenï¼Œéœ€çœ‹é¨°è¨Šé›²é›†ç¾¤ä¸Šçš„è¨­å®š\n\né€™å€‹imageä¸åƒGKEä¸€æ¨£æœ‰åƒæ•¸å¯ä»¥ä¸Ÿé€²å»ï¼Œåªæœ‰å›ºå®šçš„å¹¾å€‹åƒæ•¸\nref. danielgormly/drone-plugin-kube\næ‰€å¹¸é€™å€‹æœ‰æ”¾åœ¨githubä¸Šï¼Œé‚„èƒ½å¤ æ ¹æ“šè‡ªå·±çš„éœ€æ±‚æ›´æ”¹å…§å®¹ï¼Œå¢åŠ åƒæ•¸ã€‚\né‡æ–°ç·¨è­¯å¾Œï¼Œå¦‚æœä¸æ˜¯ä¸Šå‚³åˆ°å…¬é–‹çš„Container Registry ï¼Œè€Œæ˜¯å‚³åˆ°ç§æœ‰çš„CRå°±å¿…é ˆåŠ ä¸Š\nimage_pull_secrets:\n- TKE_LOGIN\n\né€™å€‹èˆ‡image åŒæ¨£çš„å±¤ç´šï¼Œä¸ç„¶æœƒå°è‡´pull imageå¤±æ•—\n\nref.How to pull private images with 1.0ï¼Œ\nè‡³æ–¼TKE_LOGINçš„å…§å®¹ï¼ˆé€™å€‹ä¹Ÿå¿…é ˆåŠ åœ¨droneçš„Secretså…§ï¼‰ï¼Œ\né€šå¸¸æ˜¯åœ¨ $HOME/.docker/config.json å…§ï¼Œæœƒé•·å¾—åƒ\n{\n\t&quot;auths&quot;: {\n\t\t&quot;https://index.docker.io/v1/&quot;: {\n\t\t\t&quot;auth&quot;: &quot;YW11cmRhY2E6c3VwZXJzZWNyZXRwYXNzd29yZA==&quot;\n\t\t}\n\t}\n}\n\nä½†æ˜¯ï¼Œæˆ‘çš„åªæœ‰\n{\n\t&quot;auths&quot;: {\n\t\t&quot;https://index.docker.io/v1/&quot;: {}\n\t}\n}\n\næ‰€ä»¥ä¸‹é¢é‚£å€‹å°±å¿…é ˆè‡ªå·±ç”¢ç”Ÿäº†ï¼Œ\nç”¢ç”Ÿçš„æ–¹å¼å¦‚ä¸‹\necho -n 'username:password' | base64\næŠŠusernameèˆ‡ password è¼¸å…¥ï¼Œè½‰æˆbase64ï¼Œå†è²¼ä¸Šå»è‡³ç¨‹å¼ç¢¼å…§ï¼Œä¸¦å„²å­˜è‡³droneçš„Secrets\nref.Docker login auth token\nè‡³æ–¼ä¿®æ”¹é€™å€‹imageï¼Œè¦åŠ å…¥åƒæ•¸çš„è©±ï¼Œ\nç›®å‰çœ‹æ‡‰è©²æ˜¯ å¢åŠ  main.go è·Ÿ plugin çš„ Kubeconfig åƒæ•¸ï¼Œç„¶å¾Œé‡æ–°ç·¨è­¯(build.sh)å³å¯\np.s. åœ¨é¨°è¨Šé›²çš„pod(Alpine Linux)å…§å®‰è£è»Ÿé«”ï¼Œéœ€æ›¿æ›é¡åƒæº\nsed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g' /etc/apk/repositories\n\nref.\næ”¯æ´k8sçš„å„ç¨®æŒ‡ä»¤Sh4d1/drone-kubernetes\nå¯ç›´æ¥åœ¨droneä¸Šä¸‹kubectlæŒ‡ä»¤sinlead/drone-kubectl\nalpineæºé…ç½®",
		"tags": [ "note","â±"]
},

{
		"title": "drone jsonnet å„ç¨®æ€ªæ‹›",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â± Drone/109. drone jsonnet å„ç¨®æ€ªæ‹›/",
		"content": "ç¡ç¡å¿µ\næœ¬æ–‡ç« å…§å®¹åŒ…å«è¨±å¤šå¯«drone jsonnetæœƒç¢°åˆ°çš„å¯«æ³•ã€‚\næ­£æ–‡\n\nåœ¨pipelineä¸‹comandçš„æ™‚å€™ï¼Œæœ‰æ™‚æœƒç¢°åˆ°å¤šè¡ŒæŒ‡ä»¤æ¹Šåœ¨ä¸€èµ·çš„æƒ…æ³ï¼Œ\nåœ¨drone.yamlæ˜¯ç›´æ¥é€™æ¨£å¯«\n\nä½†å¦‚æœè¦ç”¨jsonnetçš„è©±ï¼Œè¦ç”¨\\næ›è¡Œï¼Œ\n\nè½‰æ›å¾Œå°±æœƒè®Šæˆä¸‹åœ–\n\nåœ¨åŸ·è¡Œcommandçš„æ™‚å€™ï¼Œå› ç‚ºè¦å…ˆç”¨&quot; å°‡æŒ‡ä»¤åŒ…èµ·ä¾†ï¼Œå¦‚æœè£é¢é‚„è¦æœ‰&quot; çš„è©±ï¼Œå¿…é ˆåœ¨å‰é¢åŠ ä¸Š \\\n\nåŸ·è¡Œdrone jsonnet --stream --formatå¾Œ\n\né€™æ˜¯å› çˆ² linux shellè£é¢ï¼Œå–®å¼•è™Ÿè·Ÿé›™å¼•è™Ÿçš„å·®åˆ¥ï¼Œè©³ç´°å¯çœ‹<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/133. shell scriptå­—ä¸²è™•ç†/\">shell script é›™å¼•è™Ÿèˆ‡å–®å¼•è™Ÿ</a>\n\nå¦‚æœç¢°åˆ°å¾ˆé•·çš„ä¸€ä¸²æŒ‡ä»¤ï¼Œä¾‹å¦‚if elseä¹‹é¡çš„ï¼Œæ”¹ä½¿ç”¨ @'' å°‡ç¨‹å¼åŒ…èµ·ä¾†ã€‚\n\n@'\nif [ -z $${TAG_FROM} ]\n\nthen\n\necho &quot;éŒ¯èª¤ï¼šç„¡ä¾†æºTAGã€‚&quot;;\n\nexit 1\n\nfi'\n\nå¦‚æœå­—ä¸²éé•·ï¼Œæƒ³è¦æ›è¡Œçš„è©±ï¼Œ å¯åœ¨é›™å¼•è™Ÿå…§ ä½¿ç”¨ å…©å€‹\\\n\nç”¨curlæ™‚ï¼Œæœ‰äº›åƒæ•¸è¦ç”¨&quot; ï¼Œæ‰€ä»¥åœ¨å–®å¼•è™Ÿä½¿ç”¨ &quot; &quot; å›ºå®šåƒæ•¸ï¼Œè¦å…ˆç”¨ @ '' åŒ…èµ·ä¾†\n\n@'OAUTH2_TOKEN=$(curl -XGET $${TOTP_AUTH_URL} \\\\\n-H &quot;accept: application/json&quot; \\\\\n-H &quot;TOTP-PIN-CODE: $${pin}&quot; \\\\\n-H &quot;TOTP-USER: $${user}&quot;)',\n\nref.\n\njsonnetæ•™å­¸\njsonnet å®˜æ–¹èªªæ˜\nStandard Library",
		"tags": [ "note","â±"]
},

{
		"title": "Drone  plugin-Drone-docker ä¿®æ”¹åŸå§‹æª”",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â± Drone/119. Drone  plugin-Drone-docker ä¿®æ”¹åŸå§‹æª”/",
		"content": "ç¢ç¢å¿µ\nä¹‹å‰ç™¼ç¾ä¸€å€‹å¾Œç«¯åŸ·è¡Œdroneæœƒç™¼ç”Ÿçš„å•é¡Œï¼Œ\nå¶çˆ¾ç™¼ç”Ÿï¼Œä½†ä¸€æ®µæ™‚é–“ç¸½æœƒç™¼ç”Ÿä¸€æ¬¡ã€‚\nå¤šå€‹stepåŒæ™‚buildï¼Œæœƒé€ æˆimageéŒ¯äº‚ã€‚\nå¥½éº»ç…©é˜¿....\næ­£æ–‡\nå…ˆä¾†çœ‹å¹¾å¼µåœ–ï¼Œæ‡‰è©²å°±èƒ½ç­è§£æˆ‘å†èªªä»€éº¼äº†ã€‚\n\né¦–å…ˆçœ‹åˆ°ç¬¬ä¸€å¼µåœ–ï¼Œä»–åœ¨åŸ·è¡Œdocker buildçš„æ™‚å€™ï¼Œæœƒç”¨git commitçš„å€¼ï¼Œç•¶ä½œimageçš„tagåç¨±ã€‚\nç„¶å¾Œçœ‹ç¬¬äºŒå¼µåœ–ï¼Œç›´åˆ°buildå®Œimageå¾Œï¼Œæ‰æœƒå†æ ¹æ“šä½ çš„tagå»å°‡imageæ”¹æˆä½ è¦çš„tags\næ‰€ä»¥æˆ‘å€‘ä¾†æƒ³ä¸€å€‹æƒ…å¢ƒï¼Œç•¶Aã€BåŒæ™‚åŸ·è¡Œæ™‚ï¼Œä»–å€‘çš„git commitéƒ½ä¸€æ¨£ï¼Œ\nAå·²ç¶“buildå®Œäº†ï¼Œæ­£è¦åŸ·è¡Œæœ€å¾Œä¸€å€‹æ­¥é©Ÿï¼Œå°‡git commit tagæ”¹æˆæ­£å¸¸çš„image tag ã€‚\næ­¤æ™‚Bä¹Ÿå‰›buildå®Œï¼Œæ‰€ä»¥ä»–ä¹Ÿç”¢ç”Ÿäº†ä¸€å€‹ä¸€æ¨¡ä¸€æ¨£çš„ commit tagçš„imageï¼Œé‚£AåŸ·è¡Œæœ€å¾Œä¸€å€‹æ­¥é©Ÿæ™‚ï¼Œä»–æ”¹å¾—åˆ°åº•æ˜¯èª°çš„imageï¼Ÿ\n\nå¦‚æœä¸€å€‹æ¥ä¸€å€‹stepè·‘çš„è©±ï¼Œæ™‚é–“å¤§æ¦‚éœ€è¦ 4åˆ†åŠï¼Œ\nä½†åŒæ­¥çš„è©±ï¼Œåªè¦1åˆ†åŠï¼Œæ™‚é–“å¿«äº†ä¸‰å€ã€‚\n\næ‰€ä»¥é‚„æ˜¯è¦æƒ³è¾¦æ³•è§£æ‰ï¼Œæœ¬ä¾†æœ‰æƒ³å¹¾å€‹è§£æ³•ï¼Œ\n\nä¸€æ¬¡æŠŠç¨‹å¼éƒ½buildä¸€éï¼Œæ”¾åœ¨åŒä¸€å€‹imageå…§ï¼Œ\nåŸ·è¡Œæ™‚ï¼Œå†æ ¹æ“šåƒæ•¸çœ‹è¦åŸ·è¡Œå“ªå€‹æª”æ¡ˆã€‚\n\nä½†æ˜¯ä»–å€‘æœ‰ä¸€ç¨®æƒ…å¢ƒæ˜¯åªè¦æ›´æ–°å…¶ä¸­ä¸€å€‹åŠŸèƒ½å°±å¥½ï¼Œé‚£æ­¤æ™‚å…¨éƒ¨buildå°±ä¸å¤ªé©åˆã€‚\n\nåœ¨drone stepæ™‚ï¼Œå¡tagé€²å»ï¼Œä½†ä»–åªæœƒåœ¨æœ€å¾Œä¸€å€‹æ­¥é©Ÿï¼Œæ‰æœƒæ”¹imageçš„tag ï¼Œé€™æ‹›ä¹Ÿä¸è¡Œ\n\næ”¹plugin/gcr äº†ï¼Œåœ¨ç¬¬ä¸€æ­¥é©Ÿæ™‚å°±æŠŠimageçš„tagæ”¹æ‰ï¼Œä¸è¦ä½¿ç”¨git commitï¼Œé‚£å°±è§£æ‰é€™å€‹å•é¡Œäº†ã€‚\n\nå‹•æ‰‹\né¦–å…ˆæ‰¾åˆ°é€™å€‹imageçš„åŸå§‹ç¢¼ drone-plugins/drone-dockerï¼Œç„¶å¾Œé–‹å§‹æ”¹å§ã€‚\nå„ç’°å¢ƒmain.goçš„package import docker è¦å…ˆæ”¹æ‰ï¼Œä¸æ”¹æ‰æˆ‘ä¸ç¢ºå®šä»–æœƒä¸æœƒæŠ“æœ¬æ©Ÿçš„packageï¼Œæˆ‘golangåˆå­¸æ²’å¤šä¹…ã€‚\nä¿®æ”¹å‰\nimport (\n\t&quot;os&quot;\n\t&quot;runtime&quot;\n\n\t&quot;github.com/joho/godotenv&quot;\n\t&quot;github.com/sirupsen/logrus&quot;\n\t&quot;github.com/urfave/cli&quot;\n\n\tdocker &quot;github.com/drone-plugins/drone-docker&quot;\n)\n\nä¿®æ”¹å¾Œ\nimport (\n\t&quot;os&quot;\n\t&quot;runtime&quot;\n\n\t&quot;github.com/joho/godotenv&quot;\n\t&quot;github.com/sirupsen/logrus&quot;\n\t&quot;github.com/urfave/cli&quot;\n\n\tdocker &quot;drone-docker&quot;\n)\n\nç„¶å¾Œæˆ‘åœ¨docker.goä¸Šé¢ç›´æ¥åŠ äº†å…©è¡Œï¼ŒæŒ‡å®šäº†tagï¼Œé€™ä¸é©åˆæ‰€æœ‰äººï¼Œ\nå› ç‚ºä½ å€‘çš„ä½¿ç”¨æƒ…å¢ƒå¯èƒ½è·Ÿæˆ‘ä¸å¤ªä¸€æ¨£ï¼Œæˆ‘é€™é‚Šæ˜¯åªè¦pushåˆ°gitå¾Œï¼Œdroneæœƒè‡ªå‹•ç”¢ç”Ÿtagï¼Œæ‰€ä»¥å¦‚æœä¸æŒ‡å®šçš„è©±ï¼Œæˆ‘é‚„æ˜¯æœ‰tagçš„å€¼å¯ä»¥å–å¾—ã€‚\ntag := build.Repo + &quot;:&quot; + build.Tags[0]\n\nargs := []string{\n&quot;build&quot;,\n&quot;--rm=true&quot;,\n&quot;-f&quot;, build.Dockerfile,\n&quot;-t&quot;, build.Name,\n&quot;-t&quot;, tag,\n}\n\nå¦å¤–ï¼Œå¦‚æœè¦çŸ¥é“plugin/gcrè£é¢æœ‰ä»€éº¼ç’°å¢ƒè®Šæ•¸å¯ä»¥æ‹¿ä¾†ç”¨çš„è©±ï¼Œ\nå¯ä»¥åœ¨droneçš„stepä¸Šé¢ï¼ŒåŸ·è¡Œexport -p\n- name: publish-dev\nimage: plugins/gcr\npull: if-not-exists\nvolumes:\n- name: docker\npath: /var/run/docker.sock\ncommands:\n- export -p\n\nåŸ·è¡Œçµæœï¼š\n\næ”¹å®Œå¾Œï¼ŒåŸ·è¡Œä¸‹é¢çš„æŒ‡ä»¤å…ˆç”¢ç”Ÿgo çš„ç¨‹å¼ã€‚\né€™å€‹goçš„æŒ‡ä»¤ï¼Œæˆ‘æ˜¯å¾.drone.yamlæŠ„å‡ºä¾†çš„ã€‚\nåŸ·è¡Œå‰è¨˜å¾—å…ˆè¨­å®šç’°å¢ƒè®Šæ•¸\nexport GOOS=linux\nexport GOARCH=amd64\nexport CGO_ENABLED=0\nexport GO111MODULE=on\n\nGo build\ngo build -v -ldflags &quot;-X main.version=${DRONE_COMMIT_SHA:0:8}&quot; -a -tags netgo -o release/linux/amd64/drone-docker ./cmd/drone-docker\n\ngo build -v -ldflags &quot;-X main.version=${DRONE_COMMIT_SHA:0:8}&quot; -a -tags netgo -o release/linux/amd64/drone-gcr ./cmd/drone-gcr\n\nDocker build\nå°‡goçš„åŸ·è¡Œæª”æ‰“åŒ…é€²å»docker imageå…§ï¼Œ\nå…ˆæ‰“åŒ…åˆ°æœ¬æ©Ÿçš„docker:linux-amd64ï¼Œ\nå› ç‚ºdocker-gcrçš„dockerfileæœƒå»æŠ“docker:linux-amd64 ç•¶ä½œimageçš„åŸºåº•å†ç”¢ç”Ÿæª”æ¡ˆ\ndocker build \\\n--label org.label-schema.build-date=$(date -u +&quot;%Y-%m-%dT%H:%M:%SZ&quot;) \\\n--label org.label-schema.vcs-ref=$(git rev-parse --short HEAD) \\\n--file docker/docker/Dockerfile.linux.amd64 --tag plugins/docker:linux-amd64 .\n\ndocker build \\\n--label org.label-schema.build-date=$(date -u +&quot;%Y-%m-%dT%H:%M:%SZ&quot;) \\\n--label org.label-schema.vcs-ref=$(git rev-parse --short HEAD) \\\n--file docker/gcr/Dockerfile.linux.amd64 --tag asia-east1-docker.pkg.dev/rouge-sms/docker-public/gcr:0.0.13 .\n\nå®Œæˆ\n\nä¸Šåœ–å¯ä»¥çœ‹åˆ°ï¼Œåœ¨docker buildæ™‚ï¼ŒæœƒåŒæ™‚ä¸‹å…©å€‹tagï¼Œ\nä¸€å€‹é‚„æ˜¯ç¶­æŒgit commitçš„å€¼ï¼Œä½†å¦ä¸€å€‹å°±æ˜¯æ‹¿repositoryåŠ ç‰ˆæœ¬è™Ÿç•¶ä½œtagã€‚\nref.\n\nDRONE_STEP_NAME not available as substitution in environment\n\næŸ¥è³‡æ–™æ™‚å‰›å¥½æœ‰ç¢°åˆ°é€™å€‹å•é¡Œï¼Œdrone_step_nameä¸€ç›´æŠ“ä¸åˆ°ï¼ŒåŸå› å†æ–‡ç« å…§ã€‚\n\nä¿®å¾©åœ¨å¤šæ¨¡çµ„javaé …ç›®ä¸­ï¼Œå¹³è¡Œæ‰“åŒ…é¡åƒæ™‚ï¼Œé¡åƒå› ç‚ºåŒåç¨±è¢«è¦†è“‹çš„å•é¡Œ\n\næ˜¨å¤©æ‰çœ‹åˆ°æœ‰äººç™¼äº†å€‹PRä¿®å¾©åŒåç¨±çš„å•é¡Œï¼Œæ„Ÿè¦ºè·Ÿæˆ‘çš„é —åƒï¼Œä½†å¯¦éš›çœ‹äº†ï¼Œè¦ºå¾—ä¸å¤ªé©åˆã€‚",
		"tags": [ "note","â±"]
},

{
		"title": "æ’°å¯«drone.yml ç­†è¨˜ç¯‡",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â± Drone/3. æ’°å¯«drone.yml ç­†è¨˜ç¯‡(æœª)/",
		"content": "å‰è¨€\næ›å·¥ä½œå¾Œï¼Œé–‹å§‹æ¥è§¸k8sã€GCPã€GKEï¼Œå†ä¾†æ˜¯Droneã€‚\nk8sä¸­åˆå»¶ä¼¸äº†kustomize ï¼Œymalçš„å¯«æ³•ã€ä½ˆç½²æ–¹å¼ã€‚\nGCPä¸­çš„cloud armorã€GCE ï¼Œç„¶å¾ŒGKEçš„æ¶æ§‹\nçœŸçš„æ˜¯....æ»¿æ»¿çš„å‘é˜¿ã€‚ä»¥ä¸Šè¬›åˆ°çš„ï¼Œé‚„è™•æ–¼æ‡æ‡‚ä¸­ï¼Œ\nç­†è¨˜ä¸çŸ¥é“ä½•å¹´ä½•æœˆä½•æ—¥å¯å¯«\næ­£æ–‡\nç°¡å–®èªªä¸€ä¸‹ç’°å¢ƒï¼Œåœ¨GKEä¸Šé¢ä½ˆç½² drone è·Ÿ gitlabï¼Œ\nç•¶gitlabæœ‰æ¢ä»¶è§¸ç™¼çš„è©±(ä¾‹å¦‚åœ¨push åœ¨masterä¸Š)ï¼ŒæœƒåŒæ™‚é€å‡ºä¸€å€‹webhookçµ¦droneï¼Œ\næ­¤æ™‚droneå°±æœƒå»gitlab pullç¨‹å¼ç¢¼ä¸‹ä¾†ï¼Œåšä½ æƒ³è¦çš„å‹•ä½œï¼ˆä¾‹å¦‚ï¼Œæ‰“åŒ…æˆimageï¼ŒæŠŠimageé€åˆ°gcrä¸Šé¢ï¼Œå†ä½ˆç½²åˆ°GKEä¸Šï¼‰ã€‚\nå…ˆä¾†ä»½yamlï¼Œå»ºè­°å¯ä»¥å…ˆçœ‹ä¸€ä¸‹yamlæ˜¯ä»€éº¼æ±è¥¿ï¼Œé€™æ¨£å¯«èµ·ä¾†æ¯”è¼ƒä¸æœƒæ’ç‰†ã€‚\n(ref. https://zh.wikipedia.org/wiki/YAML)\nkind: pipeline\nname: Pipeline(branch)\n\nsteps:\n- name: push2GCR(å‰å“¨)\nimage: plugins/gcr\nsettings:\nrepo: gcr.io/rd7-project/landingpage\ntags:\n- latest\n- ${DRONE_COMMIT}\n# dockerfile: configs/beta/Dockerfile\njson_key:\nfrom_secret: GOOGLE_CREDENTIALS\nbuild_args:\n- website=beta\n\n- name: deploy2GKE(å‰å“¨)\nimage: nytimes/drone-gke\nenvironment:\nTOKEN:\nfrom_secret: GOOGLE_CREDENTIALS\nsettings:\nproject: rd7-project\n# æ”¹æ‹‰åƒæ•¸å‚³å…¥kube.ymlå…§\n# template: configs/beta/.kube.yml\nvars:\ndeployName: yaboxxx-landing-page-beta\nenv: beta\nzone: asia-east1-a\ncluster: xbb-common\ntrigger:\n# branch:\n# - master\nref:\ninclude:\n- refs/heads/master\nevent:\n- push\n\nåˆ†æˆä¸‰å°å¡Šä¾†çœ‹ï¼Œ\nå¦‚æœä»¥ --- å€åˆ†çš„è©±ï¼Œé‚£\nkind: pipeline\nname: Pipeline(branch)\næ˜¯å¿…é ˆçš„ã€‚\nå†ä¾†æ˜¯ steps ï¼Œ\næ ¹æ“šæ­¥é©Ÿæ¸¸ä¸Šå¾€ä¸‹åŸ·è¡Œï¼Œå¦‚æœè¦å¹¶è¡Œçš„è©±ï¼Œå‰‡ä½¿ç”¨depend_on ï¼Œ\né€™éƒ¨åˆ†ç•™åˆ°ä¸‹æ¬¡è¬›ã€‚\n\ntrigger ï¼Œé€™æ˜¯è§¸ç™¼æ¢ä»¶ï¼Œè¡¨ç¤ºåœ¨gitlabä¸Šé¢åšäº†å“ªäº›å‹•ä½œï¼Œæœƒè§¸ç™¼é€™å€‹stepï¼ˆæ­¥é©Ÿï¼‰\né€™é‚Šçš„è§¸ç™¼äº‹ä»¶ï¼Œå¸¸ç”¨åˆ°æ‡‰è©²æ˜¯ Branchã€Reference ä»¥åŠ Event\n(ref. https://docs.drone.io/pipeline/docker/syntax/trigger/)\nBranch è·Ÿ Event æ¯”è¼ƒå¥½ç†è§£ï¼ˆä½†ç¢°åˆ°Tagçš„äº‹ä»¶åˆæ˜¯å¦ä¸€å›äº‹äº†ï¼‰ ã€‚\nReference é€™å€‹å…¶å¯¦åªè¦åœ¨ä½ çš„gitè£¡é¢ä¸‹æŒ‡ä»¤\ntree .git/refs/\nå¤§æ¦‚å°±æœƒçŸ¥é“ä»–åœ¨è¬›äº›ä»€éº¼ï¼Œgitçš„åº•å±¤éƒ½æ˜¯é refså»ç”¨å‡ºä¾†çš„\n(\nref.\nhttp://iissnan.com/progit/html/zh-tw/ch9_3.html\nhttps://titangene.github.io/article/git-branch-ref.html\n)\nä½†è¦æ³¨æ„çš„æ˜¯ï¼Œdrone 1.Xï¼Œä»¥å¾Œçš„ç‰ˆæœ¬ä¸æ”¯æ´eventçš„tag èˆ‡ branch å…±å­˜ã€‚\nå¯ä»¥åƒè€ƒé€™ç¯‡\n(\nref.\nhttps://github.com/drone/drone/issues/2536\nhttps://rabbit52.com/2019/11/drone-from-0-8-to-1-0/\n)\n\nsteps:\né€™éƒ¨åˆ†å‰‡é–‹å§‹ç”±ä¸Šå¾€ä¸‹é–‹å§‹åŸ·è¡Œï¼Œ\nåƒä¸Šé¢çš„ç¨‹å¼å…ˆåšçš„æ˜¯å°‡ç¨‹å¼æ‰“åŒ…å¾Œï¼Œä¸Šå‚³åˆ°GCRä¸Šé¢ã€‚\nï¼ˆæœ€ä¸Šé¢é‚„æœ‰ä¸€æ®µcloneï¼Œæœƒå…ˆåšï¼ˆé€™æ˜¯droneé è¨­çš„ï¼‰ï¼Œå°‡gitlabçš„ç¨‹å¼è¤‡è£½åˆ°æ©Ÿå™¨å…§ï¼Œé€™æ¨£æ‰èƒ½åšå¾Œé¢çš„ä¸Šå‚³ï¼Œ\né€™ä¸€å¡Šå¯ä»¥ åƒè€ƒ https://docs.drone.io/pipeline/docker/syntax/cloning/ ï¼‰\nä¸Šå‚³åˆ°GCRä½¿ç”¨çš„ plugins/gcr ï¼Œé€™å€‹imageï¼Œè£¡é¢çš„åƒæ•¸è«‹åƒè€ƒèªªæ˜é é¢\nç”±æ–¼é€™é‚Šéœ€è¦ä¸Šå‚³åˆ°GCRï¼Œæ•…è¦å…ˆåˆ°Google çš„ æœå‹™è³¬æˆ¶ç”³è«‹æ¬Šé™ ï¼Œé™¤äº†éœ€è¦pushä»¥å¤–é‚„å¿…é ˆè¦æœ‰ storage.buckets.get\né€™é‚Šæœƒå–å¾—ä¸€å€‹jsonæª”æ¡ˆï¼Œå°‡å…§å®¹å¡å…¥droneå…§çš„Sercetsã€‚",
		"tags": [ "note","â±"]
},

{
		"title": "drone on GKE å»ºç«‹",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â± Drone/72. drone on GKE å»ºç«‹/",
		"content": "å‰è¨€\næ­£æ–‡\ngitlabçš„å®‰è£æ–¹å¼ï¼Œåƒè€ƒ <a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/GKE/71.gitlab on GKE ç½å®³é‚„åŸç­†è¨˜/\">71.gitlab on GKE ç½å®³é‚„åŸç­†è¨˜</a>\nå†ä¾†æ˜¯å®‰è£droneçš„æ–¹å¼ï¼Œ\né€™é‚Šä¹‹å‰æ²’å¯«æ–‡ä»¶ï¼Œé‡è©¦çš„æ™‚å€™æäº†ä¸€é™£å­ã€‚\nè¦å…ˆçŸ¥é“ runneråˆ†æˆå“ªå¹¾ç¨®ï¼Œæ ¹æ“šä½ çš„ç’°å¢ƒé¸æ“‡ä½ è¦çš„æ–¹å¼ã€‚\nåœ¨droneç•«é¢ï¼ŒåŸºæœ¬ä¸Šéƒ½å·®ä¸å¤šã€‚\næœ‰å·®ç•°çš„é»æ˜¯å†å»ºç½®æ™‚ï¼Œå°±ç›´æ¥çœ‹åœ–å§\nDrone Runneråˆ†æˆäº”ç¨®ï¼Œé©ç”¨æ–¼ä¸åŒçš„æƒ…å¢ƒ\n\nDocker runner :æ˜¯droneæœ€å¸¸è¦‹çš„ç”¨æ³•ï¼Œpinelineä¸­çš„æ¯ä¸€å€‹stepéƒ½èµ·ä¸€å€‹ç¨ç«‹çš„containeré‹è¡Œç‰¹å®šä»»å‹™ï¼Œæœ¬æ–‡å³æ˜¯æ¡ç”¨docker runnerã€‚\n\nåœ¨å»ºç½®æ™‚ï¼Œæœƒåœ¨è©²runnerè£¡é¢åŸ·è¡Œdockerï¼Œæ‰€ä»¥ç•¶ä¸‹åªæœƒçœ‹åˆ°runnerè£¡é¢çš„cpuè·Ÿramä½¿ç”¨é‡ä¸Šå‡ã€‚\n\nKubernetes runner:è·Ÿdocker runner çš„åŠŸèƒ½ç›¸ä¼¼ï¼Œåªæ˜¯æ”¹æˆKubernetes ç‰ˆæœ¬ï¼Œå¦‚æœä½ çš„æœå‹™è¦æ­å»ºåœ¨k8sä¸Šï¼Œå°±ç”¨é€™å€‹ã€‚\n\né¸æ“‡kubernetesçš„ç‰ˆæœ¬ï¼Œå†å»ºç½®æ™‚æœƒåœ¨ç•¶ä¸‹çš„å¢é›†å»ºç«‹ä¸€å€‹podï¼Œ\nç„¶å¾Œå°±æœƒåœ¨è£¡é¢åŸ·è¡Œè¦è·‘å¾—æ­¥é©Ÿã€‚\n\nExec runner:ç”¨æ–¼ä½ çš„å°ˆæ¡ˆä¸é©åˆè·‘åœ¨å®¹å™¨å…§çš„ç‹€æ³EX:MacOså°ˆæ¡ˆã€‚\n\nSSH runner:ç›´æ¥ä»¥ssh é€£ç·šåˆ°é ç«¯ä»¥default shell åŸ·è¡Œpipelineæµç¨‹ï¼Œéœ€è¦ä½¿ç”¨openssh 7.9 ä»¥ä¸Šç‰ˆæœ¬ã€‚\n\nDigital Ocean runnerÂ :ç”¨æ–¼ç•¶ä½ çš„pipelineéœ€è¦æ¬Šé™å¯ä»¥æ“ä½œæ•´å°è™›æ“¬æ©Ÿçš„æƒ…æ³ï¼Œä¸”ä¸é©åˆè·‘åœ¨å®¹å™¨å…§ã€‚\n\nè§’è‰²\nåŠŸèƒ½\n\nç”¨æˆ¶\nGitlab\n\nDrone Server\nDrone ä¸»æœå‹™ï¼Œæä¾›Webç•Œé¢\n\nDrone Runner\næˆ‘ç†è§£ç‚ºå¯¦ç¾å„ç¨®æ“ä½œçš„é©é…å™¨ï¼Œä¾‹å¦‚sshã€dockerã€k8sæ“ä½œ\n\nDrone Agent\næ“ä½œä¸»æ©Ÿ Docker API çš„ä»£ç†ç¨‹åº\n\nDocker Server\nä¸»æ©Ÿçš„ Doker ç¨‹åº\n\nç™¼ä½ˆåˆ°GKEï¼Œåƒæ•¸èªªæ˜\nç™¼ä½ˆåˆ°GCRï¼Œåƒæ•¸èªªæ˜\n\nå†ä¾†å°±æ˜¯è¦ä½ˆç½² drone serverè·Ÿ runneräº†ã€‚\nStep 1.\né¦–å…ˆè¦åˆ°Gitlabï¼Œå»ºç«‹oAuthçš„id è·Ÿtokenã€‚\nåˆ‡è¨˜æ˜¯åœ¨user Settingçš„ Applicationï¼Œ\nå› ç‚ºGitlabæ˜¯æˆ‘å»ºçš„ï¼Œæ‰€ä»¥æˆ‘æœ‰å¦ä¸€å€‹Adminçš„å€åŸŸï¼Œ\nä¸æ˜¯åœ¨Adminè£¡é¢ã€‚\n\nç¶²é ä¸è¦é—œï¼Œ Application ID è·Ÿ Secretç­‰ç­‰æœƒç”¨åˆ°ã€‚\n\nStep 2. drone Server\n\nå°‡ä¸€äº›åƒæ•¸æ”¹æˆè‡ªå·±çš„ã€‚\n\nyamlæ¬„ä½\nå°æ‡‰çš„æ¬„ä½\n\nDRONE_GITLAB_CLIENT_ID\nApplication ID\n\nDRONE_GITLAB_CLIENT_SECRET\nSecret\n\nDRONE_SERVER_HOST\nCallback URL çš„domain\n\nDRONE_RPC_SECRET\nè‡ªè¡Œå»ºç«‹ï¼Œrunnerçš„secretéœ€ä¸€è‡´\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: gke-drone-server\nlabels:\napp: drone\ndrone: drone-server\nio.kompose.service: drone-server\nspec:\nselector:\nmatchLabels:\napp: drone\ndrone: drone-server\nio.kompose.service: drone-server\ntemplate:\nmetadata:\nlabels:\napp: drone\ndrone: drone-server\nio.kompose.service: drone-server\nspec:\ncontainers:\n- env:\n- name: DRONE_GITLAB_CLIENT_ID # OAuth çš„ Application ID\nvalue: 5b2f90188137bab7b1c6959721feb6e55f1137919e5b4b5ce005bd5e15af536a\n- name: DRONE_GITLAB_CLIENT_SECRET # OAuth çš„ Secret\nvalue: 4cc261149603b3df864677f5af37b55613f6f4d20dd65fbb3e4f77f0cbca9e15\n- name: DRONE_GITLAB_SERVER # Gitlab Server\nvalue: http://35.234.26.234\n- name: DRONE_GIT_ALWAYS_AUTH # Drone clone æ™‚ï¼Œæ˜¯å¦æ¯æ¬¡éƒ½é©—è­‰\nvalue: &quot;false&quot;\n- name: DRONE_LOGS_COLOR # Log å•Ÿç”¨é¡è‰²è¾¨è­˜\nvalue: &quot;true&quot;\n- name: DRONE_LOGS_DEBUG # é¸æ“‡æ˜¯å¦é–‹å•Ÿ debug æ¨¡å¼\nvalue: &quot;false&quot;\n- name: DRONE_LOGS_PRETY\nvalue: &quot;false&quot;\n# - name: DRONE_LOGS_TRACE #é–‹å•Ÿlogè¿½è¹¤\n# value: &quot;true&quot;\n- name: DRONE_RUNNER_CAPACITY # è¡¨ç¤ºä¸€æ¬¡å¯åŸ·è¡Œ n å€‹ job\nvalue: &quot;3&quot;\n- name: DRONE_SERVER_HOST # Drone URL,ä¸èƒ½åŠ HTTPï¼Œè§£ææœƒåœ¨åŠ ä¸ŠHTTP\nvalue: 14.199.130.26\n- name: DRONE_SERVER_PROTO # http æˆ–è€… https é€£ç·šè¨­å®š\nvalue: http\n- name: DRONE_TLS_AUTOCERT # è‡ªå‹•ç”Ÿæˆ ssl è­‰æ›¸ï¼Œä¸¦æ¥å— https é€£ç·šï¼Œæœ«èªç‚ºfalse\nvalue: &quot;false&quot;\n- name: DRONE_REGISTRATION_CLOSED # å•Ÿç”¨çš„è©±ï¼Œç®¡ç†å“¡éœ€åœ¨ç”¨æˆ¶ç™»å…¥å‰å‰µå»ºç”¨æˆ¶\nvalue: &quot;false&quot;\n- name: DRONE_USER_CREATE # å»ºç«‹adminæ¬Šé™çš„ä½¿ç”¨è€… cliç™»å…¥ç”¨\nvalue: username:ezio,admin:true\n- name: DRONE_USER_FILTER # å¯æ“ä½œ Drone çš„ç”¨æˆ¶æ¸…å–®\nvalue: root,ezio\n- name: DRONE_RPC_SECRET\nvalue: 824de51510f08498fa770c7798e3cc9e\nimage: drone/drone:2\nimagePullPolicy: &quot;Always&quot;\nname: drone-server\nports:\n- containerPort: 80\nresources: {}\nvolumeMounts:\n- mountPath: /data\nname: drone-server-claim0\nrestartPolicy: Always\nserviceAccountName: &quot;&quot;\nvolumes:\n- name: drone-server-claim0\npersistentVolumeClaim:\nclaimName: gke-drone-server-claim0\n\nå¦‚æœè¦å…¶ä»–gitçš„å®‰è£æ–¹å¼è«‹åƒè€ƒ 1. çš„å®˜æ–¹æ–‡ä»¶\nref.\n\nDrone Gitlab\n\nStep 3-a. drone Runner - Docker Runner\n\næ³¨æ„ DRONE_RPC_SECRETéœ€èˆ‡serverä¸€è‡´ã€‚\né€™é‚Šæœƒç”¨åˆ° docker.sockï¼Œä¹Ÿæ˜¯å› ç‚ºé€™å€‹çš„é—œä¿‚ï¼Œ\næ‰å°è‡´é€™æ¬¡é‡æ–°æ¸¬è©¦ã€‚\nk8så³å°‡å»¢æ£„ Dockershimï¼Œæ”¹ç”¨containerdï¼Œ\nè©³ç´°å…§å®¹å°±ä¸å¤šèªªäº†ï¼Œæœ‰èˆˆè¶£çš„å¯åƒè€ƒ (1) ã€ (2)\né›–ç„¶æˆ‘å¯¦æ¸¬å‡ºä¾†çš„çµæœï¼Œ\nåœ¨containerdçš„nodeæ˜¯å¯ä»¥ç”¨çš„ã€‚\næœ‰åœ¨æƒ³æ˜¯ä¸æ˜¯å› ç‚ºæ ¸å¿ƒé‚„æ˜¯ /var/run/docker.sock å€‹é—œä¿‚ï¼Œ\nä½†éš¨è‘—å¾ŒçºŒç ”ç©¶ docker.sock (3)ï¼Œç™¼è¦ºæ‡‰è©²æ˜¯ä¸èƒ½ç”¨çš„æ‰å°...\nä½†ç‚ºä»€éº¼èƒ½ç”¨é‚„æ˜¯æä¸æ‡‚ã€‚ä½†(4)çš„å®˜æ–¹è«–å£‡æœ‰èªªï¼Œä»–ä¸æ“”å¿ƒé€™å€‹å•é¡Œï¼Œ\nå¯¦éš›ä¸Šé‚„çœŸçš„æ²’å•é¡Œ...\nè£œå……ï¼Œ\næœ€è¿‘æŠŠnodeçš„ containerd ç‰ˆæœ¬å‡åˆ° 1.20 å¾Œï¼ŒDocker Runnerå°±çœŸçš„ä¸èƒ½ç”¨äº†ã€‚æ‡‰è©²æ˜¯æ—©æœŸé‚„åœ¨ç”¨èˆŠç‰ˆçš„containerdï¼Œæ‰€ä»¥æ‰èƒ½è·‘ã€‚\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: agent\nspec:\nselector:\nmatchLabels:\ndrone: drone-agent\nreplicas: 1\ntemplate:\nspec:\ncontainers:\n- env:\n- name: DRONE_LOGS_DEBUG\nvalue: &quot;false&quot;\n# - name: DRONE_LOGS_TRACE #é–‹å•Ÿlogè¿½è¹¤\n# value: &quot;true&quot;\n- name: DRONE_RPC_SECRET\nvalue: 824de51510f08498fa770c7798e3cc9e\n- name: DRONE_RPC_HOST\nvalue: 14.199.130.26\n- name: DRONE_RPC_PROTO\nvalue: &quot;http&quot;\n- name: DRONE_RUNNER_CAPACITY\nvalue: &quot;3&quot;\nimage: drone/drone-runner-docker:1\nimagePullPolicy: &quot;&quot;\nname: drone-agent\nresources: {}\nvolumeMounts:\n- mountPath: /var/run/docker.sock\nname: docker-socket\nrestartPolicy: Always\nserviceAccountName: &quot;&quot;\nvolumes:\n- name: docker-socket\nhostPath:\npath: /var/run/docker.sock\n\nref.\n1. æª¢æŸ¥æ£„ç”¨ Dockershim å°ä½ çš„å½±éŸ¿\n2. æ£„ç”¨ Dockershim çš„å¸¸è¦‹å•é¡Œ\n3. [Docker] æ›è¼‰ /var/run/docker.sock çš„ç”¨æ„ï¼Ÿ\n4. Drone Disscus - Docker plugin &amp; dockershim deprecation // Kubernetes 1.20+\nStep 3-b. drone Runner - kubernete Runner\n\næ³¨æ„ DRONE_RPC_SECRETéœ€èˆ‡serverä¸€è‡´ã€‚\n\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\nnamespace: default\nname: drone\nrules:\n- apiGroups:\n- &quot;&quot;\nresources:\n- secrets\nverbs:\n- create\n- delete\n- apiGroups:\n- &quot;&quot;\nresources:\n- pods\n- pods/log\nverbs:\n- get\n- create\n- delete\n- list\n- watch\n- update\n\n---\n\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\nname: drone\nnamespace: default\nsubjects:\n- kind: ServiceAccount\nname: default\nnamespace: default\nroleRef:\nkind: Role\nname: drone\napiGroup: rbac.authorization.k8s.io\n\n---\n\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: gke-drone-agent\n\nlabels:\napp: drone\ndrone: drone-agent\nio.kompose.service: drone-agent\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: drone\ndrone: drone-agent\nio.kompose.service: drone-agent\ntemplate:\nmetadata:\nannotations:\nsidecar.istio.io/inject: &quot;true&quot;\nlabels:\napp: drone\ndrone: drone-agent\nio.kompose.service: drone-agent\nspec:\ncontainers:\n- name: runner\nimage: drone/drone-runner-kube:latest\nports:\n- containerPort: 3000\nenv:\n- name: DRONE_RPC_SECRET\nvalue: 824de51510f08498fa770c7798e3cc9e\n- name: DRONE_RPC_HOST\nvalue: 14.199.130.26\n- name: DRONE_RPC_PROTO\nvalue: &quot;http&quot;\n- name: DRONE_RUNNER_CAPACITY\nvalue: &quot;3&quot;\n\nref.\n- KUBERNETES Runner\nå•é¡Œæ’é™¤\n\né¦–å…ˆç¢°åˆ°çš„å•é¡Œæ˜¯ï¼Œdroneæ²’æœ‰åæ‡‰ï¼Œå…ˆæª¢æŸ¥webhook\nåˆ°å°ˆæ¡ˆåº•ä¸‹çš„webhooké¸é …ï¼ŒæŸ¥çœ‹éŒ¯èª¤çš„è¨Šæ¯\n\nå› ç‚ºGKEçš„é˜²ç«ç‰†æ²’é–‹çš„é—œä¿‚ï¼Œå°è‡´webhookè³‡æ–™ä¸Ÿä¸éå»ã€‚\n\n2. droneç„¡æ³•é€£ç·šåˆ°gitlab\n\næœ¬ä¾†ä»¥ç‚ºæ˜¯é˜²ç«ç‰†çš„é—œä¿‚ï¼Œä½†ç›´æ¥é€£é€²å»podè£¡é¢ï¼Œå‘¼å«é€™å€‹ç¶²å€æ˜¯æ­£å¸¸çš„ã€‚\nå¾Œä¾†çœ‹åˆ° (2) çš„è¨è«–ï¼Œæˆ‘è·Ÿä»–å€‘ç‹€æ³ä¸€æ¨£ï¼Œæ‡‰è©²ä¹Ÿæ˜¯istioé€ æˆçš„ã€‚\nåŸä»¥ç‚ºæ˜¯ drone serveræˆ– runnerï¼Œæœ‰å®‰è£istioçš„é—œä¿‚ï¼Œ\né‚„ç‰¹åˆ¥å¯«äº†\ntemplate:\nmetadata:\nannotations:\nsidecar.istio.io/inject: &quot;false&quot;\n\nä¾†é˜»æ­¢ istioçš„æ³¨å…¥(3)ã€‚\nå¾Œä¾†æƒ³äº†åˆæƒ³ï¼Œæ‰é©šè¦ºï¼Œæˆ‘è¦å–æ¶ˆçš„æ‡‰è©²æ˜¯æ•´å€‹namespaceçš„istioæ³¨å…¥ï¼Œ\nå› ç‚ºç•¶æ–°çš„ pipelineå»ºç«‹æ™‚ï¼Œå°±å·²ç¶“æ³¨å…¥äº†istioçš„sidecarï¼Œ\n\næ‰€ä»¥è¦å…ˆè®“é€™å€‹namespaceé€šé€šä¸èƒ½è‡ªå‹•æ³¨å…¥ï¼Œ\næŒ‡å®šå…¶ä»–çš„deployæœƒè‡ªå‹•æ³¨å…¥ã€‚\nè‡ªå‹•æ³¨å…¥çš„è¦å‰‡ï¼Œè«‹åƒè€ƒ <a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/73. istio sidecar æ³¨å…¥è¦å‰‡/\">73. istio sidecar æ³¨å…¥è¦å‰‡</a>\n\nåˆ‡æ›namespaceï¼Œç„¡æ³•ä½ˆç½²\n\nref.\n1. Gitlab Webhooks\n2. Drone CI pipeline first step clone failed: Connection refused\n3. å®‰è£ Sidecar\n4. istio -Resource Annotations",
		"tags": ["é–‹å•Ÿlogè¿½è¹¤", "é–‹å•Ÿlogè¿½è¹¤", "note","â±"]
},

{
		"title": "drone build Open Source Edition",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â± Drone/77. drone build Open Source Edition/",
		"content": "å‰è¨€\nåœ¨æŸä¸€å¤©ï¼Œdroneå°±è·³å‡ºä¾†äº† ã€Your license limit is exceededã€‚ã€\nç•¶ä¸‹çœŸæ˜¯åš‡æ­»æˆ‘äº†ï¼Œç•¶å¤©åˆæ˜¯ç¶­è­·æ—¥ï¼Œ\nä¸€å †ç¨‹å¼è¦ä¸Šç‰ˆï¼Œè‡ªå‹•ä½ˆç½²æ›æ‰å°±å®Œäº†ï¼Œè¦é€šé€šæ‰‹å‹•ä¸Šã€‚\né‚„å¥½ï¼Œæ²’äº‹ï¼Œåªæ˜¯è·³å€‹é€šçŸ¥åœ¨é‚£é‚Šï¼ŒæŸ¥äº†ä¸€äº›æ–‡ä»¶ï¼Œ\néƒ½æ²’èªªåˆ°æœŸäº†æœƒæ€æ¨£ï¼Œå°±é€™æ¨£éäº†å…©å€‹æœˆï¼Œ\nä¹Ÿéƒ½æ²’äº‹ç™¼ç”Ÿï¼Œæœ¬ä¾†æƒ³ç¹¼çºŒæ’ä¸‹å»çš„ï¼Œ\nä½†æœ‰å…¶ä»–æ±è¥¿è¦ç”¨ï¼Œå°±é †ä¾¿ä¸€èµ·å‹•äº†ã€‚\næ­£æ–‡\n\nå®˜æ–¹æ–‡ä»¶æœ‰å¯«åˆ°é—œæ–¼æ¬Šé™çš„éƒ¨åˆ†ï¼Œ\n\nYour license limit is exceeded ï¼Œé€™å€‹æ˜¯å› ç‚ºä½ build è¶…éäº†5000æ¬¡ï¼Œç„¶å¾Œä½ åˆæ˜¯ç›´æ¥æŠ“å®˜æ–¹ç‰ˆæœ¬çš„imageæ‰æœƒå‡ºç¾é€™å€‹é€šçŸ¥ã€‚ï¼ˆOSï¼šä¸€é–‹å§‹æ¸¬è©¦ç•¶ç„¶ç›´æ¥æŠ“å®˜æ–¹çš„imageä¾†ç”¨é˜¿...ï¼‰\nåŸºæœ¬ä¸Šåªè¦æ˜¯å¹´æ”¶å…¥æ²’åˆ° 1 millionï¼ˆç¾é‡‘ï¼‰çš„å…¬å¸ï¼Œéƒ½èƒ½å…è²»ä½¿ç”¨ï¼Œä½†è¦è‡ªå·±æ‰“åŒ…imageã€‚\n\nå…¶ä»–ç´°é …ï¼Œå¯è‡ªè¡Œåƒè€ƒå®˜æ–¹ç¶²ç«™\nBuild image\næˆ‘å€‘å¯ä»¥å…ˆå¾å®˜æ–¹çš„githubçœ‹çœ‹ï¼Œä»–å€‘æ˜¯æ€éº¼ç·¨è­¯çš„ã€‚\ndrone.yml\n\nå…ˆåŸ·è¡Œï¼Œ scripts/build.sh\nå†æ ¹æ“š docker/Dockerfile.server.linux.amd64 çš„dockerfileå»æ‰“åŒ…ç¨‹å¼ã€‚\n\nä¸‹é¢é€™æ®µï¼Œç›´æ¥å­˜æˆdockerfileå»ç·¨è­¯å§ï¼Œ\nç‰ˆæœ¬è™Ÿè‡ªè¡Œæ›´æ”¹ã€‚\n\nè£œå……èªªæ˜ï¼Œ\ndocker åœ¨ç·¨è­¯çš„æ™‚å€™ï¼Œ\næ¯ä¸€è¡ŒæŒ‡ä»¤ (å‰é¢æœ‰åŠ  RUN æˆ–COPY..çš„é€™ç¨®ç®—ä¸€è¡Œï¼‰ï¼Œ\néƒ½ç®—æ˜¯ä¸€å€‹æ–°çš„imageï¼Œå¯ä»¥çœ‹åˆ°sha256çš„æ•¸å€¼éƒ½ä¸ä¸€æ¨£ï¼Œ\næ‰€ä»¥ç”¨ cd drone åˆ‡ è·¯å¾‘çš„è©±ï¼Œè¦å†åŒä¸€è¡ŒæŠŠè¦åŸ·è¡Œçš„commandï¼Œ\néƒ½åŸ·è¡Œå®Œã€‚\nFROM golang AS Builder\n\nENV DRONE_VERSION v2.9.1\nWORKDIR $GOPATH/src\nRUN git clone https://github.com/drone/drone --branch ${DRONE_VERSION} --single-branch\nRUN cd drone &amp;&amp; pwd &amp;&amp; go mod download &amp;&amp; \\\ngo build -ldflags &quot;-extldflags \\&quot;-static\\&quot;&quot; -tags=&quot;nolimit&quot; github.com/drone/drone/cmd/drone-server\n\nFROM alpine:3.13 AS Certs\n\nRUN apk add -U --no-cache ca-certificates\n\nFROM alpine:3.13\nEXPOSE 80 443\nVOLUME /data\n\nRUN [ ! -e /etc/nsswitch.conf ] &amp;&amp; echo 'hosts: files dns' &gt; /etc/nsswitch.conf\n\nENV GODEBUG netdns=go\nENV XDG_CACHE_HOME /data\nENV DRONE_DATABASE_DRIVER sqlite3\nENV DRONE_DATABASE_DATASOURCE /data/database.sqlite\nENV DRONE_RUNNER_OS=linux\nENV DRONE_RUNNER_ARCH=amd64\nENV DRONE_SERVER_PORT=:80\nENV DRONE_SERVER_HOST=localhost\nENV DRONE_DATADOG_ENABLED=true\nENV DRONE_DATADOG_ENDPOINT=https://stats.drone.ci/api/v1/series\n\nCOPY --from=Certs /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/\nCOPY --from=Builder go/src/drone/drone-server /bin/drone-server\n\nENTRYPOINT [&quot;/bin/drone-server&quot;]\n\næœ¬ä¾†æƒ³ç”¨go get çš„æ–¹å¼ï¼Œç›´æ¥æŠŠç¨‹å¼buildå‡ºä¾†ï¼Œ\nä½†ä¸€ç›´å¡åœ¨go çš„ç‰ˆè™Ÿé™åˆ¶ï¼Œçœ‹äº†ä¸€äº›æ–‡ç« éƒ½èªªè¦æ”¹è£¡é¢çš„ç¨‹å¼ã€‚\nä½†é€™æ±è¥¿å¯«å®Œï¼ŒåŸºæœ¬ä¸Šå°±ä¸æœƒå†å‹•äº†ã€‚\nåªå¥½ç”¨git cloneæŠŠç¨‹å¼å…ˆæŠ“ä¸‹ä¾†ï¼Œå†buildäº†ã€‚\nref.\n\nä½¿ç”¨å®¹å™¨æ–¹å¼ç·¨è­¯ç„¡åŠŸèƒ½é™åˆ¶çš„ Drone CI\ngo getå‘½ä»¤â€”â€”ä¸€éµç²å–ä»£ç¢¼ã€ç·¨è­¯ä¸¦å®‰è£\ngo å‘½ä»¤",
		"tags": [ "note","â±"]
},

{
		"title": "drone k8s-runner é€²éšè¨­å®š",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â± Drone/78. drone k8s-runner é€²éšè¨­å®š/",
		"content": "å‰è¨€\nå†ä¸Šç¯‡ <a class=\"internal-link\" data-note-icon=\"\" href=\"/â± Drone/72. drone on GKE å»ºç«‹/\">72. drone on GKE å»ºç«‹</a>ï¼Œæœ‰è«‡åˆ°k8s runnerï¼Œ\né‚£æ™‚å€™éƒ½åœ¨default çš„ namespaceä¸Šé¢é‹ä½œï¼Œ\næ‰€ä»¥æ²’ä»€éº¼å•é¡Œï¼Œ\nä½†ä¸€åˆ°äº†æ­£å¼ç’°å¢ƒï¼Œè¦åˆ‡å°ˆé–€çš„namespaceï¼Œ\nå°±é™£äº¡æ‹‰)))))\næ­£æ–‡\né€™ç¯‡æœƒè¬›åˆ°å…©å€‹æ±è¥¿ï¼Œ\n\nRBAC(Role-based Access Control)\ndrone k8s-runner policy\n\nStep 1.\nå…ˆå¾Cloud RBACé–‹å§‹èªªèµ·ï¼Œ\nåŸºæœ¬æ¦‚å¿µå¦‚ä¸‹åœ–\n\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\nnamespace: default\nname: drone\nrules:\n- apiGroups:\n- &quot;&quot;\nresources:\n- secrets\nverbs:\n- create\n- delete\n- apiGroups:\n- &quot;&quot;\nresources:\n- pods\n- pods/log\nverbs:\n- get\n- create\n- delete\n- list\n- watch\n- update\n\n---\n\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\nname: drone\nnamespace: default\nsubjects:\n- kind: ServiceAccount\nname: default\nnamespace: default\nroleRef:\nkind: Role\nname: drone\napiGroup: rbac.authorization.k8s.io\n\nrole ï¼š è¨­å®šæ¬Šé™èƒ½åšä»€éº¼äº‹\nroleBinding ï¼š è¦å°‡å“ªå€‹è§’è‰²ç¶å®šæ¬Šé™åˆ°saå¸³è™Ÿ\né€™é‚Šç°¡å–®èªªæ˜roleBinding ï¼ˆå› rolebindingçš„roleRef ç„¡æ³•æŒ‡å®šns)ï¼Œ\n\nå°‡ role, namespace åœ¨ default çš„ drone è·Ÿ\nserviceAccountçš„ namespaceåœ¨ default çš„ default ç¶åœ¨ä¸€èµ·ï¼Œ\n\næ›´ç´°é …çš„èªªæ˜ï¼Œè«‹åƒè€ƒ (1)~(4)\nç•¶æœå‹™æ²’æœ‰æŒ‡å®šæ˜¯å“ªä¸€å€‹ ã€serviceAccountNameã€ï¼Œå°±æœƒä½¿ç”¨é è¨­çš„default ã€‚\næ‰€ä»¥ï¼Œå¦‚æœå°‡namespaceé€šé€šæ”¹æˆdroneçš„è©±ï¼Œæœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ\næœƒå…ˆåœ¨droneçš„ç•«é¢çœ‹åˆ° skip\n\nç„¶å¾ŒæŸ¥çœ‹ k8s-runnerçš„ logï¼Œæœƒçœ‹åˆ°æ²’æœ‰æ¬Šé™ï¼Œè¢«æ‹’çµ•åŸ·è¡Œã€‚\n\nStep 2.\nå†ä¾†è¦è§£æ±ºæ¬Šé™å•é¡Œï¼Œ\nå› ç‚ºk8s-runnerï¼Œé è¨­éƒ½æ˜¯ä½¿ç”¨ default(namespace)çš„defaultå†å»ºç«‹podã€‚\næ‰€ä»¥ï¼Œç¾åœ¨æœ‰å…©ç¨®åšæ³•ï¼ˆé€™é‚Šæœƒè¬›ç¬¬äºŒç¨®åšæ³•ï¼‰ã€‚\n\nroleçš„æ¬Šé™ï¼Œçµ¦ä»–èƒ½å¤ åœ¨ä¸åŒçš„nsä¹Ÿèƒ½ä½ˆç½²çš„æ¬Šé™ï¼ˆé€™éƒ¨åˆ†æ‡‰è©²æ˜¯å»ºç«‹clusterRoleï¼Œæ²’è©¦éï¼‰ã€‚\nk8s-runneråœ¨pipelineæ™‚ï¼Œè¦æ±‚åœ¨æŒ‡å®šçš„namespaceåšå‹•ä½œã€‚\n\nå»ºç«‹ä¸€å€‹ policy(5) çš„ ymlï¼Œ\nåº•ä¸‹çš„é—œéµæ¬„ä½ï¼Œæœ‰åœ¨ç¢°k8sçš„æ‡‰è©²éƒ½å¾ˆç†Ÿï¼Œ\nmatché€™å¡Šè¦å†æ¸¬è©¦çœ‹çœ‹ï¼Œé€™é‚Šå°±å…ˆè¨»è§£æ‰ã€‚\nï¼ˆæ–‡ä»¶ä¸Šæ˜¯èªª ï¼Œå¯ä»¥ç”¨ä¾†å®šç¾©å¤šå€‹policyç”¨ï¼Œ\nç•¶æœ‰ç¬¦åˆæ™‚ï¼Œå°±åŸ·è¡Œä¸‹é¢çš„policyï¼‰\né€™é‚Šè¨­å®šè¦å‰‡æ˜¯ï¼Œ\n\nä½ˆç½²æ™‚ï¼Œä½ˆç½²åˆ°droneçš„namespace ï¼Œ\nè³‡æºè«‹æ±‚æ˜¯ 512Mi,ç¯€é»é¸æ“‡çš„label æ˜¯ disktype: ssd\n\nkind: policy\nname: drone\n\n# match:\n# repo:\n# - &quot;octocat/*&quot;\n# - &quot;octocat/hello-world&quot;\n\nmetadata:\nnamespace: drone\n\nresources:\nrequest:\nmemory: 512MiB\n# limit:\n# cpu: 4000\n# memory: 1GiB\n\nnode_selector:\ndisktype: ssd\n\nå†ä¾†è¦åœ¨runnerè£¡é¢æ›è¼‰é€™å€‹æª”æ¡ˆï¼Œç›´æ¥ç”¨ configMapå°‡æª”æ¡ˆè¼‰å…¥ã€‚\nå»ºç«‹configmap\nkubectl create configmap -n drone drone-policy --from-file=policy.yml --dry-run=client -o yaml | kubectl apply -f -\n\nk8s-runnerå…§æ›è¼‰configmap\nè¦ç‰¹åˆ¥æ³¨æ„env ï¼Œ\nDRONE_POLICY_FILE(6)ï¼Œéœ€è¦æŒ‡å®šä½ çš„ymlä½ç½®ã€‚\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: drone-runner-k8s\nnamespace: drone\nlabels:\ndrone: runner-k8s\nspec:\nreplicas: 1\nselector:\nmatchLabels:\ndrone: runner-k8s\ntemplate:\nmetadata:\nlabels:\ndrone: runner-k8s\nspec:\ncontainers:\n- name: runner\nimage: drone/drone-runner-kube:latest\nports:\n- containerPort: 3000\nvolumeMounts:\n- mountPath: /policy.yml\nname: policy\nsubPath: policy.yml\nenv:\n- name: DRONE_POLICY_FILE\nvalue: /policy.yml\nvolumes:\n- configMap:\ndefaultMode: 420\nname: drone-policy\nname: policy\n\né™„è¨»ï¼Œå¦‚æœnode_selectorï¼Œé¸æ“‡çš„ç¯€é»æ˜¯ssdçš„ç¡¬ç¢Ÿçš„è©±ï¼Œ\næ™‚é–“æœƒæ¸›å°‘ 35%ã€‚ ä½†æ¯å€‹æœˆæœƒå¤š13å¡Šç¾é‡‘ã€‚\nå†ä¾†ä¸‹ç¯‡æ‡‰è©²å°±æ˜¯å¯«å°‡droneå®Œæ•´å°å…¥istioçš„åšæ³•äº†\nref.\n\nä½¿ç”¨ RBAC é‘‘æ¬Š\nKubernetesæ¬Šé™ç®¡ç†ä¹‹RBAC\nDay-28 ç­è§£ Namespace èˆ‡ Rbac\n[Kubernetes] å¦‚ä½•å–å¾—åˆæ³•å¯ç”¨çš„æ¬Šé™ï¼Œè®“ pod èˆ‡ API server æºé€š\nPolicies\nDRONE_POLICY_FILE\né…ç½® Pod çš„ Service Account",
		"tags": [ "note","â±"]
},

{
		"title": "GCP MOC",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/0.GCP MOC/",
		"content": "é›²æ¶æ§‹ä¸­å¿ƒ\nref. ### é›²æ¶æ§‹ä¸­å¿ƒ\nPrice\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/Price/GCPè²»ç”¨/\">GCPè²»ç”¨</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/Price/GCP CPUç”¨é€”/\">GCP CPUç”¨é€”</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/Price/180. GCP ç›£æ§è²»ç”¨/\">180. GCP ç›£æ§è²»ç”¨</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/Price/126. GCP ç¡¬ç¢Ÿè²»ç”¨æ¯”è¼ƒ/\">126. GCP ç¡¬ç¢Ÿè²»ç”¨æ¯”è¼ƒ</a>\nGCP\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/88.æ‰¹æ¬¡ä¿®æ”¹GCPçš„label/\">88.æ‰¹æ¬¡ä¿®æ”¹GCPçš„label</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/5. Google Cloud Functioné™åˆ¶/\">5. Google Cloud Functioné™åˆ¶</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/95.cloud buildçš„å•é¡Œ/\">95.cloud buildçš„å•é¡Œ</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/97. Anthos åˆé«”é©—/\">97. Anthos åˆé«”é©—</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/120. æŒ‡ä»¤å‚™ä»½cloudSQLåŠä¸‹è¼‰/\">120. æŒ‡ä»¤å‚™ä»½cloudSQLåŠä¸‹è¼‰</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/121.cloudCDNè¨­å®š/\">121.cloudCDNè¨­å®š</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/128. è§£æ±º the gcp auth plugin is deprecated in v1.22+/\">128. è§£æ±º the gcp auth plugin is deprecated in v1.22+</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/161. GKEåˆ©ç”¨pubsubé€šçŸ¥è¨Šæ¯åˆ°discord/\">161. GKEåˆ©ç”¨pubsubé€šçŸ¥è¨Šæ¯åˆ°discord</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/164.gcloud install by bash/\">164.gcloud install by bash</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/181. cloudstorageç„¡æ³•ä½¿ç”¨cloudflareè½‰å€/\">181. cloudstorageç„¡æ³•ä½¿ç”¨cloudflareè½‰å€</a>\nGCE\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/19. GCEç¡¬ç¢Ÿå¢åŠ å®¹é‡å¤§å°/\">GCEç¡¬ç¢Ÿå¢åŠ å®¹é‡å¤§å°</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/46.åˆ—å‡ºGCEçš„æ‰€æœ‰VM/\">46.åˆ—å‡ºGCEçš„æ‰€æœ‰VM</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/46.GCEæ©Ÿå™¨åˆ—è¡¨å…§çš„CPUå€‹æ•¸/\">46.GCEæ©Ÿå™¨åˆ—è¡¨å…§çš„CPUå€‹æ•¸</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/79. gcloud compute instance ç­†è¨˜/\">GCEæŒ‡ä»¤</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/130. Google IAP sshå¤±æ•—/\">130. Google IAP sshå¤±æ•—</a>\nGCS\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/8.GCSä½¿ç”¨æ–¹å¼/\">GCSä½¿ç”¨æ–¹å¼</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/109.GCSè‡¨æ™‚ä¸‹è¼‰æ¬Šé™/\">109.GCSè‡¨æ™‚ä¸‹è¼‰æ¬Šé™</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/127. fuse device not found, try 'modprobe fuse' first/\">127. fuse device not found, try 'modprobe fuse' first</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/129. nginx æ›è¼‰gcs/\">129. nginx æ›è¼‰gcs</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/135. gsutilæ•´æ‰¹è¤‡è£½/\">135. gsutilæ•´æ‰¹è¤‡è£½</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/140. gcs æ›è¼‰domain/\">140. gcs æ›è¼‰domain</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/141. gcsè‡ªå‹•åˆªé™¤æª”æ¡ˆ/\">141. gcsè‡ªå‹•åˆªé™¤æª”æ¡ˆ</a>\nNetwrok\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/9.GCPç¶²è·¯å°å¤–çš„æ–¹å¼/\">GCPç¶²è·¯å°å¤–çš„æ–¹å¼</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/13.é¨°è¨Šé›²é€£æ¥GOOGLEé›²/\">13.é¨°è¨Šé›²é€£æ¥GOOGLEé›²</a>\nTroubleshooting\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/17. Gcloud AttributeError module importlib has no attribute util/\">17. Gcloud AttributeError module importlib has no attribute util</a>",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "GCSè‡¨æ™‚ä¸‹è¼‰æ¬Šé™",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/109.GCSè‡¨æ™‚ä¸‹è¼‰æ¬Šé™/",
		"content": "ç¢ç¢å¿µ\nä»Šå¤©ç¶­è­·ï¼Œå¾Œç«¯åŒä»è¦cloudSQLçš„å‚™ä»½æª”ï¼Œ\nç„¶å¾Œï¼Œå› ç‚ºä»–å€‘éƒ½æ²’æ¬Šé™ï¼Œåªå¥½ä¸Ÿå»ç¶²è·¯ç©ºé–“ï¼Œçµ¦ä»–å€‘æŠ“ã€‚\næˆ‘å°±åœ¨æƒ³ï¼Œæ²’é“ç†é˜¿ï¼Œæ‡‰è©²æœ‰å€‹æ–¹æ³•èƒ½å¤ é–‹ç‰¹å®šçš„æª”æ¡ˆè‡¨æ™‚çµ¦äººç”¨ã€‚\næ­£æ–‡\nç”±æ–¼GCSçš„æ¬Šé™æ˜¯ çµ±ä¸€å„²å­˜åˆ†å€ç´šå­˜å–æ¬Šï¼Œ\næ‰€ä»¥ä¸èƒ½ç´°åˆ†æª”æ¡ˆæ¬Šé™çµ¦åˆ¥äººç”¨ã€‚\næ‰€ä»¥ï¼Œé–‹V4ç°½åï¼Œå°±èƒ½çµ¦åˆ¥äººè¨ªå•äº†ã€‚\ngsutil signurl -d 1m gcs-download.json gs://ai-assist-data/&quot;Cloud_SQL_Export_warehouse_2022-10-12 (06:03:23)&quot;.bak\n\n1m è¡¨ç¤ºï¼Œåªé–‹æ”¾ä¸€åˆ†é˜çš„æ™‚é–“\ngcs-download.jsonæ˜¯SAï¼Œå¾IAMé‚£é‚Šæ‰¾åˆ°ä¸€å€‹æœ‰æ¬Šé™ä¸‹è¼‰çš„å¸³è™Ÿç”¢ç”Ÿçš„é‡‘é‘°ã€‚\ngs çš„ç¶²å€ï¼Œå¯ä»¥åˆ°è©³ç´°è³‡æ–™å…§å–å¾— gsutil URI\n\né€™å€‹åŸ·è¡Œå¾Œï¼Œæœƒå¾—åˆ°ä¸€ä¸²\n\næŠŠå¾Œé¢çš„httpsè¤‡è£½ï¼Œå°±èƒ½æ‹¿ä¾†ç”¨äº†ã€‚\néŒ¯èª¤è™•ç†\nå¦‚æœåœ¨åŸ·è¡Œsignurlçš„æ™‚å€™ç™¼ç”Ÿä»¥ä¸‹éŒ¯èª¤ï¼Œ\nCommandException: The signurl command requires the pyopenssl library (try pip install pyopenssl or easy_install pyopenssl)\n\nåŸ·è¡Œ\npip3 install pyopenssl\n\nå…¶ä»–æ–¹å¼\nå°‡åº•ä¸‹çš„æª”æ¡ˆè·‘éè¿´(-R)ï¼Œé€šé€šè¨­æˆpublic-read\ngsutil -m acl set -R -a public-read gs://bucket",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "æŒ‡ä»¤å‚™ä»½cloudSQLåŠä¸‹è¼‰",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/120. æŒ‡ä»¤å‚™ä»½cloudSQLåŠä¸‹è¼‰/",
		"content": "å‰è¨€\næœ‰äººä¸ç¿’æ…£uiæ“ä½œï¼Œ\nåŠ ä¸Šä»–å€‘æ˜¯å…©ä¸‰å€‹æœˆç”¨ä¸€æ¬¡ï¼Œ\né‚£å°±ç”Ÿå€‹æŒ‡ä»¤çµ¦ä»–å€‘ç”¨å§ã€‚\nåšæˆè‡ªå‹•åŒ–æ‡‰è©²ä¹Ÿå¯ä»¥ï¼Œ\nåªæ˜¯è¦çœ‹ä¸€ä¸‹æ¬Šé™è¦ç”¨èª°çš„ã€‚\næ­£æ–‡\nä¸»è¦çš„å…©è¡ŒæŒ‡ä»¤ï¼Œè«‹å°‡è¦–è§’å¾€ä¸‹ç§»\n\ntest-db01: cloudSQLçš„instanceåç¨±\ngs://data/desk-22-12-14.bak ï¼šè¦å­˜æ”¾cloudStorageçš„ä½ç½®\nDesk : è³‡æ–™åº«åç¨±\n\ngcloud storage cp\n\ngcloud beta sql export bak test-db01 gs://data/desk-22-12-14.bak \\\n--database=Desk\n\ngcloud storage cp gs://data/desk-22-12-14.bak /Users/daimom/Downloads\n\nTroubleshooting\n\nåŸ·è¡Œ gcloud storage cp ï¼Œå‡ºç¾error invalid choice storage\n\næ›´æ–° gcloud components\ngcloud components update\n\nref. gcloud beta functions command says &quot;Invalid choice functions&quot;\n\næ¬Šé™å•é¡Œ\ncloudSQL å‚™ä»½æ¬Šé™\nCloud SQL Editor è§’è‰²å’ŒÂ storage.objectAdminÂ IAM è§’è‰²\ncloudStorageä¸‹è¼‰æ¬Šé™\né€™éƒ¨åˆ†å°±éœ€è¦åˆ°cloudStorageçš„bucketè¨­å®šäº†\nref.\nä½¿ç”¨ BAK æª”æ¡ˆåŒ¯å‡ºå’ŒåŒ¯å…¥\nå¾å„²å­˜æ¡¶ä¸‹è¼‰å°è±¡",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "cloudCDNè¨­å®š",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/121.cloudCDNè¨­å®š/",
		"content": "ç¢ç¢å¿µ\nä¹‹å‰æ¸¬å®Œå¾Œå°±å¿˜äº†å¯«ï¼Œ\nä½†ä»Šå¤©æœ‰äººå•æˆ‘æ‰æƒ³èµ·ä¾†ï¼Œ\næˆ‘åˆ°åº•è·‘å»å“ªè¨­å®šçš„ï¼ï¼Ÿ\nç¾åœ¨è¶•ç·Šè£œä¸€ä¸‹\næ­£æ–‡\nå¦‚æœå·²ç¶“åœ¨GCPä¸Šé¢å»ºç«‹å¥½äº†è² è¼‰å¹³è¡¡ï¼Œ\né‚£å°±åˆ°å¾Œç«¯è¨­å®šï¼Œçœ‹è¦é‡å°å“ªå€‹æœå‹™å»é–‹å•“cdnå°±å¥½äº†ã€‚\nä¸Šé¢æœ‰å€‹é€¾æ™‚çš„è¨­å®šï¼Œçœ‹è¦è¨­å®šå¤šå°‘ï¼Œ\nç•¶åˆåŒäº‹æ˜¯æœ‰èªªä»–æ¸¬30ç§’å°±æœƒæ–·ç·šä¸€æ¬¡ï¼Œ\næ‰€ä»¥æˆ‘æœ‰æŠŠé€™é‚Šæ‹‰é•·ã€‚\n\né€™é‚Šè¨­å®šå®Œå¾Œï¼Œåœ¨cloudCDNä¸Šé¢å°±æœƒå¤šä¸€å€‹è¨­å®šå‡ºä¾†ã€‚\n\nä¹Ÿèƒ½ç”¨æŒ‡ä»¤å»æŸ¥ï¼Œå•“ç”¨cdnæ™‚çš„æ¬„ä½\nkubectl get BackendConfig\n\nref. cloudCDN",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "fuse device not found try modprobe fuse first",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/127. fuse device not found, try &#39;modprobe fuse&#39; first/",
		"content": "ç¡ç¡å¿µ\nä»¥å‰ç”¨GKEæ›è¼‰gcsçš„æ™‚å€™ç™¼ç”ŸéŒ¯èª¤ï¼Œfuse device not found, try 'modprobe fuse' firstã€‚è§£æ±ºæ–¹æ³•ã€‚\nç¾åœ¨GKEæœ‰äº†æ–°çš„æ›è¼‰GCSæ–¹æ³•äº†ï¼ŒAnnouncing Cloud Storage FUSE and GKE CSI driver for AI/ML workloadsã€‚\nç›®å‰æˆ‘æ²’é‡‡ç”¨æ­¤æ–¹å¼ï¼Œè«‹ä»–å€‘æ”¹ç”¨apiçš„æ–¹å¼ä¸Šå‚³æª”æ¡ˆäº†ï¼Œ\nè¦è¨ªå•çš„è©±ï¼Œç”¨Load balancing æŒ‡å‘GCS bucketã€‚\né€™æ–‡ç« ç”¨æ–¹æ³•æ‡‰è©²ä¸å¤ªé©ç”¨ï¼Œ\nè€Œä¸”æ­¤æ–¹æ³•æœ‰ç¼ºé»ï¼Œç•¶ä½ æª”æ¡ˆæ•¸é‡å¤ªå¤šæ™‚ï¼Œæœƒæ›è¼‰ä¸èµ·ä¾†ã€‚\næ­£æ–‡\n\napt install -y gnupg lsb-release\nexport GCSFUSE_REPO=gcsfuse-`lsb_release -c -s`\nexport GCSFUSE_REPO=gcsfuse-buster\necho &quot;deb https://packages.cloud.google.com/apt $GCSFUSE_REPO main&quot; | tee /etc/apt/sources.list.d/gcsfuse.list\ncurl https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -\napt-get update\napt-get install -y gcsfuse\nexport GOOGLE_APPLICATION_CREDENTIALS=/home/gcs-download.json\ngcsfuse sms_backend_backup ./gcs-mount\n\néœ€è¦ç”¨ç‰¹æ¬Šæ¨¡å¼\nåœ¨yamlæª”è£é¢ï¼ŒåŠ ä¸Š\nsecurityContext:\nprivileged: true",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "è§£æ±º the gcp auth plugin is deprecated in v1.22+",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/128. è§£æ±º the gcp auth plugin is deprecated in v1.22+/",
		"content": "ç¡ç¡å¿µ\næ¯æ¬¡ä¸‹kubectlçš„æŒ‡ä»¤ç¸½æœƒè·³é€™å€‹éŒ¯èª¤å‡ºä¾†ï¼Œ\nä¸è™•ç†ä¹Ÿæ²’ä»€éº¼äº‹ï¼Œä½†å°±æ˜¯éƒ½æœƒå‡ºç¾ã€‚\nä»Šå¤©...å°±è§£æ±ºå§\næ­£æ–‡\nè­¦å‘Šè¨Šæ¯é€šå¸¸æ˜¯é€™æ¨£ï¼Œ\nä½†ä½ deployçš„æœå‹™éƒ½é‚„æ˜¯æœƒè·‘ã€‚\n\nWARNING: the gcp auth plugin is deprecated in v1.22+, unavailable in v1.26+; use gcloud instead.\nTo learn more, consult https://cloud.google.com/blog/products/containers-kubernetes/kubectl-auth-changes-in-gke\n\né€™æ˜¯ç”±æ–¼dockeråœ¨å®‰è£çš„æ™‚å€™ï¼Œæœƒé †ä¾¿å°‡kubectlå®‰è£é€²å»ï¼Œ\nwhere kubectl\n\nå¯ä»¥å¾—åˆ° kubectlçš„åŸ·è¡Œæª”ä½ç½®\n\n/usr/local/bin/kubectl\n\næŸ¥è©¢kubectlçš„softlink ä½ç½®ï¼ŒæœƒæŸ¥åˆ°kubectlçš„å‘½ä»¤æ˜¯è·Ÿdockeré€£çµçš„ã€‚\né™„è¨», ll è·Ÿ ls -la åŒæ„\nls -la /usr/local/bin\n\nå…ˆå°‡æœ¬ä¾†çš„softlinkåˆªé™¤ï¼Œ\nrm /usr/local/bin/kubectl\n\nå®‰è£gcloudç‰ˆæœ¬çš„kubectl\ngcloud components install kubectl\n\nè£å®Œå¾Œå¦‚æœé‚„ä¸èªè­˜æŒ‡ä»¤ï¼Œ\néœ€è¦é¡å¤–è™•ç†ã€‚\nå…ˆæª¢æŸ¥ä¸€ä¸‹gcloudæœ‰æ²’æœ‰å®‰è£å¥½kubectlï¼Œ\nå¦‚æœpathæœ‰è·¯å¾‘å°±ä»£è¡¨æ­£å¸¸ï¼Œä¸ç„¶éœ€è¦é‡æ–°è£½ä½œsoftlink\ngcloud info | grep -i kubectl\n\nè£½ä½œsoftlink\nln /usr/local/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/bin/kubectl /usr/local/bin/kubectl\n\nref.\n- [å¯¦ä½œç­†è¨˜] éŒ¯èª¤è™•ç† the gcp auth plugin is deprecated\n- How to set path to kubectl when installed using gcloud components install?",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "nginx æ›è¼‰gcs",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/129. nginx æ›è¼‰gcs/",
		"content": "ç¡ç¡å¿µ\nä»Šå¤©è¦ä¸ŠQAæ¸¬è©¦äº†ï¼Œç„¶å¾Œæˆ‘çªç„¶ç™¼ç¾æˆ‘ä¹‹å‰æ¸¬å®Œæ²’ç•™ä¸‹ç­†è¨˜ã€‚\nç¾åœ¨éƒ½å¿«å¿˜å…‰äº†ï¼Œé‚„å¥½æœ€å¾Œæœ‰æ‰¾å›è¨˜æ†¶ã€‚\nä¾†è£œä¸€ä¸‹äº†ã€‚\næ­£æ–‡\nä»Šå¤©è¦åšçš„æ˜¯æŠŠGCSè®Šæˆä¸€å€‹åœ–ç‰‡ä¸Šå‚³ç©ºé–“ï¼Œ\nå¯ä»¥ç”¨nginxä¾†è¨ªå•ã€‚\n\nå‰è¨€\næŸå€‹æ¡ˆå­ï¼Œè¦æ•´å€‹ç¿»æ‰é‡åšï¼Œé€™æ¬¡è¦è®“VMçš„æ©Ÿå™¨è·ŸGKEçš„podèƒ½å¤ åŒæ™‚å­˜å–ä¸€å€‹å„²å­˜ç©ºé–“ï¼Œ\né è¨ˆä½¿ç”¨Google Cloud Storageï¼Œè¸©äº†ä¸€å€‹æ—©ä¸Šçš„å‘ã€‚\næ­£æ–‡\né è¨ˆåšå…©å€‹é …ç›®\n\nåœ¨VMä¸Šé¢æ›è¼‰gcsçš„è³‡æ–™å¤¾\n\nåœ¨GKE ä¸Šé¢çš„podåŒæ™‚æ›è¼‰ gcsçš„è³‡æ–™å¤¾\n\nåœ¨VMä¸Šé¢æ›è¼‰gcsçš„è³‡æ–™å¤¾\nå®‰è£æ–¹å¼ï¼Œç›®å‰æˆ‘çš„vmæ˜¯ RedHat æ‰€ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼ï¼ŒCentOSä¹Ÿæ˜¯ç”¨åŒæ¨£çš„æ–¹å¼\n\nConfigure the gcsfuse repo:\n\nsudo tee /etc/yum.repos.d/gcsfuse.repo &gt; /dev/null &lt;&lt;EOF\n[gcsfuse]\nname=gcsfuse (packages.cloud.google.com)\nbaseurl=https://packages.cloud.google.com/yum/repos/gcsfuse-el7-x86_64\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg\nhttps://packages.cloud.google.com/yum/doc/rpm-package-key.gpg\nEOF\n\nInstall gcsfuse:\n\nsudo yum install gcsfuse\n\nå®Œæˆï¼Œå…¶ä»–å®‰è£æ–¹å¼ï¼Œè«‹åƒè€ƒGoogleCloudPlatform/gcsfuse/install.md\nç™»å…¥ä½¿ç”¨ï¼Œ\né€™é‚Šå…ˆä½¿ç”¨ gcloud auth login åšæ¸¬è©¦\nå…ˆå»ºç«‹è³‡æ–™å¤¾ mkdir upload\næ›è¼‰ gcsfuse my-bucket upload\nå¸é™¤æ›è¼‰ fusermount -u upload\nDebugç”¨\ngcsfuse --foreground --debug_gcs --debug_http --debug_fuse --debug_invariants --key-file=/home/user/Downloads/my-key.json mybucket /upload\n\næ°¸ä¹…åŠ å…¥GOOGLE_APPLICATION_CREDENTIALSè®Šæ•¸\né–‹å•Ÿ /etc/profiles\næ–°å¢ export GOOGLE_APPLICATION_CREDENTIALS=&quot;/home/user/Downloads/my-key.json&quot;\nä¿®æ”¹æª”æ¡ˆå¾Œè¦æƒ³é¦¬ä¸Šç”Ÿæ•ˆé‚„è¦åŸ·è¡Œ#\nsource /etc/profileä¸ç„¶åªèƒ½åœ¨ä¸‹æ¬¡é‡é€²æ­¤ä½¿ç”¨è€…æ™‚ç”Ÿæ•ˆã€‚\n\nref.Linuxç³»çµ±ç’°å¢ƒè®Šæ•¸å’Œåˆ¥åè¨­å®šï¼ˆæ°¸ä¹…ç”Ÿæ•ˆå’Œè‡¨æ™‚ç”Ÿæ•ˆï¼‰\né™„è¨»ï¼Œjsonæª”æ¡ˆçš„å–å¾—åœ¨ IAMè§’è‰²å…§çš„æœå‹™è³¬æˆ¶\nref.å‰µå»ºå’Œç®¡ç†æœå‹™å¸³è™Ÿå¯†é‘°ã€‚\næ–°å¢å®ŒGCSï¼Œè¨˜å¾—æŠŠæ¬Šé™çµ¦æœå‹™è³¬æˆ¶ã€‚è¨˜å¾—é¸æ“‡å®Œæ•´æ¬Šé™ï¼ˆFig. 1)\nè‡ªå‹•æ›è¼‰\næœ‰æ¬Šé™äº†å·²å¾Œï¼Œå†ä¾†å°±æ˜¯è‡ªå‹•æ›è¼‰äº†ã€‚\nåˆ°/etc/fstabä¸Šï¼Œè¼¸å…¥\nmy_bucket /home/ezio/upload gcsfuse key_file=key/key.json,rw,user,allow_other,uid=1008,gid=1009 0 0\n\né‡é–‹æ©Ÿæ¸¬è©¦çœ‹çœ‹ï¼Œæ”¶å·¥ã€‚\nref.\nHow to use mount command in fstab file\ngcsfuse automount on a non root user\næŸ¥è©¢ç›®å‰ç™»å…¥ä½¿ç”¨è€…çš„uid è·Ÿ gid\nid $(whoami)\n\nå¦‚æœè¦çœ‹å…¨éƒ¨ä½¿ç”¨è€…çš„è©±ï¼Œ\ncat /etc/passwd\n\nref.Linux çš„å¸³è™Ÿèˆ‡ç¾¤çµ„\n\nåœ¨GKE ä¸Šé¢çš„podåŒæ™‚æ›è¼‰ gcsçš„è³‡æ–™å¤¾\nåŸºæœ¬çš„æ–¹å¼ï¼Œ\nå…ˆè‡ªå·±ç”¢ç”Ÿä¸€å€‹ image\n\nFROM golang:1.14-alpine AS build-env\nENV GO111MODULE on\n\n# WORKDIR /å·¥ä½œåéŒ„åç¨± ç•¶å‰çš„å·¥ä½œç›®éŒ„åç¨±ï¼Œè‹¥æ˜¯ä¸å­˜åœ¨å‰‡æœƒæ–°å»ºè©²ç›®éŒ„ï¼Œ\n# éœ€è¦æ³¨æ„çš„æ˜¯copyè·Ÿrunçš„æŒ‡ä»¤éƒ½æ˜¯ä»¥WORKDIRç‚ºç•¶å‰ç›®éŒ„ä¸‹å»è·‘çš„ï¼Œ\n# é‹ç”¨çš„æ™‚å€™éœ€è¦æ³¨æ„ç›¸å°ä½ç½®ã€‚\nWORKDIR $GOPATH/src\n\nRUN go get -u github.com/googlecloudplatform/gcsfuse\n\nCOPY key.json .\n\nFROM alpine:3.6\nRUN apk add --no-cache ca-certificates fuse &amp;&amp; rm -rf /tmp/*\nCOPY --from=build-env /go/bin/gcsfuse /usr/local/bin\nCOPY --from=build-env /go/src/key.json /\nWORKDIR /\n\nä½ˆç½² Deployment\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nlabels:\napp: gcs-fuse\nversion: v1\nnamespace: debug\nname: gcsfuse-test\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: gcs-fuse\nversion: v1\ntemplate:\nmetadata:\nlabels:\napp: gcs-fuse\nversion: v1\nspec:\ncontainers:\n- name: gcsfuse-test\nimage: gcr.io/your-project/gcsfuse:v1.2\n# image: golang:1.14-alpine\n# command: [ &quot;/bin/sh&quot;, &quot;-c&quot;, &quot;--&quot; ]\n# args: [ &quot;while true; do sleep 600; done;&quot; ]\nsecurityContext:\nprivileged: true\ncommand:\n- &quot;/bin/sh&quot;\n- &quot;-c&quot;\n- &quot;while true; do mkdir /upload ; gcsfuse --key-file=key.json your-bucket /folder; sleep 600; done; &quot;\n\nå¦‚æœè·Ÿç¾æœ‰çš„ç¨‹å¼æ•´åˆçš„è©±ï¼Œ\nç”±æ–¼è¦åŸ·è¡Œå¤šè¡ŒæŒ‡ä»¤ï¼Œéœ€ä½¿ç”¨shellScriptçš„æ–¹å¼åŸ·è¡ŒæŒ‡ä»¤ã€‚\nå¯èƒ½æœƒé‡åˆ°ä¸‹åˆ—æƒ…æ³\n&quot;exec: &quot;/init.sh&quot;: permission denied\nåœ¨Dockerfileä¸Šä¿®æ”¹æ¬Šé™\nRUN chmod +x /init.sh\n\nref.\ngetting permission denied in docker run\nexec user process caused &quot;exec format error&quot;\næœ‰äººèªªåœ¨shçš„é ‚ç«¯åŠ ä¸Š\n#!/bin/bash\nä½†æˆ‘è©¦äº†æ²’ç”¨ï¼Œåœ¨çŒœæƒ³å¯èƒ½æ˜¯alpine linuxæ²’æœ‰bashå°è‡´\næ‰€ä»¥æ”¹ç”¨ä¸‹é¢é€™å€‹\nENTRYPOINT [&quot;sh&quot;,&quot;/run.sh&quot;]\n\nref. standard_init_linux.go:178: exec user process caused â€œexec format errorâ€\nåŸ·è¡Œshæ™‚å¡ä½ï¼Œdebugæ–¹å¼\nç”¨if elseæª¢æŸ¥\nif mkdir /upload; then\necho &quot;mkdir directory! Success&quot; 1&gt;&amp;2\ngcsfuse --key-file=key.json yellow-video /upload\nelse\necho &quot;Could not mkdir directory!&quot; 1&gt;&amp;2\nexit 1\nfi\n\nå¦å¤–ï¼Œæœ€å¾Œæ‰¾å‡ºä¾†åŸå› æ˜¯å› ç‚ºå…ˆåŸ·è¡Œgoçš„ç¨‹å¼ï¼Œå°è‡´å¾ŒçºŒå¡ä½ï¼Œæ‰€ä»¥å…ˆå»ºç«‹è³‡æ–™å¤¾å¾Œï¼Œå†åŸ·è¡Œgo\nref.\nShell Script é‡åˆ°éŒ¯èª¤æ™‚è‡ªå‹•é€€å‡ºé›¢é–‹\nref.\nèº«ä»½é©—è­‰å…¥é–€\nLinuxç³»çµ±ç’°å¢ƒè®Šæ•¸å’Œåˆ¥åè¨­å®šï¼ˆæ°¸ä¹…ç”Ÿæ•ˆå’Œè‡¨æ™‚ç”Ÿæ•ˆï¼‰\n\né€™ç¯‡æœ‰è¬›åˆ°å¦‚ä½•åœ¨deployæ›è¼‰GCS\né€šå¸¸å°±æ˜¯è¦å®‰è£ä¸€äº›æ±è¥¿ã€‚\næœƒä½¿ç”¨åˆ°gcsfuseé€™å€‹æŒ‡ä»¤ï¼Œ\næ‰€ä»¥æˆ‘é¸æ“‡ç›´æ¥å»ºä¸€å€‹imageï¼Œ\nç„¶å¾Œæ›è¼‰çš„æ™‚å€™ç›´æ¥ç”¨é‚£å€‹imageå°±å¥½ã€‚\ngcs-download.json æ˜¯ è¦æ›è¼‰GCSç”¨çš„æ¬Šé™jsonæª”\nFROM nginx:latest\nWORKDIR /app\n\nCOPY gcs-download.json .\n#Start CloudStorage\nRUN apt update &amp;&amp; apt install -y gnupg lsb-release\nRUN echo &quot;deb https://packages.cloud.google.com/apt gcsfuse-$(lsb_release -c -s) main&quot; | tee /etc/apt/sources.list.d/gcsfuse.list\nRUN curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -\nRUN apt-get update &amp;&amp; apt-get install -y gcsfuse\nENV GOOGLE_APPLICATION_CREDENTIALS=/app/gcs-download.json\n\nWORKDIR /usr/share/nginx/html/files\n\nç„¶å¾Œéƒ¨ç½²çš„yamlï¼Œ\né€™é‚Šè¦æ³¨æ„çš„åœ°æ–¹æ˜¯\n1.\nnginx.conf è¦åŠ ä¸Š user root ï¼Œ\né€™æ˜¯å› çˆ²gcsæ›è¼‰è³‡æ–™å¤¾æ˜¯ç”¨rootçš„è§’è‰²ï¼Œæ‰€ä»¥å¦‚æœnginxä¸ç”¨rootå•“å‹•ï¼Œ\næœƒå‡ºç¾403çš„æ¬Šé™å•é¡Œã€‚\nref. å››ç¨®è§£æ±ºNginxå‡ºç¾403 forbidden å ±éŒ¯çš„æ–¹æ³•\n2.\ndaemon off; é€™éƒ¨åˆ†æŒ‡çš„æ˜¯è¦è®“nginxèƒ½å¤ åœ¨å‰æ™¯åŸ·è¡Œï¼Œä¸ç„¶podæœƒä¸€ç›´é‡é–‹ã€‚\nref. nginx -g &quot;daemon off;&quot; ä½ å­¸å»¢äº†å—ï¼Ÿ\napiVersion: v1\nkind: ConfigMap\nmetadata:\nname: systemfile-nginx-config\nnamespace: default\ndata:\nnginx.conf: |\nuser root;\nworker_processes auto;\n\nerror_log /var/log/nginx/error.log notice;\npid /var/run/nginx.pid;\n\nevents {\nworker_connections 1024;\n}\n\nhttp {\ninclude /etc/nginx/mime.types;\ndefault_type application/octet-stream;\n\nlog_format main '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '\n'$status $body_bytes_sent &quot;$http_referer&quot; '\n'&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';\n\naccess_log /var/log/nginx/access.log main;\n\nsendfile on;\n#tcp_nopush on;\n\nkeepalive_timeout 65;\n\n#gzip on;\n\ninclude /etc/nginx/conf.d/*.conf;\n}\n\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\nname: sms-systemfile-config\nnamespace: default\ndata:\ndefault.conf: |\nserver {\nlisten 80 default_server;\nserver_name _;\nserver_tokens off;\n\nindex index.html;\n\nlocation /files {\nalias /usr/share/nginx/html/files;\nautoindex on;\n}\n\nlocation / {\nroot /usr/share/nginx/html;\nindex index.html;\n}\n\nerror_page 500 502 503 504 /50x.html;\nlocation = /50x.html {\nroot /usr/share/nginx/html;\n}\n}\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nname: systemmanageservice-systemfile\nnamespace: default\nlabels:\ngroup: systemmanageservice\napp: systemfile\nspec:\nreplicas: 1\nrevisionHistoryLimit: 5\nprogressDeadlineSeconds: 15\nselector:\nmatchLabels:\ngroup: systemmanageservice\napp: systemfile\nstrategy:\nrollingUpdate:\nmaxSurge: 25%\nmaxUnavailable: 25%\ntype: RollingUpdate\ntemplate:\nmetadata:\nlabels:\ngroup: systemmanageservice\napp: systemfile\nspec:\ncontainers:\n- name: systemmanageservice-systemfile\nimage: gcs-nginx:0.0.2\ncommand:\n- /bin/bash\n- '-c'\n- &gt;-\ngcsfuse systemfile-qa /usr/share/nginx/html/files &amp;&amp; nginx -g\n&quot;daemon off;&quot;;\nimagePullPolicy: Always # IfNotPresent, Always, Never\nsecurityContext:\nprivileged: true\nports:\n- name: http\ncontainerPort: 80\nprotocol: TCP\nresources: {}\nterminationMessagePath: /dev/termination-log\nterminationMessagePolicy: File\nvolumeMounts:\n- name: config-volume\nmountPath: /etc/nginx/conf.d/default.conf\nsubPath: default.conf\nreadOnly: true\n- name: nginx-config-volume\nmountPath: /etc/nginx/nginx.conf\nsubPath: nginx.conf\nreadOnly: true\nvolumes:\n- name: config-volume\nconfigMap:\nname: sms-systemfile-config\nitems:\n- key: default.conf\npath: default.conf\ndefaultMode: 420\n- name: nginx-config-volume\nconfigMap:\nname: systemfile-nginx-config\nitems:\n- key: nginx.conf\npath: nginx.conf\ndefaultMode: 420\ndnsPolicy: ClusterFirst\nrestartPolicy: Always\nterminationGracePeriodSeconds: 30\nschedulerName: default-scheduler\nsecurityContext: {}",
		"tags": ["Start", "tcp_nopush", "gzip", "note","â˜ï¸"]
},

{
		"title": "é¨°è¨Šé›²é€£æ¥GOOGLEé›²",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/13.é¨°è¨Šé›²é€£æ¥GOOGLEé›²/",
		"content": "å‰è¨€\nåˆåœ¨ææ–°çš„æ±è¥¿äº†ï¼Œé€™æ¬¡è¦æŠŠé¨°è¨Šé›²ï¼ˆTKEï¼‰è·ŸGoogleé›²ï¼ˆGCPï¼‰ï¼ŒåšVPNå°é€£ï¼Œ\né€™æ¬¡ä¸€æ¨£åˆå¼„äº†å¹¾å¤©....æœ€å¾Œé‚„æ˜¯æ‰¾äº†GOOGLEå·¥ç¨‹å¸«å”åŠ©ã€‚\næ­£æ–‡\nä¸‹é¢çš„æ­¥é©Ÿï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯TKEè·ŸGCPï¼Œäº’ç›¸åˆ‡æ›è¨­å®šã€‚\n\né¨°è¨Šé›²è¨­å®šç¶²é—œIP\nç§æœ‰ç¶²è·¯-&gt; VPNé€£æ¥-&gt;VPNç¶²é—œ\n\n!<a class=\"internal-link is-unresolved\" href=\"/404\">13.fig-1.jpg</a>\nå…§å®¹å°±ç…§æƒ³è¼¸å…¥çš„æ‰“ï¼Œè¼¸å…¥å®Œæˆå¾Œæœƒçœ‹åˆ°å…¬ç¶²IPï¼Œç‚ºäº†æ–¹ä¾¿æºé€šï¼Œå°±ç¨±å‘¼ä»–ç‚ºTKEçš„é–˜é“IPã€‚\n\nGCPè¨­å®šVPNé–˜é“\né€™é‚Šçš„é¸é …æ¯”è¼ƒç¹ç‘£ï¼Œå› ç‚ºé¨°è¨Šé›²ä¸æ”¯æ´IKEv2ï¼ŒåŒæ™‚ä¹Ÿä¸æ”¯æ´BGPçš„å”å®šï¼Œ\næ‰€ä»¥Googleè¦ä½¿ç”¨å‚³çµ±VPNã€‚\né«˜å¯ç”¨æ€§çš„VPNæœ‰äº›è¦æ±‚æ‰èƒ½ä½¿ç”¨ï¼Œè«‹åƒè€ƒè½‰ç‚ºé«˜å¯ç”¨æ€§ VPN\n\nå¾Fig.3 æœ‰é€£çµå¯ä»¥åˆ‡åˆ° å‚³çµ±VPNè¨­å®šï¼Œ\nå†ä¾†çµ‚æ–¼è¦é–‹å§‹è¨­å®šGCPé–˜é“IPäº†ã€‚\nå»ºç«‹IPï¼Œé€™é‚Šå»ºç«‹çš„å°±æ˜¯GCPçš„é–˜é“ipï¼Œé€™çµ„å°±æ˜¯è¦èˆ‡ TKEçš„é–˜é“IP å°è¯çš„IPã€‚\n\nå…¶ä»–çš„é¸é …ï¼Œ\n\nåç¨±ï¼š è‡ªå¡«\nç¶²è·¯ï¼š VPN è¦é€£çµçš„ Compute Engine ç¶²è·¯\nå€åŸŸï¼š é€£çµè‡³ Compute Engine ç¶²è·¯çš„é–˜é“æ‰€åœ¨åœ°å€\n\nGCPçš„é€šé“è¨­å®š\n\nåç¨±ï¼š éš¨æ„\né ç«¯å°ç­‰äº’é€£IPï¼š TKEçš„é–˜é“IP\nIKEç‰ˆæœ¬ï¼šé€™é‚Šé¸ IKEv1\nIKEé å…ˆå…±ç”¨é‡‘é‘°ï¼š å¯ä»¥è‡ªè¡Œè¼¸å…¥ æˆ–æ˜¯ ç”±ç³»çµ±ç”¢ç”Ÿï¼Œä½†è¦æ³¨æ„é¨°è¨Šé›²ä¸æ”¯æ´ ç‰¹æ®Šç¬¦è™Ÿï¼ˆ. / ä¹‹é¡çš„ï¼‰ï¼Œ\næ‰€ä»¥è¦æ³¨æ„è‡ªè¡Œç”¢ç”Ÿçš„é‡‘é‘°\nå°å‘é¸é …ï¼š é€™é‚Šé¸æ“‡ ã€ä¾æ“šæ”¿ç­–ã€\né ç«¯ç¶²è·¯ipç¯„åœï¼šè¼¸å…¥TKEçš„ç§æœ‰ç¶²è·¯ç¯„åœï¼Œå¯ä»¥å¾ã€é¨°è¨Šé›²çš„ç§æœ‰ç¶²è·¯-&gt;ç§æœ‰ç¶²è·¯ã€ çœ‹åˆ° IPv4 CIDR (Fig.6)ã€‚\n\nGCPçš„é˜²ç«ç‰†è¨­å®š\nå¯èƒ½éœ€è¦é…ç½®é˜²ç«ç‰†è¦å‰‡ï¼Œä¸ç¢ºå®šã€‚\nref. é…ç½®é˜²ç«ç‰†è¦å‰‡\n4. é¨°è¨Šé›²çš„å°ç«¯ç¶²é—œè¨­å®š\nç§æœ‰ç¶²è·¯-&gt;VPNé€£æ¥-&gt;å°ç«¯ç¶²é—œ\n\nåç¨±ï¼š éš¨æ„\nå…¬ç¶²IP: é€™é‚Šå°±æ˜¯è¼¸å…¥ GCPçš„é–˜é“ip\næ¨™ç±¤ï¼š å¯ä»¥ä¸æ‰“\n\né¨°è¨Šé›²çš„VPNé€šé“è¨­å®š\n\né€šé“åç¨±ï¼šéš¨æ„\nåœ°åŸŸï¼š é€£çµè‡³ç¶²è·¯çš„å€åŸŸ\nVPNç¶²é—œé¡å‹ï¼š ç§æœ‰ç¶²è·¯ã€‚ é›²è¯ç¶²æŒ‡çš„æ˜¯ é¨°è¨Šé›²å…§éƒ¨å„å€åŸŸçš„ç§æœ‰ç¶²è·¯äº’è¯(ref.é›²è¯ç¶²ç”¢å“æ¦‚è¿°)\nç§æœ‰ç¶²è·¯ï¼š è«‹çœ‹(Fig.6)\nVPNç¶²é—œï¼š è«‹çœ‹(Fig.1)\nå°ç«¯ç¶²é—œï¼š è«‹çœ‹(Fig.7)\né å…±äº«é‡‘é‘°ï¼š è«‹çœ‹(Fig.5) çš„é å…ˆå…±äº«é‡‘é‘°\n\nSPDç­–ç•¥\n\næœ¬ç«¯ç¶²æ®µï¼š è«‹çœ‹(Fig.6)\nå°ç«¯ç¶²æ®µï¼š è«‹çœ‹(Fig.4)çš„ç¶²æ®µ\n\nIKEã€IPsecé…ç½®\néœ€èˆ‡ä¸‹åœ–ä¸€æ‘¸ä¸€æ¨£ã€‚\n\nref. æ”¯æŒçš„ IKE åŠ å¯†æ–¹å¼ï¼Œæ­¤æ–‡å…§(IKEv1 åŠ å¯†æ–¹å¼çš„ç¬¬äºŒéšæ®µï¼ŒæŒ‡çš„å°±æ˜¯ IPsecé…ç½®ï¼‰\nIKE é…ç½®\n\nç‰ˆæœ¬ï¼š IKEv1\nåŠ å¯†ç®—æ³•ï¼š AES-128\nèªè­‰ç®—æ³•ï¼š SHA1\nå”å•†æ¨¡å¼ï¼š main\nDH group: DH2\nIKE SA Lifetimeï¼š 36600\n\nIPsec é…ç½®\n\nåŠ å¯†ç®—æ³•ï¼šAES-128\nèªè­‰ç®—æ³•ï¼šSHA1\nPFSï¼š DH-GROUP2\nIPsec sa Lifetimeï¼š10800\n\nçµå°¾ï¼ˆä¸ï¼Œé‚„æœ‰è·¯ç”±è¦è¨­å®šï¼‰\n\né€™é‚Šæœƒå…ˆçœ‹åˆ°VPNçš„é€šé“ç‹€æ…‹æ˜¯ å·²è¯é€šï¼Œ ä½†å¦‚æœå¯¦éš›å»Pingæ©Ÿå™¨ï¼Œæœƒç™¼ç¾é‚„æ˜¯ä¸é€šã€‚\n\né¨°è¨Šé›²è·¯ç”±è¡¨è¨­å®š\nç§æœ‰ç¶²è·¯-&gt;è·¯ç”±è¡¨-&gt;é»˜èªè·¯ç”±è¡¨\n\næ–°å¢è·¯ç”±ç­–ç•¥(Fig.13)\n\næ–°å¢è·¯ç”±(Fig.14)\n\næ–°å¢è·¯ç”±ï¼šé€™é‚Šæ˜¯å¾é¨°è¨Šé›²è¦è·³å»GCPçš„ç¶²æ®µï¼Œæ‰€ä»¥é€™é‚Šè¦è¼¸å…¥çš„æ˜¯ï¼ˆFig.9)çš„å°ç«¯ç¶²æ®µ\nä¸‹ä¸€è·³é¡å‹ï¼šé¸æ“‡VPNç¶²é—œ\n\nçµè«–\nå¯èƒ½æœ‰äººæœƒæƒ³ï¼Œç‚ºä»€éº¼é¨°è¨Šé›²è¦è¨­å®šè·¯ç”±ï¼Œ\nè€ŒGCPä¸ç”¨è¨­å®šè·¯ç”±ã€‚\nå› ç‚ºåœ¨è¨­å®š(Fig.5)çš„æ™‚å€™ï¼Œå°±å·²ç¶“å¹«ä½ è¨­å®šå¥½äº†ã€‚\nä½†å¦‚æœèµ°çš„æ˜¯ ä¾æ“šè·¯å¾‘ï¼Œé‚£é€™å¡Šå°±å¿…é ˆè¦è‡ªè¡Œè¨­å®šäº†ã€‚\nå¦‚æœæƒ³è¦çœ‹è·¯ç”±è¡¨ï¼Œå¯ä»¥åˆ°\nGCP-&gt;VPCç¶²è·¯-&gt;è·¯å¾‘\n\nref.\nä½¿ç”¨éœæ…‹è·¯ç”±å‰µå»ºå‚³çµ± VPN\nç¶²çµ¡å’Œéš§é“è·¯ç”±\nã€VPNéŒ¦å›Šã€‘ é¨°è¨Šé›²å°æ¥è¯ç‚ºé›²é…ç½®æŒ‡å—\né€šéVPNé€£æ¥åˆ°VPC\nMTRï¼šLinux ç¶²è·¯è¨ºæ–·å·¥å…·ä½¿ç”¨æ•™å­¸",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "Google IAP sshå¤±æ•—",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/130. Google IAP sshå¤±æ•—/",
		"content": "ç¡ç¡å¿µ\nç‚ºä»€éº¼æœƒç™¼ç”Ÿï¼Œä¿ºä¸çŸ¥é“ã€‚\nä½†å¥½åƒæ˜¯å¥½ä¹‹å‰ç¡¬ç¢Ÿç©ºé–“ä¸å¤ ï¼Œæˆ‘ç äº†è³‡æ–™å¤¾çš„é—œä¿‚...\næ­£æ–‡\nå…ˆçœ‹å€‹éŒ¯èª¤è¨Šæ¯\n\næ¬Šé™æˆæ¬Šå¤±æ•—ï¼Œä¸€èˆ¬ä½¿ç”¨sshé€£ç·šçš„è©±ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯serverçš„ssh keyå‡ºå•é¡Œ\nå¯ä»¥å…ˆåƒè€ƒ [GCP]é‡åˆ°permission denied (publickey)æ€éº¼è¾¦ï¼Ÿ\næ‰€ä»¥æˆ‘æ‰å›æƒ³èµ·ï¼Œä¹‹å‰æˆ‘å¥½åƒå»ç éè³‡æ–™å¤¾ã€‚\næ‰€ä»¥å…ˆå¼„sshèƒ½å¤ ç›´é€£GCEçš„æ©Ÿå™¨ï¼Œå†ä¾†ç´°çœ‹è£é¢çš„ç‹€æ³ã€‚\nSSHè§£æ³•\n\nå»ºç«‹ssh key\n\nssh-keygen -C &quot;ezio&quot;\n\né€™é‚Šä½¿ç”¨ezioç•¶ä½œåç¨±\n\nè¤‡è£½ public key\nå°‡ ~/.ssh/id_rsa.pubçš„å…§å®¹è¤‡è£½\næœ‰ .pubçš„æ˜¯å…¬é‘° ï¼Œæ²’æœ‰çš„æ˜¯ ç§é‘°\n\nè²¼ä¸Šå…¬é‘°\nåˆ°GCEçš„VMåŸ·è¡Œå€‹é«”å…§ï¼Œå°‡å‰›å‰›å–å¾—çš„å…¬é‘°è²¼åˆ° ã€å®‰å…¨æ®¼å±¤é‡‘é‘°ã€\n\nç›´æ¥ç”¨sshé€£ç·š\n\n\tssh ezio@32.12.32.12\n\nä¸€èˆ¬åˆ°é€™é‚Šå°±çµæŸäº†ï¼Œä½†ä»Šå¤©çš„ä¸»é¡Œæ˜¯ç”¨IAPç„¡æ³•ç™»å…¥ã€‚\næ›´è©³ç´°çš„ssh ç”¨æ³•ï¼Œè«‹åƒè€ƒä¸‹åˆ—ç¶²å€\nref.\n- ### [Git] å¤šå€‹SSH Keyèˆ‡å¸³è™Ÿçš„è¨­å®š(Mac)\n- [æ•™å­¸] ç”¢ç”ŸSSH Keyä¸¦ä¸”é€éKEYé€²è¡Œå…å¯†ç¢¼ç™»å…¥\nIAPè§£æ³•\nèƒ½é€£é€²å»äº†ï¼Œçµ‚æ–¼ç¢ºå®šè£é¢æ²’æœ‰æˆ‘ä¹‹å‰çš„è³‡æ–™å¤¾ã€‚\næ‰€ä»¥æ‡‰è©²æ˜¯é€™æ¨£å°è‡´ç„¡æ³•ç™»å…¥ï¼Ÿ\nç„¶å¾ŒæŸ¥äº†ä¸€ä¸‹ç›®å‰çš„ä½¿ç”¨è€…å¸³è™Ÿ\ncat /etc/passwd | awk -F: '{print $1}'\n\næœ‰æˆ‘mailçš„ä½¿ç”¨è€…å¸³è™Ÿï¼Œ\nç„¶å¾Œåˆªé™¤ï¼ï¼ï¼\nuserdel -r daimom\n\nå†ä¾†è©¦è©¦ï¼Œç”¨IAPç™»å…¥ï¼Œçœ‹èƒ½ä¸èƒ½åœ¨VMä¸Šé¢é‡å»ºä¸€å€‹ä½¿ç”¨è€…\ngcloud compute ssh --tunnel-through-iap --project sms --zone asia-east1-b test-service01\n\né‚„æ˜¯åŒæ¨£çš„æ¬Šé™å¤±æ•—ã€‚\næœ€å¾Œï¼Œåœ¨GCEçš„è¨­å®šç•«é¢ï¼Œå°‡æœ¬ä¾†çš„å®‰å…¨æ®¼å±¤é‡‘é‘°åˆªæ‰ï¼Œå¼·è¿«é‡å»ºï¼Œ\nçµ‚æ–¼èƒ½é€£äº†",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "gsutilæ•´æ‰¹è¤‡è£½",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/135. gsutilæ•´æ‰¹è¤‡è£½/",
		"content": "ç¡ç¡å¿µ\nå¹«å¾Œç«¯æ”¹åœ–ç‰‡ä¸Šå‚³çš„æ¶æ§‹ï¼Œç›´æ¥æŠŠGCE(Google Compute Engine)çš„æ©Ÿå™¨æ”¹æˆç”¨GCSï¼ˆGoogleCloudStorageï¼‰ï¼Œæ‰€ä»¥è¦æŠŠGCEçš„åœ–æ¬åˆ°GCSã€‚\næ­£æ–‡\n\né¦–å…ˆè¦ç”¨åˆ°çš„æ˜¯ <a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/135. gsutilæ•´æ‰¹è¤‡è£½/\">é—œé–‰sshé€£ç·šå¾Œï¼Œä»å¯åŸ·è¡Œç¨‹å¼</a> ï¼Œä¸ç„¶ç”¨gcloud é€£ç·šæ™‚é–“éä¹…æ˜¯æœƒè¢«åˆ‡æ–·é€£ç·šçš„ã€‚\n\næƒ…å¢ƒ 1 æ•´æ‰¹è³‡æ–™å¤¾\nå°‡nfsè³‡æ–™å¤¾è£é¢çš„æ‰€æœ‰æª”æ¡ˆ/è³‡æ–™å¤¾è¤‡è£½åˆ°bucketè£é¢ï¼Œ\n-m æ˜¯å¤šå·¥ï¼Œ-r æ˜¯è¤‡è£½åº•ä¸‹è³‡æ–™å¤¾çš„æª”æ¡ˆ\ngsutil -m rsync -r nfs gs://systemfile-stage/\n\nref. gsutil rsync\næƒ…å¢ƒ2 ï¼Œè¤‡è£½ç‰¹å®šè³‡æ–™å¤¾\néœ€è¦å…ˆå»ºç«‹ä¸€å€‹æ–‡å­—æª”ï¼Œå°‡è³‡æ–™å¤¾åç¨±å¯«å…¥\nrsync.txt\n\n20220201\n20220301\n20220310\n\nwhile read p;\ndo\nfolder=$(echo &quot;$p&quot;);\ngsutil rsync -r nfs/$p gs://systemfile-stage/$p/\ndone &lt; rsync.txt\n\næƒ…å¢ƒ3ï¼Œè¤‡è£½ç‰¹å®šåœ–ç‰‡\né€™é‚Šåªèƒ½æ ¹æ“šä½ çš„ä¾†æºéš¨æ©Ÿæ‡‰è®Šäº†ï¼Œ\næˆ‘çš„æ–‡ä»¶æ ¼å¼ç‚º\nkeepfile.csv\n\n&quot;files/20230217/104abc69-e612-4b6c-abe4-52b91b79562f.jpg&quot;,&quot;17/2/2023 19:27:46.79&quot;\n&quot;files/20230217/7a30d9eb-5e7c-4eb8-93c9-a72e5bd74f78.jpg&quot;,&quot;17/2/2023 19:28:47.56&quot;\n&quot;files/20230217/ea81d738-ff0c-416a-b6d9-3520fda8f0ed.jpg&quot;,&quot;17/2/2023 19:32:47.44&quot;\n&quot;files/20230217/7a7e1c75-4bec-4831-9a58-fa9650a82df1.jpg&quot;,&quot;17/2/2023 19:33:24.94&quot;\n&quot;files/20230217/cf495ecb-71a9-4d46-95f4-b051f260523a.jpg&quot;,&quot;17/2/2023 19:33:49.4&quot;\n&quot;files/20230217/eb05163b-bc0f-4e3b-96d5-82b0bb4f3a8d.jpg&quot;,&quot;17/2/2023 19:34:41.463&quot;\n\næ‰€ä»¥ï¼Œè¦æ”¹è®€csvçš„æ ¼å¼ï¼Œç„¶å¾Œå°‡è·¯å¾‘èˆ‡æª”æ¡ˆåç¨±æ‹†é–‹ï¼Œ\næœ€å¾Œæ‰è¤‡è£½åœ–ç‰‡éå»ã€‚ä½†é€™å€‹éæˆçœŸçš„ä¹…ï¼Œ\nå¦‚æœå¯ä»¥æœ€å¥½æ˜¯ç”¨rsyncè¤‡è£½è³‡æ–™å¤¾å§ã€‚\n$fileçš„è®Šæ•¸ï¼Œæ‹†è§£å‡ºä¾†æœ‰&quot; ï¼Œæ‰€ä»¥åˆç”¨äº†<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/133. shell scriptå­—ä¸²è™•ç†/\">133. shell scriptå­—ä¸²è™•ç†</a>çš„æ–¹å¼ï¼Œå°‡&quot;åˆªé™¤ã€‚\nwhile IFS=&quot;,&quot; read -r path date\ndo\nfolder=$(echo &quot;$path&quot; | awk -F '/' '{print $2}');\nfile=$(echo &quot;$path&quot; | awk -F '/' '{print $3}');\ngsutil cp -n nfs/$folder/${file%*\\&quot;} gs://systemfile-stage/$folder/\ndone &lt; keepfile-sort.csv\n\nref.\n\nHow to Parse a CSV File in Bash\ngsutil cp",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "gcs æ›è¼‰domain",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/140. gcs æ›è¼‰domain/",
		"content": "ç¡ç¡å¿µ\né€™ç¯‡æ–‡ç« è¦å®Œæˆå¾—éƒ¨åˆ†æœ‰\n\nå»ºç«‹LBï¼Œé€£çµåˆ°GCS\nè¨­å®šcloud Armorç™½åå–®\nCertificate Manager å¢åŠ  sslæ†‘è­‰\n\næ­£æ–‡\nå»ºç«‹è² è¼‰å¹³è¡¡\nå»ºç«‹è² è¼‰å¹³è¡¡ -&gt; HTTP(S) è² è¼‰å¹³è¡¡\n\nä¸èƒ½ç”¨å€åŸŸçš„ï¼Œå› ç‚ºå€åŸŸçš„ä¸æ”¯æ´å¾Œç«¯å€¼å€\n\nå‰ç«¯è¨­å®š\né€™é‚Šå»ºè­°æœ€å¥½å°±ç›´æ¥å»ºç«‹ä¸€å€‹ipï¼Œä¸è¦ç”¨è‡¨æ™‚çš„ã€‚\nå¦‚æœé€šè¨Šå”å®šè¦ç”¨httpsï¼Œéœ€è¦è¨­å®šæ†‘è­‰ï¼Œæ‰€ä»¥é€™é‚Šå…ˆé¸æ“‡httpå°±å¥½\n\nå¾Œç«¯è¨­å®š\nå»ºç«‹å€¼å€\n\nç¬¬ä¸€å€‹ç®­é ­ï¼Œé¸æ“‡ä½ è¦å»ºç«‹çš„å€¼å€\nç¬¬äºŒå€‹ç®­é ­ï¼Œçœ‹è¦ä¸è¦å»ºCDN\nç¬¬ä¸‰å€‹ç®­é ­ï¼Œæ˜¯è¨­å®šç™½åå–®(cloud Armor)ç”¨çš„ï¼Œé€™é‚Šå…ˆä¸è¨­å®šï¼Œç­‰ç­‰ç¬¬äºŒéƒ¨åˆ†æœƒèªª\n\nä¸»æ©Ÿèˆ‡è·¯å¾‘è¦å‰‡\né è¨­æœƒç›´æ¥é€²å…¥bucketï¼Œé€™é‚Šè¦æ³¨æ„ï¼Œè¨˜å¾—è¦å°‡bucket è¨­å®šç‚ºå…¬é–‹ã€‚\n\nè¨­å®šcloud Armor\nä¸Šä¸€éƒ¨ä»½æœ‰èªªåˆ°è¨­å®šç™½åå–®(cloud Armor)\nç¶²è·¯å®‰å…¨æ€§-&gt; Cloud Armor\né€™é‚Šè¦å¢åŠ çš„è¨­å®šæ˜¯ Edge å®‰å…¨æ€§æ”¿ç­–ï¼Œä¸æ˜¯å¾Œç«¯å®‰å…¨æ€§æ”¿ç­–ï¼Œ\nå› ç‚ºåªæœ‰edgeå®‰å…¨æ€§æ”¿ç­–æ”¯æ´å¾Œç«¯å„²å­˜åˆ†å€\nref. å®‰å…¨æ”¿ç­–çš„é¡å‹ã€‚\n\næ–°å¢çš„æ™‚å€™ï¼Œé¸æ“‡ Edgeå®‰å…¨æ€§æ”¿ç­–ï¼Œå¦‚æœæ²’çœ‹åˆ°é€™å€‹é¸é …ï¼Œ\nä½ å¯èƒ½å·²ç¶“é€²åˆ°æ”¿ç­–è£é¢çš„è¦å‰‡äº†ã€‚\n\nå»ºç«‹å®Œæˆå¾Œï¼Œå¯ä»¥å¾ç›®æ¨™å»æ–°å¢è¦æ–°å¢çš„å°è±¡ï¼Œæˆ–æ˜¯åˆ°è² è¼‰å¹³è¡¡é‚£é‚Šåšä¿®æ”¹ã€‚\ncloud armor ç›®æ¨™æ–°å¢\n\né¸æ“‡ã€è² è¼‰å¹³è¡¡å™¨å¾Œç«¯å€¼å€ã€ï¼Œå†é¸æ“‡ä½ çš„bucket\n\nè² è¼‰å¹³è¡¡å™¨ä¿®æ”¹\nå¾Œç«¯è¨­å®š -&gt; ä¿®æ”¹\n\nç®­é ­è™•é¸æ“‡å‰›å‰›æ–°å¢çš„ cloud armorè¦å‰‡\n\nCertificate Manager æ–°å¢æ†‘è­‰\nsslæ†‘è­‰ï¼Œåœ¨GCPä¸Šé¢æ˜¯å¯ä»¥ç›´æ¥å¹«ä½ ç®¡ç†çš„ã€‚\né›–ç„¶ä¸æ”¯æ´ Wildcard SSL Certificate\n\næ†‘è­‰åˆ†æˆè‡ªå·±ç®¡ç†èˆ‡googleä»£ç®¡ï¼Œ\nè‡ªå·±ç®¡ç†ï¼Œæ™‚é–“åˆ°å°±è¦è‡ªå·±ä¸Šå‚³æ–°çš„æ†‘è­‰ã€‚\ngoogleç®¡ç†ï¼Œä¸ç”¨ç®¡ï¼Œæ™‚é–“åˆ°æœƒè‡ªå·±å±•å»¶ï¼Œå‰ææ˜¯ä½ å¿…é ˆè¦æœ‰è©²domainã€‚\né¸æ“‡googleä»£ç®¡çš„æ†‘è­‰ï¼Œè¼¸å…¥è¦ç®¡ç†çš„domain\n\nå„²å­˜å¾Œï¼Œå›åˆ°ç•«é¢æ‡‰è©²æœƒçœ‹åˆ°æ­£åœ¨ä½ˆå»ºä¸­(PROVISIONING)ï¼Œ\né€™å€‹éœ€è¦ä¸€é»æ™‚é–“ï¼Œæœ€ä¹…å¯èƒ½è¦åˆ°60 åˆ†\n\nç„¶å¾Œåˆ°dnsä¼ºæœå™¨ä¸Šé¢ç¶å®šdomainè·Ÿipäº†ï¼Œ\næˆ‘æ˜¯ä½¿ç”¨cloudflareï¼Œå°±ä¸æˆªåœ–äº†ã€‚\nref. ä½¿ç”¨ Google ç®¡ç†çš„ SSL è­‰æ›¸\nè¨­å®šå¥½äº†ä»¥å¾Œï¼Œå›åˆ°è² è¼‰å¹³è¡¡çš„å‰ç«¯è¨­å®š\nç¬¬ä¸€å€‹ç®­é ­ï¼Œå¯ä»¥é¸æ“‡è·Ÿä¸Šé¢ä¸€æ¨£çš„ipï¼ˆä½†ä½ å¿…é ˆå…ˆå¹«ä»–å»ºç«‹ï¼‰\nç¬¬äºŒå€‹ç®­é ­ï¼Œé¸æ“‡å‰›å‰›æ–°å¢çš„sslæ†‘è­‰ï¼Œè¨˜å¾—ä¸€å®šè¦æ–°å¢ï¼Œ\nä¸ç„¶æˆ‘å¡äº†ä¸‰å€‹å¤šå°æ™‚é‚„æ²’éƒ¨ç½²å®Œã€‚\n\nref. éƒ¨ç½²æ¦‚è¦½\nç¶œåˆè¨­å®š\nå‡è¨­æœ‰ä¸€å€‹æƒ…å¢ƒæ˜¯å¸Œæœ›domainå¾Œé¢ä¸€å®šè¦æœ‰filesæ‰èƒ½çœ‹åœ–çš„è©±ï¼Œ\néœ€è¦ç”¨åˆ°ã€é€²éšå‹ä¸»æ©Ÿèˆ‡è·¯å¾‘è¦å‰‡(ç¬¬ä¸€å€‹ç®­é ­)ã€\nç¬¬äºŒå€‹ç®­é ­è¨­å®šdomain\nç¬¬ä¸‰å€‹ç®­é ­æ–°å¢æ–°çš„è·¯å¾‘è¦å‰‡\n\nè·¯å¾‘å‰ç½®å­—ä¸²é‡æ–°ç·¨å¯«ï¼Œå°‡/filesè½‰æˆ / è¨ªå•bucket\n\nå¦å¤–è¦æ³¨æ„ï¼Œç”±æ–¼æ¯å€‹è¦å‰‡éƒ½æœ‰ä¸€æ¢é è¨­çš„æ¢ä»¶ï¼Œ\nã€ä»»ä½•ä¸ç›¸ç¬¦åˆçš„é …ç›®ã€ï¼Œé€™å€‹å¯ä»¥é¸æ“‡è¦ä¸è¦å°è½‰åˆ°å…¶ä»–ç¶²ç«™ã€‚",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "gcsè‡ªå‹•åˆªé™¤æª”æ¡ˆ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/141. gcsè‡ªå‹•åˆªé™¤æª”æ¡ˆ/",
		"content": "ç¡ç¡å¿µ\næœ¬ç¯‡çš„ç›®æ¨™ï¼Œæ¸¬è©¦ç”¨çš„bucketï¼Œæ¯éš”ä¸€æ®µæ™‚é–“å°±åˆªé™¤æª”æ¡ˆã€‚\næˆ–æ˜¯è½‰åˆ°æ›´ä¾¿å®œçš„bucketã€‚\nå…ˆèªªå€‹æ¦‚å¿µï¼Œä¸€å€‹bucketè£é¢ï¼Œä»–çš„æª”æ¡ˆé¡å‹å¯ä»¥æ˜¯ä¸ä¸€æ¨£çš„ã€‚\næ­£æ–‡\nä¸Šé¢é‚£å¥è©±ä¸æ‡‚çš„è©±ï¼Œç›´æ¥çœ‹åœ–å§ã€‚\n\nç”±æ–¼æ¯å€‹å„²å­˜é¡å‹çš„åƒ¹æ ¼ä¸ä¸€æ¨£ï¼Œé‡å¤§çš„è©±é‚„æ˜¯èƒ½çœä¸å°‘éŒ¢ã€‚\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/Price/126. GCP ç¡¬ç¢Ÿè²»ç”¨æ¯”è¼ƒ/\">126. GCP ç¡¬ç¢Ÿè²»ç”¨æ¯”è¼ƒ</a>\nåˆ°bucketè£é¢é¸æ“‡ ã€ç”Ÿå‘½é€±æœŸã€-&gt;æ–°å¢è¦å‰‡\n\nå‹•ä½œçœ‹è¦é¸æ“‡å“ªä¸€ç¨®\n\né¸æ“‡æ¢ä»¶\n\nè¦æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼Œè¨­å®šå®Œä¸æ˜¯é¦¬ä¸Šç”Ÿæ•ˆï¼Œ\n\nå°å„²å­˜æ¡¶ç”Ÿå‘½é€±æœŸçµ„æ…‹çš„æ›´æ”¹å¯èƒ½éœ€è¦é•·é” 24 å°æ™‚æ‰èƒ½ç”Ÿæ•ˆï¼Œåœ¨æ­¤æœŸé–“ï¼Œå°è±¡ç”Ÿå‘½é€±æœŸç®¡ç†å¯èƒ½ä»æœƒæ ¹æ“šèˆŠçµ„æ…‹åŸ·è¡Œæ“ä½œã€‚\n\nè¨­å®šå®Œå¾Œï¼Œå†ä¾†å°±æ˜¯ç­‰å¾…ä»–åŸ·è¡Œäº†ã€‚\nå¦å¤–ï¼Œå¦‚æœæœ‰å¤šå€‹è¦å‰‡çš„è©±ï¼Œ\nç›®å‰GCPçš„å„ªå…ˆé †åºç‚º\n\nå¦‚æœå¤šå€‹è¦å‰‡åŒæ™‚æ»¿è¶³å–®å€‹å°è±¡çš„æ¢ä»¶ï¼Œå‰‡ Cloud Storage å°‡åŸºæ–¼ä»¥ä¸‹è€ƒæ…®ï¼Œåƒ…åŸ·è¡Œèˆ‡å…¶ä¸­ä¸€å€‹è¦å‰‡é—œè¯çš„æ“ä½œï¼š\n\nDeleteÂ æ“ä½œå„ªå…ˆæ–¼ä»»ä½•Â SetStorageClassÂ æ“ä½œã€‚\nå°‡å°è±¡åˆ‡æ›è‡³éœæ…‹å„²å­˜åƒ¹æ ¼æœ€ä½çš„å„²å­˜é¡åˆ¥çš„Â SetStorageClassÂ æ“ä½œå„ªå…ˆã€‚\n\np.s å¦‚æœä½ ä¹Ÿè·‘å»chtGPTæå•çš„è©±ï¼Œå¯èƒ½ä¹Ÿæœƒç¢°åˆ°æˆ‘é€™å€‹ç­”æ¡ˆï¼Œä½†ç›®å‰çœ‹èµ·ä¾†GCSæ²’æœ‰æ¨™è¨˜é€™å€‹æ±è¥¿äº†ã€‚\n\nref. å°è±¡ç”Ÿå‘½é€±æœŸç®¡ç†",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "gcs corsè¨­å®š",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/142.gcs corsè¨­å®š/",
		"content": "ç¡ç¡å¿µ\næ¶æ§‹å¾æœ¬ä¾†çš„ NFSå…¨éƒ¨è½‰åˆ°GCSä¸Šäº†ï¼Œ\næ‰€ä»¥corsä¹Ÿè¦è·Ÿç€è¨­å®š\næ­£æ–‡\nå°‡ä¸‹é¢æª”æ¡ˆï¼Œå­˜æˆjson\n[\n{\n&quot;origin&quot;: [&quot;https://tester.abc.com&quot;],\n&quot;method&quot;: [&quot;GET&quot;,&quot;PUT&quot;,&quot;POST&quot;,&quot;HEAD&quot;,&quot;DELETE&quot;,&quot;PATCH&quot;],\n&quot;responseHeader&quot;: [&quot;Content-Type&quot;, &quot;DNT&quot;,&quot;X-CustomHeader&quot;,&quot;X-LANG,Keep-Alive&quot;,&quot;User-Agent&quot;,&quot;X-Requested-With&quot;,&quot;If-Modified-Since,Cache-Control&quot;,&quot;X-Api-Key,X-Device-Id&quot;,&quot;Access-Control-Allow-Origin&quot;],\n&quot;maxAgeSeconds&quot;: 3600\n}\n]\n\nåŸ·è¡Œï¼Œæ”¶å·¥ã€‚\ngsutil cors set example_cors_file.json gs://example_bucket\n\nä½†è¦æ³¨æ„ï¼Œé€™å€‹ä¸æœƒé¦¬ä¸Šç”Ÿæ•ˆï¼Œæ„Ÿè¦ºè¦ç­‰è¶…é10åˆ†é˜ä»¥ä¸Šã€‚\n~~è£œå……ï¼Œoriginä¸èƒ½ç”¨ * çš„è¬ç”¨ç¬¦è™Ÿï¼Œä¹‹å‰æ¸¬äº†æ²’æœ‰æ•ˆæœ ï¼Œ\næœªä¾†æœƒä¸æœƒæ”¹ä¸æ¸…æ¥šã€‚ ~~\næ¸¬è©¦æ™‚ï¼Œå¯ä»¥ç”¨* ï¼Œç›´æ¥ç”¨ origin:*\næŸ¥çœ‹bucketæœ‰æ²’æœ‰è¨­å®šcorså‰‡ç”¨\ngsutil cors get gs://example_bucket\nor\ngcloud storage buckets describe gs://example_bucket --format=&quot;default(cors_config)&quot;\n\nå¦‚æœè¦ç”¨gcloud/apiï¼Œè«‹çœ‹ä¸‹é¢é€£çµ\nref. è¨­å®šå’ŒæŸ¥çœ‹ CORS çµ„æ…‹\nCorsçš„å·¥ä½œåŸç†\nç•¶ç€è¦½å™¨å‘ Cloud Storage ç™¼å‡ºç°¡å–®è«‹æ±‚æ™‚ï¼Œæœƒç™¼ç”Ÿä»¥ä¸‹éç¨‹ï¼š\n\nç€è¦½å™¨å°‡Â OriginÂ æ¨™é ­æ–°å¢åˆ°è«‹æ±‚ä¸­ã€‚OriginÂ æ¨™é ­åŒ…å«ç›¸æ‡‰è³‡æºï¼ˆè©²è³‡æºåœ¨å°‹æ±‚å…±äº« Cloud Storage å„²å­˜æ¡¶çš„è³‡æºï¼‰çš„ä¾†æºï¼Œä¾‹å¦‚Â Origin:https://www.example.appspot.comã€‚\n\nCloud Storage å°‡è«‹æ±‚çš„ HTTP æ–¹æ³•ä»¥åŠÂ OriginÂ æ¨™é ­çš„å€¼èˆ‡ç›®æ¨™å„²å­˜æ¡¶çš„ CORS çµ„æ…‹ä¸­çš„æ–¹æ³•å’Œä¾†æºè³‡è¨Šé€²è¡Œæ¯”è¼ƒï¼Œä»¥æŸ¥çœ‹æ˜¯å¦å­˜åœ¨åŒ¹é…é …ã€‚å¦‚æœå­˜åœ¨åŒ¹é…é …ï¼ŒCloud Storage å°‡åœ¨éŸ¿æ‡‰ä¸­åŒ…å«Â Access-Control-Allow-OriginÂ æ¨™é ­ã€‚Access-Control-Allow-OriginÂ æ¨™é ­åŒ…å«åˆå§‹è«‹æ±‚çš„Â OriginÂ æ¨™é ­çš„å€¼ã€‚\n\nç€è¦½å™¨æ¥æ”¶éŸ¿æ‡‰ä¸¦æª¢æŸ¥Â Access-Control-Allow-OriginÂ å€¼æ˜¯å¦èˆ‡åŸå§‹è«‹æ±‚ä¸­æŒ‡å®šçš„ç¶²åŸŸåŒ¹é…ã€‚å¦‚æœå®ƒå€‘åŒ¹é…ï¼Œå‰‡è«‹æ±‚æˆåŠŸã€‚å¦‚æœå®ƒå€‘ä¸åŒ¹é…ï¼Œæˆ–è€…éŸ¿æ‡‰ä¸­ä¸å­˜åœ¨Â Access-Control-Allow-OriginÂ æ¨™é ­ï¼Œå‰‡è«‹æ±‚å¤±æ•—ã€‚",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "GKE Pub/Subé€šçŸ¥è¨Šæ¯åˆ°DC",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/161. GKEåˆ©ç”¨pubsubé€šçŸ¥è¨Šæ¯åˆ°discord/",
		"content": "å‰è¨€\næœ¬ä¾†ä»¥çˆ²ä¸éœ€è¦ï¼Œä½†GKEæœ‰æ™‚å°±æœƒå¹«ä½ å‡ç´šmasterçš„ç‰ˆæœ¬ï¼Œ\nç¥ä¸çŸ¥é¬¼ä¸è¦ºï¼Œå°±ç®—ç”¨éœæ…‹ç‰ˆæœ¬ä¹Ÿæ˜¯ã€‚\né›–ç„¶æ˜¯ä¸æœƒå½±éŸ¿åˆ°ç·šä¸Šæœå‹™ï¼Œ\nä½†é‚„æ˜¯æœ€å¥½çŸ¥é“ä¸€ä¸‹æ˜¯ä»€éº¼æ™‚å€™å‡ç´šçš„ã€‚\næ­£æ–‡\n\nPub/Subå»ºç«‹ä¸€å€‹ä¸»é¡Œ\n\nGKEçš„å¢é›†è¨­å®šé–‹å•“é€šçŸ¥ï¼Œä¸¦é¸æ“‡å‰›å‰›å»ºç«‹çš„ä¸»é¡Œ\n\nå»ºç«‹Cloud Function\n\nç’°å¢ƒé¸ã€ç¬¬äºŒä»£ã€ï¼Œå‡½å¼åç¨±è‡ªå·±å‘½åã€‚\nè§¸ç™¼æ¢ä»¶ï¼Œã€å…è¨±æœªç¶“é©—è­‰çš„å«ç”¨ã€ï¼Œå†é¸æ“‡ ADD TRIGERè£é¢çš„ã€Pub/Sub triggerã€\n\né¸æ“‡å‰›å‰›å»ºç«‹çš„Pub/Subä¸»é¡Œ\n\nåœ¨é€£ç·šçš„åœ°æ–¹ï¼Œå¯é¸æ“‡åƒ…å…è¨±å…§éƒ¨æµé‡å³å¯ã€‚\n\nå»ºç«‹ç¨‹å¼ç¢¼\n\né¸æ“‡Go 1.20 ï¼Œé€²å…¥é»æ”¹æˆ sendDiscord\nåŸå§‹ç¢¼åˆ°pubsub notifyè¤‡è£½ function.goçš„ç¨‹å¼ã€‚\n\næ¸¬è©¦\n\nè§¸ç™¼GKEçš„å‡ç´šå¾Œï¼Œå°±æœƒç™¼é€è¨Šæ¯åˆ°Discordä¸Šé¢ã€‚\n\nç›¸é—œè³‡è¨Š\nPub/Subåƒ¹æ ¼\nåœ¨æ¯å€‹æ—¥æ›†æœˆï¼Œçµç®—å¸³è™Ÿçš„Â Message Delivery BasicÂ SKU çš„å‰ 10 GiB ååé‡å…è²»\nref. Pub/Sub åƒ¹æ ¼\nPub/Subæ¶æ§‹\n\nref. ä»€éº¼æ˜¯ Pub/Subï¼Ÿ\nThe request was not authenticated.\n\nThe request was not authenticated. Either allow unauthenticated invocations or set the proper Authorization header. Read more at https://cloud.google.com/run/docs/securing/authenticating Additional troubleshooting documentation can be found at: https://cloud.google.com/run/docs/troubleshooting#unauthorized-client\n\nå¦‚æœæ²’åœ¨ ç¬¬ä¸‰æ­¥é©Ÿï¼Œé¸æ“‡ã€å…è¨±æœªç¶“é©—è­‰çš„å«ç”¨ã€ï¼Œäº‹å¾Œéœ€æ”¹åˆ°cloud runä¿®æ”¹å®‰å…¨æ€§ã€‚\n\nå¾cloud functionçš„é€£çµåˆ°cloud run\n\nåˆ°å®‰å…¨æ€§ï¼Œå°‡é©—è­‰æ”¹æˆã€å…è¨±æœªç¶“é©—è­‰çš„å«ç”¨ã€ã€‚\nå¦‚æœä½ ä»ç„¶æƒ³è¦ç”¨éœ€è¦é©—è­‰ï¼Œ\nå¯èƒ½éœ€è¦ç ”ç©¶ä¸‹ï¼Œç›®å‰åªå…è¨±å…§éƒ¨æµé‡èª¿ç”¨ã€‚\nMessagePublishedData\npub/sub äº‹ä»¶çš„çµ„æˆéƒ¨åˆ†\n{\n&quot;subscription&quot;: &quot;projects/test-project/subscriptions/my-subscription&quot;,\n&quot;message&quot;: {\n&quot;attributes&quot;: {\n&quot;attr1&quot;:&quot;attr1-value&quot;\n},\n&quot;data&quot;: &quot;dGVzdCBtZXNzYWdlIDM=&quot;,\n&quot;messageId&quot;: &quot;message-id&quot;,\n&quot;publishTime&quot;:&quot;2021-02-05T04:06:14.109Z&quot;,\n&quot;orderingKey&quot;: &quot;ordering-key&quot;\n}\n}",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "ä½¿ç”¨bashå®‰è£gcloud cli",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/164.gcloud install by bash/",
		"content": "å‰è¨€\nå› çˆ²ã€æ‡¶ã€ï¼Œæ‰€ä»¥è¦ä¾†æå€‹ä¸€å€‹shå°±èƒ½å®‰è£å®Œæ‰€æœ‰æ±è¥¿ã€‚\nä½†åœ¨install gcloudå°±è¸©å‘äº†ã€‚\næ­£æ–‡\nå®˜æ–¹æ–‡ä»¶ï¼Œé€™é‚Šæåˆ°æ­£å¸¸çš„å®‰è£æ–¹å¼ï¼Œ\n./google-cloud-sdk/install.sh\n\nä½†é€™å€‹æ˜¯å»ºç«‹åœ¨äººè¦åœ¨é›»è…¦å‰é¢è¼¸å…¥Yï¼Œæ–¼æ˜¯æ”¹æˆ\n./google-cloud-sdk/install.sh --command-completion=true --path-update=true --quiet\n\né€™æ¨£æ‰æœƒåœ¨.bashrc å¢åŠ åŸ·è¡Œçš„åƒæ•¸ã€‚\nä¸€é–‹å§‹æ²’æœ‰æƒ³åˆ°æ˜¯æ²’æœ‰å¢åŠ  .bashrcçš„é—œä¿‚ï¼Œ\nåªæœ‰ä¸€ç›´å‡ºç¾æ‰¾ä¸åˆ°gcloudçš„éŒ¯èª¤ï¼Œ\næœ€å¾Œç¢ºèª<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/163.Shellçš„å€åˆ¥åŠæŸ¥è©¢/\">163.Shellçš„å€åˆ¥åŠæŸ¥è©¢</a>çš„é—œä¿‚å¾Œï¼Œ\næ‰é‡æ¸…æ˜¯.bashrcæ²’åŠ ï¼Œ\næ–¼æ˜¯åˆ©ç”¨\n./google-cloud-sdk/install.sh --help\n\næŸ¥è©¢æœ‰å“ªäº›åƒæ•¸å¯ä¾›ä½¿ç”¨ã€‚\nå®Œæ•´shell script\nå®Œæ•´install.shå¦‚ä¸‹ï¼Œéœ€ä½¿ç”¨rootåŸ·è¡Œï¼Œä¸ç„¶åœ¨å®‰è£gcloudæœƒå‡ºéŒ¯ï¼Œ\nupdate-cert.shæ˜¯å¦ä¸€å€‹shell scriptï¼Œæ˜¯ç”¨gsutilæ‹¿ä¾†æŠ“gcsçš„è³‡æ–™ç”¨ã€‚\ncurl -O https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-cli-443.0.0-linux-x86_64.tar.gz\ntar -xf google-cloud-cli-443.0.0-linux-x86_64.tar.gz\n./google-cloud-sdk/install.sh --command-completion=true --path-update=true --quiet\nsource ~/.bashrc\n\ngcloud auth activate-service-account view-bucket@project.iam.gserviceaccount.com --key-file=view-bucket.json\n\nSCRIPTPATH=$(dirname &quot;$(readlink -f $0)&quot;)\nchmod u+x update-cert.sh\n\necho &quot;30 1 * * 1 root /bin/bash ${SCRIPTPATH}/update-cert.sh&quot; &gt;&gt; /etc/crontab\n\nref.\n\ngcloud command not found - while installing Google Cloud SDK\ninstall Google Cloud CLI\n[Shell Script] åŸ·è¡Œshæª”æ¡ˆæç¤ºPermission denied\nç¬¬åäº”ç« ã€ä¾‹è¡Œæ€§å·¥ä½œæ’ç¨‹(crontab)",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "Gcloud AttributeError module importlib has no attribute util",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/17. Gcloud AttributeError module importlib has no attribute util/",
		"content": "å‰è¨€\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/16.dustise sleep æ¸¬è©¦å·¥å…·ç°¡ä»‹/\">16.dustise sleep æ¸¬è©¦å·¥å…·ç°¡ä»‹</a> ä¸Šä¸€ç¯‡ï¼Œæœ‰è¬›åˆ°httpieé€™å€‹å¥—ä»¶ï¼Œç°¡å–®ä½¿ç”¨ï¼Œæˆ‘å°±ç›´æ¥åœ¨macä¸Šè£äº†ã€‚\nç„¶å¾Œï¼Œgcloud,kubectlå°±æ›äº†...\næ­£æ–‡\néŒ¯èª¤ç¢¼æ˜¯é€™æ¨£ï¼Œ\nAttributeError: module 'importlib' has no attribute 'util'\n\nå¾Œä¾†ä¸€æŸ¥ï¼Œç™¼ç¾æ˜¯kubectl è·Ÿ python 3.9 çš„å•é¡ŒAttributeError: module 'importlib' has no attribute 'util' #970\næœ¬ä¾†æ˜¯æƒ³ç›´æ¥å‡ç´škubectlå°±å¥½åœ¨ macOS ä¸Šä½¿ç”¨ Homebrew å®‰è£ï¼Œ\nbrew upgrade kubectl\n\né›–ç„¶å‡ç´šå®Œæˆäº†ï¼Œ\nä½†æŸ¥è©¢ç‰ˆæœ¬\nkubectl version --client\nå‡ºä¾†çš„ç‰ˆæœ¬ä»æ˜¯èˆŠçš„ã€‚\nå¾Œä¾†æ‰æƒ³åˆ°ï¼Œæˆ‘çš„kubectl å¥½åƒæ˜¯è·Ÿgcloud ä¸€èµ·è£çš„ï¼Œè©¦äº†ä¸€ä¸‹ï¼Œé€£gcloudä¹Ÿæ˜¯åŒæ¨£çš„éŒ¯èª¤ã€‚\né‚£å°±ä¾†å‡ç´šgcloudå§ã€‚ä½†åªè¦è¼¸å…¥ gcloud components update ä¹Ÿæ˜¯å‡ºç¾åŒæ¨£çš„éŒ¯èª¤ï¼Œé‚£è¦æ€éº¼å‡ç´š...\næ‰€ä»¥ï¼Œæ ¹æ“šé€™ç¯‡ å…ˆåœ¨terminalä¸Šé¢è¼¸å…¥ï¼Œ\nexport CLOUDSDK_PYTHON=python2 # å…ˆæŒ‡å®šä½¿ç”¨å…¶ä»–pythonç‰ˆæœ¬\ngcloud components update # æ›´æ–°gcloud\n\nå®Œæˆã€‚",
		"tags": ["970", "note","â˜ï¸"]
},

{
		"title": "Debian install",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/181. cloudstorageç„¡æ³•ä½¿ç”¨cloudflareè½‰å€/",
		"content": "å‰è¨€\nç·šä¸Šçš„åœ–ç‰‡æ˜¯ä½¿ç”¨GCPçš„Load balanceré€£åˆ°Google cloud storageï¼Œ\nä¹‹å‰æ¸¬è©¦æ²’å•é¡Œï¼Œä½†å¾Œä¾† <a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/186. istioçš„Authorization policy(ç™½åå–®)/#cloudflare\">186. istioçš„Authorization policy(ç™½åå–®)#cloudflareè½‰ç™¼</a> ï¼Œ\nclientåˆ°origin server éƒ½ä½¿ç”¨sslé€£ç·šå¾Œï¼Œå°±æ›äº†ï¼Œ\nå› ç‚ºLoad balancerç•¶åˆæ²’æœ‰è¨­å®šSSLçš„æ†‘è­‰ï¼Œå°è‡´ç„¡æ³•é€£ç·šã€‚\næ­£æ–‡\nåˆ°GCPçš„æ†‘è­‰ç®¡ç†å™¨ï¼Œæ–°å¢æ†‘è­‰ã€‚\nä¸€é–‹å§‹æ˜¯æ²’æœ‰å•“ç”¨çš„ï¼Œå¿…é ˆå…ˆå•“ç”¨\n\nå»ºç«‹æ–°æ†‘è­‰ï¼Œä¸æ”¯æ´è¬ç”¨å­—å…ƒ\n\né€™é‚Šæ³¨æ„ï¼Œå»ºç«‹å®Œå¾Œï¼Œ\nå¯èƒ½éœ€è¦ç­‰ä¸€é™£å­(å¹¾å°æ™‚ï¼‰æ‰æœƒå¥½ï¼Œ\nå»ºç«‹å®Œå¾Œä¸€å®šè¦åˆ°LBç¶å®šï¼Œå‘ˆç¾æœ‰ä½¿ç”¨è€…çš„ç‹€æ…‹ã€‚\nç•¶å¥½çš„æ™‚å€™ï¼Œæœƒçœ‹åˆ°ç‹€æ…‹ç‚ºã€æœ‰æ•ˆã€ã€‚\næ­¤æ™‚ï¼Œå†åˆ°Load Balanceré‚£é‚Šè¨­å®šæ†‘è­‰ï¼Œé–‹å•“httpsçš„å…¥å£å³å¯ã€‚\n\nå‰é¢æ­¥é©Ÿï¼Œåƒè€ƒ <a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/140. gcs æ›è¼‰domain/\">140. gcs æ›è¼‰domain</a>",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "GCEç¡¬ç¢Ÿå¢åŠ å®¹é‡å¤§å°",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/19. GCEç¡¬ç¢Ÿå¢åŠ å®¹é‡å¤§å°/",
		"content": "å‰è¨€\nä¹‹å‰æœ‰åŠ å¤§éGCEçš„CPUè·Ÿramï¼Œä½†æ€éº¼åŠ ç¡¬ç¢Ÿç©ºé–“é‚„çœŸçš„ä¸çŸ¥é“ã€‚\næ­£æ–‡\n\nå…ˆåˆ°GCEï¼Œé–‹å•Ÿæ©Ÿå™¨ã€‚é¸æ“‡é–‹æ©Ÿç£ç¢Ÿï¼ˆå¯åœ¨é–‹æ©Ÿçš„ç‹€æ…‹ä¸‹é‹ä½œï¼‰\n\næŒ‰ä¸‹ç·¨è¼¯ï¼Œä¿®æ”¹ç¡¬ç¢Ÿå¤§å°ï¼Œå„²å­˜ã€‚\n\né‡æ–°æ•´ç†ç•«é¢ï¼Œæœƒçœ‹åˆ°ç¡¬ç¢Ÿç©ºé–“å®¹é‡è®Šäº†ã€‚ä½†é‚„æ²’å®Œæˆï¼Œéœ€è¦åˆ°æ©Ÿå™¨è£¡é¢é‡æ–°èª¿æ•´å¤§å°ã€‚\n\nlsblk åˆ—å‡ºå¯ç”¨è¨­å‚™\nlsblk\n\nNAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT\nsda 8:0 0 35G 0 disk\nâ””â”€sda1 8:1 0 30G 0 part /\n\nNAMEï¼šé€™æ˜¯å¡Šè¨­å‚™åã€‚\nMAJ:MINï¼šæœ¬æ¬„é¡¯ç¤ºä¸»è¦å’Œæ¬¡è¦è¨­å‚™è™Ÿã€‚\nRMï¼šæœ¬æ¬„é¡¯ç¤ºè¨­å‚™æ˜¯å¦å¯ç§»å‹•è¨­å‚™ã€‚æ³¨æ„ï¼Œåœ¨è¨­å‚™sdbå’Œsr0çš„RMå€¼ç­‰æ–¼1ï¼Œé€™èªªæ˜ä»–å€‘æ˜¯å¯ç§»å‹•è¨­å‚™ã€‚\nSIZEï¼šæœ¬æ¬„åˆ—å‡ºè¨­å‚™çš„å®¹é‡å¤§å°ä¿¡æ¯ã€‚ä¾‹å¦‚35Gè¡¨æ˜è©²è¨­å‚™å¤§å°ç‚º35GBï¼Œè€Œ1Kè¡¨æ˜è©²è¨­å‚™å¤§å°ç‚º1KBã€‚\nROï¼šè©²é …è¡¨æ˜è¨­å‚™æ˜¯å¦ç‚ºåªè®€ã€‚åœ¨æœ¬æ¡ˆä¾‹ä¸­ï¼Œæ‰€æœ‰è¨­å‚™çš„ROå€¼ç‚º0ï¼Œè¡¨æ˜ä»–å€‘ä¸æ˜¯åªè®€çš„ã€‚\nTYPEï¼šæœ¬æ¬„é¡¯ç¤ºå¡Šè¨­å‚™æ˜¯å¦æ˜¯ç£ç›¤æˆ–ç£ç›¤ä¸Šçš„ä¸€å€‹åˆ†å€ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œsdaå’Œsdbæ˜¯ç£ç›¤ï¼Œè€Œsr0æ˜¯åªè®€å­˜å„²ï¼ˆromï¼‰ã€‚\nMOUNTPOINTï¼šæœ¬æ¬„æŒ‡å‡ºè¨­å‚™æ›è¼‰çš„æ›è¼‰é»ã€‚\nref. lsblkå‘½ä»¤\n\ngrowpart å°‡å…¨éƒ¨å¤šé¤˜çš„ç©ºé–“çµ¦æŒ‡å®šçš„åˆ†å‰²å€\nextend a partition\tin a partition table to\tfill available space\nubuntu å®‰è£æ–¹å¼ï¼š\napt -y install cloud-guest-growpart\n\n2024/08/15æ›´æ–°\napt -y install cloud-guest-utils\nCentOS å®‰è£æ–¹å¼ï¼š\nyum -y install cloud-utils-growpart\ngrowpart /dev/sda 1\n\né€™é‚Šçš„dev/sda æŒ‡çš„æ˜¯disk,æ•…sdaèˆ‡ 1 ä¸­é–“æœ‰ç©ºæ ¼\nref. growpart\np.s å¦‚æœå‡ºç¾ éŒ¯èª¤\nFAILED: sfdisk not found\n\nè«‹ä½¿ç”¨sudo growpart /dev/sda 1 çš„æ–¹å¼åŸ·è¡Œ\næˆ– apt install -y fdisk\n\nresize2fs èª¿æ•´ç³»çµ±å¤§å° resize2fs /dev/sda1\n\né€™é‚Šçš„dev/sda1 æŒ‡çš„æ˜¯part ,æ•…sdaèˆ‡ 1 ä¸­é–“æ²’æœ‰ç©ºæ ¼\nref. LinuxåŸºç¤å‘½ä»¤---resize2fs\n\ndf æª¢æŸ¥åˆ†å‰²å€å¤§å°df -h\n\nref.\ngcp å¢åŠ ç¡¬ç¢Ÿå®¹é‡\nä¸é—œæ©Ÿã€ä¸æ‹”ç¡¬ç¢Ÿæ“´å……VM root ç£ç¢Ÿå€ - growpart\nèª¿æ•´ç£ç¢Ÿå€å¤§å°å¾Œæ“´å±• Linux æª”æ¡ˆç³»çµ±\nLinux æ“´å±•ext2/3/4 xfs rootåˆ†å‰²å€ä¸ç”¨LVM\nTroubleshooting\n\nå¦‚æœä½¿ç”¨resize2fs ç¢°åˆ°éŒ¯èª¤è¨Šæ¯\n\nresize2fs 1.45.6 (20-Mar-2020)\nresize2fs: Bad magic number in super-block while trying to open /dev/sda2\nCouldn't find valid filesystem superblock.\n\nè¡¨ç¤ºä½ ä½¿ç”¨çš„å¯èƒ½æ˜¯xfsç³»çµ±ï¼Œä¾†æŸ¥ä¸€ä¸‹\n\n\tmount \t\n\næ‰€ä»¥å¿…é ˆæ”¹ç”¨ä¸‹é¢æŒ‡ä»¤\nxfs_growfs /dev/sda2\n\nref. # xfsæª”æ¡ˆç³»çµ±æ“´å®¹å ±resize2fs: Bad magic number in super-block while trying to open /dev/centos/root Couldnâ€™t find valid filesystem superblock",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "GCEæ©Ÿå™¨åˆ—è¡¨å…§çš„CPUå€‹æ•¸",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/46.GCEæ©Ÿå™¨åˆ—è¡¨å…§çš„CPUå€‹æ•¸/",
		"content": "å‰è¨€\nè¦ç®—ä¸€ä¸‹å„æœå‹™æ‰€ä½”çš„æ¯”ä¾‹ï¼Œ\nå¤§æ–¹å‘ç”¨VMçš„æ©Ÿå™¨ cpuä¾†ç®—\næ­£æ–‡\nå¦‚æœç”¨gcloud compute list èƒ½å¤ åˆ—å‡ºæ©Ÿå™¨çš„é¡å‹ï¼Œä½†è£¡é¢çš„cpuæ•¸é‡é‚„æ˜¯ä¸çŸ¥é“ã€‚\næ‰¾äº†ä¸€ä¸‹ç™¼ç¾æœ‰äººå¯«å¥½ä¸€å€‹shell scriptï¼Œæ‹¿ä¾†æ”¹ä¸€ä¸‹èƒ½å¤ ç›´æ¥åˆ—å‡ºcpuæ•¸é‡\nè·Ÿé€£çµçš„å…§å®¹ç›¸æ¯”ï¼Œæˆ‘é€™é‚Šå¤šåŠ äº†ä¸€å€‹ç‹€æ…‹ã€‚\nå› ç‚ºæœ‰äº›æ©Ÿå™¨æ˜¯ä¸é–‹æ©Ÿçš„ï¼Œç•¶æœ‰ä»»å‹™æ™‚ï¼Œæ‰æœƒé–‹æ©Ÿï¼Œæ•…å¤§éƒ¨åˆ†æ™‚é–“éƒ½æ˜¯é—œæ©Ÿç‹€æ…‹ã€‚\n# Get instance name,zone for `${PROJECT}\nfor PAIR in $(\\\ngcloud compute instances list \\\n--project=${PROJECT} \\\n--format=&quot;csv[no-heading](name,zone.scope(zones),status)&quot;)\ndo\n# Parse result from above into instance and zone vars\nIFS=, read INSTANCE ZONE STATUS &lt;&lt;&lt; ${PAIR}\n# Get the machine type value only\nMACHINE_TYPE=$(\\\ngcloud compute instances describe ${INSTANCE} \\\n--project=${PROJECT} \\\n--zone=${ZONE} \\\n--format=&quot;value(machineType.scope(machineTypes))&quot;)\n# If it's custom-${vCPUs}-${RAM} we've sufficient info\nif [[ ${MACHINE_TYPE} == custom* ]]\nthen\nIFS=- read CUSTOM CPU MEM &lt;&lt;&lt; ${MACHINE_TYPE}\nprintf &quot;%s: vCPUs: %s; Mem: %s; Status: %s\\n&quot; ${INSTANCE} ${CPU} ${MEM} ${STATUS}\nelse\n# Otherwise, we need to call `machine-types describe`\nCPU_MEMORY=$(\\\ngcloud compute machine-types describe ${MACHINE_TYPE} \\\n--project=${PROJECT} \\\n--zone=${ZONE} \\\n--format=&quot;csv[no-heading](guestCpus,memoryMb)&quot;)\nIFS=, read CPU MEM &lt;&lt;&lt; ${CPU_MEMORY}\nprintf &quot;%s: vCPUs: %s; Mem: %s; Status: %s\\n&quot; ${INSTANCE} ${CPU} ${MEM} ${STATUS}\nfi\ndone\n\nref. gcloud command to display vCPU's and Memory assigned to Instances",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "åˆ—å‡ºGCEçš„æ‰€æœ‰VM",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/46.åˆ—å‡ºGCEçš„æ‰€æœ‰VM/",
		"content": "å‰è¨€\næ­£æ–‡\nå¦‚æœè¦æŸ¥ç‰¹å®šçš„æ¬„ä½ï¼Œå¯ä»¥å…ˆåˆ—å‡ºinstances çš„çµæ§‹ï¼Œ\nçœ‹ä¸€ä¸‹è¦ä»€éº¼æ¨£çš„è³‡æ–™ã€‚\ngcloud compute instances describe gke-xxxxxx-test-n2-8-819a6098-3b3r --zone=asia-east1-b\n\nç„¶å¾Œå°±èƒ½æ¹Šå‡ºä¸‹é¢çš„èªæ³•äº†\ngcloud compute instances list --format=&quot;table(\nname,\nzone.basename(),\nnetworkInterfaces[].ipv6AccessConfigs[0].externalIpv6.notnull().list():label=EXTERNAL_IPV6,\nnetworkInterfaces[].subnetwork)&quot; | sort -k 5 | grep -E 'gateway.*test'\n\næœ€å‰é¢çš„èªæ³•ï¼Œæ˜¯è¦å–å‡ºå­ç¶²è·¯çš„åç¨±ï¼Œä»¥ä¾¿è¨ˆç®—è©²å­ç¶²è·¯å…§æœ‰å¹¾å°VMï¼Œ\nç„¶å¾Œæ’åºã€æ¯”å° åç¨±è£¡é¢æœ‰ gatewayè€Œä¸”å¾Œé¢æ˜¯ testçš„VMã€‚\nref.\ngrep æŒ‡ä»¤ä½¿ç”¨ or åŠ and æŸ¥å…©å€‹æ¢ä»¶ä»¥ä¸Š\ngcloud compute instances describe\ngcloud compute instances list",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "Google Cloud Functioné™åˆ¶",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/5. Google Cloud Functioné™åˆ¶/",
		"content": "å‰è¨€\né€™æ¬¡è¦ç”Ÿä¸€å€‹ffmpegçš„ç’°å¢ƒå‡ºä¾†ï¼Œç„¶å¾Œæ‰¾é˜¿æ‰¾é˜¿ï¼Œ\næ‰¾åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œä¸Šé¢å¯«\nGoogleå°‡Cloud Functionsä½œæ¥­ç³»çµ±å‡ç´šåˆ°äº†Ubuntu 18.04 LTSï¼Œæ“´å¤§äº†å¯ç”¨å‡½å¼åº«çš„ç¯„åœï¼Œé™¤äº†Imagemagickä¸€ç›´éƒ½æœ‰å¤–ï¼Œé‚„å¤šäº†Ffmpegå’ŒLibcairo2ç³»çµ±å‡½å¼åº«ï¼Œé€£ç„¡é ­Chromeä¹Ÿæœ‰ï¼Œä½¿ç”¨è€…ä¸åªå¯ä»¥åœ¨Cloud Functionsä¸­è™•ç†å½±ç‰‡ï¼Œç”šè‡³é‚„èƒ½é€²è¡Œç¶²é æˆªåœ–ã€‚\n\nref Googleäº‹ä»¶é©…å‹•ç„¡ä¼ºæœå™¨å¹³è‡ºCloud Functionsæ­£å¼ä¸Šç·šäº†!\nç„¶å¾Œä¸ç”¨æ¶æ©Ÿå™¨ï¼Œå°±ä¾†çœ‹çœ‹é€™æ¢è·¯è¡Œä¸è¡Œçš„é€šå§\næ­£æ–‡\næ‰¾äº†ä¸€é™£å­ï¼Œå…ˆæ³¨æ„åˆ°çš„æ˜¯GCFçš„é™åˆ¶\n\ntimeout é è¨­1åˆ†é˜ï¼Œæœ€é•·9åˆ†é˜\nå–®ä¸€functionå¯ç”¨memoryç‚º2Gï¼Œè¶…éæœƒä¸­æ–·\né€™å…©å€‹æ˜¯æˆ‘èªç‚ºæ¯”è¼ƒé‡è¦çš„éƒ¨åˆ†ï¼Œå…¶ä»–ç´°é …ï¼Œ\nå¯åƒè€ƒ\né…é¡å’Œé™åˆ¶\næ·ºè«‡Serverless Solution â€” ä»¥GCP Cloud Functionç‚ºä¾‹\n\nçµè«–ï¼Œæ‹¿ä¾†åšå½±ç‰‡è½‰æª”çš„è©±...æ‡‰è©²æ˜¯æ²’è¾¦æ³•äº†ã€‚é™¤éé€™å½±ç‰‡å¤ å°ã€‚\nä¸ç„¶åªå¯«apiçœ‹ä¾†æ˜¯æŒºå¿«çš„",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "gcloud compute instance ç­†è¨˜",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/79. gcloud compute instance ç­†è¨˜/",
		"content": "å‰è¨€\nå› ç‚ºå…¬å¸æ”¿ç­–ï¼Œ\nè¦æŠŠlabelå…¨éƒ¨çµ±ä¸€ï¼Œä¹‹å‰æœ‰äº›å·²ç¶“å‘½åéä¸€æ¬¡çš„ä½†åç¨±ä¸å°ï¼Œ\nä¸€å€‹ä¸€å€‹æ”¹åˆå¥½éº»ç…©ï¼Œ\nä¾†å¯«commandå§\næ­£æ–‡\næŒ‡ä»¤æ¼”åŒ–é †åº\nStep 1.\nå…ˆç”¨æŒ‡ä»¤æ’ˆå‡º GCEçš„å…¨éƒ¨åˆ—è¡¨\ngcloud compute instances --project=project list --format='table(name,status,labels.list())'\n\nStep 2.\næ‰¾å‡ºlabelåªæœ‰ç‰¹å®šå­—å…ƒçš„åˆ—è¡¨\ngcloud compute instances --project=project list --format='table(name,status,labels.list())' | grep product=abc\n\nå•é¡Œä¾†äº†ï¼Œå¦‚æœæˆ‘åªè¦å–nameå‡ºä¾†ï¼Œä½œçˆ²è®Šæ•¸çš„è©±ï¼Œ\nè¦æ€éº¼åšï¼Ÿ\næˆ‘ä¹Ÿä¸€ä¸‹å­æƒ³ä¸å‡ºä¾†ï¼Œå°±å…ˆè·‘å»çœ‹ä¸€ä¸‹gcloudæ–‡ä»¶äº†ã€‚\nStep 3.\ngcloud compute instances --project=project list --filter=&quot;labels.product:abc&quot; --format=&quot;table(name)&quot;\n\næ”¹ç”¨ filterå»ç¯©é¸ï¼Œé€™æ¨£å°±èƒ½åªé¡¯ç¤ºåç¨±äº†ã€‚\n\nStep 4.\nåŠ ä¸Šforè¿´åœˆï¼Œå°‡label.productæ”¹æˆ zzz\nfor name in $(gcloud compute instances --project=project list --filter=&quot;labels.product:abc&quot; --format=&quot;table(name)&quot;); do\ngcloud compute instances update &quot;$name&quot; --update-labels product=zzz\ndone\n\né™„è¨»ï¼š\nåˆªé™¤labelçš„æŒ‡ä»¤\nproduct ç‚º keyå€¼\ngcloud compute instances update beta-api01 --remove-labels product\n\nref.\n\nä½¿ç”¨æ¨™ç±¤æ•´ç†è³‡\ngcloud command",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "GCSä½¿ç”¨æ–¹å¼",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/8.GCSä½¿ç”¨æ–¹å¼/",
		"content": "å‰è¨€\næŸå€‹æ¡ˆå­ï¼Œè¦æ•´å€‹ç¿»æ‰é‡åšï¼Œé€™æ¬¡è¦è®“VMçš„æ©Ÿå™¨è·ŸGKEçš„podèƒ½å¤ åŒæ™‚å­˜å–ä¸€å€‹å„²å­˜ç©ºé–“ï¼Œ\né è¨ˆä½¿ç”¨Google Cloud Storageï¼Œè¸©äº†ä¸€å€‹æ—©ä¸Šçš„å‘ã€‚\næ­£æ–‡\né è¨ˆåšå…©å€‹é …ç›®\n\nåœ¨VMä¸Šé¢æ›è¼‰gcsçš„è³‡æ–™å¤¾\n\nåœ¨GKE ä¸Šé¢çš„podåŒæ™‚æ›è¼‰ gcsçš„è³‡æ–™å¤¾\n\nåœ¨VMä¸Šé¢æ›è¼‰gcsçš„è³‡æ–™å¤¾\nå®‰è£æ–¹å¼ï¼Œç›®å‰æˆ‘çš„vmæ˜¯ RedHat æ‰€ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼ï¼ŒCentOSä¹Ÿæ˜¯ç”¨åŒæ¨£çš„æ–¹å¼\n\nConfigure the gcsfuse repo:\n\nsudo tee /etc/yum.repos.d/gcsfuse.repo &gt; /dev/null &lt;&lt;EOF\n[gcsfuse]\nname=gcsfuse (packages.cloud.google.com)\nbaseurl=https://packages.cloud.google.com/yum/repos/gcsfuse-el7-x86_64\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg\nhttps://packages.cloud.google.com/yum/doc/rpm-package-key.gpg\nEOF\n\nInstall gcsfuse:\n\nsudo yum install gcsfuse\n\nå®Œæˆï¼Œå…¶ä»–å®‰è£æ–¹å¼ï¼Œè«‹åƒè€ƒGoogleCloudPlatform/gcsfuse/install.md\nç™»å…¥ä½¿ç”¨ï¼Œ\né€™é‚Šå…ˆä½¿ç”¨ gcloud auth login åšæ¸¬è©¦\nå…ˆå»ºç«‹è³‡æ–™å¤¾ mkdir upload\næ›è¼‰ gcsfuse my-bucket upload\nå¸é™¤æ›è¼‰ fusermount -u upload\nDebugç”¨\ngcsfuse --foreground --debug_gcs --debug_http --debug_fuse --debug_invariants --key-file=/home/user/Downloads/my-key.json mybucket /upload\n\næ°¸ä¹…åŠ å…¥GOOGLE_APPLICATION_CREDENTIALSè®Šæ•¸\né–‹å•Ÿ /etc/profiles\næ–°å¢ export GOOGLE_APPLICATION_CREDENTIALS=&quot;/home/user/Downloads/my-key.json&quot;\nä¿®æ”¹æª”æ¡ˆå¾Œè¦æƒ³é¦¬ä¸Šç”Ÿæ•ˆé‚„è¦åŸ·è¡Œ#\nsource /etc/profileä¸ç„¶åªèƒ½åœ¨ä¸‹æ¬¡é‡é€²æ­¤ä½¿ç”¨è€…æ™‚ç”Ÿæ•ˆã€‚\n\nref.Linuxç³»çµ±ç’°å¢ƒè®Šæ•¸å’Œåˆ¥åè¨­å®šï¼ˆæ°¸ä¹…ç”Ÿæ•ˆå’Œè‡¨æ™‚ç”Ÿæ•ˆï¼‰\né™„è¨»ï¼Œjsonæª”æ¡ˆçš„å–å¾—åœ¨ IAMè§’è‰²å…§çš„æœå‹™è³¬æˆ¶\nref.å‰µå»ºå’Œç®¡ç†æœå‹™å¸³è™Ÿå¯†é‘°ã€‚\næ–°å¢å®ŒGCSï¼Œè¨˜å¾—æŠŠæ¬Šé™çµ¦æœå‹™è³¬æˆ¶ã€‚è¨˜å¾—é¸æ“‡å®Œæ•´æ¬Šé™ï¼ˆFig. 1)\nè‡ªå‹•æ›è¼‰\næœ‰æ¬Šé™äº†å·²å¾Œï¼Œå†ä¾†å°±æ˜¯è‡ªå‹•æ›è¼‰äº†ã€‚\nåˆ°/etc/fstabä¸Šï¼Œè¼¸å…¥\nmy_bucket /home/ezio/upload gcsfuse key_file=key/key.json,rw,user,allow_other,uid=1008,gid=1009 0 0\n\né‡é–‹æ©Ÿæ¸¬è©¦çœ‹çœ‹ï¼Œæ”¶å·¥ã€‚\nref.\nHow to use mount command in fstab file\ngcsfuse automount on a non root user\næŸ¥è©¢ç›®å‰ç™»å…¥ä½¿ç”¨è€…çš„uid è·Ÿ gid\nid $(whoami)\n\nå¦‚æœè¦çœ‹å…¨éƒ¨ä½¿ç”¨è€…çš„è©±ï¼Œ\ncat /etc/passwd\n\nref.Linux çš„å¸³è™Ÿèˆ‡ç¾¤çµ„\n\nåœ¨GKE ä¸Šé¢çš„podåŒæ™‚æ›è¼‰ gcsçš„è³‡æ–™å¤¾\nåŸºæœ¬çš„æ–¹å¼ï¼Œ\nå…ˆè‡ªå·±ç”¢ç”Ÿä¸€å€‹ image\n\nFROM golang:1.14-alpine AS build-env\nENV GO111MODULE on\n\n# WORKDIR /å·¥ä½œåéŒ„åç¨± ç•¶å‰çš„å·¥ä½œç›®éŒ„åç¨±ï¼Œè‹¥æ˜¯ä¸å­˜åœ¨å‰‡æœƒæ–°å»ºè©²ç›®éŒ„ï¼Œ\n# éœ€è¦æ³¨æ„çš„æ˜¯copyè·Ÿrunçš„æŒ‡ä»¤éƒ½æ˜¯ä»¥WORKDIRç‚ºç•¶å‰ç›®éŒ„ä¸‹å»è·‘çš„ï¼Œ\n# é‹ç”¨çš„æ™‚å€™éœ€è¦æ³¨æ„ç›¸å°ä½ç½®ã€‚\nWORKDIR $GOPATH/src\n\nRUN go get -u github.com/googlecloudplatform/gcsfuse\n\nCOPY key.json .\n\nFROM alpine:3.6\nRUN apk add --no-cache ca-certificates fuse &amp;&amp; rm -rf /tmp/*\nCOPY --from=build-env /go/bin/gcsfuse /usr/local/bin\nCOPY --from=build-env /go/src/key.json /\nWORKDIR /\n\nä½ˆç½² Deployment\napiVersion: apps/v1\nkind: Deployment\nmetadata:\nlabels:\napp: gcs-fuse\nversion: v1\nnamespace: debug\nname: gcsfuse-test\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: gcs-fuse\nversion: v1\ntemplate:\nmetadata:\nlabels:\napp: gcs-fuse\nversion: v1\nspec:\ncontainers:\n- name: gcsfuse-test\nimage: gcr.io/your-project/gcsfuse:v1.2\n# image: golang:1.14-alpine\n# command: [ &quot;/bin/sh&quot;, &quot;-c&quot;, &quot;--&quot; ]\n# args: [ &quot;while true; do sleep 600; done;&quot; ]\nsecurityContext:\nprivileged: true\ncommand:\n- &quot;/bin/sh&quot;\n- &quot;-c&quot;\n- &quot;while true; do mkdir /upload ; gcsfuse --key-file=key.json your-bucket /folder; sleep 600; done; &quot;\n\nå¦‚æœè·Ÿç¾æœ‰çš„ç¨‹å¼æ•´åˆçš„è©±ï¼Œ\nç”±æ–¼è¦åŸ·è¡Œå¤šè¡ŒæŒ‡ä»¤ï¼Œéœ€ä½¿ç”¨shellScriptçš„æ–¹å¼åŸ·è¡ŒæŒ‡ä»¤ã€‚\nå¯èƒ½æœƒé‡åˆ°ä¸‹åˆ—æƒ…æ³\n&quot;exec: &quot;/init.sh&quot;: permission denied\nåœ¨Dockerfileä¸Šä¿®æ”¹æ¬Šé™\nRUN chmod +x /init.sh\n\nref.\ngetting permission denied in docker run\nexec user process caused &quot;exec format error&quot;\næœ‰äººèªªåœ¨shçš„é ‚ç«¯åŠ ä¸Š\n#!/bin/bash\nä½†æˆ‘è©¦äº†æ²’ç”¨ï¼Œåœ¨çŒœæƒ³å¯èƒ½æ˜¯alpine linuxæ²’æœ‰bashå°è‡´\næ‰€ä»¥æ”¹ç”¨ä¸‹é¢é€™å€‹\nENTRYPOINT [&quot;sh&quot;,&quot;/run.sh&quot;]\n\nref. standard_init_linux.go:178: exec user process caused â€œexec format errorâ€\nåŸ·è¡Œshæ™‚å¡ä½ï¼Œdebugæ–¹å¼\nç”¨if elseæª¢æŸ¥\nif mkdir /upload; then\necho &quot;mkdir directory! Success&quot; 1&gt;&amp;2\ngcsfuse --key-file=key.json yellow-video /upload\nelse\necho &quot;Could not mkdir directory!&quot; 1&gt;&amp;2\nexit 1\nfi\n\nå¦å¤–ï¼Œæœ€å¾Œæ‰¾å‡ºä¾†åŸå› æ˜¯å› ç‚ºå…ˆåŸ·è¡Œgoçš„ç¨‹å¼ï¼Œå°è‡´å¾ŒçºŒå¡ä½ï¼Œæ‰€ä»¥å…ˆå»ºç«‹è³‡æ–™å¤¾å¾Œï¼Œå†åŸ·è¡Œgo\nref.\nShell Script é‡åˆ°éŒ¯èª¤æ™‚è‡ªå‹•é€€å‡ºé›¢é–‹\nref.\nèº«ä»½é©—è­‰å…¥é–€\nLinuxç³»çµ±ç’°å¢ƒè®Šæ•¸å’Œåˆ¥åè¨­å®šï¼ˆæ°¸ä¹…ç”Ÿæ•ˆå’Œè‡¨æ™‚ç”Ÿæ•ˆï¼‰",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "æ‰¹æ¬¡ä¿®æ”¹GCPçš„label",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/88.æ‰¹æ¬¡ä¿®æ”¹GCPçš„label/",
		"content": "å‰è¨€\nç™¼ç¾æœ‰ä¸€æ•´æ‰¹çš„è³‡æºæ²’æœ‰åŠ é label ï¼Œ\nGCEçš„ç¡¬ç¢Ÿã€è² è¼‰å¹³è¡¡çš„å‰ç«¯è½‰å°è¦å‰‡..\næœ‰äº›æ¢ä»¶ä¸ä¸€æ¨£ï¼Œä¸€å€‹ä¸€å€‹åŠ æœƒç˜‹æ‰ã€‚\nå·¥ç¨‹å¸«å°±æ˜¯æ‡¶...å¯«shå§\næ­£æ–‡\né–‹å§‹æ§‹æ€\n\nå…ˆæŠŠé—œéµå€¼æ‹‰å‡ºä¾† (1)\n\ngcloud compute forwarding-rules list\n\nåªæœ‰ipï¼Œè¦è·‘å»æ¯å€‹å¢é›†æŸ¥è³‡æ–™ï¼Œçœ‹é€™è©²æ­¸å±¬å“ªå€‹labelï¼Œ\nå¤ªç¬¨äº†ï¼Œä¸è¡Œã€‚\nå…ˆçœ‹ä¸€ä¸‹forwarding-rules æœ‰å“ªäº›è³‡è¨Š(2)ï¼Œå†æŠŠæ¬„ä½é¡¯ç¤ºå‡ºä¾†ã€‚\ngcloud compute forwarding-rules describe a0589a367cdc1470e839b05803958e2b\n\nè£¡é¢çš„descriptionä¼¼ä¹è »æœ‰ç”¨è™•çš„ï¼Œå¯ä»¥å¹«å¿™é‡æ¸…æ˜¯å“ªå€‹cluster\n\nç”¨ --format (3)ï¼Œé¡¯ç¤ºæ¬„ä½\ngcloud compute forwarding-rules list --format='table(name,IPAddress,description)'\n\né–‹å§‹å¯«bash\n\nå°‡nameä¸Ÿé€² æ–‡å­—æª”ï¼Œ\nç„¶å¾ŒåŸ·è¡Œbashï¼Œbashçš„æµç¨‹ï¼Œè¿´åœˆè®€æª”æ¡ˆå…§å®¹(4)ï¼ŒåŸ·è¡Œæ›´æ–°labelæŒ‡ä»¤(5)ã€‚é€™é‚Šè¦æ³¨æ„ï¼Œå¦‚æœæ˜¯ingressæˆ–æ˜¯å€åŸŸå‹çš„è¦é¡å¤–åŠ ä¸Š --globalï¼Œ\næ‰èƒ½æ›´æ–°ã€‚\nwhile read p; do\necho &quot;$p&quot;; gcloud compute forwarding-rules update $p \\\n--update-labels=product=abc,env=prod,dept=rd; echo &quot;done&quot;;\ndone &lt;lbfr.txt\n\nref.\n\ngcloud compute forwarding-rules list\ngcloud compute forwarding-rules describe\ngcloud topic formats\nhttp://www.compciv.org/topics/bash/loops/\ngcloud compute forwarding-rules update",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "GCPç¶²è·¯å°å¤–çš„æ–¹å¼",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/9.GCPç¶²è·¯å°å¤–çš„æ–¹å¼/",
		"content": "å‰è¨€\né€™ç®—æ˜¯å…ˆå‰ä¸€ç›´æœ‰å•é¡Œï¼Œä½†ä¸çŸ¥é“ç‚ºä»€éº¼ï¼Œä¹Ÿæ²’å»æŸ¥åŸå› ã€‚\næ­£æ–‡\nç‚ºäº†è¦æ­£ç¢ºå°æ‡‰ï¼Œè®“å…¶ä»–æ©Ÿå™¨é–‹ç™½åå–®ï¼Œä¸å¾—ä¸å¼„æ¸…æ¥šï¼Œåˆ°åº•æ€éº¼ä¸€å›äº‹ã€‚\nä¹‹å‰åŒäº‹éƒ½èªªæ˜¯èµ°cloudNatï¼Œä½†æˆ‘ç›´æ¥é€£å» vm or podè£¡é¢ï¼Œ\nç”¨curl ifconfig.me æŠ“åˆ°çš„ipéƒ½ä¸æ˜¯æˆ‘æ‰€çŸ¥é“çš„ipï¼Œ\n(ifconfig.me æ˜¯ä¸€å€‹ç¶²å€ï¼Œå–®ç´”é¡¯ç¤ºç›®å‰é€£å»ç¶²ç«™çš„ipä½ç½®)\nCloudNAT çš„åŸºæœ¬æ¦‚å¿µï¼Œä¸»è¦æ˜¯å¯æä¾›å…§éƒ¨æ©Ÿå™¨å°å¤–é€£ç·š\nref. Cloud NAT æ¦‚è¦½\nåŸºæœ¬çš„è¨­å®šæ–¹å¼ï¼Œ\nref. ä½¿ç”¨ Cloud NAT\nGCEæ²’æœ‰å•é¡Œï¼ŒåŸºæœ¬ä¸Šæ²’æœ‰å¤–éƒ¨ipè€Œä¸”åˆæ²’è¨­å®šcloudNATçš„è©±ï¼Œå°±æ˜¯ç„¡æ³•é€£æ¥å¤–ç¶²ã€‚\nç„¶è€Œæœ‰å¤–éƒ¨ipä½ç½®çš„è©±ï¼ŒGoogle Cloud æœƒè‡ªå‹•å°ä¾†æºèˆ‡è©²æ¥å£çš„ä¸»å…§éƒ¨ IP åœ°å€åŒ¹é…çš„æ•¸æ“šåŒ…åŸ·è¡Œä¸€å°ä¸€ NATã€‚\nä½†GKEå°±æœ‰é»å•é¡Œäº†ï¼Œå°±ç®—æ²’æœ‰è¨­å®šå¤–éƒ¨ipï¼Œé‚„æ˜¯èƒ½å¤ å°å¤–ï¼Œ\nè€Œä¸”æŠ“åˆ°çš„ipä½ç½®ï¼Œä½ ä¸çŸ¥é“æ˜¯å¾ä½•è€Œä¾†ï¼Œä¹Ÿä¸æ˜¯CloudNATçš„IP\næœ€å¾Œå¾å•é¡Œæ’æŸ¥é€™é‚Šæ‰¾åˆ°äº†ç­”æ¡ˆï¼Œ\nç¢ºä¿æ‚¨çš„ Google Kubernetes Engine (GKE) é›†ç¾¤æ˜¯ä¸€å€‹å°ˆç”¨é›†ç¾¤ã€‚éå°ˆç”¨é›†ç¾¤ä¸­çš„æ¯å€‹ç¯€é»è™›æ“¬æ©Ÿéƒ½å…·æœ‰å¤–éƒ¨ IP åœ°å€ï¼Œå› æ­¤æ¯å€‹ç¯€é»éƒ½å¯ä»¥ä½¿ç”¨ Virtual Private Cloud (VPC) ç¶²çµ¡ä¸­ä¸‹ä¸€å€‹èºé»ç‚ºé»˜èªäº’è¯ç¶²ç¶²é—œè€Œä¸ä¾è³´ Cloud NAT çš„è·¯ç”±ã€‚\n\nç°¡å–®èªªï¼Œå¦‚æœæ²’æœ‰è¨­å®šå°ˆæœ‰é›†ç¾¤ï¼ˆç§æœ‰å¢é›†ï¼‰ï¼Œæœ¬èº«çš„nodeæ˜¯å…·æœ‰å°å¤–çš„ipï¼Œæ‰€ä»¥é‚„æ²’åˆ°CloudNATä¹‹å‰ï¼Œ\nå°±ç›´æ¥å¾nodeç¯€é»å‡ºå»äº†ã€‚é€™éƒ¨åˆ†å¯ä»¥åˆ°podè£¡é¢ æŠ“å–å°å¤–ipï¼Œç„¶å¾Œå»æ¯”å°ï¼Œé€™å€‹podæ‰€åœ¨çš„nodeçš„å°å¤–ipå°±çŸ¥é“äº†ã€‚\nå»ºç«‹ç§äººå¢é›†\n2021/04/19 æ›´æ–°\nä»Šå¤©ä¾†ç®—ä¸€ä¸‹æ•¸å­¸ï¼Œ\nä¸Šé¢æœ‰æåˆ°ï¼Œç•¶è¨­æˆç§æœ‰å¢é›†æˆ–æ˜¯VMï¼Œéœ€è¦å°å¤–é€£ç·šæ™‚ï¼Œ\néœ€è¨­å®šcloud nat ipï¼Œ\nç•¶å°å¤–é€£ç·šæ•¸é‡ä¸è¶³æ™‚ï¼Œæœƒç™¼ç”Ÿè¨±å¤šå¥‡æ€ªçš„å•é¡Œï¼Œ\nä¾‹å¦‚ï¼Œä½ˆç½² deployment ï¼Œæœƒç™¼ç”Ÿimage pull error ï¼Œpodç„¡æ³•å•Ÿå‹•ï¼Œä¸€ç›´é‡é–‹...ç­‰ç­‰ã€‚\n[[9-fig.1.jpg]]\næ¯å€‹ VM åŸ·è¡Œå€‹é«”çš„æœ€ä½é€šè¨ŠåŸ æ•¸é‡ ï¼š64\nè¡¨ç¤ºæ¯å°VMå¯ä»¥å°å¤–çš„é€£ç·šæ•¸é‡ã€‚\nå‡è¨­(fig.1)\nå°å¤–çš„ipæœ‰å…©å€‹ï¼Œ\nä¸€å€‹å°å¤–ipå¯ä»¥æä¾› 64512çš„ port çµ¦è£¡é¢çš„ä¾†æºå­ç¶²è·¯èˆ‡IPä½¿ç”¨ï¼Œ\nè€Œæˆ‘å€‘ä¸Šé¢è¨­å®š æ¯å€‹ VM åŸ·è¡Œå€‹é«”çš„æœ€ä½é€šè¨ŠåŸ æ•¸é‡ ç‚º 64 ï¼Œ\næ•… 64512 * 2/64 = 2016 å¯æä¾›çš„VMæ•¸é‡\nè¡¨ç¤º ä¾†æºå­ç¶²è·¯èˆ‡ IP ç¯„åœ çš„VPCç¶²è·¯ å¯ä»¥æä¾›çµ¦2016 å€‹VM ï¼ˆåŒ…å« GCE è·Ÿ GKEçš„ç¯€é»ï¼‰ ä½¿ç”¨ã€‚\nref. Cloud NAT åœ°å€å’Œç«¯å£æ¦‚è¦½",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "cloud buildçš„å•é¡Œ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/95.cloud buildçš„å•é¡Œ/",
		"content": "å‰è¨€\næ­£æ–‡\nåœ¨å»ºç½®cloud buildæ™‚é‡åˆ°å•é¡Œï¼Œ\nç¶“æŸ¥è©¢å¾Œæ¨æ¸¬å•é¡Œåœ¨æ–¼ï¼Œ\ncloud buildçš„google serviceç•¶ä»–åœ¨é‹ä½œéç¨‹ï¼Œ\néœ€è¦å‘ç§æœ‰å°ˆæ¡ˆå…§çš„gke clusteræ“ä½œï¼Œ\ncloud buildæ˜¯ä½¿ç”¨googleçš„æµ®å‹•ipï¼Œ\nåœ¨æ­¤è™•æ‡‰è©²æ˜¯è¢«blockæ‰äº†æ‰€ä»¥ç„¡æ³•å®Œæˆcloud buildå»ºç½®\néŒ¯èª¤è¨Šæ¯ï¼šUnable to connect to the server: dial tcp 124.111.27.75:443: i/o timeout\n(IPç‚ºclusterç«¯é»ip)\nref. googleéŒ¯èª¤æ’è§£\nç¾éšæ®µæœ‰ä¸‰ç¨®æ–¹å¼\n\nè‡ªæ¶CICDç³»çµ±\nGKE ç›´æ¥é–‹æ”¾ 0.0.0.0/0 &gt; é€™æœ‰å®‰å…¨ç–‘æ…®\nä½¿ç”¨ private conn &gt; é€™è¤‡é›œåº¦å¾ˆé«˜ä¸”ä¸å½ˆæ€§",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "Anthos åˆé«”é©—",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/97. Anthos åˆé«”é©—/",
		"content": "å‰è¨€\næ­£æ–‡\n\næ¯å€‹æœˆå¢åŠ  50 ç¾\ncreate new cluster ,ç„¡æ³•æ›´æ”¹ç¾æœ‰(Anthos)\nåªèƒ½ç”¨workload identity\ncpuè‡³å°‘å››å€‹ï¼Œtotal è¦å…«å€‹\nAnthos è·Ÿ Anthos Service Mesh ä¸ä¸€æ¨£\nref. Anthos èˆ‡ Anthos Service Mesh ç•Œé¢å·®ç•°\n\nå¦‚æœåœ¨macä¸Šï¼Œåƒç…§æ–‡ä»¶ï¼ŒåŸ·è¡Œçš„è©±æœƒå‡ºç¾ä¸€äº›éŒ¯èª¤ã€‚\n\nmacä¸æ”¯æ´æ­¤æŒ‡ä»¤ï¼Œ\nä¹Ÿä¸è¦ä½¿ç”¨cloudShellï¼Œæœƒå› ç‚ºVPCSC è€Œå‡ºç¾éŒ¯èª¤\næœ€ä½³è§£æ³•ï¼Œä½¿ç”¨linuxç³»çµ±\n\ndocker run -it --rm -v &quot;$HOME&quot;/.config:/root/.config -v /Users/ezio_liu/Documents/kill:/data google/cloud-sdk:latest\n\nå› ç‚ºæœ‰å°‡ gcpé©—è­‰ æ›è¼‰åˆ°imageå…§ï¼Œæ‰€ä»¥ä¸ç”¨åœ¨é©—è­‰ä¸€æ¬¡ã€‚\nå¯ä»¥ä½¿ç”¨ä¸‹é¢æŒ‡ä»¤ï¼Œçœ‹äººå“¡æœ‰æ²’æœ‰é©—è­‰\ngcloud auth list\n\næœ€å¾Œï¼Œä½¿ç”¨ä¸‹é¢æŒ‡ä»¤å®‰è£\n./asmcli install \\\n--project_id rd7-project \\\n--cluster_name istio-test \\\n--cluster_location asia-east1-b \\\n--fleet_id rd7-project \\\n--output_dir asmcli_output \\\n--managed \\\n--ca mesh_ca\n\n--managed æ˜¯ä½¿ç”¨ ä»£ç®¡å¼anthos",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "GCP ç¡¬ç¢Ÿè²»ç”¨æ¯”è¼ƒ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/Price/126. GCP ç¡¬ç¢Ÿè²»ç”¨æ¯”è¼ƒ/",
		"content": "ç¡ç¡å¿µ\næ­£æ–‡\nGCE\n\nStandard : $0.04 per GiB\nSSD : $0.17 per GiB\n\nCloudStorage\n\nStandard ï¼šé©åˆçŸ­æœŸå„²å­˜å’Œç¶“å¸¸å­˜å–çš„è³‡æ–™\nNearline ï¼š é©ç”¨æ–¼å‚™ä»½é …ç›®å’Œä¸€å€‹æœˆå­˜å–ä¸åˆ°ä¸€æ¬¡çš„è³‡æ–™\nColdlineï¼šæœ€é©åˆç”¨æ–¼ç½é›£å¾©åŸï¼Œä»¥åŠå„²å­˜ã€Œæ¯å­£å­˜å–å°‘æ–¼ä¸€æ¬¡ã€çš„è³‡æ–™\nArchive ï¼šé©åˆä»¥æ•¸ä½æ–¹å¼é•·æœŸä¿å­˜ä¸€å¹´å­˜å–ä¸åˆ°ä¸€æ¬¡çš„è³‡æ–™\n\nä¸‹é¢ç‚ºæ¯æœˆæ¯GBçš„ç©ºé–“è²»ç”¨\n| | Standard å„²å­˜ç©ºé–“ | Nearline å„²å­˜ç©ºé–“ | Coldline å„²å­˜ç©ºé–“ | å°å­˜å„²å­˜ç©ºé–“ | |\n|-----------------|---------------|---------------|---------------|------------|\n| å°ç£ (asia-east1) | $0.020 ç¾å…ƒ | $0.010 ç¾å…ƒ | $0.005 ç¾å…ƒ | $0.0015 ç¾å…ƒ |\nå¦‚æœæœ‰ç¶²è·¯æµé‡ï¼Œé¡å¤–åœ¨ç®—\n| æ¯æœˆç”¨é‡ | è¼¸å‡ºè‡³ä¸–ç•Œå„åœ° (äºæ´²å’Œæ¾³æ´²é™¤å¤–) | è¼¸å‡ºè‡³äºæ´²åœ°å€ (ä¸­åœ‹é™¤å¤–ï¼Œä½†å«é¦™æ¸¯) | è¼¸å‡ºè‡³ä¸­åœ‹åœ°å€ (é¦™æ¸¯é™¤å¤–) | è¼¸å‡ºè‡³æ¾³æ´²åœ°å€ï¼Œå¾ä½æ–¼æ¾³æ´²çš„ Cloud Storage å€åŸŸè¼¸å‡º | è¼¸å…¥ | | | | |\n|-----------|-------------------|---------------------|----------------|-----------------------------------|----|\n| 0 è‡³ 1 TB | $0.12 ç¾å…ƒ | $0.12 ç¾å…ƒ | $0.23 ç¾å…ƒ | $0.19 ç¾å…ƒ | å…è²» |\n| 1 è‡³ 10 TB | $0.11 ç¾å…ƒ | $0.11 ç¾å…ƒ | $0.22 ç¾å…ƒ | $0.18 ç¾å…ƒ | å…è²» |\n| 10 TB ä»¥ä¸Š | $0.08 ç¾å…ƒ | $0.08 ç¾å…ƒ | $0.20 ç¾å…ƒ | $0.15 ç¾å…ƒ | å…è²» |\nref. åƒ¹ç›®è¡¨",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "GCP ç›£æ§è²»ç”¨",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/Price/180. GCP ç›£æ§è²»ç”¨/",
		"content": "æ­£æ–‡\n\nåŠŸèƒ½\nåƒ¹æ ¼1\næ¯æœˆå…è²»é…é¡\n\nLoggingÂ å„²å­˜*\n$0.50/GiBï¼› å°‡æ—¥èªŒæµå¼å‚³è¼¸åˆ°æ—¥èªŒå„²å­˜æ¡¶å„²å­˜ç©ºé–“ï¼Œä»¥ä¾¿ç·¨å…¥ç´¢å¼•ã€æŸ¥è©¢å’Œåˆ†æçš„ä¸€æ¬¡æ€§è²»ç”¨ï¼›åŒ…æ‹¬æ—¥èªŒå„²å­˜æ¡¶ä¸­é•·é” 30 å¤©çš„å„²å­˜è²»ç”¨ã€‚ æŸ¥è©¢å’Œåˆ†ææ—¥èªŒè³‡æ–™ä¸æœƒç”¢ç”Ÿé¡å¤–è²»ç”¨ã€‚\næ¯å€‹é …ç›®æ¯æœˆçš„å‰ 50 GiB\n\nLoggingÂ ä¿ç•™â€ \nå°æ–¼ä¿ç•™è¶…é 30 å¤©çš„æ—¥èªŒï¼Œæ¯æœˆæ¯ GiB ç‚º $0.01ï¼›æ ¹æ“šç•™å­˜ç‡æŒ‰æœˆçµç®—ã€‚\nåœ¨é»˜èªä¿ç•™æœŸé™å…§ä¿ç•™çš„æ—¥èªŒä¸æœƒç”¢ç”Ÿä¿ç•™è²»ç”¨ã€‚\n\næ—¥èªŒè¨˜éŒ„å…¥ç«™æµé‡â€¡\nç„¡éœ€é¡å¤–è²»ç”¨\nä¸é©ç”¨\n\næ—¥èªŒè·¯ç”±å™¨â™¦\nç„¡éœ€é¡å¤–è²»ç”¨\nä¸é©ç”¨\n\nLog Analyticsâ™£\nç„¡éœ€é¡å¤–è²»ç”¨\nä¸é©ç”¨\n\nLoggingä¿ç•™\nLoggingä¿ç•™çš„è²»ç”¨ï¼Œåœ¨é»˜èªä¿ç•™çš„å¤©æ•¸ç‚ºä»¥ä¸‹\n\næ—¥èªŒå„²å­˜æ¡¶\né»˜èªä¿ç•™æœŸé™\nè‡ªè¨‚ä¿ç•™æœŸé™\n\n_Required\n400 å¤©\nä¸å¯çµ„æ…‹\n\n_Default\n30 å¤©\nå¯çµ„æ…‹\n\nä½¿ç”¨è€…å®šç¾©\n30 å¤©\nå¯çµ„æ…‹\n\n_RequiredÂ æ—¥èªŒå„²å­˜æ¡¶\nCloud Logging æœƒè‡ªå‹•å°‡ä»¥ä¸‹é¡å‹çš„æ—¥èªŒè·¯ç”±åˆ°Â _RequiredÂ å„²å­˜æ¡¶ï¼š\n\nç®¡ç†å“¡æ´»å‹•ç¨½æ ¸æ—¥èªŒ\nç³»çµ±äº‹ä»¶ç¨½æ ¸æ—¥èªŒ\nGoogle Workspace ç®¡ç†å“¡ç¨½æ ¸æ—¥èªŒ\nä¼æ¥­ç‰ˆç¾¤çµ„ç¨½æ ¸æ—¥èªŒ\nç™»éŒ„ç¨½æ ¸æ—¥èªŒ\nAccess Transparency æ—¥èªŒã€‚å¦‚éœ€ç­è§£å¦‚ä½•å•Ÿç”¨ Access Transparency æ—¥èªŒï¼Œè«‹åƒé–±Â Access Transparency æ—¥èªŒæ–‡ä»¶ã€‚\n\n_DefaultÂ æ—¥èªŒå„²å­˜æ¡¶\né™¤éæ‚¨åœç”¨æˆ–ä»¥å…¶ä»–æ–¹å¼ä¿®æ”¹Â _DefaultÂ æ¥æ”¶å™¨ï¼Œå¦å‰‡æœªå„²å­˜åœ¨Â _RequiredÂ å„²å­˜æ¡¶ä¸­çš„ä»»ä½•æ—¥èªŒæ¢ç›®éƒ½æœƒè¢«Â _DefaultÂ æ¥æ”¶å™¨è·¯ç”±åˆ°Â _DefaultÂ å„²å­˜æ¡¶ã€‚å¦‚éœ€ç­è§£å¦‚ä½•ä¿®æ”¹æ¥æ”¶å™¨ï¼Œè«‹åƒé–±ç®¡ç†æ¥æ”¶å™¨ã€‚\nCloud Logging æœƒè‡ªå‹•å°‡ä»¥ä¸‹é¡å‹çš„æ—¥èªŒè·¯ç”±åˆ°Â _DefaultÂ å„²å­˜æ¡¶ï¼š\n\nè³‡æ–™è¨ªå•ç¨½æ ¸æ—¥èªŒ\næ”¿ç­–æ‹’çµ•ç¨½æ ¸æ—¥èªŒ\n\né™¤éæ‚¨ç‚ºÂ _DefaultÂ å„²å­˜æ¡¶çµ„æ…‹è‡ªè¨‚ä¿ç•™ï¼Œå¦å‰‡ Cloud Logging æœƒå°‡æ—¥èªŒä¿ç•™ 30 å¤©ã€‚\nref.\n\nGoogle Cloud çš„ç¶­é‹å¥—ä»¶åƒ¹æ ¼\næ—¥èªŒä¿ç•™æœŸé™\nè·¯ç”±å’Œå„²å­˜æ¦‚è¦½",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": "GCP CPUç”¨é€”",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/Price/GCP CPUç”¨é€”/",
		"content": "<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/Price/GCP CPUç”¨é€”/#2024-07-09\">#2024/07/09æ›´æ–°</a>\nå®˜æ–¹å»ºè­°\nä¸‹è¡¨æ˜¯å®˜æ–¹å»ºè­°çš„æ©Ÿå™¨å‹è™ŸåŠç”¨é€”\nref.é€šç”¨æ©Ÿå™¨ç³»åˆ—\nE2\n\nWeb æœå‹™\nä¸­å°å‹è³‡æ–™åº«\næ‡‰ç”¨æä¾›æœå‹™\nå¾Œå°æ‡‰ç”¨\nå¾®æœå‹™\nè™›æ“¬æ¡Œé¢\né–‹ç™¼ç’°å¢ƒ\n\nN2ã€N2Dã€Tau T2Dã€N1\n\nWeb æœå‹™\nå¤§ä¸­å‹è³‡æ–™åº«\næ‡‰ç”¨æä¾›æœå‹™\nå¾Œå°æ‡‰ç”¨\nå¿«å–\nåª’é«”/æµå¼å‚³è¼¸\n\nTau T2A\n\næ‡‰ç”¨æœå‹™ã€Web æœå‹™å’ŒéŠæˆ²æœå‹™\nåµŒå…¥å¼ç³»çµ±é–‹ç™¼\nArm ä¸Šçš„ CI/CD é–‹ç™¼\nè¦–è¨Šå’Œåœ–ç‰‡ç·¨ç¢¼ã€è½‰ç¢¼å’Œè™•ç†\næ•¸å­—å»£å‘Šäº¤æ˜“å’ŒæŠ•æ”¾\nå¿«å–ä¼ºæœå™¨\nè¨ˆç®—å‹è—¥å“ç ”ç™¼\nAndroid é–‹ç™¼\nè‡ªå‹•é§•é§›æˆ–å‚³çµ±æ±½è»Šè»Ÿé«”é–‹ç™¼\n\nå…¶ä»– N2D è·Ÿ Tau T2Déƒ½æ˜¯AMDçš„CPUï¼Œåƒ¹æ ¼æ¯”N2çš„ä¾¿å®œ\nä»¥åŒæ¨£çš„ 4 cpu , 16GB memory ä¾†æ¯”è¼ƒåƒ¹æ ¼çš„è©±ï¼Œ\næ”¹å¤©è¦é–‹åˆ°N2çš„è©±ï¼Œå¯ä»¥è©¦è©¦N2Dçš„æ©Ÿå™¨ã€‚\n\né¡å‹\nCPU\nè¨˜æ†¶é«”\nåƒ¹æ ¼\n\nn2-standard-4\n4\n16GB\n$0.1942\n\nn2d-standard-4\n4\n16GB\n$0.1690\n\ne2-standard-4\n4\n16GB\n$0.13402\n\næ›´è©³ç´°çš„åƒ¹æ ¼ï¼Œåƒè€ƒ è™›æ“¬æ©Ÿå™¨å¯¦ä¾‹åƒ¹æ ¼\n2024/07/09æ›´æ–°\nä»Šå¤©ä¾†ç®—æ•¸å­¸äº†ï¼Œ\nç¾åœ¨è¦ä¾†æ¯”è¼ƒN2Dèˆ‡C2Dçš„åƒ¹æ ¼å·®è·\n\né¡å‹\nOn-demand price\n1-year\n3-year\nUnit\n\nN2D CPU\n$23.24612\n$14.64453\n$10.4609\nvCPU month\n\nC2D CPU\n$24.98863\n$15.74245\n$11.24492\nvCPU month\n\nC3D CPU\n$26.62383\n$16.77321\n$11.98076\nvCPU month\n\nN2D Memory\n$3.11564\n$1.96297\n$1.40233\nGB month\n\nC2D Memory\n$3.34632\n$2.10824\n$1.50599\nGB month\n\nC3D Memory\n$3.56532\n$2.24621\n$1.60454\nGB month\n\nä½†è¦ç‰¹åˆ¥æ³¨æ„ N2Dï¼Œå¦‚æœè‡ªå®šç¾©CPUèˆ‡Memoryçš„è©±ï¼Œ\nåƒ¹æ ¼åˆä¸ä¸€æ¨£äº†ã€‚\nCPU æœƒä¾†åˆ° $24.408426 / vCPU month\nMemory æœƒä¾†åˆ° $3.271422 / GB month\nåŒæ¨£ä»¥4é¡†CPUä¾†ç®—çš„è©±ï¼Œ\nç•¶è¨˜æ†¶é«”åˆ°13.82Gæ™‚ï¼Œåƒ¹æ ¼å°‡æ¥è¿‘æ¨™æº–N2Dã€‚",
		"tags": ["2024/07/09æ›´æ–°", "note","â˜ï¸"]
},

{
		"title": "GCPè²»ç”¨",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â˜ï¸ GCP/Price/GCPè²»ç”¨/",
		"content": "å‰è¨€\næ­£æ–‡\nGCPçš„è²»ç”¨ä¸»è¦åˆ†ä¸‰å¡Šï¼Œ\n\næ©Ÿå™¨è¦æ ¼çš„é–‹æ©Ÿè²»ç”¨\nç°¡å–®èªªå°±æ˜¯ï¼Œæ©Ÿå™¨é–‹æ©Ÿçš„è©±ç”¢ç”Ÿçš„è²»ç”¨ï¼Œä½†è¦æ³¨æ„çš„GCPä»–æœ‰çºŒç”¨æŠ˜æ‰£ï¼Œç•¶ä½ ç”¨è¶Šå¤šå°±èƒ½å¤ æ‰“æŠ˜ã€‚è€Œä¸”ä»–æœƒä¸»å‹•åˆä½µæœªæ»¿ä¸€å€‹æœˆæ©Ÿå™¨ï¼Œå†ä¸€èµ·ç®—è²»ç”¨ã€‚\nref.\n\nè½èªª GCP è²»ç”¨æœ€ä½ï¼Ÿå„ç¨®æŠ˜æ‰£æ–¹æ¡ˆå®Œæ•´èªªæ˜\næŒçºŒä½¿ç”¨æŠ˜æ‰£\n\nç¡¬ç¢Ÿçš„è²»ç”¨\næ©...å°±é–‹æ©Ÿå™¨æ™‚ï¼Œæ‰€éœ€è¦çš„ç¡¬ç¢Ÿç©ºé–“å¤§å°è²»ç”¨ï¼Œå°±ç®—ä½ æ©Ÿå™¨é—œæ©Ÿä¸€æ¨£ç…§ç®—ã€‚\nref. ç£ç¢Ÿå’Œæ˜ åƒåƒ¹æ ¼\nç¶²è·¯çš„è²»ç”¨\nä»¥ä¼ºæœå™¨çš„è§’åº¦ä¾†èªªï¼Œingress(æµé‡é€²ä¾†ï¼‰ä¸ç®—éŒ¢ï¼Œegressï¼ˆæµé‡å‡ºå»ï¼‰ç®—éŒ¢ã€‚\nä»¥ä½¿ç”¨è€…çš„è§’åº¦ä¾†èªªï¼Œä¸Šå‚³ä¸ç”¨éŒ¢ï¼Œä¸‹è¼‰è¦éŒ¢ã€‚\nref. GCP å¦‚ä½•è¨ˆè²»ï¼Ÿå°±åƒæ°´é›»è²»ä¸€æ¨£\n\nRegistry\n\nArtifact Registry\nContainer Registry\n\n0.5GBä»¥ä¸‹å…è²»ï¼Œè¶…é0.5GBï¼Œæ¯GB 0.1 ç¾å…ƒ\næ ¹æ“šcloudStorageè¨ˆåƒ¹\n\nç¶²è·¯è¼¸å‡ºå¦è¨ˆ\nref. Artifact Registry å®šåƒ¹",
		"tags": [ "note","â˜ï¸"]
},

{
		"title": " â›µï¸ istio MOC  ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/0.istio MOC/",
		"content": "<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/73. istio sidecar æ³¨å…¥è¦å‰‡/\">73. istio sidecar æ³¨å…¥è¦å‰‡</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/89. istio å¸¸è¦‹ç‹€æ…‹ç¢¼/\">89. istio å¸¸è¦‹ç‹€æ…‹ç¢¼</a>\n\nå»ºç½®\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/7. Istioå®‰è£åŠä½¿ç”¨/\">7. Istioå®‰è£åŠä½¿ç”¨</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/11. istio èˆ‡ kiali/\">11. istio èˆ‡ kiali</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/14.istioå®‰è£æ™‚å›ºå®šip/\">14.istioå®‰è£æ™‚å›ºå®šip</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/20. è¨ªå•istio å…§éƒ¨è² è¼‰å¹³è¡¡ip/\">20. è¨ªå•istio å…§éƒ¨è² è¼‰å¹³è¡¡ip</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/21. flagger è‡ªå‹•é‡‘çµ²é›€ä½ˆç½² for istio/\">21. flagger è‡ªå‹•é‡‘çµ²é›€ä½ˆç½² for istio</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/23.istioçš„ prometheusæˆªå–GKE metrics/\">23.istioçš„ prometheusæˆªå–GKE metrics</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/34. istio operator å®‰è£æ–°çš„ ingress deployåŠservice/\">34. istio operator å®‰è£æ–°çš„ ingress deployåŠservice</a>\n<a class=\"internal-link is-unresolved\" href=\"/404\">199. istioä½¿ç”¨gatewayAPI</a>\n\nVirtualService\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/11. istio èˆ‡ kiali/\">11. istio èˆ‡ kiali</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/30. istioçš„virtualservice matchæ¯”å°/\">30. istioçš„virtualservice matchæ¯”å°</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/35. istio virtualService delegateä½¿ç”¨/\">35. istio virtualService delegateä½¿ç”¨</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/54. istio æ›è¼‰ECK kibana/\">54. istio æ›è¼‰ECK kibana</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/62. isito é¡åƒæµé‡/\">62. isito é¡åƒæµé‡</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/75. istio virtual service å¸¸ç”¨åƒæ•¸/\">75. istio virtual service å¸¸ç”¨åƒæ•¸</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/89. istio å¸¸è¦‹ç‹€æ…‹ç¢¼/\">89. istio å¸¸è¦‹ç‹€æ…‹ç¢¼</a>\n\nAuthorization Policy\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/186. istioçš„Authorization policy(ç™½åå–®)/\">186. istioçš„Authorization policy(ç™½åå–®)</a>\n\nTroubleshooting\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/15.istioæœå‹™ç„¡æ³•è¨ªå•/\">15.istioæœå‹™ç„¡æ³•è¨ªå•</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/18.istio Virtual Service è·¨namespaceè®€å– DestinationRule/\">18.istio Virtual Service è·¨namespaceè®€å– DestinationRule</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/31.istio æŠ“èŸ²è¨˜/\">31.istio æŠ“èŸ²è¨˜</a>",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "istio èˆ‡ kiali",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/11. istio èˆ‡ kiali/",
		"content": "å‰è¨€\nå¾istioæ‰¯åˆ°kialiï¼Œæ˜¯èªªkialiæ˜¯çœŸçš„å¥½ç”¨ï¼Œçœ‹æ±è¥¿æŒºç›´è¦ºå¾—ã€‚\nä½†æœ‰äº›è­¦å‘Šï¼Œè¦è§£èª¿å°±è¦ç…§ä»–çš„è¦ç¯„èµ°\næ­£æ–‡\nç¾åœ¨æœ€å¸¸ç¢°åˆ°çš„ï¼Œä¹Ÿé‚„æ²’è§£\n\nå¦‚æœä½¿ç”¨GKEçš„ç§äººå¢é›†ï¼Œè«‹è¨˜å¾—è¦æŠŠ masterçš„é˜²ç«ç‰†è¦å‰‡ï¼Œé–‹å•Ÿ8080 ï¼Œä¸ç„¶æœƒç™¼ç”Ÿè®€å–æ™‚éœ€è¦ä¸€åˆ†é˜ï¼Œè³‡æ–™æ‰æœƒå‡ºç¾ã€‚\n\nNo matching workload found for gateway selector in this namespace\n\nç°¡å–®è¬›å°±æ˜¯ç›®å‰çš„namespaceæ²’æœ‰æ‰¾åˆ°ç›®å‰çš„ ingressgatewayï¼Œæœªä¾†å¯èƒ½æœƒç™¼ç”Ÿå•é¡Œ\nref.\n\nNo matching workload found for gateway selector in this namespace\n\nPort name must follow &lt;protocol&gt;[-suffix] form\nserviceä¸Šçš„ port name å¿…é ˆè¦ç¬¦åˆæ ¼å¼ï¼Œ\næ ¼å¼å¿…é ˆç‚º http- é€™æ¨£çš„\napiVersion: v1\nkind: Service\nmetadata:\nnamespace: rd7-video\nlabels:\napp: video-api-qa\nname: video-api\nspec:\nports:\n# éœ€éµç…§æ ¼å¼ å‰é¢ç‚º protocol å¾Œé¢ç‚º -suffix\n- name: &quot;http-video&quot;\nport: 80\nselector:\napp: video-api-qa\n\nref.\n\nPort name must follow &lt;protocol&gt;[-suffix] form\n\nå¦å¤–ï¼Œå¦‚æœç·¨è¼¯configæœ‰éŒ¯æ™‚ï¼Œ\næŒ‰äº†SAVEæ²’æœ‰åæ‡‰ï¼ŒéŒ¯èª¤è¨Šæ¯å¯èƒ½åœ¨æœ€ä¸Šé¢ï¼Œè¦å°‡æ²è»¸å¾€ä¸Šæ‹‰ã€‚\n\nref.\n\nv1.13 validation\n\nç‚ºäº†kialiçš„å¥åº·åº¦ï¼Œæœ€å¥½æ˜¯åœ¨podä¸Šé¢å¯«å€‹ readinessProbeï¼ˆå°±ç·’æ¢é‡ï¼‰\n\nreadinessProbe:\nfailureThreshold: 3\ninitialDelaySeconds: 30\nperiodSeconds: 10\nsuccessThreshold: 1\ntcpSocket:\nport: 80\ntimeoutSeconds: 1\n\nkialiå¥åº·åº¦ æª¢æŸ¥ pod è®Šæˆ proxy unsynced\n\nref.\n\nv1.28Health Configuration\nistioä¹‹envoyå¸¸è¦‹è¡“èªåŠç‹€æ…‹ç¢¼\nkialiåœ–è¡¨èªªæ˜\n\nvirtualservice is pointing to a non-existent gateway\n\nå› ç‚ºgatewayä¸åœ¨åŒä¸€å±¤çš„namespaceä¸Šé¢ï¼Œæ‰€ä»¥è¦è¨­å®šåç¨±æ™‚ï¼Œ\nè¦æ”¹ç”¨\ngateways:\n- istio-ingressgateway-video.sex-system.svc.cluster.local",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "istioå®‰è£æ™‚å›ºå®šip",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/14.istioå®‰è£æ™‚å›ºå®šip/",
		"content": "å‰è¨€\nå¦‚æœåˆªé™¤GKEçš„ç¯€é»ï¼Œé‡å»ºæ–°çš„è©±ï¼Œå¿…é ˆè¦æŠŠistioç§»é™¤ï¼Œæ‰èƒ½å¤ ä½¿ç”¨ é·ç§»å·¥ä½œè² è¼‰åˆ°ä¸åŒnodeã€‚\nä½†å¦‚æœå·²ç¶“å°‡istioçš„ip ï¼Œç¶ä¸Šå›ºå®šçš„domainï¼Œä¸€æ—¦ç§»é™¤å°±å¿…é ˆè¦é‡æ–°ç¶å®šã€‚\næ­£æ–‡\nä»¥ä¸‹å…§å®¹éƒ½åœ¨GCPä¸Šé¢å¯¦ä½œ(istio ç‰ˆæœ¬ç‚º1.8.2)ã€‚ é¨°è¨Šé›²ä¸èƒ½é€™æ¨£ç©ã€‚\n\nå…ˆå°‡IPè®Šæˆéœæ…‹ï¼Œè€Œä¸æ˜¯è‡¨æ™‚ã€‚\n\nå°‡ä¸‹é¢yamlå¦å­˜æˆæª”æ¡ˆ\n\napiVersion: install.istio.io/v1alpha1\nkind: IstioOperator\nspec:\ncomponents:\ningressGateways:\n- name: istio-ingressgateway\nenabled: true\nk8s:\nservice:\nloadBalancerIP: 123.123.123.123\nloadBalancerSourceRanges:\n- 111.222.222.111/32\n\nè·ŸèˆŠç‰ˆçš„å·®ç•°åœ¨å¿…é ˆåŠ ä¸Šnameçš„åç¨±ï¼Œä¸ç„¶åœ¨manifest generate çš„æ™‚å€™æœƒç™¼ç”ŸéŒ¯èª¤\n\nå®‰è£\n\nistioctl install -f value.yaml\n\nå¯ä»¥å…ˆç”¢ç”Ÿyamlçœ‹å…§å®¹æ˜¯ä¸æ˜¯æœ‰è·Ÿæƒ³è±¡ä¸­çš„ä¸€æ¨£\nistioctl manifest generate -f value.yaml\n\nref.\nIstio 1.5 éƒ¨ç½²æŒ‡å—ä¿®æ­£ç‰ˆ\nIstioOperator Options",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "istioæœå‹™ç„¡æ³•è¨ªå•",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/15.istioæœå‹™ç„¡æ³•è¨ªå•/",
		"content": "å‰è¨€\nä»Šå¤©ä¸Šç­å°±ç™¼ç¾é€™å€‹æƒ…æ³ï¼Œistioçš„æœå‹™ç„¡æ³•è¨ªå•ï¼Œä½†åŒä¸€å€‹å¢é›†çš„å¦ä¸€å€‹istioå»æ­£å¸¸ã€‚\næ­£æ–‡\nçœ‹äº‹ä»¶éŒ¯èª¤å¯«çš„æ˜¯\nReadiness probe failed: HTTP probe failed with statuscode: 503\n\npod çš„ç‹€æ…‹æ˜¯running ï¼Œä½†istio-proxy å»æ˜¯ containers with unready status\n\næ ¹æ“šéŒ¯èª¤è¨Šæ¯éƒ½æ²’æ‰¾åˆ°ç›¸ç¬¦åˆçš„è³‡æ–™\nref.\nReadiness probe failed: HTTP probe failed with statuscode: 503 #23283ã€‚\nç¾åœ¨çœ‹istio-proxyçš„æ—¥èªŒï¼Œä¸Šé¢å¯«çš„æ˜¯\nEnvoy proxy is NOT ready: config not received from Pilot (is Pilot running?)\né€™å€‹ä¼¼ä¹æ˜¯åŸå› ..\n\næŸ¥çœ‹ç¶²æ ¼çš„ç‹€æ³\nistioctl proxy-status\n\næ‰€å±¬çš„ç¶²æ ¼LDSå¯« Never Ackonwledged\nå„æ¬„ä½çš„æ„æ€å¦‚ä¸‹\n\nLDSï¼ŒListener ç™¼ç¾æœå‹™ï¼šListener ç›£è½å™¨æ§åˆ¶ sidecar å•Ÿå‹•ç«¯å£ç›£è½ï¼ˆç›®å‰åªæ”¯æŒ TCP å”è­°ï¼‰ï¼Œä¸¦é…ç½® L3/L4 å±¤éæ¿¾å™¨ï¼Œç•¶ç¶²çµ¡é€£æ¥é”åˆ°å¾Œï¼Œé…ç½®å¥½çš„ç¶²çµ¡éæ¿¾å™¨å †æ£§é–‹å§‹è™•ç†å¾ŒçºŒäº‹ä»¶ã€‚\nRDSï¼ŒRouter ç™¼ç¾æœå‹™ï¼šç”¨æ–¼ HTTP é€£æ¥ç®¡ç†éæ¿¾å™¨å‹•æ…‹ç²å–è·¯ç”±é…ç½®ï¼Œè·¯ç”±é…ç½®åŒ…å« HTTP é ­éƒ¨ä¿®æ”¹ï¼ˆå¢åŠ ã€åˆªé™¤ HTTP é ­éƒ¨éµå€¼ï¼‰ï¼Œvirtual hosts ï¼ˆè™›æ“¬ä¸»æ©Ÿï¼‰ï¼Œä»¥åŠ virtual hosts å®šç¾©çš„å„å€‹è·¯ç”±æ¢ç›®ã€‚\nCDSï¼ŒCluster ç™¼ç¾æœå‹™ï¼šç”¨æ–¼å‹•æ…‹ç²å– Cluster ä¿¡æ¯ã€‚\nEDSï¼ŒEndpoint ç™¼ç¾æœå‹™ï¼šç”¨æ–¼å‹•æ…‹ç¶­è­·ç«¯é»ä¿¡æ¯ï¼Œç«¯é»ä¿¡æ¯ä¸­é‚„åŒ…æ‹¬è² è¼‰å‡è¡¡æ¬Šé‡ã€é‡‘çµ²é›€ç‹€æ…‹ç­‰ï¼ŒåŸºæ–¼é€™äº›ä¿¡æ¯ï¼Œsidecar å¯ä»¥åšå‡ºæ™ºèƒ½çš„è² è¼‰å‡è¡¡æ±ºç­–ã€‚\n\nref. Pilot\n\næŸ¥çœ‹podéŒ¯èª¤\n\nEnvoy proxy is NOT ready: config not received from Pilot (is Pilot running?): cds updates: 1 successful, 0 rejected; lds updates: 0 successful, 1 rejected\n\næˆ‘ä¸€ç›´ä»¥çˆ²é—œéµå­—æ˜¯æŸ¥å‰é¢çš„config not received from Pilot(is Pilot running?)\nä½†å¾Œä¾†é–‹äº†å·¥å–®æ‰¾äº†Googleå·¥ç¨‹å¸«ï¼Œä»–èªªé‡é»æ˜¯å¾Œé¢é‚£å¥ lds updates: 0 successful, 1 rejected\nç„¶å¾ŒæŸ¥çœ‹ istiod logï¼Œå¯ä»¥çœ‹åˆ°ldsç‚ºä»€éº¼æœƒrejected\nwarn\tads\tADS:LDS: ACK ERROR router~10.131.1.19~istio-ingressgateway-794bbdb877-np94z.istio-system~istio-system.svc.cluster.local-994 Internal:Error adding/updating listener(s) 0.0.0.0_8443: Invalid path: /etc/istio/ingressgateway-certs/tls.crt\n\né€™æ®µåœ¨podå‰›é–‹å§‹å»ºç«‹æ™‚ä¹Ÿæœ‰å‡ºç¾æ­¤éŒ¯èª¤ï¼Œçœ‹èµ·ä¾†æ˜¯httpsçš„æ†‘è­‰æœ‰å•é¡Œï¼Œ\næœ¬ä¾†ä½ˆç½²gatewayçš„yamlæª”åƒé€™æ¨£\napiVersion: networking.istio.io/v1beta1\nkind: Gateway\nmetadata:\nname: istio-ingressgateway-video\nnamespace: sex-system\nspec:\nselector:\nistio: ingressgateway # ä½¿ç”¨é»˜èªçš„æ§åˆ¶å™¨\nservers:\n- port: #åŠ å¯†å‚³è¼¸\nnumber: 443\nname: http\nprotocol: HTTPS\ntls:\nmode: SIMPLE\nserverCertificate: /etc/istio/ingressgateway-certs/tls.crt #è¨­å®šæ†‘è­‰è·¯å¾‘\nprivateKey: /etc/istio/ingressgateway-certs/tls.key #è¨­å®šæ†‘è­‰è·¯å¾‘\nhosts:\n- &quot;*&quot; #è©²æœå‹™å°æ‡‰domain\n- port:\nnumber: 80\nname: http\nprotocol: HTTP\nhosts:\n- &quot;*&quot; #è©²æœå‹™å°æ‡‰domain\n\næ†‘è­‰è·¯å¾‘æ˜¯ç›´æ¥æŒ‡å‘podè£¡é¢çš„è·¯å¾‘ï¼Œ\nä½†\n\ngoogleå·¥ç¨‹å¸«èªª istio v1.6é–‹å§‹gatewayçš„tlså·²ç»ä¸æ”¯æ´file mountç±»çš„è®¾ç½®äº†(i.e. privateKey, serverCertificate). ã€‚\n\næ‰€ä»¥ï¼Œè¦éº»è‡ªå·±å»ºç«‹ httpsçš„æ†‘è­‰ ï¼Œæˆ–è€…æ˜¯ä¹¾è„†ä¸è¦httpsã€‚\nï¼ˆref. Secure Gateways)\nè‡ªå·±å»ºç«‹æ†‘è­‰çš„è©±ï¼Œ\næ ¹æ“šä¸Šé¢çš„ç¶²å€ï¼Œç”¢ç”Ÿ crt è·Ÿ key ï¼Œç„¶å¾Œä½¿ç”¨\nkubectl create secret tls credential-httpbin -n istio-system --cert=./httpbin.com.crt --key=./httpbin.com.key\n\nå»ºç«‹sercretï¼Œæœ€å¾Œå†yamlå…§ç›´æ¥ä½¿ç”¨é€™å€‹sercretçš„name\napiVersion: networking.istio.io/v1beta1\nkind: Gateway\nmetadata:\nname: istio-ingressgateway-custom\nnamespace: rd7-video\nspec:\nselector:\nistio: ingressgateway-private # ä½¿ç”¨é»˜èªçš„æ§åˆ¶å™¨\nservers:\n- hosts:\n- httpbin.com\nport:\nname: httpbin\nnumber: 443\nprotocol: HTTPS\ntls:\ncredentialName: credential-httpbin\nmode: SIMPLE\n- port:\nnumber: 80\nname: http\nprotocol: HTTP\nhosts:\n- &quot;*&quot; #è©²æœå‹™å°æ‡‰domain\n\nç›®å‰çœ‹èµ·ä¾†æ˜¯æœ‰ç›´æ¥è§£æ‰é€™å€‹å•é¡Œï¼Œ\nå‰›å‰›æ›æ‰çš„podï¼Œæœ‰è®Šå›æ­£å¸¸çš„ç‹€æ…‹ã€‚\nä½†ç•¶åˆå…©å€‹podï¼Œä¸€å€‹æ´»ç€ï¼Œå¦ä¸€å€‹é™£äº¡ï¼Œé‚„ä¸çŸ¥é“çˆ²ä½•æœƒé€™æ¨£ã€‚",
		"tags": ["23283", "åŠ å¯†å‚³è¼¸", "è¨­å®šæ†‘è­‰è·¯å¾‘", "è¨­å®šæ†‘è­‰è·¯å¾‘", "è©²æœå‹™å°æ‡‰domain", "è©²æœå‹™å°æ‡‰domain", "è©²æœå‹™å°æ‡‰domain", "note","â›µï¸"]
},

{
		"title": "istio Virtual Service è·¨namespaceè®€å– DestinationRule",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/18.istio Virtual Service è·¨namespaceè®€å– DestinationRule/",
		"content": "å‰è¨€\nå› ç‚ºåœ¨å¯« vsçš„match uriï¼Œæœ‰ç™¼ç”Ÿä¸€äº›å‘ï¼Œä½¿ç”¨äº†prefixå°è‡´å…¶ä»–çš„VSéƒ½å»æŠ“åˆ°å¦ä¸€å€‹VSçš„è·¯å¾‘ï¼Œ\næ–¼æ˜¯æƒ³è¦è®“æ‰€æœ‰çš„VSéƒ½ç”¨åŒä¸€å€‹VSï¼Œé¿å…æœªä¾†ç™¼ç”ŸåŒæ¨£çš„éŒ¯èª¤ï¼Œä¸å¥½æ‰¾åŸå› ã€‚\næ­£æ–‡\nç›®å‰çš„ç‹€æ³æ˜¯ Aæœå‹™åœ¨ A çš„namespaceä¸Šé¢ï¼Œ Bæœå‹™åœ¨ B çš„ namespaceä¸Šé¢ã€‚\næ­£å¸¸çš„æ–¹å¼ï¼Œ\n\nVirtualService è·Ÿ DestinationRule éƒ½æœƒå„è‡ªåœ¨æ‰€å±¬æœå‹™ä¸Šé¢çš„ namespaceä¸Šé¢ã€‚\næ‰€ä»¥ï¼Œå¦‚æœæœ‰ ä¸‰å€‹æœå‹™ï¼Œå°±æœƒæœ‰ ä¸‰å€‹ VirtualService ï¼Œ\nåŒæ™‚ match uriçš„prefixéƒ¨åˆ†ï¼Œä¹Ÿéƒ½å¯« /api /api2 /api3 çš„è©±ï¼Œå°±æœƒç™¼ç¾ï¼Œæœå‹™ä¸ç®¡æ€éº¼å‘¼å«éƒ½æ˜¯å‘¼å«åˆ°api\nå…¶å¯¦é€™ä¹Ÿç®—æˆ‘ç™¼ç”Ÿçš„éŒ¯èª¤ï¼Œprefix æ˜¯åªé‡å°å‰é¢çš„å­—ä¸²ç¬¦åˆå°±éäº†ã€‚\nref. HTTPMatchRequest\nä½†é€™å€‹éŒ¯èª¤æœªä¾†ä¸çŸ¥é“æœ‰æ²’æœ‰è¾¦æ³•é¿å…ï¼Œæ˜¯ä¹Ÿèƒ½å¤ ä½¿ç”¨exact å®Œå…¨ç¬¦åˆçš„é—œéµå­—ä¾†é¿å…ä¸Šé¢çš„éŒ¯èª¤ç™¼ç”Ÿã€‚\nä½†æ­¤æ™‚æˆ‘å°±åœ¨æ€è€ƒï¼Œèƒ½ä¸èƒ½æœªä¾†éƒ½çµ±ä¸€ä½¿ç”¨ä¸€å€‹ VirtualService å°±å¥½ï¼Œ\né€™æ¨£ä¹Ÿæ–¹ä¾¿ç®¡ç†ã€‚\néç¨‹ä¸­çš„è¡€æ·šï¼Œå°±ä¸ç´°èªªäº†ã€‚\nç›®å‰èƒ½åšåˆ°çš„æ˜¯ Aã€B å…±ç”¨ä¸€å€‹ VirtualServiceï¼Œæ­¤ VSåœ¨Açš„ namespaceä¸Šé¢ï¼Œ\nç„¶å¾Œ DestinationRule å‰‡åˆ†åˆ¥åœ¨Aã€B çš„namespaceä¸Šé¢å„æ¶è¨­ä¸€å€‹ã€‚\nå¦‚æœDRä¹Ÿæƒ³è¦å…±ç”¨çš„è©±ï¼Œæœƒç™¼ç”ŸéŒ¯èª¤ï¼Œ\nThis subsetâ€™s labels are not found in any matching host\n\næƒ³éä½¿ç”¨æŒ‡å®šçš„FQDNçš„labelï¼Œä¾†å¼·è¿«ä»–å»æŒ‡å®šçš„åœ°æ–¹æ‰¾deploymentï¼Œä½†å¤±æ•—äº†ã€‚\nå¦‚æœæœ‰äººæœ‰çœ‹åˆ°æ–¹æ³•é‚„éº»ç…©å‘ŠçŸ¥ã€‚\nå‰›åœ¨å¯«æ–‡ç« çš„æ™‚å€™ï¼Œæœ‰çœ‹åˆ°DR ä¹Ÿæœ‰exportTOçš„æŒ‡ä»¤ï¼Œ\næ‰€ä»¥æ‡‰è©²ä¹Ÿæ˜¯å¯ä»¥é€éexportTOçš„æ–¹æ³•ï¼Œä¾†å…±ç”¨åŒä¸€å€‹DRã€‚\nç›®å‰çš„yamlå¯«æ³•å¦‚ä¸‹\nexportTo:\n- '*'\nhttp:\n- match:\n- uri:\nprefix: /v2\nname: bale-api-v2\nrewrite:\nuri: /api\nroute:\n- destination:\nhost: bale-api.sex-system.svc.cluster.local\nport:\nnumber: 80\nsubset: bale-api2\nweight: 80\n- destination:\nhost: bale-api.sex-system.svc.cluster.local\nport:\nnumber: 80\nsubset: bale-api\nweight: 20\n\né€™é‚Šåœ¨kialiæœƒçœ‹åˆ°è­¦å‘Š Subnet not found (Fig.1)ï¼Œä½†å¦‚æœç›´æ¥å¾Graphçœ‹æµé‡åˆ†ä½ˆçš„è©±ï¼Œæ˜¯æœ‰åœ¨åˆ†æµçš„ã€‚\né€™é‚Šè¦æ³¨æ„ï¼Œä¸€å®šè¦åŠ ä¸Š exportTO ï¼Œå…è¨±è©²æœå‹™å¯ä»¥è·¨éé‚Šç•Œå»å°‹æ‰¾åˆ°DRã€‚\nexportTO:\n- '*'\n\nref.\nVirtualService\nDestination Rule is not applied to traffic from all namespaces it's exported to\nIstio çš„é…ç½®åˆ†æ\nVirtualServiceè³‡æºè©³è§£",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "186. istioçš„Authorization policy(ç™½åå–®)",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/186. istioçš„Authorization policy(ç™½åå–®)/",
		"content": "å‰è¨€\nç¶“éä¸€å€‹æœˆçš„æ¬å®¶äº‹å®œï¼Œ\né€™ç¯‡æ‡‰è©²æ˜¯ç¬¬ä¸€ç¯‡ï¼Œä¹‹å¾Œé‚„æœ‰è¨±å¤šæ±è¥¿ï¼Œ\néƒ½æ˜¯é€™å€‹æœˆæ¬projectç¢°åˆ°çš„ã€‚\næ­£æ–‡\nç›®çš„\nåªè¦è¨­å®šç™½åå–®ï¼Œé™åˆ¶æŸäº›ipèƒ½é€²å…¥å°±å¥½ï¼Œ\nå…¶ä»–ä¸ç”¨ã€‚\nå¯¦ä½œ-Network\né€™é‚Šä½¿ç”¨istio 1.20 ç‰ˆæœ¬ï¼Œé›–ç„¶gateway API å‰›å‡ºçˆï¼Œ\nä½†æˆ‘é‚„æ²’å»ç ”ç©¶ï¼Œæ‰€ä»¥ä¸‹é¢ç”¨çš„éƒ½é‚„æ˜¯ istio API\né¦–å…ˆç¢ºèªä½ çš„LBé¡å‹ï¼Œ\nç›´é€£ï¼ˆNetwork)çš„è©±ï¼ŒåŸºæœ¬ä¸Šæ²’å¤ªå¤§å•é¡Œï¼Œç™½åå–®å¾ˆå¥½è¨­å®šã€‚\n\né–‹å•“ externalTrafficPolicy&quot;:&quot;Local&quot;ï¼Œ\nå…©ç¨®æ–¹æ³•\na. æ‰‹å‹•æ”¹service\n\nkubectl patch svc istio-ingressgateway -n istio-system -p '{&quot;spec&quot;:{&quot;externalTrafficPolicy&quot;:&quot;Local&quot;}}'\n\nb. åŠ åœ¨istioOperatorä¸Šé¢\ningressGateways:\n- name: istio-ingressgateway\nenabled: true\nk8s:\nservice:\nexternalTrafficPolicy: Local\nloadBalancerSourceRanges:\n- 10.0.0.0/8\n- 172.16.0.0/12\n- 192.168.0.0/16\n\nAuthorizationè¨­å®š\n\napiVersion: security.istio.io/v1\nkind: AuthorizationPolicy\nmetadata:\nname: manage-ingress-policy\nnamespace: istio-system\nspec:\nselector:\nmatchLabels:\nistio: ingressgateway\naction: ALLOW\nrules:\n- from:\n- source:\nipBlocks::\n- &quot;10.0.0.0/8&quot;\n- &quot;172.16.0.0/12&quot;\n- &quot;192.168.0.0/16&quot;\n\nï¼ˆæ³¨æ„ï¼Œé€™é‚Šçš„Load Balancer TypeæŒ‡çš„æ˜¯Networkï¼Œæ²’é€éproxyçš„ï¼Œ\nå¦‚æœæœ‰é–‹CDNï¼Œé‚£å°±æ˜¯istioèªªæ˜ä¸Šé¢çš„Load Balancer Type æ˜¯TCP Proxy)\nref. Ingress Access Control\nå¯¦ä½œ-Proxy\né€™é‚Šçš„ç¶²è·¯èµ°æ³•æ˜¯ï¼Œæœ‰é€éCDNï¼Œæˆ–æ˜¯å…¶ä»–çš„prxoyä»£ç†é€£éä¾†çš„æœå‹™ã€‚\nnumTrustedProxies é€™å€‹çš„å€¼ï¼Œå–æ±ºæ–¼ä½ çš„èµ°æ³•éäº†å¹¾å±¤çš„proxyï¼Œ\næˆ‘åªæœ‰cdnè½‰å³¶åˆ°gkeä¸Šé¢çš„istio LB\n\nè¨­å®šæ–¹å¼\na. åœ¨podä¸Šé¢æ–°å¢ anntations\n\nmetadata:\nannotations:\n&quot;proxy.istio.io/config&quot;: '{&quot;gatewayTopology&quot; : { &quot;numTrustedProxies&quot;: 1 } }'\n\nb. åœ¨istioOperatoræ–°å¢\napiVersion: install.istio.io/v1alpha1\nkind: IstioOperator\nspec:\nmeshConfig:\ndefaultConfig:\ngatewayTopology:\nnumTrustedProxies: 1\t\n\nAuthorizationè¨­å®š\n\né€™é‚Šæœ‰é»å‘ï¼Œæäº†ä¸€å¤©æ‰ææ¸…æ¥šã€‚\nå¼·çƒˆå»ºè­°æŠŠistioçš„httpbinè£èµ·ä¾†ï¼Œå¯¦éš›å»æ‰“ï¼Œ\nç„¶å¾Œä¸€é‚ŠæŸ¥çœ‹ingressgatewayçš„deploymentçš„logã€‚\na. é™åˆ¶å…¨éƒ¨\né€™æ˜¯ç¬¬ä¸€ç¨®æ–¹æ³•ï¼Œä½†é€™å€‹åªèƒ½é‡å°ã€å…¥å£ã€çš„ingressåšç™½åå–®é©—è­‰ã€‚\napiVersion: security.istio.io/v1\nkind: AuthorizationPolicy\nmetadata:\nname: frontend-ingress-policy\nnamespace: istio-system\nspec:\nselector:\nmatchLabels:\napp: ingressgateway-external\naction: ALLOW\nrules:\n- from:\n- source:\nremoteIpBlocks:\n- &quot;10.0.0.0/8&quot;\n- &quot;172.16.0.0/12&quot;\n- &quot;192.168.0.0/16&quot;\n\nb. é‡å°å–®å€‹\nå‡å¦‚æ²’æœ‰åœ¨å…¥å£çš„è©±ï¼Œç„¡æ³•ç…§ä¸Šé¢a.çš„æ–¹å¼æŠ“åˆ°è³‡æ–™ï¼Œ\næ‰€ä»¥åªèƒ½å¼·åˆ¶æŒ‡å®šåˆ¤æ–·headerã€‚\nref. Incorrect RemoteIP when Authorization Policy is applied to Injected Istio Proxy\napiVersion: security.istio.io/v1\nkind: AuthorizationPolicy\nmetadata:\nname: frontend-ingress-policy\nspec:\nselector:\nmatchLabels:\ngroup: frontend\naction: ALLOW\nrules:\n- when:\n- key: request.headers[X-Envoy-External-Address]\nvalues:\n- &quot;10.*&quot;\n\nref. Configuring Gateway Network Topology\nTroubleshooting\nistioOperatorå¢åŠ log é–±è®€æ€§\nspec:\nmeshConfig:\naccessLogFile: /dev/stdout\naccessLogEncoding: JSON\naccessLogFormat: |\n{\n&quot;protocol&quot;: &quot;%PROTOCOL%&quot;,\n&quot;upstream_service_time&quot;: &quot;%REQ(X-ENVOY-UPSTREAM_SERVICE_TIME)%&quot;,\n&quot;upstream_local_address&quot;: &quot;%UPSTREAM_LOCAL_ADDRESS%&quot;,\n&quot;duration&quot;: &quot;%DURATION%&quot;,\n&quot;upstream_transport_failure_reason&quot;: &quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%&quot;,\n&quot;route_name&quot;: &quot;%ROUTE_NAME%&quot;,\n&quot;downstream_local_address&quot;: &quot;%DOWNSTREAM_LOCAL_ADDRESS%&quot;,\n&quot;user_agent&quot;: &quot;%REQ(USER-AGENT)%&quot;,\n&quot;response_code&quot;: &quot;%RESPONSE_CODE%&quot;,\n&quot;response_flags&quot;: &quot;%RESPONSE_FLAGS%&quot;,\n&quot;start_time&quot;: &quot;%START_TIME%&quot;,\n&quot;method&quot;: &quot;%REQ(:METHOD)%&quot;,\n&quot;request_id&quot;: &quot;%REQ(X-REQUEST-ID)%&quot;,\n&quot;upstream_host&quot;: &quot;%UPSTREAM_HOST%&quot;,\n&quot;x_forwarded_for&quot;: &quot;%REQ(X-FORWARDED-FOR)%&quot;,\n&quot;client_ip&quot;: &quot;%REQ(TRUE-Client-IP)%&quot;,\n&quot;requested_server_name&quot;: &quot;%REQUESTED_SERVER_NAME%&quot;,\n&quot;bytes_received&quot;: &quot;%BYTES_RECEIVED%&quot;,\n&quot;bytes_sent&quot;: &quot;%BYTES_SENT%&quot;,\n&quot;upstream_cluster&quot;: &quot;%UPSTREAM_CLUSTER%&quot;,\n&quot;downstream_remote_address&quot;: &quot;%DOWNSTREAM_REMOTE_ADDRESS%&quot;,\n&quot;authority&quot;: &quot;%REQ(:AUTHORITY)%&quot;,\n&quot;path&quot;: &quot;%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%&quot;,\n&quot;response_code_details&quot;: &quot;%RESPONSE_CODE_DETAILS%&quot;\n}\n\nref. Understanding Istio Access Logs\nAuthorization Policyè¦å‰‡\n\nIf there are any CUSTOM policies that match the request, evaluate and deny the request if the evaluation result is deny.\n\nå¦‚æœæœ‰ä»»ä½•ç¬¦åˆè«‹æ±‚çš„è‡ªè¨‚ç­–ç•¥ï¼Œå‰‡è©•ä¼°ä¸¦æ‹’çµ•è«‹æ±‚ï¼Œè‹¥è©•ä¼°çµæœç‚ºæ‹’çµ•ã€‚\n\nIf there are any DENY policies that match the request, deny the request.\n\nå¦‚æœæœ‰ç¬¦åˆè«‹æ±‚çš„ä»»ä½•æ‹’çµ•ç­–ç•¥ï¼Œå‰‡æ‹’çµ•è©²è«‹æ±‚ã€‚\n\nIf there are no ALLOW policies for the workload, allow the request.\n\nå¦‚æœå·¥ä½œè² è¼‰æ²’æœ‰ä»»ä½•å…è¨±ç­–ç•¥ï¼Œå‰‡å…è¨±è©²è«‹æ±‚ã€‚\n\nIf any of the ALLOW policies match the request, allow the request.\n\nå¦‚æœæœ‰ä»»ä½•å…è¨±ç­–ç•¥ç¬¦åˆè©²è«‹æ±‚ï¼Œå‰‡å…è¨±è©²è«‹æ±‚ã€‚\n\nDeny the request.\n\næ‹’çµ•è©²è«‹æ±‚ã€‚\n\nref. Authorization Policy\ncloudflareè½‰ç™¼\nä¸Šé¢æœ‰æåˆ°ç”¨cloudflareçš„CDNæ™‚ï¼Œç™½åå–®æœƒè·Ÿç€è®Šï¼Œ\nä½†åœ¨é‚£ä¹‹å‰é‚„æœ‰å€‹æ±è¥¿è¦æ³¨æ„ï¼ŒCDNè½‰ç™¼æ™‚ï¼Œ\ncloudflareå¯ä»¥æŒ‡å®šèµ°httpé‚„æ˜¯èµ°https\né€™å€‹æœƒå½±éŸ¿åˆ°istioçš„gatewayï¼Œæ˜¯é–‹80é‚„æ˜¯443ã€‚",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "è¨ªå•istio å…§éƒ¨è² è¼‰å¹³è¡¡ip",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/20. è¨ªå•istio å…§éƒ¨è² è¼‰å¹³è¡¡ip/",
		"content": "å‰è¨€\næ­£æ–‡\nè¦æŒ‡å®šå…§éƒ¨è² è¼‰å¹³è¡¡IPçš„è©±ï¼Œä¸€èˆ¬åœ¨svcä¸Šé¢æ˜¯åªè¦æŒ‡å®š\nmetadata:\nannotations:\ncloud.google.com/load-balancer-type: &quot;Internal&quot;\nspec:\ntype: LoadBalancer\n\né€™æ¨£åœ¨GKEä¸Šé¢å°±æœƒæŒ‡å®šæˆå…§éƒ¨è² è¼‰å¹³è¡¡ã€‚\nä½†åœ¨istioä¸Šé¢è¦æŒ‡å®šçš„è©±ï¼Œéœ€åœ¨k8såº•ä¸‹æ–°å¢ serviceAnnotations\nåƒä¸‹é¢é€™æ¨£ï¼ˆé€™æ˜¯GKEçš„å¯«æ³•ï¼Œå…¶ä»–é›²ç«¯æ©Ÿå™¨è¨­å®šçš„æ–¹å¼æœƒä¸ä¸€æ¨£ï¼‰\nk8s:\nserviceAnnotations:\ncloud.google.com/load-balancer-type: &quot;Internal&quot;\n\nå…¶ä»–çš„åƒæ•¸è«‹åƒè€ƒ istioå®‰è£åŠä½¿ç”¨ =&gt; åŒä¸€å€‹å¢é›†å®‰è£å¤šå€‹ingressgateway\n\nref.\nSetup Multiple Ingress Gateways in Istio\nHow can I add service annotation in istio operator patch\nVirtualServiceçš„å¯«æ³•\nGatewayçš„å¯«æ³•èˆ‡ä¹‹å‰çš„ä¸€è‡´ï¼Œ\næ¯”è¼ƒæœ‰å·®ç•°çš„æ˜¯VSçš„å¯«æ³•\nhosts éœ€è¨­å®šå…§éƒ¨ipï¼Œä¸èƒ½ä½¿ç”¨ &quot;*&quot;\ngateways éœ€å¢åŠ meshï¼Œè¡¨ç¤ºè·¯ç”±æ˜¯å¾ç¶²æ ¼å…§çš„æµé‡ä¾†çš„ã€‚\nå¦‚æœä¸åœ¨gatewaysä¸Šé¢ï¼Œå¯«meshï¼Œæœƒç™¼ç”Ÿ\n503 upstream connect error or disconnect/reset before headers. reset reason local reset istio\n\nçš„éŒ¯èª¤ã€‚\næœƒç™¼ç¾é€™å€‹éŒ¯èª¤ï¼Œæ˜¯å› ç‚ºçœ‹äº†Istioå¯¦è¸é¿å‘æŒ‡å—ï¼š10 å¤§å¸¸è¦‹ç•°å¸¸ã€æœ€ä½³å¯¦è¸åŠè§£æ±ºæ–¹æ¡ˆæ¸…æ¥šç¶²æ ¼å…§ï¼Œèˆ‡ç¶²æ ¼é‚Šç·£çš„å·®ç•°ï¼Œæ‰çŸ¥é“å¢åŠ æ­¤è¨­å®šã€‚\næœ€å¾Œyamlå¦‚ä¸‹\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\nname: vs-internal\nnamespace: default\nspec:\nhosts:\n- 10.4.0.37\ngateways:\n- mesh\n- istio-ingressgateway-internal.default.svc.cluster.local\nhttp:\n- corsPolicy:\nallowOrigin:\n- '*'\nmatch:\n- uri:\nexact: /api/v1/health\nname: route-v1\nroute:\n- destination:\nhost: abc.default.svc.cluster.local\nport:\nnumber: 80\nweight: 100\n\nref.\nIstio é‹ç¶­å¯¦æˆ°ç³»åˆ—ï¼ˆ3ï¼‰ï¼šè®“äººé ­å¤§çš„ã€ç„¡é ­æœå‹™ã€-ä¸‹\nè¨˜ä¸€æ¬¡Istioé–“æ­‡503çš„å•é¡Œæ’æŸ¥",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "istio flagger è‡ªå‹•é‡‘çµ²é›€ä½ˆç½²",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/21. flagger è‡ªå‹•é‡‘çµ²é›€ä½ˆç½² for istio/",
		"content": "å‰è¨€\næœ¬ä¾†è‡ªå‹•ä½ˆç½²é…ä¸Šistioéƒ½å¥½äº†ï¼Œ\nä½†åœ¨å¯¦éš›ä¸Šæ¸¬è©¦çš„æ™‚å€™ç™¼ç¾ï¼Œå¦‚æœä¸å°å…¥è‡ªå‹•è—ç¶ ä½ˆç½²æˆ–é‡‘çµ²é›€ä½ˆç½²çš„è©±ï¼Œ\nåˆ°æ™‚é–‹ç™¼äººå“¡ç™¼ä½ˆç¨‹å¼æ™‚ï¼Œéœ€è¦æ›´æ”¹istio çš„ VirtualService ä»¥åŠ DestinationRuleã€‚\né™¤éç™¼ä½ˆçš„äººæ‡‚é€™äº›æ±è¥¿ï¼Œä¸ç„¶...æ”¹å£å°±...ï¼Œæ‰€ä»¥åªå¥½å…ˆç ”ç©¶flaggeräº†ã€‚æ¸›å°‘é–‹ç™¼äººå“¡ä½ˆç½²çš„know howï¼Œ\nåªè¦git tag ï¼Œç„¶å¾Œã€ç­‰ã€ å°±å¥½äº†ã€‚\næ­£æ–‡\n\nç°¡æ˜“æµç¨‹ä»‹ç´¹\n\nç›®å‰æ­£åœ¨åŸ·è¡Œçš„deploy ç‚ºabc-primary ï¼Œç•¶æœ‰æ–°çš„deploy ä½ˆç½²åœ¨ abc æ™‚ï¼Œflaggerå•Ÿå‹•ï¼Œ\nå…ˆå°‡æµé‡å¾ abc-primary è½‰åˆ° abc ï¼Œå› ç‚ºabc ç‚ºæ–°ç‰ˆæœ¬ã€‚\nç•¶æµé‡å…¨éƒ¨è½‰åˆ°abcå¾Œï¼Œå°‡ abc-primary åˆªé™¤ï¼Œä¸¦ä½ˆç½²æˆæ–°çš„ç‰ˆæœ¬ã€‚\nç•¶abc-primaryä½ˆç½²å®Œå¾Œï¼Œå†å°‡ æµé‡å¾ abc è½‰å› abc-primaryï¼Œ\nç­‰å¾…å…¨éƒ¨æµé‡è½‰å›ä¾†å¾Œï¼Œå†å°‡abcçš„deployåˆªé™¤ã€‚\n\nå…ˆå®‰è£flagger\n\nkustomize build https://github.com/fluxcd/flagger/kustomize/istio?ref=main | kubectl apply -f -\n\nref. Flagger Install on Kubernetes\n3. ä½ˆç½²è² è¼‰æ¸¬è©¦æœå‹™ flagger-loadtester\nå¦‚æœnamespaceè¦å…ˆå»ºç«‹test ï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨é€™å€‹åç¨±ï¼Œè«‹ä¸‹è¼‰yamlæª”å¾Œä¿®æ”¹ kustomization.yaml çš„namespace\nflagger-loadtester\nkubectl apply -k https://github.com/fluxcd/flagger//kustomize/tester?ref=main\n\né€™è£é¢ä¸»è¦æ˜¯ä½¿ç”¨hey ä½œçˆ²é€£ç·šæ¸¬è©¦çš„å·¥å…·ï¼Œ\nåœ¨å¾Œé¢çš„webhookæœƒç”¨åˆ°æ­¤æœå‹™ã€‚\n\nè¨­å®šCanary\n\næ­¤ç¯„ä¾‹ç‚ºABä½ˆç½²ï¼Œå¦æœ‰é‡‘çµ²é›€ä½ˆç½²ï¼Œè«‹åƒè€ƒ\nspec åº•ä¸‹çš„åƒæ•¸ï¼Œ\n- targetRef.name æ˜¯ deployæœƒæˆªå–ç¾æœ‰çš„deployè¨­å®šï¼Œç¢ºèªåç¨±èˆ‡ç¾æœ‰çš„deployåç¨±ä¸€æ¨£\n- autoscalerRef.name æ˜¯ HPAæœƒæˆªå–ç¾æœ‰çš„HPAè¨­å®šï¼Œç¢ºèªåç¨±èˆ‡ç¾æœ‰çš„HPAåç¨±ä¸€æ¨£ã€‚\n- service.nameæ˜¯ serviceæœƒæˆªå–ç¾æœ‰çš„serviceè¨­å®šï¼Œç¢ºèªåç¨±èˆ‡ç¾æœ‰çš„serviceåç¨±ä¸€æ¨£ã€‚\n- service.host éœ€æŒ‡å®šç›®å‰æœå‹™çš„domainï¼Œå¦‚æœç‚ºipåªèƒ½æœ‰ä¸€çµ„\n- webhooks.metadata.cmd ï¼Œç¶²å€å¿…é ˆæ›´æ”¹æˆæœå‹™èƒ½å¤ è¨ªå•çš„ç¶²å€ã€‚\napiVersion: flagger.app/v1beta1\nkind: Canary\nmetadata:\nname: video\nnamespace: sex-system\nspec:\nprovider: istio\ntargetRef:\napiVersion: apps/v1\nkind: Deployment\nname: video-api\nautoscalerRef:\napiVersion: autoscaling/v1\nkind: HorizontalPodAutoscaler\nname: video-api\n\nservice:\nname: video-api\nport: 80\ntargetPort: 80\nportName: http\nportDiscovery: true\ngateways:\n- istio-gateway-external.istio-system.svc.cluster.local\n- istio-gateway-internal.istio-system.svc.cluster.local\n- mesh\nhosts:\n- 123.123.123.123\ntrafficPolicy:\ntls:\nmode: DISABLE\nmatch:\n- uri:\nprefix: /\nrewrite:\nuri: /\ntimeout: 30s\nanalysis:\n# analysis spend time : interval * iterations\n# æ™‚é–“é–“éš” (é»˜èª 60s)\ninterval: 30s\n# å›æ»¾å‰çš„æœ€å¤§å¤±æ•—æŒ‡æ¨™æª¢æŸ¥æ¬¡æ•¸(å¯èƒ½å› ç‚ºæª¢æŸ¥æ™‚é–“å·®çš„é—œä¿‚ï¼Œè‡³å°‘æœƒæœ‰å…©æ¬¡å¤±æ•—)\nthreshold: 5\niterations: 1\nmetrics:\n- name: request-success-rate\nthresholdRange:\nmin: 99\ninterval: 1m\n- name: request-duration\nthresholdRange:\nmax: 500\ninterval: 30s\nwebhooks:\n- name: load-test-get\ntype: pre-rollout\nurl: http://flagger-loadtester.tools/\ntimeout: 15s\nmetadata:\ntype: cmd\ncmd: &quot;hey -z 1m -q 10 -c 2 http://video-api-canary.test/api/v1/Health/health&quot;\n- name: &quot;notify&quot;\ntype: event\nurl: http://webhook-api.tools/webhook/flagger\ntimeout: 5s\nmetadata:\nchannel: &quot;-1023450&quot;\n- name: load-test\ntype: rollout\nurl: http://flagger-loadtester.tools/\ntimeout: 5s\nmetadata:\ntype: cmd\ncmd: &quot;hey -z 1m -q 10 http://video-api-canary.test/api/v1/Health/health&quot;\n\nå¯«å¥½canaryï¼Œç„¶å¾Œç›´æ¥ä½ˆç½²ã€‚\næ­¤æ™‚ï¼Œk8sæœƒæ ¹æ“šä½ çš„è¨­å®šï¼Œå»ºç«‹èµ· ä¸€äº›ç›¸é—œçš„serviceä»¥åŠ deployment ï¼Œ\nä¾‹å¦‚ï¼Œæœ¬ä¾†çš„deploymentã€serviceä»¥åŠ hpaçš„ åç¨±å« abc ï¼Œ\né‚£åŒæ™‚æœƒå»ºç«‹ abc-primary çš„deployment è·Ÿ hpaï¼Œ\nä»¥åŠ abc-canary ã€ abc-primary çš„ service ã€‚\nç„¶å¾Œå†istioä¸Šé¢ä¹Ÿæœƒè‡ªå‹•å»ºç«‹ VirtualService è·Ÿ DestinationRule\næ‰€ä»¥Canaryå¾ˆé‡è¦ã€å¾ˆé‡è¦ã€å¾ˆé‡è¦ã€‚\nref.\nflagger/artifacts/examples/istio-canary.yaml\nIstio Canary Deployments\nIstio A/B Testing\n\nå¼•å…¥ grafana\n\nå› ç‚ºistioæœ¬èº«å°±æœ‰grafanaäº†ï¼Œæ‰€ä»¥æˆ‘ä¸æƒ³é‡è¤‡å®‰è£ï¼Œ\nåˆ°ä»–å€‘çš„git\nå°‡jsonæª”ä¸‹è¼‰ä¸‹ä¾†ï¼Œ\nåˆ°grafanaåŒ¯å…¥json(fig.1)ï¼Œ\n\næ­¤æ™‚æœƒç™¼ç”ŸéŒ¯èª¤\nTemplate variables could not be initialized: Datasource named prometheus was not found\n\nåŸå› æ˜¯åŸæœ¬çš„jsonæª”è£¡é¢çš„datasourceæ˜¯ prometheus\nè€Œç›®å‰å®‰è£çš„æ˜¯ Promethus ï¼Œå°‡æœ¬ä¾†çš„jsonæ›´æ”¹å¾Œå†åŒ¯å…¥ã€‚\nref.\nFlagger - Monitor Your Canary Deployments with Grafana\n\nä½ˆç½²å¤±æ•—ï¼Œé‡æ–°ä½ˆç½²æ–¹å¼\n\nè—ç¶ ä½ˆç½²æˆ–é‡‘çµ²é›€ä½ˆç½²ä¸Šé¢æœ‰æåˆ°ï¼Œæœƒè‡ªå‹•æ–°å¢ä¸€å€‹deploymentï¼Œå†åŸæœ‰çš„åç¨±ä¸Šé¢åŠ ä¸Š-primaryï¼Œ\nç„¶å¾ŒåŸæœ‰çš„deploymenté‚„æœƒå­˜åœ¨ï¼Œä½†ä»–çš„podæœƒæ¸…é™¤ã€‚\nç•¶æœ‰æ–°çš„imageæ™‚ï¼Œæœƒè§¸ç™¼å‹•ä½œï¼Œåœ¨åŸæœ‰çš„deploymentä¸Šå°‡podç”¢ç”Ÿå‡ºä¾†ï¼Œ\nç„¶å¾Œé–‹å§‹åšæµé‡çš„å°è½‰ï¼Œä¸¦ç™¼ä½ˆæ–°ç‰ˆæœ¬ã€‚\nä½†åœ¨æ¸¬è©¦çš„æ™‚å€™ï¼Œå¦‚æœcanaryå¯«éŒ¯äº†ï¼Œæœƒå°è‡´ç™¼ä½ˆå¤±æ•—ã€‚\næ­¤æ™‚ä¿®æ”¹å®Œï¼Œé‡æ–°apply ï¼Œä¹Ÿæœƒå¡åœ¨Failçš„ç‹€æ…‹ï¼Œ\néœ€åˆ° åŸæœ¬çš„deployment å¢åŠ  ä¸‹é¢çš„ç¨‹å¼ï¼Œ\nè®“canaryé‡æ–°è§¸ç™¼ã€‚\napiVersion: apps/v1\nkind: Deployment\nspec:\ntemplate:\nmetadata:\nannotations:\ntimestamp: &quot;2020-03-10T14:24:48+0000&quot;\n\nref. How to retry a failed release\n\nä½ˆç½²å¤±æ•—åŸå› \n\nç›®å‰æ¸¬è©¦ï¼Œ~æ¯æ¬¡ä¸€å®šæœƒè·³é€™å€‹å‡ºä¾†~ ï¼Œå·²è§£æ±ºã€‚å·®åˆ¥åªåœ¨æ¬¡æ•¸\nHalt advancement no values found for istio metric request-success-rate probably video-api.sex-system is not receiving traffic: running query failed: no values found\nç”¨curlæ‰“ ä¸æœƒç”¢ç”Ÿæ­¤éŒ¯èª¤ï¼Œ\ninterval æ™‚é–“å£“åœ¨30s ï¼Œæ­¤éŒ¯èª¤åªæœƒç™¼ç”Ÿ1æ¬¡\ninterval æ™‚é–“å£“åœ¨20s ï¼Œæ­¤éŒ¯èª¤æœƒç™¼ç”Ÿ2æ¬¡\nthresholdï¼šå›æ»¾æœ€å¤§éŒ¯èª¤ç™¼ç”Ÿæ¬¡æ•¸ï¼Œè¨­æˆ5ï¼Œåªè¦å°æ–¼éŒ¯èª¤ç™¼ç”Ÿçš„æ¬¡æ•¸ï¼Œé‚„æ˜¯å¯ä»¥æˆåŠŸè‡ªå‹•ä½ˆç½²\næœ‰æŸ¥åˆ°æœƒç™¼ç”Ÿé€™å€‹éŒ¯èª¤çš„åŸå› ï¼Œå¦‚æœåœ¨æµé‡å°è½‰æœŸé–“æ²’æœ‰æ”¶åˆ°æµé‡çš„è©±å°±æœƒç™¼ç”Ÿæ­¤éŒ¯èª¤ã€‚\næ‰€ä»¥è¦è§£æ±ºé€™å€‹éŒ¯èª¤ï¼Œè¦å† pre-rollout çš„æ™‚å€™ï¼Œå…ˆé€ä¸€äº›é€£ç·šéå»ã€‚\né€™æ¨£å°±ä¸æœƒæœ‰æ­¤éŒ¯èª¤ç™¼ç”Ÿäº†ã€‚\nref.Load Testing\n\nç›£æ§æ–¹å¼\n\næŸ¥è©¢flaggerä½ˆç½²ç‹€æ…‹ï¼Œéœ€é¡å¤–å®‰è£jqï¼ˆè§£æjsonçš„è»Ÿé«”)\n\nwatch &quot;kubectl -n istio-system logs deployment/flagger --tail=10 | jq '.ts,.msg'&quot;\næˆ–\nkubectl -n test describe canary/video-api | tail -20f\n\nçœ‹æµé‡æ¯”é‡\n\nwatch kubectl get canaries -A\n\nwebhookä¸»å‹•é€šçŸ¥\n\nåœ¨flaggerè£¡é¢ï¼Œæœ‰å¯¦ä½œwebhookï¼Œå¯ä»¥å°‡äº‹ä»¶çš„ç‹€æ…‹é€šçŸ¥çµ¦éœ€è¦çš„äººã€‚\nå…§å»ºæœ‰ slack ã€discord ï¼Œ é€™æ®µæˆ‘æ²’å¯¦ä½œ ï¼Œçœ‹èµ·ä¾†åªè¦åŠ åƒæ•¸å³å¯ï¼Œ\nè«‹åƒè€ƒ Alerting\nä½†å› ç‚ºå…¬å¸æ”¿ç­–ï¼Œæˆ‘ä¸èƒ½ç”¨slackæ‰€ä»¥åªå¥½è‡ªå·±åštelegramäº†ï¼Œ\ntelegramåšæ©Ÿå™¨äººé‚„æŒºå¿«çš„ï¼Œæ”¹å¤©å†å¯«ä¸€ç¯‡é—œæ–¼telegramçš„ä½¿ç”¨æ–¹å¼ã€‚\nwebhooks:\n- name: &quot;notify&quot;\ntype: event\nurl: http://webhook-api-v2.test/webhook/flagger\ntimeout: 5s\nmetadata:\nsome: &quot;some message&quot;\n\nåœ¨canaryä¸Šé¢åŠ å…¥ä¸Šé¢çš„ç¨‹å¼ç¢¼ï¼Œç„¶å¾Œç•¶æœ‰äº‹ä»¶è§¸ç™¼æ™‚ï¼Œ\næœƒå›å‚³ä¸‹é¢çš„jsonæ ¼å¼ã€‚\næ³¨æ„ webhook-api-v2.test æ˜¯ä¸€å€‹æˆ‘è‡ªå·±å»ºç«‹åœ¨ namespce ï¼štest ï¼Œdeploymentï¼šwebhook-api-v2 çš„api\nwebhookå…¶å¯¦å°±æ˜¯è‡ªå·±å»ºç«‹ä¸€å€‹apiçš„æ¥æ”¶æ©Ÿåˆ¶ï¼Œç•¶serverç«¯æœ‰è³‡æ–™æ™‚ï¼Œ\næœƒæ ¹æ“šä¸Šé¢çš„urlé€å‡ºjsonçµ¦ä½ ï¼Œæ­¤æ™‚è¦æ€éº¼åˆ©ç”¨ï¼Œå°±çœ‹å„è‡ªçš„éœ€æ±‚äº†ã€‚\n{\n&quot;name&quot;:&quot;video&quot;,\n&quot;namespace&quot;:&quot;test&quot;,\n&quot;phase&quot;:&quot;Failed&quot;,\n&quot;metadata&quot;:{\n&quot;eventMessage&quot;:&quot;Canary failed! Scaling down abc.test&quot;,\n&quot;eventType&quot;:&quot;Warning&quot;,\n&quot;some&quot;:&quot;some message&quot;,\n&quot;timestamp&quot;:&quot;1616654792750&quot;\n}\n}\n\nref.\nwebhook æ˜¯ä»€éº¼ä»¥åŠå¦‚ä½•å‰µå»º\nLINE Bot ç³»åˆ—æ–‡ â€” ä»€éº¼æ˜¯ Webhook?\nçµè«–\næœ‰æ™‚æ–‡ç« æ¸¬è©¦æœ‰å•é¡Œçš„è©±ï¼Œå»ºè­°åˆ°ä»–å€‘çš„git\næ‰¾ç›¸é—œçš„ç¯„ä¾‹ï¼Œåšæ¸¬è©¦ã€‚\nref.\nåŸºæ–¼Flaggerå’ŒIstioå¯¦ç¾è‡ªå‹•åŒ–é‡‘çµ²é›€éƒ¨ç½²\nIstio å¯¦è¸\nService Mesh - Istioå¯¦æˆ°ç¯‡ï¼ˆä¸Šï¼‰\nAutomated canary deployments with Flagger and Istio\nistioå…¥é–€ç³»åˆ—ä¹‹è‡ªå‹•åŒ–ç°åº¦ç™¼ä½ˆ",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "istioçš„ prometheusæˆªå–GKE metrics",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/23.istioçš„ prometheusæˆªå–GKE metrics/",
		"content": "å‰è¨€\nä¸»è¦æ¶æ§‹å¼„å¾—å·®ä¸å¤šçš„ï¼Œä½¿ç”¨ istio åŠ ä¸Š drone çš„ è‡ªå‹•ä½ˆç½²ï¼Œ\nå†é…åˆ flaggerçš„è—ç¶ ä½ˆç½²ï¼Œè—ç¶ ä½ˆç½²æ™‚ä½¿ç”¨telegramé€šçŸ¥ç›®å‰ä½ˆç½²é€²åº¦ã€‚\nï¼Œç¾åœ¨å‰©ä¸‹ç›£æ§é€™ä¸€å¡Šã€‚\nç„¶å¾Œï¼Œé˜¿ä¼¯ï¼Œå‡ºäº‹æ‹‰....\næ­£æ–‡\nä¸€é–‹å§‹æƒ³ä½¿ç”¨grafanaä¸Šé¢çš„æ¨£æ¿ï¼ŒåŸä»¥çˆ²åªè¦é€™æ¨£å°±å¥½ã€‚\n\n1. Kubernetes Deployment Statefulset Daemonset metrics\n1 Kubernetes for Prometheus Dashboard CN 20201209\nPrometheus 2 - Deploy Grafana\n\nä½†æ˜¯ï¼Œç™¼ç¾æˆ‘æŠ“ä¸åˆ°è³‡æ–™ã€‚ç›´æ¥é€£ç·šè‡³Prometheusè£¡é¢æŸ¥è©¢ä¹Ÿæ²’æœ‰ï¼Œ\næ–¼æ˜¯æ–·å®šï¼Œæˆ‘æ ¹æœ¬æ²’æœ‰æ’ˆè³‡æ–™åˆ°Prometheusã€‚\nå¦‚æœç›´æ¥æ¶è¨­ä¸€å€‹æ–°çš„grafanaä¸ä½¿ç”¨istioçš„grafanaæœƒä¸æœƒæ¯”è¼ƒå¥½ï¼Ÿ\nä½†æ˜¯é€™æ¨£æœ¬ä¾†istioçš„grafana dashboard (Fig.1) å°±è¦è‡ªå·±å»ºç«‹äº†ã€‚\n\nkube-state-metrics\næŸ¥äº†ä¸€äº›è³‡æ–™ï¼Œæœ€å¾Œæ‰¾åˆ°çš„æ–¹æ¡ˆæ˜¯å®‰è£ kube-state-metrics\nä½†æ˜¯å…‰å®‰è£é‚„æ˜¯ä¸è¡Œï¼Œå¿…é ˆè¦è®“PrometheusæŠ“å¾—åˆ°è³‡æ–™æ‰è¡Œã€‚\nå»ºè­°å…ˆå°‡yamlæª”æŠ“ä¸‹ä¾†ï¼Œå› ç‚ºæœ‰äº›åœ°æ–¹éœ€è¦æ›´æ”¹ã€‚\næ‰“é–‹ standard/service.yaml\nåœ¨metadataåº•ä¸‹ åŠ ä¸Š prometheus.io/scrape: 'true'\né€™æ˜¯è¦è®“prometheus å¯ä»¥è‡ªå‹•å¾—å»ç™¼ç¾æœå‹™\nmetadataå®Œæ•´çš„yamlå¦‚ä¸‹\nmetadata:\nlabels:\napp.kubernetes.io/name: kube-state-metrics\napp.kubernetes.io/version: v1.9.8\nannotations:\nprometheus.io/scrape: 'true'\nname: kube-state-metrics\nnamespace: kube-system\n\nç„¶å¾Œï¼Œä½ˆç½²\nkubectl apply -f standard\n\nNode-Exporter\nå¾Œä¾†æŸ¥äº†ä¸€ä¸‹ï¼Œé€™é‚Šçš„æŒ‡æ¨™è³‡æ–™å·²ç¶“åœ¨ cadvisor è£¡é¢äº†ï¼Œæ‰€ä»¥ä¸ç”¨åœ¨é¡å¤–åšã€‚\nref. Prometheus (node_exporter) issue when update from GKE 1.15 to 1.16\nref.\nPrometheus 5 - Node Exporter &amp; Kube State Metrics\nprometheusï¼ˆä¹ï¼‰ æ”¶é›†kube-state-metricsæŒ‡æ¨™è³‡è¨Š",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "istioçš„virtualservice matchæ¯”å°",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/30. istioçš„virtualservice matchæ¯”å°/",
		"content": "å‰è¨€\næœ€è¿‘å› ç‚ºæ–°çš„éœ€æ±‚ï¼Œå†åº¦è·Ÿistioçš„virtualserviceæ§“ä¸Šäº†ã€‚\né€™æ¬¡è¦åšçš„æ˜¯é‡å°domainå»è§£æç¶²å€ï¼Œhostä¸å†è‡ªå®šã€‚\næ­£æ–‡\nè¸©åˆ°çš„å‘å¾ˆç‰¹åˆ¥ï¼Œæ ¹æ“šå®˜æ–¹æ–‡ä»¶ä¸Šå¯«çš„æ˜¯\n\nFor example, the following restricts the rule to match only requests where the URL path starts with /ratings/v2/ and the request contains a custom end-user header with value jason\n\næ–‡ç« çš„ç¯„ä¾‹å¦‚ä¸‹ï¼Œå®˜æ–¹æ–‡ä»¶æ˜¯èªªæ˜ç•¶url path ç¬¦åˆ /ratings/v2 è€Œä¸” headerè£¡é¢çš„end-userçš„å€¼ç‚º jason æ‰æœƒè½‰åˆ°æ­£ç¢ºçš„è·¯ç”±ã€‚\napiVersion: networking.istio.io/v1beta1\nkind: VirtualService\nmetadata:\nname: ratings-route\nspec:\nhosts:\n- ratings.prod.svc.cluster.local\nhttp:\n- match:\n- headers:\nend-user:\nexact: jason\nuri:\nprefix: &quot;/ratings/v2/&quot;\nignoreUriCase: true\nroute:\n- destination:\nhost: ratings.prod.svc.cluster.local\n\nref.HTTPMatchRequest\nå†ä¾†å°±æ˜¯æˆ‘è¸©å‘çš„åœ°æ–¹ï¼Œå› ç‚ºæˆ‘ä¸ç®¡æ€éº¼æ¸¬è©¦ï¼Œæ¸¬è©¦å‡ºä¾†çš„éƒ½æ˜¯ ã€æˆ–ã€ï¼Œ\nä¹Ÿå°±æ˜¯èªª ç•¶æµé‡é€²å…¥æ™‚ï¼Œ åªè¦ url path æ˜¯ /api ã€æˆ–ã€ header çš„Hostæ˜¯ ç¬¦åˆ qa2.777.+.comçš„æ­£å‰‡ï¼Œæ‰æœƒå°å»æ­£ç¢ºçš„è·¯ç”±ã€‚\nè·Ÿå®˜æ–¹æ–‡ä»¶çš„è¬›æ³•è½å·®æœ‰é»å¤§ï¼Œå¾Œä¾†æ¸¬è©¦äº†è€åŠå¤©æ‰ç™¼ç¾ï¼Œé—œéµåœ¨ ã€ - ã€ã€‚\nä¸‹é¢çš„ç¨‹å¼ï¼Œæ¢ä»¶æ˜¯ ã€æˆ–ã€ï¼Œå…©å€‹æ¢ä»¶å…¶ä¸­ä¸€å€‹ééƒ½æœƒå°åˆ°æ­£ç¢ºçš„è·¯ç”±\nmatch:\n- headers:\nHost:\nregex: qa2\\.777.+\\.com\n- uri:\nprefix: /api\n\nä¸‹é¢çš„ç¨‹å¼ï¼Œæ¢ä»¶å¼ ã€è€Œä¸”ã€ ï¼Œå…©å€‹æ¢ä»¶éƒ½è¦ç¬¦åˆæ‰æœƒå°åˆ°æ­£ç¢ºçš„è·¯ç”±\nmatch:\n- headers:\nHost:\nregex: qa2.?\\.777.+\\.com\nuri:\nprefix: /api\n\næœ¬ä¾†é‚„æœ‰åœ¨æ¢è¨å¦ä¸€ç¨®æ–¹æ³•ï¼Œç›´æ¥åœ¨hostsä¸Šé¢åšåˆ¤æ–·(fig.1)ï¼Œ\nä½†æ˜¯æ¸¬è©¦å‡ºä¾†åªèƒ½é‡å° sub domainï¼Œå¦‚æœæŠŠè¬ç”¨å­—å…ƒæ”¾åœ¨å¾Œé¢ï¼Œé€£å­˜æª”éƒ½æœƒå‡ºéŒ¯æ¡ã€‚\n\nhosts:\n- &quot;*.777.com&quot;\n\nref.\nSupport wildcard/regexp in VirtualService host\nconfig.route.v3.VirtualHost",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "istio æŠ“èŸ²è¨˜",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/31.istio æŠ“èŸ²è¨˜/",
		"content": "å‰è¨€\nç‹€æ³å¾ˆå¥‡ç‰¹ï¼Œå¥‡ç‰¹åˆ°æˆ‘ä¸çŸ¥é“è©²å¾å“ªé‡Œæ‰¾ã€‚ç°¡å–®èªªå°±æ˜¯gatewayè£¡é¢æœ‰meshçš„è©±ï¼Œ\nå°±æœƒæœ‰æ­¤å‘å‡ºç¾ã€‚\næ­£æ–‡\nå…ˆèªªæ˜ä¸€ä¸‹ç’°å¢ƒï¼ŒDeployment A çš„ VirtualService æœ‰è¨­å®š domain , abc.com\næ­¤æ™‚é€²å» Deploymentè£¡é¢çš„ pod ï¼Œ ä½¿ç”¨ curl å‘¼å«å¤–éƒ¨çš„ipï¼Œæœƒç™¼ç”Ÿ404çš„éŒ¯èª¤ã€‚\ne.g. curl -v 123.213.123.213 -H &quot;Host:abc.com&quot;\nä½†æ˜¯ï¼Œå¦‚æœHostä¸å¸¶abc.com ï¼Œæ”¹å¸¶ä»»æ„çš„ domainï¼Œå³å¯æ­£å¸¸åŸ·è¡Œã€‚\né™¤éŒ¯éç¨‹\n\nä½¿ç”¨tcpdump ï¼Œå°‡æ‰€æœ‰çš„å°åŒ…æ’ˆå‡ºï¼Œä½†ç™¼ç¾å¦‚æœ host å¸¶ abc.com ï¼Œæ²’æœ‰ä»»ä½•çš„å°åŒ…é€²å‡ºã€‚\nä½†å¸¶ä»»æ„ domain: def.com ï¼Œå‰‡æœƒæœ‰å°åŒ…é€²å‡ºã€‚æ•…é–‹å§‹æ‡·ç–‘æ˜¯ sidecarçš„æŸäº›æ©Ÿåˆ¶å°‡æµé‡å°åˆ°æœ¬æ©Ÿï¼Œ\nä»¥è‡³æ–¼å›å‚³404çš„éŒ¯èª¤ã€‚\nç°¡æ˜“çš„tcpdumpä½¿ç”¨ï¼Œ\nè©³ç´°ç”¨æ³•è«‹åƒè€ƒé€£çµ\né‡å° host æ˜¯ 123.213.123.213 ä¸” port æ˜¯ 80 çš„å°åŒ…æˆªå–ï¼Œä¸¦å­˜å…¥demo2.pcapçš„æª”æ¡ˆ\ntcpdump host 123.213.123.213 and port 80 -w demo2.pcap\n\nä½†æ˜¯å¾podè£¡é¢çœ‹å°åŒ…ï¼Œæœƒæƒ³å“­ï¼Œæ‰€ä»¥é€²ä¸€æ­¥è¦æŠŠå°åŒ…çš„æª”æ¡ˆæ”¾åˆ°è‡ªå·±çš„æ©Ÿå™¨ä¸Šï¼Œå†ä½¿ç”¨wiresharkçœ‹ã€‚\nå°‡pod(api-beta-v2-primary-69797b47d6-bl6vf)ï¼Œè£¡é¢çš„æª”æ¡ˆ demo2.pcap è¤‡è£½åˆ°æœ¬æ©Ÿä¸Š\nkubectl cp api-beta-v2-primary-69797b47d6-bl6vf:/app/demo2.pcap -n istio ./demo2.pcap\n\nref. [Linux] Tcpdump æ“·å–å°åŒ…æŒ‡ä»¤ç¯„ä¾‹æ•™å­¸\n\næŸ¥è©¢outbound handler\n\nistioctl proxy-config route api-beta-v2-primary-69797b47d6-bl6vf -n istio\n\nçµ‚æ–¼æŸ¥åˆ°äº†ä¸€å€‹é—œéµï¼Œåœ¨æœ‰å•é¡Œdomainï¼Œä»–matchçš„pathæ˜¯å¦å¤–ä¸€å€‹virtualService(fig.1)ï¼Œæœ€å¾ŒæŸ¥åˆ°é‚£å€‹VirtualSerice ï¼Œåœ¨gatewayä¸Šé¢å¤šè¨­äº†ä¸€çµ„ meshï¼Œ\nå°è‡´ä»–ä¸€ç›´åœ¨ç¶²æ ¼å…§ç¹ï¼Œæ‰€ä»¥æ‰æœƒ404ã€‚\n\né¡å¤–è£œå……ï¼ŒæŸ¥è©¢ Inbound handler\nistioctl proxy-config listener reviews-v1-54b8794ddf-jxksn\n\nå¯ç›´æ¥ç”¨ istioctl pc ä¾†å–ä»£ proxy-config\nref. Istio ä¸­çš„ Sidecar æ³¨å…¥åŠé€æ˜æµé‡åŠ«æŒéç¨‹è©³è§£",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "istio operator å®‰è£æ–°çš„ ingress deployåŠservice",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/34. istio operator å®‰è£æ–°çš„ ingress deployåŠservice/",
		"content": "å‰è¨€\nä¸»ç®¡æŒ‘æˆ°DCå¤±æ•—ï¼Œè®Šæˆåˆè¦è®Šå›èˆŠçš„ç³»çµ±æ¶æ§‹ã€‚æšˆ...\nç”¨äº†istioæ˜¯ç‚ºäº†ä¸€å€‹ipæ‰“æ‰€æœ‰æœå‹™ï¼Œç¾åœ¨åˆè®Šå›å»ã€‚\næœå‹™è·Ÿ ip æ˜¯ä¸€å°ä¸€çš„å­˜åœ¨ã€‚\næ­£æ–‡\næœ€ç°¡å–®çš„å®‰è£æ–¹å¼ï¼Œå¯çœ‹å‰ä¸€ç¯‡ <a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/7. Istioå®‰è£åŠä½¿ç”¨/\">7. Istioå®‰è£åŠä½¿ç”¨</a>\nä»¥å‰æ–°å¢çš„æ™‚å€™ï¼Œéƒ½æœƒåŒæ™‚å®‰è£æœ€åŸå§‹çš„deploy ä»¥åŠ service(fig.1)ï¼Œ\n\næ‰€ä»¥åœ¨æ–°å¢æ–°çš„ingressgatewayçš„æ™‚å€™ï¼Œéœ€è¦å…ˆæŒ‡å®šåŸå§‹çš„istio-ingressgateway ç‚º enable:falseã€‚\né€™æ¨£åœ¨å®‰è£çš„æ™‚å€™ï¼Œæ‰ä¸æœƒåŒæ™‚å®‰è£ã€‚\nkind: IstioOperator\napiVersion: install.istio.io/v1alpha1\nmetadata:\nannotations:\ninstall.istio.io/ignoreReconcile: 'true'\nname: istio-external-test\nnamespace: istio-system\nspec:\naddonComponents:\nistiocoredns:\nenabled: false\ncomponents:\nbase:\nenabled: true\ncni:\nenabled: false\ningressGateways:\n- name: istio-ingressgateway # 20210730æ–°å¢ï¼Œå¯å–æ¶ˆå–®ç¨ä½ˆç½²æ­¤yamlé‚„æœƒé¡å¤–è£ingress-gateway\nenabled: false\n- name: ingressgateway-external\nnamespace: istio-system\nenabled: true\nk8s:\nservice:\n# loadBalancerIP è¦è·Ÿè‘—æ”¹ï¼Œæœ€å¥½å…ˆå°‡IPè¨­æˆéœæ…‹\nloadBalancerIP:\nloadBalancerSourceRanges:\n# - 0.0.0.0/0\n- 10.0.0.0/8\n- 172.16.0.0/12\n- 192.168.0.0/16\nenv:\n- name: ISTIO_META_ROUTER_MODE\nvalue: standard\nhpaSpec:\nminReplicas: 1\noverlays:\n- kind: HorizontalPodAutoscaler\nname: ingressgateway-external\npatches:\n- path: metadata.labels.app\nvalue: ingressgateway-external\n- path: metadata.labels.istio\nvalue: ingressgateway-external\n- path: spec.scaleTargetRef.name\nvalue: ingressgateway-external\n- kind: Deployment\nname: ingressgateway-external\npatches:\n- path: metadata.labels.app\nvalue: ingressgateway-external\n- path: metadata.labels.istio\nvalue: ingressgateway-external\n- path: spec.selector.matchLabels.app\nvalue: ingressgateway-external\n- path: spec.selector.matchLabels.istio\nvalue: ingressgateway-external\n- path: spec.template.metadata.labels.app\nvalue: ingressgateway-external\n- path: spec.template.metadata.labels.istio\nvalue: ingressgateway-external\n- kind: Service\nname: ingressgateway-external\npatches:\n- path: metadata.labels.app\nvalue: ingressgateway-external\n- path: metadata.labels.istio\nvalue: ingressgateway-external\n- path: spec.selector.app\nvalue: ingressgateway-external\n- path: spec.selector.istio\nvalue: ingressgateway-external\n- kind: PodDisruptionBudget\nname: ingressgateway-external\npatches:\n- path: metadata.name\nvalue: ingressgateway-external\n- path: metadata.labels.app\nvalue: ingressgateway-external\n- path: metadata.labels.istio\nvalue: ingressgateway-external\n- path: spec.selector.matchLabels.app\nvalue: ingressgateway-external\n- path: spec.selector.matchLabels.istio\nvalue: ingressgateway-external",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "istio virtualService delegateä½¿ç”¨",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/35. istio virtualService delegateä½¿ç”¨/",
		"content": "å‰è¨€\næ­£æ–‡\næœƒç”¨åˆ°delegateçš„åŸå› ï¼Œæ˜¯ç‚ºäº†è¦è§£æ±ºåœ¨ç¶­è­·æ™‚ä¸Šçš„ç—›é»ã€‚\nå› ç›®å‰ä½¿ç”¨flagger canaryï¼Œ\nå°è‡´æ¯å€‹æœå‹™å°±ä¸€å€‹virtualService (ä¸‹é¢æœƒç”¨VSä»£æ›¿)ï¼Œ\nè€Œå¤šå€‹æœå‹™æœƒå…±ç”¨ä¸€å€‹host ï¼Œå°è‡´åœ¨ç¶­è­·ä¸Šçš„å›°é›£ã€‚\nè€Œä¸”åœ¨kialiä¸Šé¢æœƒå‡ºç¾è­¦å‘Š(fig.1)ï¼Œçœ‹äº†å¯¦åœ¨ç¤™çœ¼ã€‚\n\næ‰€ä»¥ä½¿ç”¨delegateã€‚é€™æ¨£çš„è©±ï¼Œæµé‡æœƒå…ˆå°åˆ° delegate vsï¼Œä¹‹å¾Œæ‰æœƒæ ¹æ“špathåˆ°å„æœå‹™çš„vsã€‚\ndelegate æœ‰å¹¾é»è¦æ³¨æ„ï¼Œ\n\nä¸æ”¯æ´ regex\nåœ¨delegateä¸Šå¯«rewriteä¸æœƒè¢«è½‰å°ï¼Œè¦åœ¨å°éå»çš„vså¯«ã€‚\nç›®å‰æ¸¬è©¦åªèƒ½åœ¨åŒä¸€å€‹namespaceä¸Šé¢ã€‚å¦‚æœä¸æ˜¯ç”¨è—ç¶ ä½ˆç½²è‡ªå®šç¾©çš„è©±ï¼Œåœ¨destination ä¸Šé¢ï¼Œå¯ä»¥ä½¿ç”¨å®Œæ•´çš„FQDNï¼Œæ˜¯å¯ä»¥åŸ·è¡Œçš„ã€‚(ä¾‹å¦‚: video-admin-primary.default.svc.cluster.local)\n\nVS delegate\napiVersion: networking.istio.io/v1beta1\nkind: VirtualService\nmetadata:\nname: control-dashboard\nnamespace: default\nspec:\nhosts:\n- &quot;*&quot;\ngateways:\n- istio-gateway-external.istio-system.svc.cluster.local\nhttp:\n- delegate:\nname: video-admin\nnamespace: default\nmatch:\n- uri:\nprefix: /ezio\n- uri:\nprefix: /abc\n- uri:\nprefix: /api\nname: reviews-v2-routes\n- delegate:\nname: tw-frontend\nnamespace: default\nmatch:\n- uri:\nprefix: /\nname: tw-frontend\n\næœå‹™çš„ vsï¼Œï¼ˆæ³¨æ„ï¼šæ­¤è™•çš„yamlæ˜¯ç”±flaggerè‡ªå‹•ç”¢ç”Ÿçš„ï¼‰\nkind: VirtualService\napiVersion: networking.istio.io/v1alpha3\nmetadata:\nname: video-admin\nnamespace: default\nspec:\nhosts: []\nhttp:\n- match:\n- uri:\nprefix: /api\n- uri:\nprefix: /abc\n- uri:\nprefix: /ezio\nrewrite:\nuri: /api\nroute:\n- destination:\nhost: video-admin-primary\nweight: 100\n- destination:\nhost: video-admin-canary\nweight: 0\n\nps. ä½¿ç”¨canaryçš„è©±ï¼Œåœ¨serviceä¸‹é¢åŠ ä¸Š\ndelegation: true\n\nref. How does Flagger interact with Istio?\napiVersion: flagger.app/v1beta1\nkind: Canary\nmetadata:\nname: example-api-qa-v2\nnamespace: istio-example\nspec:\nprovider: istio\ntargetRef:\napiVersion: apps/v1\nkind: Deployment\nname: example-api-qa-v2\nautoscalerRef:\napiVersion: autoscaling/v1\nkind: HorizontalPodAutoscaler\nname: example-api-qa-v2\n\nservice:\ndelegation: true # use delegate\nname: example-api-qa-v2\nport: 80\ntargetPort: 80\nportName: http\nportDiscovery: true\n\ntrafficPolicy:\ntls:\nmode: DISABLE\nmatch:\n- uri:\nprefix: /api-v2\nrewrite:\nuri: /api\ntimeout: 30s\nanalysis:\n# analysis spend time : interval * iterations\n# æ™‚é–“é–“éš” (é»˜èª 60s)\ninterval: 30s\n# å›æ»¾å‰çš„æœ€å¤§å¤±æ•—æŒ‡æ¨™æª¢æŸ¥æ¬¡æ•¸(å¯èƒ½å› ç‚ºæª¢æŸ¥æ™‚é–“å·®çš„é—œä¿‚ï¼Œè‡³å°‘æœƒæœ‰å…©æ¬¡å¤±æ•—)\nthreshold: 5\niterations: 1\nmetrics:\n- name: request-success-rate\nthresholdRange:\nmin: 99\ninterval: 1m\n- name: request-duration\nthresholdRange:\nmax: 500\ninterval: 30s\nwebhooks:\n- name: load-test-get\ntype: pre-rollout\nurl: http://flagger-loadtester.tools/\ntimeout: 15s\nmetadata:\ntype: cmd\ncmd: &quot;hey -z 1m -q 10 -c 2 http://example-api-qa-v2-canary.istio-example&quot;\n- name: &quot;notify&quot;\ntype: event\nurl: http://webhook-api.tools/webhook/flagger\ntimeout: 5s\nmetadata:\nchannel: &quot;-1001429024676&quot;\n- name: load-test\ntype: rollout\nurl: http://flagger-loadtester.tools/\ntimeout: 5s\nmetadata:\ntype: cmd\ncmd: &quot;hey -z 1m -q 10 http://example-api-qa-v2-canary.istio-example&quot;\n\nref.\nVS Delegate\nVS HTTPMatchRequest",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "istio æ›è¼‰ECK kibana",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/54. istio æ›è¼‰ECK kibana/",
		"content": "å‰è¨€\næ­£æ–‡\næ­£å¸¸è¨­å®švsçš„æ™‚å€™ï¼Œ\n- match:\n- uri:\nprefix: /\nname: kibana\nroute:\n- destination:\nhost: quickstart-kb-http.default.svc.cluster.local\nport:\nnumber: 5601\n\næœƒç™¼ç”ŸéŒ¯èª¤\nupstream connect error or disconnect/reset before headers. reset reason: connection termination\nä¸ç®¡æ€æ¨£æ”¹vsé‚„æ˜¯ä¸é€šï¼Œæœ€å¾Œæ˜¯è¦æŠŠkibanaçš„è¨­å®šæ”¹æ‰ï¼Œ\nå®Œæ•´çš„yamlå¦‚ä¸‹\napiVersion: kibana.k8s.elastic.co/v1\nkind: Kibana\nmetadata:\nname: quickstart\nspec:\nversion: 7.15.0\ncount: 1\nelasticsearchRef:\nname: quickstart\nhttp:\ntls:\nselfSignedCertificate:\ndisabled: true\nservice:\nspec:\nports:\n- name: http\nport: 5601\ntargetPort: 5601\n\né‡é»åœ¨æ–¼ä¸€å®šè¦åŠ  http ä¸‹é¢çš„è¨­å®šã€‚\nselfSignedCertificate ï¼Œè«‹åƒè€ƒ[3]\nè£œå……ï¼š\n[1] çš„é€£çµæœ‰æåˆ°\nmetadata:\nannotations:\nsidecar.istio.io/rewriteAppHTTPProbers: &quot;true&quot;\n\né€™é‚Šè«‹åƒè€ƒ[2]\nref.\n\nExpose kibana (eck operator) via istio gateway - https problem (Error 503)\nIstio æœå‹™çš„å¥åº·æª¢æŸ¥\nHTTP configuration",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "isito é¡åƒæµé‡",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/62. isito é¡åƒæµé‡/",
		"content": "å‰è¨€\næ­£æ–‡\næœ€è¿‘åœ¨æ¸¬è©¦ istioçš„é¡åƒæµé‡ï¼Œ\næƒ³è¦é‡å°èˆŠçš„ websocket åšé¡åƒå°‡æµé‡å°åˆ°æ–°ç‰ˆçš„websocketä¸Šé¢ã€‚\nå¯¦æ¸¬çš„çµæœï¼Œwebsocketä¸èƒ½ç”¨ã€‚\nä½†httpèƒ½å¤ ä½¿ç”¨ï¼Œé€™æ˜¯ç”±æ–¼ istioçš„é¡åƒæµé‡æ˜¯ ã€ fire and forgetã€\nä½†websocket æ˜¯éœ€è¦äº¤æ¡å¾Œï¼Œæ‰èƒ½æŒçºŒé€²è¡Œä¸‹é¢çš„æ­¥é©Ÿã€‚\næ‰€ä»¥å°è‡´é€£ç·šç„¡æ³•å»ºç«‹ï¼Œä½† RESTfulçš„è«‹æ±‚ï¼Œæ˜¯æ²’å•é¡Œçš„ã€‚\nå…ˆæ±ºæ¢ä»¶ï¼Œ\n2å€‹deploymentï¼Œåˆ†åˆ¥å« A è·Ÿ Bï¼Œ\nlabel ä½¿ç”¨ versionï¼šv1 ä»¥åŠ version: v2 åšå€åˆ¥\n1å€‹ service ï¼Œåˆ†åˆ¥æŒ‡åˆ°é€™2å€‹deployment\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\nname: ws-qa\nnamespace: istio\nspec:\nhosts:\n- www.abc.com\n- yabo-ws-qa\ngateways:\n- istio-system/istio-gateway-external\n- istio-system/istio-gateway-internal\nhttp:\n- match:\n- uri:\nregex: ^/ws/.*\nroute:\n- destination:\nhost: ws-qa\nsubset: v1\nport:\nnumber: 80\nweight: 100\nmirror:\nhost: ws-qa\nsubset: v2\nmirrorPercentage:\nvalue: 100.0\n---\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\nname: ws-qa\nnamespace: istio\nspec:\nhost: ws-qa\nsubsets:\n- labels:\nversion: v1\nname: v1\n- labels:\nversion: v2\nname: v2 \t\t\n\nç”¨ä»»ä¸€çš„å£“æ¸¬è»Ÿé«”ï¼Œå‘¼å«æœ¬ä¾†çš„ç¶²ç«™ï¼Œå°±æœƒå¾—åˆ°ä¸‹åœ–çš„æ•¸æ“šã€‚\nv2æ˜¯é¡åƒæµé‡ï¼Œæµé‡éå»å¾Œå°±ä¸æœƒç®¡æ˜¯å¦å›æ‡‰ã€‚\n\nref.\n\næµé‡é¡åƒ\nMirroring",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "Istioå®‰è£åŠä½¿ç”¨",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/7. Istioå®‰è£åŠä½¿ç”¨/",
		"content": "å‰è¨€\nk8sé‚„æ²’æ‘¸å¾ˆç†Ÿï¼Œæ–°çš„æ±è¥¿å°±éä¾†äº†ã€‚\né€™æ¬¡æ˜¯server meshæ¶æ§‹...\næ­£æ–‡\nå‰å€‹å·¥ä½œé‚„æ²’çµæŸï¼Œæ–°çš„æ±è¥¿å°±ä¾†äº†ã€‚\né€™æ¬¡æIstioï¼Œç•¶ç„¶å¯ä»¥åœ¨æ±è¥¿éƒ½å»ºç«‹å®Œå¾Œï¼Œå†é–‹å§‹ç©ã€‚\nä½†é€™æ¨£å°±æœƒè®Šæˆè¦æŠŠèˆŠçš„podç æ‰é‡æ–°å»ºç«‹äº†ã€‚\nIstio çŸ¥è­˜åœ–è­œ\n\nref.Istio Knowledge Map\nå®‰è£å‰\næœ‰æŸ¥åˆ°è¦å®‰è£istio æœ‰æœ€ä½çš„è³‡æºé™åˆ¶ï¼Œä½†æ²’çœ‹åˆ°æœ‰æ˜ç¢ºçš„æŒ‡å®šã€‚\nç›®å‰æ¸¬è©¦GKEçš„æ©Ÿå™¨ è¨­æˆ cpu 1 ram 2G æœƒç™¼ç”Ÿ timeoutçš„éŒ¯èª¤ï¼Œ\næ”¹æˆ cpu 2,ram 4G å‰‡ç„¡æ­¤ç‹€æ³ã€‚\n\nref. istioctl install fails with multiple timeouts\næ©Ÿå™¨å¤§å°è¨­å®š\nä¸»è¦çš„ç¯€é»å€åŸŸï¼Œcpuå‰‡æœƒåƒåˆ° 900 mCPUï¼Œè¨˜æ†¶é«” 2.75G\né‚„æ²’å®‰è£ kiali,jaeger,prometheus...ç­‰ï¼Œ\né–‹æ©Ÿå™¨å¤§å°æ™‚ï¼Œéœ€ç‰¹åˆ¥æ³¨æ„ã€‚\né–‹å§‹å®‰è£\né€™æ¬¡è¦å®‰è£åœ¨GKEä¸Šï¼Œæ­¤æ¬¡å®‰è£çš„é…ç½®æ˜¯ minimalç‰ˆï¼Œ\nå„ç‰ˆæœ¬çš„å·®ç•°ï¼Œä¸è¦çœ‹ä¸­æ–‡çš„ï¼Œæ²’æœ‰æ›´æ–°ã€‚å¦‚æœè¦çœ‹åŸç†å¯ä»¥çœ‹ã€‚\nè«‹åƒè€ƒ Installation Configuration Profiles\ncurl -L https://istio.io/downloadIstio | sh -\ncd istio-1.8.1\nexport PATH=$PWD/bin:$PATH\nistioctl install\n\nç§»é™¤å®‰è£\n1.20æŒ‡ä»¤æ›´æ”¹ç‚º istioctl uninstall -y --purge\nistioctl x uninstall --purge\n(æ³¨æ„ purgeæœƒæŠŠå…±ç”¨çš„æ±è¥¿é€šé€šåˆªå…‰å…‰ï¼Œä¸ä½¿ç”¨purgeä¹Ÿå¯åˆªé™¤ï¼Œä½†æœƒç•™ä¸‹ deploymentä»¥åŠ service)\nistioctl x uninstall -f /Users/ezio_liu/Documents/k8s/Sample-Yaml/istio-sample-newingeressway.yaml ï¼ˆç•¶åˆå®‰è£çš„yaml)\nref. Getting Started\nUninstall Istio\nå®‰è£å¥—ä»¶\nåœ¨åŸç›®éŒ„ä¸‹åŸ·è¡Œ\nkubectl apply -f samples/addons\nç¬¬ä¸€æ¬¡åŸ·è¡Œå®Œå¯èƒ½æœƒæœ‰éŒ¯èª¤ï¼Œå¯ä»¥åœ¨åŸ·è¡Œä¸€æ¬¡ã€‚\nå› åŸ·è¡Œå»ºç½®çš„æ©Ÿå™¨ï¼Œæœƒæœ‰æ™‚é–“å·®ã€‚\nref. Telemetry Addons\nåœ¨namespaceä¸Šé¢ æ¤å…¥ istio\nkubectl label namespaces auto istio-injection=enabled\n\næœ¬ä¾†æƒ³ä½¿ç”¨è‡ªå‹•æ¤å…¥ï¼Œå°±æ˜¯é€£é€™è¡Œä¹Ÿä¸ç”¨æ‰“ã€‚\nä½†æ˜¯ æœ‰äº› k8sç‰ˆæœ¬ï¼Œæœ¬èº«æœƒç¦æ­¢é€™å€‹è¡Œç‚ºï¼Œéœ€è¦çš„è©±è¦å¦è¡Œæ‰“é–‹ã€‚\nref. Automatic sidecar injection\næ­¤æ™‚å¯å»ºç«‹ä¸€å€‹pod ï¼Œå°±å¯çœ‹åˆ°è£¡é¢å¤šäº†ä¸€å€‹ container\n\nå¦‚æœæ¤å…¥sidecarå¤±æ•—ï¼Œå‡ºç¾\nInternal error occurred: failed calling webhook &quot;sidecar-injector.istio.io&quot;: Post https://istiod.istio-system.svc:443/inject?timeout=30s: context deadline exceeded\n\néœ€é–‹å•ŸGKEçš„masteré˜²ç«ç‰†è¦å‰‡ï¼Œå¢åŠ  tcp:15017 çš„ port\n(é¡Œå¤–è©±ï¼Œå¦‚æœè¦ä½¿ç”¨kialiçš„è©±ï¼Œè«‹é–‹å•Ÿ tcp: 8080 çš„ portï¼Œä¸ç„¶ä½ æœƒçœ‹kialiä¸€ç›´åœ¨è½‰åœˆåœˆ)\n\nä¸çŸ¥é“è¦è¨­å®šå“ªå€‹é˜²ç«ç‰†è¦å‰‡ï¼Œå¯ä¸‹æŒ‡ä»¤å°‹æ‰¾\ngcloud compute firewall-rules list --filter=&quot;name~gke-${CLUSTER_NAME}-[0-9a-z]*-master&quot;\n\nå…¶ä¸­çš„ ${CLUSTER_NAME} éœ€æ”¹ç‚ºä½ è¦å°‹æ‰¾çš„å¢é›†åç¨±\ngcloud compute firewall-rules update &lt;firewall-rule-name&gt; --allow tcp:10250,tcp:443,tcp:15017,tcp:8080\n\nref.Google Kubernetes Engine\né–‹å•Ÿå¥—ä»¶\næˆ‘æ˜¯ä½¿ç”¨GKEï¼ŒåŸæœ¬ä»¥ç‚ºè¦èƒ½å¤ é€£åˆ°å…§éƒ¨çš„æœå‹™ï¼Œéƒ½è¦èµ°å¤–éƒ¨ip\nä»Šå¤©åœ¨äº‚é»çš„æ™‚å€™ï¼Œé»åˆ°äº†é€™å€‹åœ°æ–¹ï¼Œå°‡é‚£è¡ŒæŒ‡ä»¤è¤‡è£½ï¼Œåœ¨æœ¬æ©ŸåŸ·è¡Œã€‚\nå‰ææ˜¯ä½ çš„gcloudè¦æœ‰èªè­‰ã€‚\n\nä»–å°±èƒ½å¤ é€éé€šè¨ŠåŸ è½‰ç™¼çš„æ–¹å¼å­˜å–ã€‚\n\nç”±(fig.3) å¯ä»¥çœ‹åˆ°ï¼Œä»–å°‡æœ¬æ©Ÿçš„8080å°åˆ°äº†serviceå…§çš„20001ï¼Œ\næ‰€ä»¥ç›´æ¥é–‹å•Ÿç¶²é æŒ‡å‘ localhost:8080 å°±å¯ä»¥çœ‹åˆ°è©²ç¶²é çš„å…§å®¹äº†ã€‚\nä½ˆç½²æ™‚ç”±ä¸Šå¾€ä¸‹é–‹å§‹ä½ˆç½²\nDestinationRule\napiVersion: networking.istio.io/v1beta1\nkind: DestinationRule\nmetadata:\nname: localgo\nnamespace: auto\nspec:\nhost: localgo\ntrafficPolicy:\nloadBalancer:\nsimple: LEAST_CONN\nsubsets:\n- name: Localgov1\nlabels:\nversion: v1\n- name: v2\nlabels:\nversion: v2\n\nref. Destination Rule\nåƒæ•¸èªªæ˜\ntrafficPolicyå…§çš„ loadBalancer:\nä»£è¡¨çš„æ˜¯å¹¾ç¨®æµé‡åˆ†ç™¼æ–¹å¼ï¼š\nâ€¢Round_Robinï¼š è¼ªè©¢æ¼”ç®—æ³•ï¼Œé¡§åæ€ç¾©è«‹æ±‚å°‡æœƒä¾æ¬¡ç™¼çµ¦æ¯ä¸€å€‹ä¾‹é …ï¼Œä¾†å…±åŒåˆ†æ“”æ‰€æœ‰çš„è«‹æ±‚ã€‚\nâ€¢Randomï¼š éš¨æ©Ÿæ¼”ç®—æ³•ï¼Œå°‡æ‰€æœ‰çš„è«‹æ±‚éš¨æ©Ÿåˆ†ç™¼çµ¦å¥åº·çš„ä¾‹é …\nâ€¢Least_Conn: æœ€å°é€£ç·šæ•¸ï¼Œåœ¨æ‰€æœ‰å¥åº·çš„ä¾‹é …ä¸­ä»»é¸å…©å€‹ï¼Œå°‡è«‹æ±‚ç™¼çµ¦é€£ç·šæ•¸è¼ƒå°çš„é‚£ä¸€å€‹ä¾‹é …ã€‚\nref. idouè€å¸«æ•™ä½ å­¸Istio 19 : Istio æµé‡æ²»ç†åŠŸèƒ½åŸç†èˆ‡å¯¦æˆ°\nVirtualService\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\nname: localgo-vs\nnamespace: auto\nspec:\nhosts:\n- &quot;*&quot;\ngateways:\n- istio-ingressgateway\nhttp:\n- name: &quot;route-v1&quot;\nroute:\n- destination:\nport:\nnumber: 80\nhost: localgo.auto.svc.cluster.local #é€™è£¡å°±æ˜¯æŒ‡å‘ä½ çœŸæ­£æœå‹™ service çš„åç¨±å–”\nsubset: Localgov1 #é€™è£¡æŒ‡çš„æ˜¯DestinationRuleçš„subset.name\nweight: 80\n- destination:\nport:\nnumber: 80\nhost: localgo.auto.svc.cluster.local\n# ä¸Šé¢ destionation ä¸‹é¢çš„ host åç¨±æœƒé€™éº¼é•·ï¼Œé€™æ˜¯ k8s å…§éƒ¨å¯¦éš› dns å…¨åï¼Œå¦‚æœéœ€è¦è·¨ namspace å­˜å–ï¼Œå°±éœ€è¦ç”¨é€™æ¨£çš„å…¨åæ–¹å¼æŒ‡å®šã€‚\n# {service name}.{namespace}.svc.cluster.local é€™å°±æ˜¯å®ƒçš„è¦å‰‡\nsubset: v2\nweight: 20\ncorsPolicy: ##é™åˆ¶\nallowOrigin: #å…è¨±æ‰€æœ‰ä¾†æº\n- '*'\n\ncorsPolicy æœ‰ä»¥ä¸‹çš„é¸é …\n\nallowOrigins\nallowMethods\nallowHeaders\nexposeHeaders\nmaxAge\nallowCredentials\n\nweight å‰‡æ˜¯ç”¨ä¾†åšæµé‡åˆ†é…ç”¨çš„\nåŒä¸€å€‹routeå…§ï¼Œç›¸åŠ å¿…é ˆ =100\nè©³ç´°èªªæ˜ï¼Œåƒè€ƒä¸‹é¢é€£çµ\nref.\nCorsPolicyç´°é …è¨­å®š\nç„¶å¾Œåœ¨ é€™é‚Šé‚„æœ‰å¦ä¸€ç¨®æ˜¯ matchçš„ç”¨æ³•ï¼Œ\nè™›æ“¬æœå‹™ä¸­å®šç¾©çš„ç¬¬ä¸€æ¢è¦å‰‡æœ‰æœ€é«˜å„ªå…ˆç´šï¼Œ\nç•¶ç¬¬ä¸€å€‹æ²’æœ‰matchåˆ°ç›¸å°æ‡‰çš„è¦å‰‡æ™‚ï¼Œ\nå‰‡ç¹¼çºŒå¾€ä¸‹åŸ·è¡Œã€‚\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\nname: localgo-vs\nnamespace: auto\nspec:\nhosts:\n- &quot;*&quot;\ngateways:\n- istio-ingressgateway\nhttp:\n- name: &quot;route-v1&quot;\nmatch:\n- uri:\nprefix: /reviews\nroute:\n- destination:\nport:\nnumber: 80\nhost: localgo.auto.svc.cluster.local #é€™è£¡å°±æ˜¯æŒ‡å‘ä½ çœŸæ­£æœå‹™ service çš„åç¨±å–”\nsubset: Localgov1 #é€™è£¡æŒ‡çš„æ˜¯DestinationRuleçš„subset.name\n- name: &quot;route-v3&quot;\nmatch:\n- uri:\nprefix: /Player\nroute:\n- destination:\nport:\nnumber: 80\nhost: localgo.auto.svc.cluster.local #é€™è£¡å°±æ˜¯æŒ‡å‘ä½ çœŸæ­£æœå‹™ service çš„åç¨±å–”\nsubset: Localgov1 #é€™è£¡æŒ‡çš„æ˜¯DestinationRuleçš„subset.name\n- name: &quot;route-v2&quot;\nroute:\n- destination:\nport:\nnumber: 80\nhost: localgo.auto.svc.cluster.local\n# ä¸Šé¢ destionation ä¸‹é¢çš„ host åç¨±æœƒé€™éº¼é•·ï¼Œé€™æ˜¯ k8s å…§éƒ¨å¯¦éš› dns å…¨åï¼Œå¦‚æœéœ€è¦è·¨ namspace å­˜å–ï¼Œå°±éœ€è¦ç”¨é€™æ¨£çš„å…¨åæ–¹å¼æŒ‡å®šã€‚\n# {service name}.{namespace}.svc.cluster.local é€™å°±æ˜¯å®ƒçš„è¦å‰‡\nsubset: v2\n\nmatch ä¸‹é¢çš„ç”¨æ³•\n\nexact (å®Œå…¨åŒ¹é…)\nprefix (åªæœ‰å‰ç¶´)\nregex (æ­£è¦è¡¨ç¤ºæ³•)\n\nä¸Šé¢é‚£æ®µçš„è¦å‰‡ç‚ºï¼Œç•¶ç¶²å€é€²ä¾†å¾Œï¼Œå¦‚æœç¶²åŸŸçš„å¾Œé¢ä¸æ˜¯reviewsçš„è©±ï¼Œ\nå‰‡å¾€ä¸‹åŸ·è¡Œåˆ°route-v3ï¼Œå¦‚æœç¶²å€ç‚º Playerçš„è©±ï¼Œå‰‡åŸ·è¡Œä¸‹é¢çš„è·¯ç”±\nref.\nStringMatch\nè·¯ç”±è¦å‰‡\nDay24 ä»€éº¼æ˜¯ istio virtual service?\ngateway\napiVersion: networking.istio.io/v1beta1\nkind: Gateway\nmetadata:\nname: istio-ingressgateway\n# é€™è£¡å°±æ˜¯å¡«å…¥kubectl get service -n istio-system æ‰€æŸ¥åˆ°çš„ istio-ingressgatewayï¼Œå¯¦å‹™ä¸Šå¦‚æœä½ æœ‰å¤šå€‹ ip ï¼Œå°±æœƒæœ‰å¤šå€‹ gateway ä»£ç†ï¼Œ\n# ç„¶å¾Œå°±è¦æè¿°å¤šå€‹ gateway å»ä½¿ç”¨ gateway ä»£ç†\nnamespace: auto\nspec:\nselector:\nistio: ingressgateway # ä½¿ç”¨é»˜èªçš„æ§åˆ¶å™¨\nservers:\n- port: #åŠ å¯†å‚³è¼¸\nnumber: 443\nname: https\nprotocol: HTTPS\ntls:\nmode: SIMPLE\nserverCertificate: /etc/istio/ingressgateway-certs/tls.crt #è¨­å®šæ†‘è­‰è·¯å¾‘\nprivateKey: /etc/istio/ingressgateway-certs/tls.key #è¨­å®šæ†‘è­‰è·¯å¾‘\nhosts:\n- &quot;*&quot; #è©²æœå‹™å°æ‡‰domain\n- port:\nnumber: 80\nname: http\nprotocol: HTTP\nhosts:\n- &quot;*&quot; #è©²æœå‹™å°æ‡‰domain\n\nref. istio gateway æ˜¯ä»€éº¼ï¼Ÿ\nåŒä¸€å€‹å¢é›†å®‰è£å¤šå€‹ingressgateway\næ»¿æ»¿çš„å‘ï¼Œå¡äº†å…©å¤©æ‰æå®šã€‚\né€™é‚Šè¦æ”¹ä½¿ç”¨operatorå®‰è£\næ‰€ä»¥å…ˆåˆå§‹åŒ–\nistioctl operator init\n\nref. Istio Operator Install\nå†ä¾†è¨­å®šæ–°å¢çš„ ingressgateway\nkind: IstioOperator\napiVersion: install.istio.io/v1alpha1\nmetadata:\nannotations:\ninstall.istio.io/ignoreReconcile: 'true'\nname: video-state\nnamespace: istio-system\nspec:\naddonComponents:\nistiocoredns:\nenabled: false\ncomponents:\nbase:\nenabled: true\ncni:\nenabled: false\ningressGateways:\n- name: ingressgateway-private\nnamespace: istio-system\nenabled: true\nk8s:\nenv:\n- name: ISTIO_META_ROUTER_MODE\nvalue: standard\nhpaSpec:\nminReplicas: 2\noverlays:\n- kind: HorizontalPodAutoscaler\nname: ingressgateway-private\npatches:\n- path: metadata.labels.app\nvalue: ingressgateway-private\n- path: metadata.labels.istio\nvalue: ingressgateway-private\n- path: spec.scaleTargetRef.name\nvalue: ingressgateway-private\n- kind: Deployment\nname: ingressgateway-private\npatches:\n- path: metadata.labels.app\nvalue: ingressgateway-private\n- path: metadata.labels.istio\nvalue: ingressgateway-private\n- path: spec.selector.matchLabels.app\nvalue: ingressgateway-private\n- path: spec.selector.matchLabels.istio\nvalue: ingressgateway-private\n- path: spec.template.metadata.labels.app\nvalue: ingressgateway-private\n- path: spec.template.metadata.labels.istio\nvalue: ingressgateway-private\n- kind: Service\nname: ingressgateway-private\npatches:\n- path: metadata.labels.app\nvalue: ingressgateway-private\n- path: metadata.labels.istio\nvalue: ingressgateway-private\n- path: spec.selector.app\nvalue: ingressgateway-private\n- path: spec.selector.istio\nvalue: ingressgateway-private\n- kind: PodDisruptionBudget\nname: ingressgateway-private\npatches:\n- path: metadata.name\nvalue: ingressgateway-private\n- path: metadata.labels.app\nvalue: ingressgateway-private\n- path: metadata.labels.istio\nvalue: ingressgateway-private\n- path: spec.selector.matchLabels.app\nvalue: ingressgateway-private\n- path: spec.selector.matchLabels.istio\nvalue: ingressgateway-private\n\nå…ˆä½¿ç”¨\nistioctl manifest generate -f newingeressway.yaml\né å…ˆç·¨è­¯ä¸€ä¸‹ï¼Œçœ‹æœ‰æ²’æœ‰æˆåŠŸã€‚ istioctl manifestçš„åŸç†ï¼Œæœ‰é»åƒæ˜¯kustomizeï¼Œ\næœ‰ä¸€å€‹åŸºåº•ï¼Œå¾Œé¢çš„ç¨‹å¼éƒ½æ˜¯æ ¹æ“šé€™å€‹åŸºåº•å»ä¿®æ”¹è¦†è“‹ã€‚\nå®‰è£çš„è©±ï¼Œå‰‡æ˜¯ä½¿ç”¨\nistioctl manifest install -f newingeressway.yaml\nref.\nMultiple ingress controller services via IstioOperator?\nistio\nIstioå…¥é–€èˆ‡å¯¦æˆ°",
		"tags": ["é€™è£¡å°±æ˜¯æŒ‡å‘ä½ çœŸæ­£æœå‹™", "é€™è£¡æŒ‡çš„æ˜¯DestinationRuleçš„subset", "å…è¨±æ‰€æœ‰ä¾†æº", "é€™è£¡å°±æ˜¯æŒ‡å‘ä½ çœŸæ­£æœå‹™", "é€™è£¡æŒ‡çš„æ˜¯DestinationRuleçš„subset", "é€™è£¡å°±æ˜¯æŒ‡å‘ä½ çœŸæ­£æœå‹™", "é€™è£¡æŒ‡çš„æ˜¯DestinationRuleçš„subset", "åŠ å¯†å‚³è¼¸", "è¨­å®šæ†‘è­‰è·¯å¾‘", "è¨­å®šæ†‘è­‰è·¯å¾‘", "è©²æœå‹™å°æ‡‰domain", "è©²æœå‹™å°æ‡‰domain", "note","â›µï¸"]
},

{
		"title": "istio sidecar æ³¨å…¥è¦å‰‡",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/73. istio sidecar æ³¨å…¥è¦å‰‡/",
		"content": "å‰è¨€\nå› ç‚ºdrone çš„ kubernetes Runnerçš„é—œä¿‚ï¼Œ\nå°è‡´æˆ‘æœ‰ä¸€å€‹nsè¦é è¨­å–æ¶ˆistio injectï¼Œ\nä½†æŸäº›ç‰¹å®šçš„podè¦æ³¨å…¥å°±å¤±æ•—äº†ã€‚\næ­£æ–‡\nå…ˆä¾†çœ‹ä¸€å¼µå®˜æ–¹åšçš„è¡¨(1)ï¼Œ\nå…¶å¯¦å°±å¾ˆå¥½è§£é‡‹ç‚ºä»€éº¼ä¸æœƒæ³¨å…¥äº†ã€‚\n\nnamespaceSelector match\ndefault policy\nPod override annotation sidecar.istio.io/inject\nSidecar injected?\n\nyes\nenabled\ntrue (default)\nyes\n\nyes\nenabled\nfalse\nno\n\nyes\ndisabled\ntrue\nyes\n\nyes\ndisabled\nfalse (default)\nno\n\nno\nenabled\ntrue (default)\nno\n\nno\nenabled\nfalse\nno\n\nno\ndisabled\ntrue\nno\n\nno\ndisabled\nfalse (default)\nno\n\nå„æ¬„ä½è§£é‡‹ï¼Œ\n\nnamespaceSelector matchï¼šå„namespaceçš„ istio-injectæ˜¯ enableæˆ– disable\ndefault policyï¼š é€™å€‹é è¨­éƒ½æ˜¯enableï¼Œè¦æŸ¥çœ‹ä½¿ç”¨commandæˆ–åˆ°configmapæŸ¥çœ‹ istio-sidecar-injector\n\nkubectl -n istio-system get configmap istio-sidecar-injector -o jsonpath='{.data.config}' | grep policy:\n\nPod override annotation ï¼š ç›´æ¥æŒ‡å®špodæœƒä¸æœƒæ³¨å…¥çš„ annotation\nSidecar injected ï¼šçµæœ\n\nçµè«–ï¼Œ\nnamespaceåªè¦æ˜¯ disabledçš„ï¼Œé€šé€šä¸æœƒinject sidecar\n\nref.\n1. Automatic Sidecar Injection\n2. Sidecar è‡ªå‹•æ³¨å…¥å•é¡Œ\n3. é—œæ–¼Istio Automatic Sidecar Injectioné‚£æª”äº‹",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "istio virtual service å¸¸ç”¨åƒæ•¸",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/75. istio virtual service å¸¸ç”¨åƒæ•¸/",
		"content": "å‰è¨€\næœ‰äº›æ±è¥¿å¶çˆ¾æœƒç”¨ï¼Œä½†ç¢°åˆ°æ™‚å°±å¿˜äº†æ€éº¼å¯«ï¼Œ\né‚„è¦å›å»ç¿»ä¸€ä¸‹ï¼Œ\næ­¤ç¯‡åŒ…å«\n\nset/remove header\nmatch header host æ­£è¦è¡¨ç¤º\nfault å›å‚³ç‰¹å®šç‹€æ…‹\nallow cors\nrewrite\nmatch uri æ­£è¦è¡¨ç¤º\n\næ­£æ–‡\n\nç•¶åŒä¸€å€‹virtual serviceå…§ï¼Œæœ‰å¤šå€‹match uriæ™‚ï¼Œå„ªå…ˆé †åºï¼Œæ˜¯ç”±ä¸Šåˆ°ä¸‹ã€‚\nã€€\nä¾‹å¦‚ï¼š\n\nmatch:\n\t- uri:\n\t\t\tprefix : /api\n\t- uri:\n\t\t prefix: /api/video\t\t\n\né€™æ¨£æ˜¯æ°¸é åˆ°ä¸äº† /api/videoçš„\n\nset/remove header\n\nadd or modify header\nspec:\nhttp:\n- name: api\nheaders:\nrequest:\nset:\nx-forward-for: 127.0.0.1\nmatch:\n- uri:\nprefix: /api\n\nroute:\n- destination:\nhost: reverse-proxy.abc.svc.cluster.local\nport:\nnumber: 80\n\nremove header\nspec:\nhttp:\n- name: api\nheaders:\nrequest:\nremove:\n- x-forward-for\nmatch:\n- uri:\nprefix: /api\n\nroute:\n- destination:\nhost: reverse-proxy.abc.svc.cluster.local\nport:\nnumber: 80\n\nmatch header host\nç•¶ header hostæœ‰å°æ‡‰åˆ° é€™å…©å€‹ domainå…¶ä¸­ä¸€å€‹çš„è©±ï¼Œ\nå‰‡è½‰åˆ°å°æ‡‰çš„è·¯å¾‘\n\nhttp:\n- match:\n- headers:\nHost:\nregex: (api.asia.com|api.american.com)\nuri:\nprefix: /api-v2\nrewrite:\nuri: /api\nroute:\n- destination:\nhost: reverse-proxy.abc.svc.cluster.local\nport:\nnumber: 80\nweight: 100\n\nç¬¦åˆæ­£å‰‡çš„çš†é€²å…¥\n\nhosts:\n- '*'\ngateways:\n- istio-system/istio-gateway-external\n- istio-system/istio-gateway-internal\nhttp:\n- match:\n- headers:\nHost:\nregex: sxqa2.?\\.777.+\\.com\nroute:\n- destination:\nhost: video-admin-api-primary\nport:\nnumber: 80\nweight: 100\n\nfault\n\nç•¶è·¯å¾‘æœ‰å€’åˆ° api/v1/abcæ™‚ï¼Œç›´æ¥å›å‚³ 487çš„éŒ¯èª¤ç¢¼ã€‚\nï¼ˆé€™å…¶å¯¦æ˜¯æ‹¿ä¾†æ¨¡æ“¬éŒ¯èª¤ç”¨çš„ï¼‰\nhttp:\n- fault:\nabort:\nhttpStatus: 487\npercentage:\nvalue: 100\nmatch:\n- uri:\nprefix: /api/v1/abc\nname: fault\nroute:\n- destination:\nhost: reverse-proxy.abc.svc.cluster.local\nport:\nnumber: 80\n\nallow cors\né–‹å•Ÿ corsçš„å…è¨±ç¯„åœ\n\nhttp:\n- corsPolicy:\nallowHeaders:\n- '*'\nallowOrigin:\n- '*'\nmatch:\n- uri:\nprefix: /api\nname: filedownload\nroute:\n- destination:\nhost: reverse-proxy.abc.svc.cluster.local\nport:\nnumber: 80\n\nrewrite\nè¦†å¯«æœ¬ä¾†çš„uri\n\nhttp:\n- match:\n- uri:\nprefix: /apmapi\nname: api\nrewrite:\nuri: /api\nroute:\n- destination:\nhost: reverse-proxy.abc.svc.cluster.local\nport:\nnumber: 80\n\nåœ¨apiä¹‹å¾Œçš„é€šé€šé€²å»ï¼Œä½†é€™ç¨®å°±ç„¡æ³•ä½¿ç”¨rewriteäº†ã€‚\nå› ç‚ºæœƒå°‡uriå…¨éƒ¨å–ä»£æ‰ã€‚\nhttp:\n- match:\n- uri:\nregex: ^/api/.*\nroute:\n- destination:\nhost: yabo-api-qa-primary\nport:\nnumber: 80\nweight: 100",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "istio å¸¸è¦‹ç‹€æ…‹ç¢¼",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/â›µï¸ istio/89. istio å¸¸è¦‹ç‹€æ…‹ç¢¼/",
		"content": "å‰è¨€\næœ€è¿‘ç”¨istioåµæ¸¬ï¼Œå¸¸ç¢°åˆ°æŸå€‹æœå‹™ç‹€æ…‹æœƒæ‰åˆ°80%ä»¥ä¸‹ï¼Œ\né‚£æ™‚éƒ½æœ‰çœ‹åˆ°APMçš„ç¨‹å¼å ±éŒ¯ï¼Œä½†æ²’äººåæ‡‰ï¼Œæœ€è¿‘æœ‰æ¬¡ç™¼ç”Ÿåœ¨ä¸Šç­æ™‚é–“ï¼Œ\né¦¬ä¸Šè¯çµ¡åŒäº‹çœ‹ä»–çš„æœå‹™æœ‰æ²’æœ‰æ­£å¸¸ï¼Œ\næœ€å¾Œä¸€è·¯è¿½ï¼Œ\nç™¼ç¾ç‹€æ…‹ç¢¼æ˜¯å› 503 DC ï¼Œå°é€™å€‹é—œéµå­—æœ‰å°è±¡ï¼Œä½†å¸¸æœƒå¿˜è¨˜ä»–çš„å…¨åã€‚\næ­£æ–‡\n\nä¸‹åˆ—ç‚ºenvoyå¸¸è¦‹ç¸®å¯«æ¯”å°\nHTTP and TCP\n\nUH: No healthy upstream hosts in upstream cluster in addition to 503 response code.\n\nUF: Upstream connection failure in addition to 503 response code.\n\nUO: Upstream overflow (circuit breaking) in addition to 503 response code.\n\nNR: NoÂ route configuredÂ for a given request in addition to 404 response code, or no matching filter chain for a downstream connection.\n\nURX: The request was rejected because theÂ upstream retry limit (HTTP)Â orÂ maximum connect attempts (TCP)Â was reached.\n\nNC: Upstream cluster not found.\n\nDT: When a request or connection exceededÂ max_connection_durationÂ orÂ max_downstream_connection_duration.\n\nHTTP only\n\nDC: Downstream connection termination.\n\nLH: Local service failedÂ health check requestÂ in addition to 503 response code.\n\nUT: Upstream request timeout in addition to 504 response code.\n\nLR: Connection local reset in addition to 503 response code.\n\nUR: Upstream remote reset in addition to 503 response code.\n\nUC: Upstream connection termination in addition to 503 response code.\n\nDI: The request processing was delayed for a period specified viaÂ fault injection.\n\nFI: The request was aborted with a response code specified viaÂ fault injection.\n\nRL: The request was ratelimited locally by theÂ HTTP rate limit filterÂ in addition to 429 response code.\n\nUAEX: The request was denied by the external authorization service.\n\nRLSE: The request was rejected because there was an error in rate limit service.\n\nIH: The request was rejected because it set an invalid value for aÂ strictly-checked headerÂ in addition to 400 response code.\n\nSI: Stream idle timeout in addition to 408 response code.\n\nDPE: The downstream request had an HTTP protocol error.\n\nUPE: The upstream response had an HTTP protocol error.\n\nUMSDR: The upstream request reached max stream duration.\n\nOM: Overload Manager terminated the request.\n\nDF: The request was terminated due to DNS resolution failure.\n\nref.\n- envoy Access logging\n- istioä¹‹envoyå¸¸è¦‹è¡“èªåŠç‹€æ…‹ç¢¼",
		"tags": [ "note","â›µï¸"]
},

{
		"title": "Google sheet Queryå‡½æ•¸",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ†’ SideProject/125. Google sheet Query/",
		"content": "ç¡ç¡å¿µ\nä»Šå¤©æ”¶åˆ°å€‹æ¶ˆæ¯ï¼Œèªªè¦çµ¦user hostsçš„æª”æ¡ˆï¼Œ\nè£é¢å…§å®¹è¦åŒ…å«ç›®å‰çš„dnsè·Ÿipçš„å°æ‡‰ï¼Œ\nä½†æˆ‘æ—¥å¾Œä¸æƒ³æ‰‹å‹•æ›´æ–°é˜¿...\næ­£æ–‡\né–‹å§‹ç™¼æƒ³\n\næœ¬ä¾†æ˜¯æƒ³ç”¨if ï¼Œå–®ç¨åˆ¤æ–·ä¸€å€‹æ¬„ä½æ˜¯ä¸æ˜¯ç¬¦åˆè¦å‰‡ã€‚\nä½†é€™æ¨£æœƒæœ‰å€‹å•é¡Œï¼Œç•¶è³‡æ–™è®Šå‹•æ™‚ï¼Œå°±å¿…é ˆæ‰‹å‹•æ‹‰å…¬å¼ã€‚\n\næŸ¥åˆ°ä¸€å€‹importrangeçš„å‡½æ•¸ï¼Œå¯ä»¥æ•´æ‰¹åŒ¯å…¥è³‡æ–™ï¼Œ\nä½†é€™æ¨£æˆ‘é‚„æ˜¯è¦åˆ†ææˆªå–ã€‚\n\nåœ¨æŸ¥è³‡æ–™éç¨‹ä¸­ï¼Œç™¼ç¾queryå‡½æ•¸ï¼Œèƒ½å¤ æ•´å€‹sheetæœå°‹ ï¼Œ\nå°±åƒSQLèªæ³•ä¸€æ¨£ï¼Œå°±æ±ºå®šæ˜¯ä½ äº†ï¼ï¼ï¼\n\nå¯¦ä½œ\nQUERYä½¿ç”¨ æ¬„ä½çš„åšé—œéµå­—ï¼Œ\nä¸éåªæœ‰åŸºæœ¬çš„æŸ¥è©¢åŠŸèƒ½ã€‚\n=query(Prod!4:1010,&quot;select D,E,G where G='Y' order by E desc&quot;)\n\næ¯”è¼ƒç‰¹åˆ¥çš„æ‡‰è©²æ˜¯\nwhereè£é¢çš„ æ–‡å­—æœå°‹\nWhere A contains 'Ezio' æŸ¥è©¢åŒ…å«Ezioçš„å­—\nWhere A starts with 'Ezio' æŸ¥è©¢Ezioé–‹é ­çš„å­—\nWhere A ends with 'Ezio' æŸ¥è©¢Ezioçµå°¾çš„å­—\nWhere A like '%Ezio' è·ŸSQLçš„likeå·®ä¸å¤šæ„æ€\n\næ³¨æ„ï¼Œlike å¾Œé¢æ¥ % æ˜¯ ä»»æ„å­—å…ƒ , å¦‚æœæ¥ _ å°±æ˜¯ä¸€å€‹å­—å…ƒ\nå¤šäº†ä¸€äº›mysql çš„èªæ³•\nselect A,B limit 3 åªå–3è¡Œçš„è³‡æ–™\nselect A,B offset 3 è·³é3è¡Œï¼Œé–‹å§‹å–è³‡æ–™\n\né‚„æœ‰ä¸€å€‹ç‰¹åˆ¥çš„ï¼Œ\nselect A,B SKIPPING 2 æ¯éš”2è¡ŒæŠ“ä¸€æ¬¡è³‡æ–™\n\nå…¶ä»–ç›¸ä¼¼çš„å°±\nèšåˆå‡½æ•¸ SUM()ã€AVG()ã€COUNT()ã€MAX()ã€MIN()\næ’åº order by\nå¦å¤–é‚„æ”¯æ´ PIVOT\nref.\n\nQUERY å‡½å¼å¤§è§£æï¼ˆä¸€ï¼‰ï¼šåŸºæœ¬åŸç†èˆ‡ SELECT",
		"tags": [ "note","ğŸ†’"]
},

{
		"title": "Obsidianç™¼ä½ˆç¶²ç«™",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ†’ SideProject/160.Obsidianç™¼ä½ˆç¶²ç«™/",
		"content": "å‰è¨€\nå› ç‚ºè¢«googleçš„blogæäº†ä¸€æ³¢ï¼ˆåŸå› è«‹çœ‹é€™ ï¼‰ï¼Œ\nè®“æˆ‘çµ‚æ–¼ä¸‹å®šæ±ºå¿ƒç ”ç©¶ mdè½‰htmlçš„æ–¹æ³•ã€‚\nç™¼ä½ˆæ–¹å¼\nå¾Obsidianç™¼ä½ˆä¸»è¦æœ‰å¹¾ç¨®æ–¹æ³•ï¼Œ\n\nå®˜æ–¹æä¾› ï¼Œæ¯å€‹æœˆ8ç¾é‡‘ï¼Œè©³æƒ…åƒè€ƒ é€™è£ã€‚\njekyll ï¼Œä¹Ÿæœ‰äººæ˜¯ç”¨é€™å€‹æ›ä¸Šå»çš„ï¼Œæ ¼å¼ç¨å¾®æ”¹ä¸€ä¸‹ï¼Œç„¶å¾Œåœ¨githubä¸Šé¢æ”¹ä¸€ä¸‹è¨­å®šï¼Œpushä¸Šå»å°±æœƒè‡ªå‹•éƒ¨ç½²äº†ï¼Œæ”¹å¤©å†ç”¨å¦ä¸€ç¯‡ä»‹ç´¹ï¼Œå› ç‚ºè¦æ”¹è¨±å¤šæ±è¥¿ï¼Œæˆ‘å°±æ²’ç”¨é€™ç¨®äº†\nObsidiançš„ç¬¬ä¸‰æ–¹plugin , Digital Garden ï¼Œæœ¬ç¯‡å°±æ˜¯é€éé€™å¥—ä¾†ç™¼ä½ˆç¶²ç«™ã€‚\n\næ­£æ–‡\nåŸæ–‡é€£çµï¼š Digital Garden-Get start\n\nå…ˆåœ¨obsidianå®‰è£ digital Garden\n\nä¸€å€‹Githubå¸³è™Ÿã€‚\n\nç”³è«‹ Vercelï¼Œç”¨githubå¸³è™Ÿç™»å…¥ã€‚\nå¦‚æœè¦ç”¨Netlifyæ‡‰è©²ä¹Ÿå¯ä»¥ï¼Œ\né€™å…©å€‹ç¶²ç«™éƒ½æ˜¯ç›´æ¥ç”¨å­åŸŸåä½œçˆ²ä½ çš„ç¶²ç«™åç¨±ï¼Œ\ngithubä»¥å‰ä¹Ÿæœ‰ï¼Œä½†ç¾åœ¨å·²ç¶“æ”¹æ‰äº†ã€‚\n(è¨˜å¾—åœ¨é€™é‚Šï¼Œæœƒå•ä½ è¦çµ¦Vercelå“ªå€‹repostoryçš„æ¬Šé™ï¼Œå¯ä»¥å…¨çµ¦ï¼Œä¹‹å¾Œå†åˆ°github çš„è¨­å®šæŒ‡å®šrepostoryå°±å¥½)\n\næ‰“é–‹ä½œè€…çš„repository ï¼ŒæŒ‰ä¸‹ä¸‹é¢çš„éƒ¨ç½²æŒ‰éˆ•ï¼Œæœƒåˆ°Verceléƒ¨ç½²ä¸€å€‹ç¶²ç«™ã€‚\n\nå¦‚æœä½ ç†Ÿgitçš„è©±ï¼Œä¹Ÿå¯ä»¥ç›´æ¥cloneé‚£å€‹repositoryï¼Œ\nå†è‡ªå·±åˆ°vercelæˆ–Netlifyéƒ¨ç½²ä¸Šå»ä¹Ÿå¯ä»¥ã€‚\nå¦‚æœä½ æƒ³è¦å†æœ¬æ©Ÿæ¸¬è©¦é–‹å•“çš„è©±ï¼Œ\ncloneé€™å€‹å°ˆæ¡ˆå¾Œï¼ŒåŸ·è¡Œä¸‹é¢ç¨‹å¼ï¼Œæ³¨æ„éœ€å…ˆå®‰è£nodejs\n\nnpm install\nnpm run build\nnpm run start\n\nå†ä¾†éœ€å»ºç«‹github tokenï¼Œé€™æ˜¯ç‚ºäº†è®“Vercelå¯ä»¥è®€å–åˆ°ä½ çš„repostoryã€‚\né–‹å•“github tokenï¼Œå–å€‹åå­—ã€å»ºç«‹ã€‚\n\nå»ºç«‹github token\n\nExpiration ï¼šåˆ°æœŸå¤©æ•¸ï¼Œå¦‚æœä¸æƒ³ä¸€ç›´æ”¹çš„è©±ï¼Œå°±è¨­å®šæ²’æœ‰æœŸé™ã€‚\nä¸‹é¢ç´…æ¡†æ˜¯å¿…é ˆè¦æœ‰çš„æ¬Šé™ã€‚\n\næ‰“é–‹ä½ çš„obsidiançš„Digital Gardenè¨­å®š\nåœ¨å››å€‹æ–¹å¡Šè£é¢è¼¸å…¥ä½ çš„è³‡è¨Š\n\nGithub Repo Nameï¼š å‰é¢æ‰€æ–°å¢çš„repostoryçš„åç¨±\nGithub UserNameï¼šä½ çš„å¸³è™Ÿåç¨±\nGithub Tokenï¼šæ­¥é©Ÿ5å»ºç«‹çš„è³‡æ–™\nBaseUrl ï¼šå¦‚æœä½ å‰›å‰›å·²ç¶“åˆæ­¥åœ¨Vercelå»ºç«‹ä¸€å€‹ç¶²ç«™çš„è©±ï¼Œæ‡‰è©²å°±æœƒçœ‹åˆ°ä½ çš„ç¶²å€ã€‚\n\næˆ‘é€™é‚Šæœ‰å…©å€‹domainï¼Œå‰é¢çš„http://daimom.vercel.app æ˜¯å¾Œä¾†è‡ªå®šçš„ã€‚\n\nç™¼ä½ˆ\nå…ˆåˆ°ä½ è¦è¨­æˆé¦–é çš„æ–‡ç« ä¸Šé¢ï¼Œè¨­å®š\n\ndg-publish: true\ndg-home: true\n\ndg-publish ï¼šè¡¨ç¤ºç™¼ä½ˆ\ndg-homeï¼šè¡¨ç¤ºè¨­çˆ²é¦–é \nå†ä¾†ä½ æœ‰å…©ç¨®æ–¹æ³•å¯ä»¥ç™¼ä½ˆï¼Œå«å‡ºObsidiançš„å‘½ä»¤é¢æ¿\nWinï¼š CTRL+P\nMacï¼šCmd+P\n\nå…ˆè¼¸å…¥dgï¼Œç„¶å¾Œæœƒçœ‹åˆ° Digital Garden: Publish Single Note\nåŸ·è¡Œå¾Œå°±æœƒç™¼ä½ˆåˆ°Vercelã€‚\næˆ–æ˜¯ GUIç•«é¢\n\næŒ‰ä¸‹ Publish unpublished Note\n\nå»ºç½®\nå¦‚æœä½ é€Ÿåº¦å¤ å¿«ï¼Œåˆ‡åˆ°Vercelçš„ç¶²ç«™ï¼Œæœƒçœ‹åˆ°Deploymentæ­£åœ¨åŸ·è¡Œçš„ç•«é¢ï¼Œæˆ–æ˜¯å·²ç¶“åŸ·è¡Œå®Œæˆçš„ç•«é¢ã€‚\n\nQ&amp;A\n\nåˆ‡æ›ä¸»é¡Œçš„æ™‚å€™ï¼Œæœ‰æ™‚å€™æœƒæ²’æœ‰æ›´æ”¹ï¼Œæ­¤æ™‚è«‹æŒ‰ä¸‹ è¨­å®šçš„ Update site çš„Manage site TemplateæŒ‰éˆ•ï¼Œä»–æœƒå¹«ä½ å»ºç«‹PRã€‚ ref. Updating the template\nä¸»é¡Œæ”¹å¾—åªæœ‰é¡è‰²è·Ÿå­—é«”å¤§å°ï¼Œå¦‚æœè¦å³é‚Šçš„è·¯å¾‘åœ–å¯ä»¥åˆ°è¨­å®šæ‰“é–‹ Show local graph for notes\n\næ›´å¤šçš„è¨­å®šï¼Œè«‹åƒè€ƒNote settings\næœ¬ç¯‡çš„themeæ˜¯ Rmaki ï¼Œä¸€äº›å°è¨­å®šæ˜¯æˆ‘æ”¹cssè·Ÿjsæ”¹å‡ºä¾†çš„ã€‚\nå¦‚æœè¦æ•´æ‰¹åŠ å…¥ç™¼ä½ˆçš„yamlï¼Œå¯ä»¥è€ƒæ…®ä½¿ç”¨ MetaEdit\nå°‡Vercelçš„æ¬Šé™é™ç¸®ç‰¹å®šrepostoryï¼Œå…ˆåˆ°githubçš„å€‹äººè¨­å®šç•«é¢ï¼Œæ‰¾åˆ° Application\n\næŒ‰ä¸‹Configure\n\nå¾åŸå…ˆçš„All repostoriesæ”¹æˆ Only select repositoriesï¼Œ\næœ€å¾ŒæŒ‡å®šä½ çš„repositoryå³å¯ã€‚\n\nref.\n\nDigital Garden Doc\nå…è²»ç›´æ¥æŠŠç­†è¨˜ç™¼ä½ˆæˆç¶²ç«™:Obsidian + GitHub + Netlify\nobsidian ç›®å‰æœ€å®Œç¾çš„å…è²»ç™¼ä½ˆæ–¹æ¡ˆ - æ¼¸é€²å¼æ•™å­¸",
		"tags": [ "note","ğŸ†’"]
},

{
		"title": " ğŸŒ Network MOC",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸŒ Network/0.Network MOC/",
		"content": "åŸºç¤\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸŒ Network/92. proxy ä»£ç†/\">92. proxy ä»£ç†</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸŒ Network/102. OSIä¸ƒå±¤/\">102. OSIä¸ƒå±¤</a>\n\nNginx\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸŒ Network/169. Nginxçš„è² è¼‰å¹³è¡¡/\">169. Nginxçš„è² è¼‰å¹³è¡¡</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸŒ Network/176. Nginx cheat sheet/\">176. Nginx cheat sheet</a>\n\nTroubleshooting\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸŒ Network/99. nginxçš„é™¤éŒ¯ç­†è¨˜/\">99. nginxçš„é™¤éŒ¯ç­†è¨˜</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸŒ Network/106. zyxel èˆ‡ fortigate å»ºç«‹VPN é»å°é»é€šé“/\">106. zyxel èˆ‡ fortigate å»ºç«‹VPN é»å°é»é€šé“</a>",
		"tags": [ "note","ğŸŒ"]
},

{
		"title": "OSIä¸ƒå±¤",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸŒ Network/102. OSIä¸ƒå±¤/",
		"content": "å‰è¨€\nå› ç‚ºä¸€ç›´èƒŒä¸èµ·ä¾† OSIä¸ƒå±¤ï¼Œä¸Šç¶²æŸ¥äº†ä¸‹ç™¼ç¾é‚„çœŸçš„æœ‰äººç™¼æ˜äº†å£è¨£\nOSIç”±æœ€ä¸Šå±¤å¾€ä¸‹\nAll People Seem To Need Domino's Pizza\nï¼ˆæ‰€æœ‰çš„äººçœ‹ä¾†éƒ½éœ€è¦é”ç¾æ¨‚æ¯”è–©)\næ­£æ–‡\n\nApplication ï¼šæ‡‰ç”¨å±¤\nä¸»è¦åŠŸèƒ½æ˜¯è™•ç†æ‡‰ç”¨ç¨‹å¼ï¼Œé€²è€Œæä¾›ä½¿ç”¨è€…ç¶²è·¯æ‡‰ç”¨æœå‹™ï¼Œ\né€éé€šè¨Šå”å®š(DHCPã€FTPã€HTTP...)å’Œè³‡æ–™æ“ä½œï¼Œå°‡è³‡è¨Šæ•´åˆèµ·ä¾†ï¼Œæä¾›çµ¦ä½¿ç”¨è€…é€²è¡Œæ“ä½œ\nPresentation ï¼šå±•ç¤ºå±¤\nå±•ç¤ºå±¤ä¸»è¦è² è²¬è½‰è­¯ã€åŠ å¯†å’Œå£“ç¸®è³‡æ–™\nSession ï¼šæœƒè­°å±¤\næœƒè­°å±¤ä¸»è¦è² è²¬å»ºç«‹ç¶²çµ¡é€£ç·šï¼Œç­‰åˆ°è³‡æ–™å‚³è¼¸çµæŸæ™‚ï¼Œå†å°‡é€£ç·šä¸­æ–·ã€‚\nTransport ï¼šå‚³è¼¸å±¤\nå‚³è¼¸å±¤çš„ä¸»è¦ç”¨é€”æ˜¯ï¼Œå”åŠ©OSIå‰ä¸‰å±¤èˆ‡OSIå¾Œä¸‰å±¤é€²è¡Œæºé€šï¼Œå‚³è¼¸å±¤ä¹Ÿè² è²¬è™•ç†æµé‡æ§åˆ¶å’ŒéŒ¯èª¤æ§åˆ¶ã€‚\nNetwork ï¼šç¶²è·¯å±¤\nç¶²è·¯å±¤æ˜¯é‡å°ä½æ–¼ä¸åŒç¶²è·¯(WAN)çš„å…©å€‹è£ç½®ï¼Œä¿ƒé€²å…©è€…ä¹‹é–“çš„è³‡æ–™å‚³è¼¸ã€‚\n(è·¯ç”±å™¨åŠLayer 3äº¤æ›å™¨å³å±¬æ–¼ç¬¬ä¸‰å±¤çš„ç¶²è·¯è¨­å‚™ï¼Œä¸»è¦ä»¥IPä½œç‚ºè³‡æ–™å‚³è¼¸ä¾æ“š)\nData Linkï¼šè³‡æ–™é€£çµå±¤\nè³‡æ–™é€£çµå±¤æ˜¯é‡å°ä½æ–¼ç›¸åŒç¶²è·¯(LAN)çš„å…©å€‹è£ç½®ï¼Œä¿ƒé€²å…©è€…ä¹‹é–“çš„è³‡æ–™å‚³è¼¸ã€‚\n(ç¶²è·¯äº¤æ›å™¨ï¼ˆSwitchï¼‰æ˜¯é€™å€‹å±¤ç´šå¸¸è¦‹çš„è¨­å‚™ï¼Œä¸»è¦åœ¨å€åŸŸç¶²è·¯ä¸Šé‹ä½œï¼Œèƒ½ä¾æ“šMACä½å€ï¼Œå°‡ç¶²è·¯è³‡æ–™å‚³é€åˆ°ç›®çš„ä¸»æ©Ÿä¸Šã€‚)\nPhysicalï¼šå¯¦é«”å±¤\nå¯¦é«”å±¤ä¸»è¦æ˜¯ç”¨ä¾†å®šç¾©è¨­å‚™è£ç½®ä¹‹é–“ä½å…ƒè³‡æ–™å‚³è¼¸ï¼Œä¹Ÿå°±æ˜¯é€éç‰©ç†ç·šæé€£æ¥è‡³å…¶ä»–å¯¦é«”è¨­å‚™ï¼Œå‚³é0å’Œ1çš„æ•¸ä½è¨Šè™Ÿã€‚\n\nref.\n- OSI ä¸ƒå±¤æ¶æ§‹\n- ä»€éº¼æ˜¯OSIçš„7å±¤æ¶æ§‹ï¼Ÿ",
		"tags": [ "note","ğŸŒ"]
},

{
		"title": "zyxel èˆ‡ fortigate å»ºç«‹VPN é»å°é»é€šé“",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸŒ Network/106. zyxel èˆ‡ fortigate å»ºç«‹VPN é»å°é»é€šé“/",
		"content": "å‰è¨€\næ›å…¬å¸å¾Œï¼ŒDevOpsé‚„è¦å…¼ç¶²ç®¡ï¼Œ\nç„¶å¾Œï¼Œåœ¨è¾¦å…¬å®¤é‚„è¦é€£vpnæ‰èƒ½é€£åˆ°devçš„é–‹ç™¼ç’°å¢ƒï¼ˆï¼Ÿ\næˆ‘å¾ˆæ‡¶ï¼Œç‚ºä»€éº¼è¦é€™æ¨£å°æˆ‘ï¼Œ\næ‰€ä»¥...å°±æ”¹äº†å§ã€‚\næ­£æ–‡\n\né è¨ˆå®Œæˆçš„æ¶æ§‹åœ–å¦‚ä¸Š\næœ‰å¹¾å€‹åœ°æ–¹çš„å‘å¾ˆæ·±ï¼Œ\nå»ºè­°éƒ½å…ˆæŸ¥ä¸€ä¸‹ã€‚\næœ¬æ¬¡åšçš„æ˜¯site to site VPNé€£ç·š\n1. æª¢æŸ¥å°çƒé¾œè·Ÿé˜²ç«ç‰†çš„é€£ç·šæ–¹å¼\nå› çˆ²æœ‰ç”³è«‹å›ºå®šipï¼Œä½†æœ¬ä¾†æ˜¯é€éå°çƒé¾œé€£åˆ°å¤–ç¶²ï¼Œ\nå¾Œä¾†ä¸€æŸ¥æ‰ç™¼ç¾æ‡‰è©²æ˜¯è¦è®“Firewallè‡ªå·±æ“æœ‰å¯¦é«”ipæ‰å°ã€‚\nä¸ç”¨å†é€éFWã€‚\næœ‰å¹¾ç¨®è§£æ³•ï¼Œ\n\nå°çƒé¾œæ”¹bridge mode ï¼ˆç¶²è·¯ä¸Šçœ‹åˆ°çš„éƒ½é€™ç¨®å±…å¤šï¼‰\nå°çƒé¾œæ”¹æµ®å‹•ipæ’¥æ¥ï¼Œç„¶å¾Œå†FWä¸Šä½¿ç”¨å›ºå®šip æ’¥æ¥æ–¹å¼ã€‚\n\né‡é»æ˜¯è¦è®“é˜²ç«ç‰†æœ‰ç›´æ¥çš„å°å¤–ipï¼Œç’°å¢ƒä¸Šæœƒæ¯”è¼ƒå–®ç´”ã€‚\næˆ‘ä¹‹å‰çš„ç’°å¢ƒï¼Œå°çƒé¾œé€£åˆ°Zyxel æ˜¯192.168.1.X ï¼Œ\nç„¶å¾Œå°çƒé¾œæ¥é˜²ç«ç‰†èµ°wan portï¼Œä½†åˆ°å…§éƒ¨çš„æ©Ÿå™¨ipä¹Ÿæ˜¯192.168.1.Xï¼Œ\n2.è¨­å®š ipSec\né€™é‚Šè¨­å®šçš„æ–¹å¼ç¶²è·¯ä¸Šå¾ˆå¤šç¨®ï¼Œå¯ä»¥å…ˆçœ‹ä¸€ä¸‹ [Nebula x Firewall]èˆ‡Fortigateå»ºç«‹IPSecç«™åˆ°ç«™site-to-site VPN\né—œéµé»åœ¨ï¼ŒPhase 1ã€Phase 2è·Ÿé‡‘é‘°çš„è¨­å®šä¸€å®šè¦å…©è‡ºä¸€æ¨£ã€‚\næˆ‘åœ¨é€£ç·šçš„æ™‚å€™ï¼Œä¸€ç›´ç¢°åˆ°ZyXel é€£vpnæ™‚ ä¸€ç›´timeoutï¼Œ\næœ€å¾Œæ˜¯åœ¨æ”¹å®Œ 1 çš„æ¶æ§‹ä»¥å¾Œï¼Œä¸€æ•´å€‹é›¨éå¤©æ™´\nZyxelçš„IPsecè¨­å®š\næœ¬åœ°çš„ipè·Ÿé ç«¯çš„ipè¦åˆ†æ¸…æ¥š\n\nfortigateçš„IPsecé€šé“ è¨­å®š\n\nç„¶å¾Œæª¢æŸ¥é€£ç·šæœ‰æ²’æœ‰é€šï¼Œ\nå…©é‚Šéƒ½è¦è¨­å®šå¥½ï¼Œæ‰æœƒé€šã€‚\n\n3. è¨­å®šè·¯ç”±\næˆ‘çœ‹çš„ç¶²è·¯ä¸Šçš„æ•™å­¸ï¼Œä»–å€‘æ˜¯ä¸€è¨­å®šå¥½å¾Œï¼Œå°±é€£çš„é€šäº†ã€‚\nä½†æˆ‘æ€éº¼é€£å°±æ˜¯ä¸é€šã€‚\n\nç”¨tracertçœ‹è·¯ç”±ï¼Œæ˜¯åªè·‘åˆ°192.168.1.1 (Zyxel FWä¸Š)ï¼Œå°±æ²’åœ¨å¾€ä¸‹äº†ã€‚æ–¼æ˜¯å…ˆå¼„å€‹ï¼ˆZyXel )ç­–ç•¥è·¯ç”±ï¼Œçœ‹è½‰ä¸è½‰çš„éå»ã€‚\n\nfortigateçš„é˜²ç«ç‰†ç­–ç•¥åŠè·¯ç”±ï¼Œé˜²ç«ç‰†è¨˜å¾—ä¸èƒ½é–‹NATã€‚\n\nfortigateä¸Šé¢æª¢æŸ¥çš„æ–¹å¼æœ‰å…©ç¨®\n\næ’ˆå°åŒ…ï¼Œç„¶å¾Œç”¨wiresharkçœ‹\n\nåˆ°fortigateçš„ CLIæ§åˆ¶æª¯ä¸‹æŒ‡ä»¤æŸ¥(é€™å€‹æ¯”è¼ƒå¿«)\n\ndiag debug reset\ndiag debug flow filter clear\ndiagnose sniffer packet any &quot;host 192.168.103.221 and icmp&quot; 4\n\næ­£å¸¸çš„è©±ï¼Œæœƒåƒé€™æ¨£æœ‰å›æ‡‰\n\næˆ‘ç•¶æ™‚ç¢°åˆ°çš„æ˜¯æœ‰æµé‡æ‰“åˆ° fortigateçš„æ©Ÿå™¨ä¸Šï¼Œä½†æ²’æœ‰è½‰éå»ï¼Œ\næ‰€ä»¥è·¯ç”±è·Ÿé˜²ç«ç‰†\nçµèª\nèŠ±äº†æˆ‘ä¸‰å¤©çš„æ™‚é–“ï¼Œæˆ‘çœŸçš„åªæ˜¯å€‹åŠåŠå­çš„ç¶²ç®¡ï¼Œç¶²è·¯æˆ‘ä¸ç†Ÿé˜¿ å—šå—š...(â•¥ï¹â•¥)\nè®“æˆ‘æ‡·å¿µèµ·ä»¥å‰ç•¶MISæ™‚çš„é˜²ç«ç‰†è¨­å®šï¼Œéƒ½æ˜¯å» å•†å¹«æˆ‘å€‘è¨­å®šçš„ï¼Œæˆ‘å€‘åªè¦ç¨å¾®çŸ¥é“ä¸€äº›ç®¡ç†å°±å¥½ï¼Œæ„Ÿè¬ShareTech ã€‚è€é—†ï¼ï¼å¦‚æœä¸‹æ¬¡æ¡è³¼æ™‚ï¼Œæˆ‘é‚„åœ¨çš„è©±ï¼Œæˆ‘è¦æ›å» å•†å•Šå•Šå•Šã€‚\nref.\n\næœ‰é—œ FortiGate é˜²ç«ç‰†ç›¸é—œè¨­å®š\n[Nebula x Firewall]èˆ‡Fortigateå»ºç«‹IPSecç«™åˆ°ç«™site-to-site VPN",
		"tags": [ "note","ğŸŒ"]
},

{
		"title": "Nginxçš„è² è¼‰å¹³è¡¡",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸŒ Network/169. Nginxçš„è² è¼‰å¹³è¡¡/",
		"content": "ç¡ç¡å”¸\né›–ç„¶çŸ¥é“nginxæ‡‰è©²å¯ä»¥åšåˆ°è² è¼‰å¹³è¡¡ï¼Œ\nä½†å¾ä¾†æ²’å¼„éï¼Œ\næŸ¥äº†ä¸€ä¸‹ï¼Œé‚„æŒºç°¡å–®çš„ã€‚\næ­£æ–‡\nä¸»è¦æœ‰å››ç¨®æ¨¡å¼ï¼Œ\néƒ½æ˜¯å¯«åœ¨upstreamåº•ä¸‹\n\nè¼ªè©¢(Round Robin) ï¼šä»€éº¼éƒ½ä¸è¦å¯«ï¼Œé è¨­çš„æ–¹æ³•\næœ€å°‘é€£æ¥(least_conn)ï¼šæœƒè½‰ç™¼åˆ°ä¼ºæœå™¨é€£æ¥æ•¸æœ€å°‘çš„é‚£è‡º\nipåœ°å€é›œæ¹Š(ip_hash)ï¼šä½¿ç”¨è€…æœƒé€£åˆ°ç‰¹å®šçš„ä¼ºæœå™¨ä¸Š\næ¬Šé‡åŠƒåˆ†(weight)ï¼šæ ¹æ“šæ¬Šé‡æ¯”ä¾‹åˆ‡æ›ä¼ºæœå™¨ï¼Œé€™ç¨®å¯«æ³•è·Ÿä¸Šé¢çš„ä¸‰ç¨®ä¸ä¸€æ¨£ã€‚\n\nref. Nginxè² è¼‰å¹³è¡¡çš„4ç¨®æ–¹å¼ ï¼šè¼ªè©¢-Round Robin ã€Ipåœ°å€-ip_hashã€æœ€å°‘é€£æ¥-least_connã€åŠ æ¬Š-weight=n\nconfig.conf\nupstream yolox-brand {\nleast_conn;\nserver yolox-brand-1:8080;\nserver yolox-brand-2:8080;\n}\n\nserver {\nlisten 80;\nserver_name 192.168.1.79;\n\nlocation / {\nproxy_pass http://yolox-brand;\nproxy_redirect off;\nproxy_set_header Host $host;\nproxy_set_header X-Real-IP $remote_addr;\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\nproxy_set_header X-Forwarded-Host $server_name;\n\nproxy_hide_header 'Access-Control-Allow-Origin';\nadd_header Access-Control-Allow-Origin *;\nadd_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';\nadd_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';\n\nif ($request_method = 'OPTIONS') {\nreturn 204;\n}\n}\n}\n\nç„¶å¾Œï¼Œdocker-compose.yamlå¦‚ä¸‹ï¼Œ\nè¦æ³¨æ„åˆ¥æŠŠconfigæª”å¡éŒ¯åœ°æ–¹äº†ï¼Œä¸ç„¶æœƒç¢°åˆ° <a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸŒ Network/99. nginxçš„é™¤éŒ¯ç­†è¨˜/\">99. nginxçš„é™¤éŒ¯ç­†è¨˜</a>çš„éŒ¯èª¤\nversion: '3.8'\nservices:\npython-1:\ncontainer_name: yolox-brand-1\nimage: busybox\npull_policy: if_not_present\nrestart: always\nnetworks:\n- internal\npython-2:\ncontainer_name: yolox-brand-2\nimage: busybox\npull_policy: if_not_present\nrestart: always\nnetworks:\n- internal\nnginx-lb:\ncontainer_name: nginx\nimage: nginx\npull_policy: if_not_present\nrestart: always\nvolumes:\n- ./proxy.conf:/etc/nginx/conf.d/proxy.conf\nports:\n- 80:80\nnetworks:\n- internal\nnetworks:\ninternal:\nname: internal\ndriver: bridge\n\nè£œå……ï¼Œproxy_pass urlÂ ä¸­åŒ…å«è·¯å¾‘æ™‚ï¼Œçµå°¾çš„Â /Â æœ€å¥½åŒÂ locationÂ åŒ¹é…è¦å‰‡ä¸€è‡´ã€‚\nref. proxy_pass url åå‘ä»£ç†çš„å‘",
		"tags": [ "note","ğŸŒ"]
},

{
		"title": "Nginx cheat sheet",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸŒ Network/176. Nginx cheat sheet/",
		"content": "å‰è¨€\né©—è­‰nginxçš„http2é–‹å•“æ–¹å¼æ™‚ï¼Œ\næ‰çªç„¶é©šè¦ºæˆ‘éœ€è¦ä¸€å€‹nginx cheat sheet\nä¸ç„¶æ€éº¼å–®ç´”å›å€‹ç‹€æ…‹éƒ½ä¸çŸ¥é“å»å“ªæŠ„\næ­£æ–‡\nresponse 200\nlocation / {\nadd_header Content-Type text/plain;\nreturn 200 'Hey James,Say Hello Nginx';\n}\n\nè‡ªç°½æ†‘è­‰\nopenssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout example.key -out example.crt\n\nåœ¨ Common Nameæ™‚ï¼Œè¨˜å¾—è¼¸å…¥ä½ ç›®å‰é›»è…¦çš„ipï¼Œ\nç”¢ç”Ÿå®Œå¾Œï¼Œæ›è¼‰å°æ‡‰çš„volumeåˆ°nginxè£é¢ã€‚\næ›´æ”¹configã€‚\ndocker-compose.yaml\n\nversion: '3.8'\nservices:\nnginx-lb:\ncontainer_name: nginx\nimage: nginx\npull_policy: if_not_present\nrestart: always\nvolumes:\n- ./certs:/etc/ssl\n- ./nginx.conf:/etc/nginx/nginx.conf\n- ./proxy.conf:/etc/nginx/conf.d/proxy.conf\nports:\n- 443:443\n- 80:80\nnetworks:\n- internal\nnetworks:\ninternal:\nname: internal\ndriver: bridge\n\nproxy.conf(æŸå€‹nginxç‰ˆæœ¬å¾Œ http2é–‹å•“çš„æ–¹å¼è¦æ”¹ç”¨ä¸‹é¢çš„æ–¹å¼)\nserver {\nlisten 443 ssl;\nserver_name 192.168.1.106;\nhttp2 on;\n\nssl_certificate /etc/ssl/example.crt;\nssl_certificate_key /etc/ssl/example.key;\nssl_protocols TLSv1.3 TLSv1.2;\nssl_prefer_server_ciphers on;\nssl_ecdh_curve X25519:secp521r1:secp384r1;\nssl_ciphers TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;\nssl_session_cache shared:TLS:2m;\nssl_buffer_size 4k;\n\n\tlocation / {\n\t add_header Content-Type text/plain;\n\t return 200 'Hey James,Say Hello Nginx';\n\t}\n}\n\nProxy_pass\nproxy_pass urlÂ ä¸­åŒ…å«è·¯å¾‘æ™‚ï¼Œçµå°¾çš„Â /Â æœ€å¥½åŒÂ locationÂ åŒ¹é…è¦å‰‡ä¸€è‡´ã€‚\nref. proxy_pass url åå‘ä»£ç†çš„å‘",
		"tags": [ "note","ğŸŒ"]
},

{
		"title": "Fortigate è¨­å®š å…§éƒ¨æœå‹™è² è¼‰å¹³è¡¡",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸŒ Network/182. Fortigate è¨­å®š å…§éƒ¨æœå‹™è² è¼‰å¹³è¡¡/",
		"content": "å‰è¨€\n&amp;(&amp;%(%^&amp;%@#$%^((&amp;^% ä¸€é€£ä¸²æ¶ˆéŸ³ï¼Œ\nèªªéæˆ‘åªæœƒç°¡æ˜“çš„ç¶²è·¯ç®¡ç†ï¼Œç„¶å¾Œç¾åœ¨å«æˆ‘æé€™å€‹ï¼Œ\nç›®å‰æ˜¯ç¬¬äºŒæ¬¡ï¼Œå†ä¾†ä¸€æ¬¡ï¼Œç›´æ¥ç•¢æ¥­å¥½äº†ã€‚\nç›´æ¥å»æ”¹å®¢æˆ¶çš„é˜²ç«ç‰†è¨­å®šæ˜¯ä½ ç˜‹äº†ï¼Œé‚„æ˜¯æˆ‘ç˜‹äº†ã€‚\nå¼„ä¸å¥½ç¶²è·¯å…¨æ–·èª°è² è²¬ï¼ï¼Ÿ\né‚„æ˜¯ä½ èªçˆ²ç¶²è·¯å¾ˆç°¡å–®ï¼Œé‚£ä½ ä»–é¦¬çš„æ€éº¼ä¸è‡ªå·±æã€‚\næ­£æ–‡\nè¦é”æˆçš„ç›®æ¨™ï¼Œuserå‘¼å«ä¸€å€‹ipç¶²å€ï¼Œæœƒè‡ªå‹•è½‰åˆ°å…¶ä»–çš„ä¼ºæœå™¨ä¸Šé¢ ã€‚\nä¸»è¦åƒè€ƒfortigateå®˜ç¶²èªªæ˜ï¼ŒVirtual server\næ¸¬è©¦ä½¿ç”¨çš„FortiOSç‰ˆæœ¬ç‚º 7.2.5\nç°¡ç•¥èªªæ˜\n\næ‰“é–‹ Virtual server\nå¦‚æœæ²’çœ‹åˆ°ï¼Œéœ€åˆ° System -&gt; Feature Visibility é–‹å•“ Additional Featuresåº•ä¸‹çš„ Load Balance\n\næ–°å¢Virtual Server\n\næ–°å¢Firewall Policy\nå•é¡Œé»åœ¨ Inspection Mode ï¼Œé¸æ“‡ Flow-basedçš„è©±ï¼Œæœƒæ‰¾ä¸åˆ°ä½ å‰›å‰›è¨­å®šçš„virtual serverï¼Œå¿…éœ€è¨­å®šProxy-basedæ‰æœ‰\n\ntroubleshoting\n\næ¸¬è©¦çµæœè·Ÿæ²’èµ°virtual serverä¸ä¸€æ¨£ï¼Ÿ\næª¢æŸ¥çœ‹çœ‹ virtual server çš„ Persistence æœ‰æ²’æœ‰è¨­å®š HTTP Cookie\nå‘¼å«apiï¼Œç™¼ç¾å‘¼å«çš„éƒ½æ˜¯åŒä¸€å€‹ip\næª¢æŸ¥ä¸€ä¸‹ Load Balancing method æ˜¯ä¸æ˜¯è¨­å®šæˆ Staticï¼Œä¸Šé¢è¨­å®šå°±è¨­éŒ¯äº†ï¼Œå°è‡´å›ºå®šåªæ‰“åŒä¸€å€‹ã€‚\n\nFirewall Policyçš„ Inspection Mode æ²’å‡ºç¾é¸é …\né€™å¡Šæ¯”è¼ƒä¸ç¢ºå®šï¼Œä½†æˆ‘æ˜¯å…ˆåˆ° System -&gt; Feature Visibility é–‹å•“ Security Featuresåº•ä¸‹çš„ Zero Trust Network Accesså¾Œï¼Œæ‰çªç„¶è·‘å‡ºä¾†ï¼Œä½†æˆ‘æŠŠä»–é—œæ‰ï¼Œä¹Ÿæ²’æœ‰æ¶ˆå¤±...\n\nref. Virtual server",
		"tags": [ "note","ğŸŒ"]
},

{
		"title": "proxy ä»£ç†",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸŒ Network/92. proxy ä»£ç†/",
		"content": "å‰è¨€\nä»£ç†ä¼ºæœå™¨ï¼Œä»¥å‰æœ€å¸¸ç”¨éçš„æ‡‰è©²æ˜¯Hinetçš„proxyï¼Œ\nåœ¨ä»¥å‰ç¶²è·¯ä¸å¿«çš„æ™‚å€™ï¼Œæœ‰æ™‚æœƒæ›prxoyï¼Œä¾†è®“ç€è¦½é€Ÿåº¦è®Šå¿«ã€‚\nproxyçš„ç”¨é€”ä¸»è¦ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå°‡userçš„è«‹æ±‚é€éprxoyå»è·Ÿç¶²ç«™å–å¾—è³‡æ–™ï¼Œå†å›çµ¦userã€‚\nä½†proxyåˆ†æˆå¾ˆå¤šç¨®..ä¸‹é¢ç°¡å–®èªªæ˜\næ­£æ–‡\n\nHTTPä»£ç†\nä¸»è¦ç”¨æ–¼å­˜å–ç¶²é ï¼Œä¸€èˆ¬æœ‰å…§å®¹éæ¿¾å’Œå¿«å–åŠŸèƒ½ï¼ˆå°‡HTTPè«‹æ±‚è½‰ç™¼åˆ°æ‰€éœ€çš„HTTPä¼ºæœå™¨ï¼‰ã€‚\nuserä½¿ç”¨æ–¹æ³•ï¼Œæ˜¯ç€è¦½å™¨æ›httpä»£ç†ä¼ºæœå™¨å¾Œï¼Œå»ç€è¦½ç¶²é \n\nTCPä»£ç†\nä¼ºæœå™¨ç«¯å¯¦ä½œè½‰ç™¼TCPè«‹æ±‚ï¼Œç•¶è¨ªå•æœ¬æ©Ÿçš„portæ™‚ï¼Œæœƒè½‰åˆ°æŒ‡å®šipçš„portä¸Š\n\nUDPä»£ç†\nä¼ºæœå™¨ç«¯å¯¦ä½œè½‰ç™¼UDPè«‹æ±‚ï¼Œç•¶è¨ªå•æœ¬æ©Ÿçš„portæ™‚ï¼Œæœƒè½‰åˆ°æŒ‡å®šipçš„portä¸Š\n\nå…§ç¶²ç©¿é€\nå°‡å…§ç¶²æœå‹™æä¾›çµ¦å¤–éƒ¨åšä½¿ç”¨, Ngrok,frp\nï¼Œç•¶è«‹æ±‚é€£åˆ°å¤–ç¶²serverçš„å›ºå®športæ™‚ï¼Œè½‰ç™¼åˆ°å…§ç¶²æœå‹™çš„portä¸Šã€‚\nï¼ˆéœ€åœ¨æä¾›æœå‹™çš„å…§ç¶²serveråŠå¤–ç¶²çš„serveråˆ†åˆ¥è¨­å®šï¼‰\n\nSOCKSä»£ç†\nåªæ˜¯å–®ç´”å‚³éå°åŒ…ï¼Œä¸é—œå¿ƒå…·é«”å”å®šå’Œç”¨æ³•ï¼Œæ‰€ä»¥é€Ÿåº¦å¿«å¾ˆå¤šï¼ˆæ›´ä½çš„å”å®šï¼ŒSOCKS5èƒ½è™•ç†udp protocol)ã€‚\nç¬¬äº”å±¤å”å®šï¼Œæ•…èƒ½è™•ç†HTTPï¼ŒHTTPSï¼ŒPOP3ï¼ŒSMTPå’ŒFTPã€‚\nuserç°¡æ˜“ä½¿ç”¨æ–¹æ³•ï¼šä½¿ç”¨ ssh tunnel é€£åˆ°å…§éƒ¨ä¸»æ©Ÿã€‚\n(æ¯”è¼ƒåä¼ºæœå™¨ç«¯å»ºè¨­ï¼Œéœ€é¡å¤–çš„è»Ÿé«”é€ésockså”å®šé€£å…¥)\n\nSSä»£ç†\nShadowsocksï¼ŒåŸºæ–¼SOCKS5ä»£ç†æ–¹å¼çš„åŠ å¯†å”å®š\n\nref.\n1. SOCKS\n2. ä»£ç†ä¼ºæœå™¨\n3. å¯¦æˆ°frpå…§ç¶²ç©¿é€ã€€å…§éƒ¨ä¸»æ©Ÿä¹Ÿèƒ½å°å¤–æœå‹™\n4. SOCKS5ä»£ç†\n5. Golangå‹•æ‰‹å¯«ä¸€å€‹Http Proxy\n\né¡Œå¤–è©±è£œå……ï¼š\næ­£å‘ä»£ç†ï¼š\nä»£ç†ç”¨æˆ¶ç«¯ï¼Œè®“ä¼ºæœå™¨ä¸çŸ¥é“ç”¨æˆ¶çš„IP\nåå‘ä»£ç†ï¼š\nä»£ç†ä¼ºæœå™¨ç«¯ï¼Œè®“ç”¨æˆ¶ä¸çŸ¥é“ä¼ºæœå™¨ç«¯çš„IP\nref.\n- ç”¨äººé¡èªè¨€è·Ÿä½ èªªç”šéº¼æ˜¯æ­£å‘ä»£ç†(Forward Proxy)å’Œåå‘ä»£ç†(Reverse Proxy)",
		"tags": [ "note","ğŸŒ"]
},

{
		"title": "nginxçš„é™¤éŒ¯ç­†è¨˜",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸŒ Network/99. nginxçš„é™¤éŒ¯ç­†è¨˜/",
		"content": "å‰è¨€\næˆ‘ä¸€ç›´å°nginxä¸å¤ªç†Ÿï¼Œ\nç›®å‰ä¹Ÿåªåˆ°äº†æœƒç”¨ï¼Œå¤§éƒ¨åˆ†çš„æŒ‡ä»¤çœ‹å¾—æ‡‚ã€‚\nä½†æ¹Šåœ¨ä¸€èµ·ï¼Œé‚„æ˜¯è¦æŸ¥ä¸€ä¸‹ã€‚\né€™æ¬¡çš„éŒ¯èª¤å°±ç™¼ç”Ÿåœ¨æˆ‘ä»¥ç‚ºçš„å•é¡Œä¸Š\næ­£æ–‡\nåˆå¤šäº†ä¸€å€‹æ–°æœå‹™è¦æ¶è¨­ï¼Œ\næ‰€ä»¥æƒ³ç•¶ç„¶ï¼Œæ±è¥¿åˆä¸Ÿåˆ°æˆ‘é€™ä¾†äº†ã€‚\né€™æ¬¡è·Ÿä»¥å‰çš„æ¯”è¼ƒä¸ä¸€æ¨£ï¼Œé€™æ¬¡æ˜¯ä¸€å€‹å…¨æ–°çš„æœå‹™ã€‚\næ‰€ä»¥ä¹‹å‰çš„è‡ªå‹•ä½ˆç½²ã€yamlã€nginxè¨­å®šæª”é€šé€šé‡ä¾†ã€‚\né›–ç„¶èªªæ˜¯é‡ä¾†ï¼Œä½†ä¹Ÿåªæ˜¯è¤‡è£½è²¼ä¸Šæ”¹ä¸€æ”¹ï¼Œç„¶å¾Œå°±ç‚¸äº†XDDDD\næˆ‘è¤‡è£½ä¹‹å‰çš„è¨­å®šæª”åƒé€™å€‹æ¨£å­ã€‚ä¸­é–“åˆªé™¤äº†å¾ˆå¤šæ±è¥¿ï¼Œ\nè«‹ä¸è¦ç…§æŠ„ã€‚\nserver_tokens off;\nlog_format client '$remote_addr - $remote_user [$time_local] , '\n'http-host: &quot;$http_host&quot; , URL: &quot;$request&quot; , request-status : &quot;$status&quot; , '\n'body-byte: $body_bytes_sent ,http-referer: &quot;$http_referer&quot; ,'\n'user-agent: &quot;$http_user_agent&quot; , X-Forwarded-For : &quot;$http_x_forwarded_for&quot; , '\n' request-time: &quot;$request_time&quot; , response_time : &quot;$upstream_response_time&quot; ';\n\nclient_max_body_size 100m;\ngzip on;\ngzip_min_length 1k;\ngzip_buffers 4 16k;\ngzip_comp_level 5;\ngzip_types text/plain text/css application/x-javascript application/javascript application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;\n\n# GCP HTTP(S) LoadBalancer will add Via, but nginx check it to disable compress by default...\ngzip_proxied any;\ngzip_vary on;\n\nserver {\nlisten 80 default_server;\nlisten [::]:80 default_server;\naccess_log /dev/stdout client;\nerror_log /dev/stderr;\n\nindex index.html index.htm;\nlocation = /favicon.ico { access_log off; log_not_found off; }\nlocation = /robots.txt { access_log off; log_not_found off; }\n\nlocation /api/socket.io/ {\nproxy_pass http://rd5-api;\nproxy_set_header Host $host;\nproxy_set_header token $rd5_token;\nproxy_set_header X-Forwarded-Proto $scheme;\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n# proxy_set_header X-NginX-Proxy true;\nproxy_set_header X-Real-IP $remote_addr;\n# proxy_set_header via 'proxy_pass/token-proxy ws';\nproxy_http_version 1.1;\nproxy_set_header Upgrade $http_upgrade;\nproxy_set_header Connection &quot;Upgrade&quot;;\nproxy_read_timeout 1d;\n\n}\n\nlocation /50x.html {\nroot /usr/share/nginx/html/frontend-client/;\ninternal;\n}\nlocation /healthz {\naccess_log off;\nreturn 200 'ok';\n}\n\nlocation / {\nerror_page 418 = @fjysdz;\nrecursive_error_pages on;\n\nif ($host = 'yb-test.fjysdz.cn') {\nreturn 418;\n}\nrewrite &quot;^(.*)\\$&quot; $1 permanent; # å»é™¤urlå°¾éƒ¨é‡è¤‡æ–œç·š\nroot /usr/share/nginx/html/frontend-client/$dir;\nadd_header via frontend-proxy;\ntry_files $uri $uri/ /index.html /index.htm =404;\n}\n\n}\n\nç„¶å¾Œå°±å‡ºç¾éŒ¯èª¤äº†\n\n&quot;server_tokens&quot; directive is not allowed here\n\næˆ‘ç™¾æ€ä¸å¾—å…¶è§£ï¼Œæˆ‘æ˜æ˜æ˜¯ç…§æŠ„çš„æ€éº¼æœƒéŒ¯ã€‚\nå¾Œä¾†å°‡server_tokensæ¬é€²å» server çš„å€å¡Šå…§ï¼Œå¥½äº†èƒ½è·‘äº†ã€‚\nä½†åˆçˆ†å‡º\n\n&quot;log_format&quot; directive is not allowed here\n\næˆ‘åˆåªå¥½åœ¨æœ€å¤–å±¤åŠ ä¸Šhttp {} ï¼Œä½†å¿ƒä¸­ä¸€ç›´æœ‰ä¸€å€‹ç–‘å•ï¼Œ\nç‚ºä»€éº¼æœƒå¤±æ•—ï¼ï¼Ÿ\næœ€å¾Œè®Šæˆé€™æ¨£\n\nevents {\nworker_connections 1024;\n}\nhttp {\n\nlog_format client '$remote_addr - $remote_user [$time_local] , '\n'http-host: &quot;$http_host&quot; , URL: &quot;$request&quot; , request-status : &quot;$status&quot; , '\n'body-byte: $body_bytes_sent ,http-referer: &quot;$http_referer&quot; ,'\n'user-agent: &quot;$http_user_agent&quot; , X-Forwarded-For : &quot;$http_x_forwarded_for&quot; , '\n' request-time: &quot;$request_time&quot; , response_time : &quot;$upstream_response_time&quot; ';\n\nclient_max_body_size 100m;\ngzip on;\ngzip_min_length 1k;\ngzip_buffers 4 16k;\ngzip_comp_level 5;\ngzip_types text/plain text/css application/x-javascript application/javascript application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;\n\n# GCP HTTP(S) LoadBalancer will add Via, but nginx check it to disable compress by default...\ngzip_proxied any;\ngzip_vary on;\n\nserver {\n\nserver_tokens off;\nlisten 80 default_server;\nlisten [::]:80 default_server;\naccess_log /dev/stdout client;\nerror_log /dev/stderr;\n\nindex index.html index.htm;\nlocation = /favicon.ico { access_log off; log_not_found off; }\nlocation = /robots.txt { access_log off; log_not_found off; }\n\nlocation /conf/domain {\naccess_log off;\ndefault_type application/json;\nadd_header 'Access-Control-Allow-Origin' '*';\nadd_header 'Access-Control-Allow-Methods' 'GET';\nreturn 200 '{&quot;domain&quot;:&quot;500015&quot;, &quot;site&quot;: &quot;porn1&quot; ,&quot;cdn&quot;:&quot;x-cdn-yb&quot;}';\n}\n\n# frontend-client\nerror_page 404 /404.html;\nerror_page 500 502 503 504 /50x.html;\nlocation /404.html {\nroot /usr/share/nginx/html/frontend-client/;\ninternal;\n}\nlocation /50x.html {\nroot /usr/share/nginx/html/frontend-client/;\ninternal;\n}\nlocation /healthz {\naccess_log off;\nreturn 200 'ok';\n}\n\nlocation / {\nrewrite &quot;^(.*)\\$&quot; $1 permanent; # å»é™¤urlå°¾éƒ¨é‡è¤‡æ–œç·š\nroot /usr/share/nginx/html/$dir;\nadd_header via frontend-proxy;\ntry_files $uri $uri/ /index.html /index.htm =404;\n}\n\n}\n\n}\n\nè·‘æ˜¯èƒ½æ­£å¸¸è·‘äº†ï¼Œä½†é é¢è¼‰å…¥ä¸€ç›´å‡ºå•é¡Œï¼Œ\nå› ç‚ºnginx logæ­£å¸¸äº†ï¼Œå°±è¯çµ¡å‰ç«¯åŒä»å¹«çœ‹ä¸€ä¸‹ã€‚\nä»–èªªå¾ä¼ºæœå™¨å–å¾—çš„css context-typeæœ‰å•é¡Œã€‚\næŸ¥äº†ä¸€ä¸‹ï¼Œåˆç™¼ç¾ä¸€å€‹æ±è¥¿æ²’å¸¶ã€‚\ninclude /etc/nginx/mime.types;\n\nç‚ºä»€éº¼ä¸€å€‹èƒ½è·‘ä¸€å€‹ä¸èƒ½è·‘ï¼Ÿï¼Ÿï¼Ÿ\næœ€å¾Œç™¼ç¾ä¸€å€‹é‡é»ã€‚\nçµè«–\nNginx çš„è¨­å®šæª”é è¨­çš„ä½ç½®æ˜¯\n\n/etc/nginx/nginx.conf\n\nç„¶å¾Œï¼Œé€™å€‹æª”æ¡ˆè£¡é¢æœƒå…ˆå¯«å¥½é è¨­çš„è¨­å®šã€‚\nuser nginx;\nworker_processes auto;\n\nerror_log /var/log/nginx/error.log notice;\npid /var/run/nginx.pid;\n\nevents {\nworker_connections 1024;\n}\n\nhttp {\ninclude /etc/nginx/mime.types;\ndefault_type application/octet-stream;\n\nlog_format main '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '\n'$status $body_bytes_sent &quot;$http_referer&quot; '\n'&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';\n\naccess_log /var/log/nginx/access.log main;\n\nsendfile on;\n#tcp_nopush on;\n\nkeepalive_timeout 65;\n\n#gzip on;\n\ninclude /etc/nginx/conf.d/*.conf;\n}\n\næ‰€ä»¥èƒ½è·‘çš„æœå‹™ï¼Œæ˜¯å› ç‚ºä»–çš„è¨­å®šæª”æ”¾åœ¨ conf.d è£¡é¢ï¼Œ\næ‰€ä»¥æ˜¯å¾ nginx.confè¼‰å…¥ /etc/nginx/conf.d/*.conf çš„è¨­å®šã€‚\nè€Œä¸èƒ½è·‘çš„æœå‹™ï¼Œæˆ‘æ˜¯å°‡è¨­å®šæª”ç›´æ¥è¦†è“‹ /etc/nginx/nginx.conf ï¼Œ\næ‰€ä»¥ä¸Šé¢é‚£ä¸€äº›è¨­å®šæˆ‘éƒ½æ²’å¯«åˆ°ã€‚\nref.\n\nnginxä¸­CSSé‡å®šå‘è§£ææœ‰å•é¡Œâ€”â€”mime.typeè©³è§£\nNginxç­†è¨˜ï¼ˆäºŒï¼‰NginxåŸºç¤",
		"tags": ["tcp_nopush", "gzip", "note","ğŸŒ"]
},

{
		"title": " ğŸ MAC MOC",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ Mac/0.ï¼­AC MOC/",
		"content": "å®‰è£äº‹é …\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ Mac/iTerm2å®‰è£/\">iTerm2å®‰è£</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ Mac/é¼ é¬šç®¡è¼¸å…¥æ³•/\">é¼ é¬šç®¡è¼¸å…¥æ³•</a>\nå°éº¥æ³¨éŸ³è¼¸å…¥æ³•\ncheatSheet\nhidden Bar\nXnip\n\nä¹‹å¾Œå¯ä»¥è©¦è©¦çœ‹\n\nå¨æ³¨éŸ³è¼¸å…¥æ³• ï¼ˆå°éº¥çœŸçš„å¥½ç”¨ï¼Œè³‡æºåˆåƒä¸å…‡ï¼‰\nAmphetamine (é€²éšèƒ½æºç¯€ç´„æ¨¡å¼)\n\nMAC è»Ÿé«”\n\n<a class=\"internal-link is-unresolved\" href=\"/404\">64.macç”¨çš„fiddlerï¼ŒWhistle</a>\niina(å½±ç‰‡æ’­æ”¾)\nskitch(æˆªåœ–)\nxnip(æˆªåœ–)\nç°¡å–®æˆªåœ–ç”¨\nshotter(å¤šåŠŸèƒ½æˆªåœ–)\nç›®å‰éƒ½æ”¹ç”¨é€™å¥—äº†\ncoconutbattery(æŸ¥è©¢iosè£ç½®é›»æ± )\nhiddenbar\nRectangleï¼ˆè¦–çª—ç®¡ç†)\n\nMACæ“ä½œ\n\n<a class=\"internal-link is-unresolved\" href=\"/404\">macåœ¨terminalé–‹å•“finder</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ Mac/æ°¸ä¹…åˆ¥å alias/\">æ°¸ä¹…åˆ¥å alias</a>\nmacé–‹å•“éš±è—æª”æ¡ˆï¼šShift+Command+ .",
		"tags": [ "note","ğŸ"]
},

{
		"title": "iTerm2-Powerlevel10kè¨­å®š",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ Mac/iTerm2-Powerlevel10kè¨­å®š/",
		"content": "å‰è¨€\næˆ‘è¨˜å¾—ä»¥å‰æˆ‘çš„iTermæœ€å¾Œé¢æœ‰é¡¯ç¤ºæ™‚é–“ï¼Œ\nä½†ç›®å‰ç”¨çš„æ²’æœ‰ï¼Œ\näº‚æ‰¾äº†ä¸€ä¸‹ï¼Œç™¼ç¾ä¸€å€‹ç°¡å–®pluginï¼Œä¸åƒ<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ Mac/iTerm2å®‰è£/\">iTerm2å®‰è£</a>ï¼Œ\néœ€è¦è‡ªå·±æ‰‹å‹•è£å­—é«”ã€‚\nå…§å®¹\n\nå®‰è£å¥½iTerm2å¾Œï¼Œåƒè€ƒ<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ Mac/iTerm2å®‰è£/\">iTerm2å®‰è£</a>\nå®‰è£ zshä¸»é¡Œ Powerlevel10k\n\ngit clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k\n\nè¨­å®šzsh theme\n\nZSH_THEME=&quot;powerlevel10k/powerlevel10k&quot;\n\né–‹å•Ÿè¨­å®šç•«é¢\nå¯ä»¥é¸æ“‡é‡é–‹iTerm2 æˆ–æ˜¯ åŸ·è¡ŒæŒ‡ä»¤\n\np10k configure\n\nå†ä¾†å°±çœ‹ä»–çš„èªªæ˜é¸æ“‡ä½ æƒ³è¦çš„è¨­å®šã€‚\nä»¥ä¸‹æ˜¯æˆ‘ç›®å‰çš„ç•«é¢\n\næœ€å¾Œä¸€é …ï¼Œé¸æ“‡è¦ä¸è¦é–‹å•Ÿ Instant Prompt\næ ¹æ“šæ–‡ç« èªªæ³•ï¼Œå¯ä»¥æ¶ˆé™¤å•Ÿå‹•æ™‚é–“éé•·çš„æƒ…æ³ï¼ˆå¦‚æœä½ çš„å¥—ä»¶å¾ˆå¤šæ™‚ï¼‰ã€‚\næˆ‘é¸æ“‡é—œæ‰ï¼Œæ²’å•¥å·®åˆ¥ã€‚\nå¦‚æœæƒ³å†é‡æ–°è¨­å®šåƒæ•¸çš„è©±ï¼Œå†åŸ·è¡Œä¸€æ¬¡æŒ‡ä»¤ p10k configure\nref. è®“ macOS çš„ Terminal åˆæ½®åˆå¯¦ç”¨ï¼šæ‰‹æŠŠæ‰‹è¨­å®šæ•™å­¸ iTerm2 + oh-my-zsh + Powerlevel10k\næ•…éšœæ’é™¤\n\næˆ‘è¼¸å…¥ä»»ä½•æŒ‡ä»¤ï¼Œéƒ½æœƒè·³å‡ºéŒ¯èª¤\n\nprompt_context:2: command not found: prompt_segment\né–‹å•Ÿ ~/.zshrc ï¼Œå°‹æ‰¾é—œéµå­— prompt_segmentï¼Œ\næŠŠé‚£æ•´å€‹functionç äº†ã€‚\n\nref. prompt_context:2: command not found: prompt_segment",
		"tags": [ "note","ğŸ"]
},

{
		"title": "iTerm2å®‰è£",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ Mac/iTerm2å®‰è£/",
		"content": "2024/05/27 æ›´æ–°\næ›äº†ä¸€å°mac miniï¼Œ\næ±è¥¿è¦é‡è£ï¼Œç„¶å¾Œç™¼ç¾ï¼Œæˆ‘æŒ‡ä»¤éƒ½éæ™‚äº†ï¼Œé †ä¾¿é‡æ–°æ•´ç†ä¸€ä¸‹ã€‚\n\nå®‰è£ Homebrew\n\n/bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot;\n\nå®‰è£iTerm2\n\nbrew install --cask iterm2\n\nå¥—ç”¨é…è‰²\nåˆ°iterm2 color schemes é¸æ“‡å–œæ­¡çš„é…è‰²å¾Œimportã€‚\n\nå®‰è£ZSH\n\nbrew install zsh zsh-completions\n\nå°‡é è¨­çµ‚ç«¯æ©Ÿæ”¹çˆ²ZSH\n\nsudo sh -c &quot;echo $(which zsh) &gt;&gt; /etc/shells&quot;\nchsh -s $(which zsh)\n\nå®‰è£ Oh My ZSH\n\nsh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot;\n\nå¥—ç”¨ä¸»é¡Œ\n\nopen ~/.zshrc\n\næ‰¾é—œéµå­—ï¼Œ SH_THEME=\nä¿®æ”¹æˆ\nZSH_THEME=&quot;agnoster&quot;\n\nå®‰è£ powerline font\nbrew install --cask font-sauce-code-pro-nerd-font\n\nåƒè€ƒä¸Šé¢åœ–ç‰‡ï¼Œæ”¹é¸æ“‡Textï¼Œä¿®æ”¹å­—é«”ï¼Œå­—é«”åç¨±ç‚º SauceCodePro Nerd Ford\nå¦‚æœè¦æ‰¾å…¶ä»–å­—é«”çš„è©±ï¼Œæœå°‹é—œéµå­—Nerd\nbrew search --cask nerd\n\nä¿®æ”¹å­—é«”ï¼Œä¸ç„¶æœ‰äº‚ç¢¼ï¼ˆå·²æ£„ç”¨ï¼‰\n\n# clone è¤‡è£½\ngit clone https://github.com/powerline/fonts.git --depth=1\n# install å®‰è£\ncd fonts\n./install.sh\n\nå¥—ç”¨å­—é«”\niTerm â†’ Preferences â†’ Profiles â†’ Text â†’ Change Fontâ†’ Meslo\n\nç¨‹å¼ç¢¼é«˜äº®\n\nbrew install zsh-syntax-highlighting\n\nç„¶å¾Œä¿®æ”¹è¨­å®š\nopen ~/.zshrc\n\nè¨­å®šæª”æœ€å¾ŒåŠ ä¸Š\n# For zsh syntax-highlighting\nsource /usr/local/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh\n\nref.\n\nè¶…ç°¡å–®ï¼ååˆ†é˜æ‰“é€ æ¼‚äº®åˆå¥½ç”¨çš„ zsh command line ç’°å¢ƒ\nç”¨Oh My ZshæŠŠiTermè®Šç¾ç¾\nå®¢è£½æˆ‘çš„ CLI â€” çµ‚æ–¼ç¨å¾®ææ‡‚ iTerm + ZSH",
		"tags": [ "note","ğŸ"]
},

{
		"title": "mac æ°¸ä¹…åˆ¥å alias",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ Mac/æ°¸ä¹…åˆ¥å alias/",
		"content": "ä¿®æ”¹è·¯å¾‘ ~/.zshrc\nç„¶å¾Œè¼¸å…¥è¦æ–°å¢çš„alias.\nalias tf=&quot;terraform&quot;",
		"tags": [ "note","ğŸ"]
},

{
		"title": "é¼ é¬šç®¡è¼¸å…¥æ³•",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ Mac/é¼ é¬šç®¡è¼¸å…¥æ³•/",
		"content": "å®‰è£ RIME\n\nbrew install --cask squirrel\n\nå®‰è£å®Œå¾Œéœ€è¦ç™»å‡ºå†ç™»å…¥\n\nä¸‹è¼‰æœ€æ–°çš„æª”æ¡ˆ\n\nhttps://github.com/Ponpon55837/Squirrel/releases\n\nmacçš„è©±ï¼Œå…ˆå¢åŠ é¼ é¬šç®¡çš„è¼¸å…¥æ³•ï¼ˆåœ¨ç°¡é«”ä¸­æ–‡å…§ï¼‰ï¼Œå†é–‹å•“ä»–çš„ç”¨æˆ¶è¨­å®š\nå°‡(3)çš„å…§å®¹å…¨éƒ¨åˆªé™¤å¾Œï¼Œå°‡(2)çš„æª”æ¡ˆè²¼åˆ°ä¸Šé¢\nç„¶å¾Œé»ã€é‡æ–°éƒ¨ç½²ã€\nsquirrel.custom.yaml ä¿®æ”¹ä¸»é¡Œæˆ–é¡è‰²",
		"tags": [ "note","ğŸ"]
},

{
		"title": " ğŸ§ Linux MOC",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/0.Linux MOC/",
		"content": "basic\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/132. shell script é›™å¼•è™Ÿèˆ‡å–®å¼•è™Ÿ/\">132. shell script é›™å¼•è™Ÿèˆ‡å–®å¼•è™Ÿ</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/133. shell scriptå­—ä¸²è™•ç†/\">133. shell scriptå­—ä¸²è™•ç†</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/163.Shellçš„å€åˆ¥åŠæŸ¥è©¢/\">163.Shellçš„å€åˆ¥åŠæŸ¥è©¢</a>\n\nSetting\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/33. centos 7å®‰è£redis æ”¹port/\">33. centos 7å®‰è£redis æ”¹port</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/49.npm èˆ‡ yarn æ¯”è¼ƒ/\">49.npm èˆ‡ yarn æ¯”è¼ƒ</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/116. å®‰è£linux server åŸºæœ¬è¨­å®š/\">116. å®‰è£linux server åŸºæœ¬è¨­å®š</a>\n\nTools\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/16.dustise sleep æ¸¬è©¦å·¥å…·ç°¡ä»‹/\">16.dustise sleep æ¸¬è©¦å·¥å…·ç°¡ä»‹</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/51.curl ç­†è¨˜/\">51.curl ç­†è¨˜</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/65. Linux command - grep/\">65. Linux command - grep</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/93. shellscriptè§£æ/\">93. shellscriptè§£æ</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/108. linux shell é€²éšæŒ‡ä»¤/\">108. linux shell é€²éšæŒ‡ä»¤</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/134. é—œé–‰sshé€£ç·šå¾Œï¼Œä»å¯åŸ·è¡Œç¨‹å¼/\">134. é—œé–‰sshé€£ç·šå¾Œï¼Œä»å¯åŸ·è¡Œç¨‹å¼</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/165. Linuxç¶²è·¯è¿½è¹¤å·¥å…·- MTR/\">165. Linuxç¶²è·¯è¿½è¹¤å·¥å…·- MTR</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/171. linux topæŒ‡ä»¤è©³è§£/\">171. linux topæŒ‡ä»¤è©³è§£</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/173. Linuxæ®­å±ç¨‹å¼/\">173. Linuxæ®­å±ç¨‹å¼</a>\n\nTroubleshooting\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/php exec ssh ç™¼ç”Ÿ Host key verification failed éŒ¯èª¤/\">php exec ssh ç™¼ç”Ÿ Host key verification failed éŒ¯èª¤</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/114. alpine linux å®£å‘Šè®Šæ•¸,error bad variable name/\">114. alpine linux å®£å‘Šè®Šæ•¸,error bad variable name</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/48.SSHç„¡æ³•é€£ç·šï¼ŒREMOTE HOST IDENTIFICATION HAS CHANGED/\">48.SSHç„¡æ³•é€£ç·šï¼ŒREMOTE HOST IDENTIFICATION HAS CHANGED</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/63.alpine linux apk ERROR unable to select packages/\">linuxå®‰è£æ¸¬è©¦package</a>",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "linux shell é€²éšæŒ‡ä»¤",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/108. linux shell é€²éšæŒ‡ä»¤/",
		"content": "ç¢ç¢å¿µ\næˆ‘ä¹Ÿä¸çŸ¥é“é€™ç®—ä¸ç®—é€²éšï¼Ÿ\nä½†å¹³å¸¸æˆ‘æ‡‰è©²ä¸æœƒç”¨ï¼Œæœ¬æ–‡æœ‰\n\nè¨ˆç®—æŸå€‹é–‹é ­çš„tagæ•¸é‡æœ‰å¤šå°‘\nforè¿´åœˆçš„è³‡æ–™å¯«åˆ°æ–‡å­—æª”\nå–å¾—æª”æ¡ˆè©³ç´°æ™‚é–“\nå–å¾—æª”æ¡ˆåˆ—è¡¨å¾Œåˆªé™¤\nxargs åƒæ•¸\nåªé¡¯ç¤ºè³‡æ–™å¤¾\nåªé¡¯ç¤ºæª”æ¡ˆ\nlsåƒæ•¸\nè¨ˆç®—ç›®éŒ„åº•ä¸‹çš„æª”æ¡ˆæ•¸\næŸ¥è©¢ä½¿ç”¨è€…\næ¶ˆè€—æœ€å¤šCPUçš„process\n\næ­£æ–‡\nè¨ˆç®—æŸå€‹é–‹é ­çš„tagæ•¸é‡æœ‰å¤šå°‘\nfor tag in $(git tag --sort -version:refname -l &quot;1.1.*&quot;); do\necho $tag;\nlet i++\ndone\necho $i;\nunset i;\n\nforè¿´åœˆçš„è³‡æ–™å¯«åˆ°æ–‡å­—æª”\nfor i in {20221201..20221202}\ndo\nfor j in {00..01}\ndo\necho &quot;mkdir $i$j&quot;\ndone\ndone &gt; 1.txt\n\nå–å¾—æª”æ¡ˆè©³ç´°æ™‚é–“\nls --full-time | sort -k6\nor\nstat file.txt\n\nå–å¾—æª”æ¡ˆåˆ—è¡¨å¾Œåˆªé™¤\nls | grep 4793877c | xargs -p rm -f\n\nxargs åƒæ•¸\n\n-I {} å°‡æŒ‡ä»¤å¸¶åˆ°å¾Œé¢çš„{}åŸ·è¡Œ\n\nls nfs | head -10 | xargs -t -I {} ls nfs/{}\n\n-t é¡¯ç¤ºåŸ·è¡Œçš„æŒ‡ä»¤\n-p åŸ·è¡Œå‰çš„ç¢ºèª\n\nref.\n\nLinux ç³»çµ± xargs æŒ‡ä»¤ç¯„ä¾‹èˆ‡æ•™å­¸\nLinux xargs å‘½ä»¤\n\nåªé¡¯ç¤ºè³‡æ–™å¤¾\nls -l | grep\n{ #d}\n# åˆ©ç”¨è©³ç´°è³‡è¨Šï¼Œåˆ¤æ–·é–‹é ­æ˜¯ä¸æ˜¯ d(directory)\nls -d */\nls -F | grep \\/$ # æª”æ¡ˆåç¨±çš„æœ€å¾Œå¦‚æœæœ‰/è¡¨ç¤ºæ˜¯folder\n\nåªé¡¯ç¤ºæª”æ¡ˆ\nls -F /etc | grep -v '/$'\n\nlsåƒæ•¸\n\n-l é¡¯ç¤ºæª”æ¡ˆèˆ‡ç›®éŒ„çš„è©³ç´°è³‡è¨Š\n-a é¡¯ç¤ºéš±è—çš„æª”æ¡ˆèˆ‡ç›®éŒ„\n-h è¼¸å‡ºçš„è³‡è¨Šä»¥æ¯”è¼ƒå®¹æ˜“é–±è®€çš„æ ¼å¼å‘ˆç¾\n-F æª”æ¡ˆåç¨±çš„å¾Œé¢åŠ ä¸Šæª”æ¡ˆé¡å‹çš„æ¨™ç¤ºå­—å…ƒ\n-r æª”æ¡ˆçš„åˆ—è¡¨ä»¥åå‘çš„æ’åºåˆ—å‡º\n-R ç”¨éè¿´çš„æ–¹å¼åˆ—å‡ºæ‰€æœ‰å­ç›®éŒ„çš„æª”æ¡ˆ\n-S æª”æ¡ˆä¾ç…§æª”æ¡ˆçš„å¤§å°ä¾†æ’åº\n-d åªåˆ—å‡ºç›®éŒ„ï¼Œå¾Œé¢ä¸åŠ ä¸Š*/ ç„¡æ³•é¡¯ç¤º\n--full-time é¡¯ç¤ºå®Œæ•´æ™‚é–“\n\nè¨ˆç®—ç›®éŒ„åº•ä¸‹çš„æª”æ¡ˆæ•¸\nÂ find ./ -type f -name *.*| wc -l\n\nfind [obj_directory] [-type f] [-name filename]\nfindåƒæ•¸èªªæ˜ï¼š\nobj_directoryï¼šè¦æœå°‹çš„è·¯å¾‘\n-typeï¼šè¦æœå°‹çš„é¡å‹ï¼Œf=æª”æ¡ˆï¼Œd=ç›®éŒ„\n-inameï¼šä¸å€åˆ†å¤§å°å¯«\n-nameï¼šå¾Œé¢æ¥æª”åï¼Œå¯åŠ è¬ç”¨å­—å…ƒ(*)ï¼Œæœå°‹é¡ä¼¼æª”åçš„æª”æ¡ˆ\nwc [-l]\nwcåƒæ•¸èªªæ˜ï¼š\n-c: çµ±è¨ˆä½å…ƒçµ„æ•¸\n-lï¼šçµ±è¨ˆè¡Œæ•¸\n-mï¼šçµ±è¨ˆå­—å…ƒæ•¸ã€‚ä¸èƒ½èˆ‡Â -c ä¸€èµ·ä½¿ç”¨ã€‚\n-wÂ çµ±è¨ˆå­—æ•¸ã€‚ä¸€å€‹å­—è¢«å®šç¾©ç‚ºç”±ç©ºç™½ã€è·³æ ¼æˆ–æ›è¡Œå­—å…ƒåˆ†éš”çš„å­—ä¸²ã€‚\n-LÂ åˆ—å°æœ€é•·è¡Œçš„é•·åº¦ã€‚\n-helpÂ é¡¯ç¤ºèª¬æ˜è³‡è¨Šã€‚\nref.\n[Linux] è¨ˆç®—ç›®éŒ„åº•ä¸‹çš„æª”æ¡ˆæ•¸\næŸ¥æ‰€æœ‰ä½¿ç”¨è€…\ncat /etc/passwd | awk -F: '{print $1}'\n\nref. How To List Users and Groups on Linux\nåˆªé™¤ä½¿ç”¨è€…\nuserdel -r &lt;userID&gt;\n\nref. [GCP]é‡åˆ°permission denied (publickey)æ€éº¼è¾¦ï¼Ÿ\nref.\n\nLinux çš„ ls æŒ‡ä»¤æ•™å­¸èˆ‡å¸¸ç”¨ç¯„ä¾‹æ•´ç†\nç®¡ç·š/é‡æ–°å°å‘\n\nlinuxä½•æ™‚å®‰è£\nstat / | awk '/Birth: /{print $2 &quot; &quot; substr($3,1,5)}'\n\nref. Linux Installation Date: How to Discover Your Systemâ€™s Age\n\nconditionæ¢ä»¶åˆ¤æ–·\n\nif [[ ! -d &quot;$1&quot; ]]; then\nmkdir -p &quot;$1&quot;\nfi\n\nå¯ä»¥ä½¿ç”¨ å…©å€‹ [[ æˆ– ä¸€å€‹ [ ï¼Œ\nä»£è¡¨çš„æ„æ€å·®ä¸å¤šï¼Œåªæ˜¯å…©å€‹ [ ç®—æ˜¯æ–°ç‰ˆç”¨æ³•ï¼Œ\nä»–å¯ä»¥å¤šåšå­—ä¸²çš„æ¯”è¼ƒæ“ä½œ== , != ,=~ ã€‚\n-d æ˜¯ä¸€å€‹æ¢ä»¶æ¸¬è©¦æ¨™èªŒï¼Œæª¢æŸ¥æ˜¯å¦ç‚ºç›®éŒ„\nå…¶ä»–çš„ç›¸ä¼¼çš„æ¨™èªŒå¦‚ä¸‹\n\n-d ï¼Œç”¨æ–¼æª¢æŸ¥æŒ‡å®šè·¯å¾‘æ˜¯å¦ç‚ºç›®éŒ„ã€‚\n-fï¼šæª¢æŸ¥æŒ‡å®šè·¯å¾‘æ˜¯å¦ç‚ºæ™®é€šæª”æ¡ˆã€‚\n-xï¼šæª¢æŸ¥æª”æ¡ˆæ˜¯å¦å¯åŸ·è¡Œã€‚\n-rï¼šæª¢æŸ¥æª”æ¡ˆæ˜¯å¦å¯è®€ã€‚\n-wï¼šæª¢æŸ¥æª”æ¡ˆæ˜¯å¦å¯å¯«ã€‚\n-sï¼šæª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨ä¸”å¤§å°ä¸ç‚ºé›¶ã€‚\n-eï¼šæª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨ã€‚\n\nfunction å»ºç«‹\nfunction bindmount() {\nif [[ ! -d &quot;$1&quot; ]]; then\nmkdir -p &quot;$1&quot;\nfi\n\nchown -R :100 &quot;$1&quot; &quot;$2&quot;\n\tmount --bind &quot;$1&quot; &quot;$2&quot;\n}\n\nbindmount &quot;/home/mike/upload&quot; &quot;/home/bms/mike&quot;\n\nå‚³åƒæ•¸é€²å»æ™‚ï¼Œè¨˜å¾—åœ¨å¾Œé¢åŠ ä¸Š&quot; é›™å¼•è™Ÿï¼ŒåŒ…èµ·ä¾†ï¼Œ\né¿å…ä¸­é–“æœ‰ç‰¹åˆ¥çš„å­—å…ƒå°è‡´ï¼Œè¼¸å…¥å¤±æ•—ã€‚\nç¨å¾®æä¸€ä¸‹ï¼Œmount --bind å‰é¢æ˜¯ä¾†æº ï¼Œå¾Œé¢æ˜¯ç›®çš„ã€‚\næˆ‘ä¸å¤ªæ‡‚GPTçš„å›ç­”\n\næ¶ˆè€—æœ€å¤šCPUçš„process\nps H -eo pid,pcpu | sort -nk2 | tail\n\nå°æ‡‰çš„æœå‹™åç¨±\nps aux | fgrep &lt;PID&gt;",
		"tags": ["d", "note","ğŸ§"]
},

{
		"title": "alpine linux å®£å‘Šè®Šæ•¸,error bad variable name",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/114. alpine linux å®£å‘Šè®Šæ•¸,error bad variable name/",
		"content": "ç¢ç¢å¿µ\né ­ä¸€æ¬¡ç¢°åˆ°é€™ç¨®å‘ï¼Œ\næˆ‘linuxæœ‰å¾…åŠ å¼· ï¼ˆå“­\næ­£æ–‡\nå…ˆçœ‹åŸ·è¡Œçµæœï¼Œ\nè®Šæ•¸å¾Œé¢ä¸èƒ½æ¥ç©ºæ ¼ï¼Œä¸ç„¶æœƒå‡ºç¾éŒ¯èª¤ã€‚\nç­‰è™Ÿå¾Œé¢ä¹Ÿä¸èƒ½æ¥ç©ºæ ¼ï¼Œä¸ç„¶æœƒå‡ºç¾éŒ¯èª¤ã€‚\nå¹³å¸¸ç¨‹å¼å¯«å¤ªé †ï¼Œéƒ½ç¿’æ…£æŒ‰ç©ºæ ¼äº†ï¼Œ\nçµæœ....\n/ # export ab = &quot;hello world&quot;\nsh: export: : bad variable name\n/ # EXPORT ab = &quot;hello world&quot;\nsh: EXPORT: not found\n/ # export ab=&quot;helloworld&quot;\n/ # echo $ab\nhelloworld\n/ # export ab = &quot;helloworld&quot;\nsh: export: : bad variable name\n/ # export ab =&quot;helloworld&quot;\nsh: export: : bad variable name\n/ # export ab= &quot;helloworld&quot;\n/ # echo $ab\nhelloworlda",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "å®‰è£linux server åŸºæœ¬è¨­å®š",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/116. å®‰è£linux server åŸºæœ¬è¨­å®š/",
		"content": "ç¢ç¢å¿µ\nå¥½ä¹…æ²’å¼„ubuntuäº†ï¼Œæœ‰äº›é è¨­è¦è¨­å®šçš„æ±è¥¿ï¼Œ\né‚„çœŸçš„ä¹…æ²’ç”¨å°±å¿˜è¨˜ï¼Œ\nç­†è¨˜ç­†è¨˜ã€‚\næ­£æ–‡\n\næ–°å¢ä½¿ç”¨è€…\n\nsudo useradd it\n\nä¿®æ”¹å¯†ç¢¼\n\nsudo passwd it\n\nref. Linux æ–°å¢ä½¿ç”¨è€… useradd æŒ‡ä»¤ç”¨æ³•æ•™å­¸èˆ‡ç¯„ä¾‹\n\næŒ‡å®šå¸³è™Ÿï¼Œè¼¸å…¥sudoå…å¯†ç¢¼\n\necho &quot;username ALL=(ALL) NOPASSWD: ALL&quot; &gt; /etc/sudoers.d/username\n\nref. ç¬¬8ç« ï¼šç®¡ç†æœ¬åœ°ç«¯ä¸»æ©Ÿä¹‹ä½¿ç”¨è€…èˆ‡ç¾¤çµ„(äºŒ)\n\næ›´æ”¹å›ºå®šipï¼Œä¿®æ”¹è£é¢çš„æª”æ¡ˆ *.network-manager-all.yaml\n\ncd /etc/netplan/\n\nnetwork:\nversion: 2\nrenderer: NetworkManager\nethernets:\nens33:\ndhcp4: no\naddresses: [192.168.103.231/24]\ngateway4: 192.168.0.1\nnameservers:\naddresses: [8.8.8.8,8.8.4.4]\n\nå®Œæˆå¾Œï¼Œå…ˆæ¸¬è©¦\nsudo netplan try\n\nref. [Ubuntu] è¨­å®šå›ºå®šip\n\nä¸€èˆ¬ä½¿ç”¨è€…åŸ·è¡Œdocker\n\nsudo usermod -a -G docker ${USER}\n\nåŸ·è¡Œå®Œå¾Œï¼Œéœ€é‡æ–°ç™»å…¥",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "shell script é›™å¼•è™Ÿèˆ‡å–®å¼•è™Ÿ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/132. shell script é›™å¼•è™Ÿèˆ‡å–®å¼•è™Ÿ/",
		"content": "ç¡ç¡å¿µ\næœ€è¿‘å¯«CI/CDï¼Œç¢°åˆ°ä¸€å †shell scriptçš„æŒ‡ä»¤ï¼Œ\nä»¥å‰éƒ½æ˜¯try errorä¸€è·¯è©¦éå»çš„ï¼Œ\næ²’ç¢°åˆ°ä»€éº¼å¤ªå¤§å•é¡Œï¼Œç›´åˆ°ç¾åœ¨é‚£ä¸€é•·ä¸²ï¼Œæˆ‘æ‰çµ‚æ–¼ç™¼ç˜‹ã€‚\næ­£æ–‡\nç°¡å–®èªªæ³•\nshell scriptçš„ å–®å¼•è™Ÿ ã€ ' ã€æ‹¬èµ·ä¾†çš„å­—ï¼Œ\næœƒä¿ç•™å¼•è™Ÿå…§æ¯å€‹å­—å…ƒï¼Œå°±æ˜¯èªªè£é¢çš„è®Šæ•¸ä¸æœƒè®Šã€‚\nabc=&quot;a&quot;\necho '$abc';\n\nå°±æ˜¯å°å‡º\n\n$abc\n\nè€Œé›™å¼•è™Ÿ ã€ &quot; ã€ æ‹¬èµ·ä¾†çš„å­—ï¼Œ\nä¸æœƒä¿ç•™å¼•è™Ÿå…§çš„å­—å…ƒï¼Œå°±æ˜¯èªªè£é¢çš„è®Šæ•¸æœƒè·Ÿç€è®Š\nabc=a\necho &quot;$abc&quot;\n\nå°å‡º\n\na\n\næ‰€ä»¥çœ‹èµ·ä¾†æœƒåƒé€™æ¨£\n\nå¦‚æœè®Šæˆå–®å¼•è™ŸåŒ…é›™å¼•è™Ÿï¼Œæˆ–æ˜¯ é›™å¼•è™ŸåŒ…å–®å¼•è™Ÿ\necho '&quot;$abc&quot;'\necho &quot;'$abc'&quot;\n\n$abc\n'a'\n\nè©³ç´°èªªæ³•\nå–®å¼•è™Ÿï¼š\nshell å°‡é€å­—è§£é‡‹å–®å¼•è™Ÿå…§çš„å°é–‰æ–‡å­—ï¼Œä¸¦ä¸”ä¸æœƒæ’å…¥ä»»ä½•å…§å®¹ï¼ŒåŒ…æ‹¬è®Šæ•¸ã€åå¼•è™Ÿã€æŸäº› \\ è½‰ç¾©ç¬¦ç­‰ï¼Œæ‰€æœ‰å­—å…ƒéƒ½æœƒç¶­æŒåŸå§‹å­—é¢æ„ç¾©\né›™å¼•è™Ÿï¼š\nå…è¨± shell è§£é‡‹ç¾å…ƒç¬¦è™Ÿ ( $ )ã€åå¼•è™Ÿ ( ` )ã€åæ–œæ§“ ( \\ ) å’Œé©šå˜†è™Ÿ (ï¼ï¼‰ï¼Œ é€™äº›å­—å…ƒèˆ‡é›™å¼•è™Ÿä¸€èµ·ä½¿ç”¨æ™‚å…·æœ‰ç‰¹æ®Šå«ç¾©ï¼Œä¸¦ä¸”åœ¨é¡¯ç¤ºä¹‹å‰å°å…¶é€²è¡Œè©•ä¼°\nref.\n\nBash ç¨‹å¼è¨­è¨ˆæ•™å­¸èˆ‡ç¯„ä¾‹ï¼šå–®å¼•è™Ÿã€é›™å¼•è™Ÿã€è·³è„«å­—å…ƒ\nçµ‚æ–¼çŸ¥é“ Shell ä¸­å–®å¼•è™Ÿé›™å¼•è™Ÿçš„å€åˆ¥äº†\n\np.s ä¸Šé¢å®£å‘Šçš„ abc å«åšæœ¬åœ°è®Šæ•¸(local variable)ï¼Œ\nå¦‚æœç”¨ä¸Šäº†export å‰‡æ˜¯ ç’°å¢ƒè®Šæ•¸(environment variable)\nå¸¸è¦‹è®Šæ•¸éŒ¯èª¤\nA = B #=è™Ÿå‰å¾Œä¸èƒ½æœ‰ç©ºæ ¼\n1A=B #è®Šé‡åç¨±ä¸èƒ½ä»¥æ•¸å­—é–‹é ­\n$A=B #è®Šé‡çš„åç¨±è£¡æœ‰$\na=B #é€™è·Ÿa=bæ˜¯ä¸åŒçš„\n\nref. shellåä¸‰å•ä¹‹5:å•var=value åœ¨exportå‰å¾Œçš„å·®åœ¨å“ª?",
		"tags": ["è®Šé‡åç¨±ä¸èƒ½ä»¥æ•¸å­—é–‹é ­", "è®Šé‡çš„åç¨±è£¡æœ‰", "é€™è·Ÿa", "note","ğŸ§"]
},

{
		"title": "shell scriptå­—ä¸²è™•ç†",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/133. shell scriptå­—ä¸²è™•ç†/",
		"content": "ç¡ç¡å¿µ\nshell scriptçš„å­—ä¸²è™•ç†ï¼ŒåŸæœ¬ä»¥çˆ²åªèƒ½ç”¨grep è·Ÿ awk èµ°pipelineä¾†ç”¨ï¼Œ\nåŸä¾†é‚„èƒ½ç›´æ¥é€é${} ä¾†è™•ç†ï¼Œshell scriptçš„æ°´å¥½æ·±é˜¿...\næ­£æ–‡\nä¾†å€‹ä¾‹å­ï¼Œ\næœ‰å€‹tag å« dev_1.1.23 ï¼Œæˆ‘åªè¦å¾Œé¢çš„ç‰ˆè™Ÿå°±å¥½ï¼Œè©²æ€éº¼åšã€‚\næœ¬ä¾†åšæ³•\n#!/bin/bash\nset -x\nabc=&quot;dev_1.1.23&quot;\necho $abc|grep -o '\\d.\\d.\\d.'\n\nåˆ©ç”¨ grep å–å€¼ï¼Œä¸¦åªé¡¯ç¤ºç¬¦åˆæ­£å‰‡çš„å­—ä¸²ï¼Œ æ‰€ä»¥è¦ç”¨ -o\n\n1.1.23\n\nå¦‚æœæ”¹ç”¨${}çš„æ–‡å­—éè²ªå©ªå·¦åˆªé™¤\n#!/bin/bash\nset -x\nabc=&quot;dev_1.1.23&quot;\necho ${abc#*_}\n\n1.1.23\n\né™¤äº†å·¦åˆªé™¤ï¼Œä¹Ÿèƒ½åšåˆ°å³åˆªé™¤\n# å°æ¯”å°å·¦\n## å¤§æ¯”å°å·¦\n% å°æ¯”å°å³\n%% å¤§æ¯”å°å³\n* ç”¨ä¾†æ¯”å°ç„¶å¾Œåˆªé™¤\n\nps.\nset -x æ˜¯å±¬æ–¼xtraceçš„æ‡‰ç”¨ï¼Œç”¨ä¾†é™¤éŒ¯çš„ã€‚\nä¹Ÿå¯ä»¥åœ¨åŸ·è¡Œçš„æ™‚å€™ï¼ŒåŠ ä¸Š bash -x curl.sh ï¼Œ\né€™æ¨£ä½¿ç”¨\nè©³ç´°åƒè€ƒShell scriptå‰è¨€\nref. Linux Shell æŒ‡ä»¤ç¢¼ä¸­ ${} ç”¨æ³•",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "é—œé–‰sshé€£ç·šå¾Œï¼Œä»å¯åŸ·è¡Œç¨‹å¼",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/134. é—œé–‰sshé€£ç·šå¾Œï¼Œä»å¯åŸ·è¡Œç¨‹å¼/",
		"content": "ç¡ç¡å¿µ\næ€éº¼æœ€è¿‘éƒ½åœ¨æshell scripté˜¿..\né€™æ¬¡æ˜¯è¦æŠŠgceçš„åœ–ç‰‡æ¬åˆ°gcsä¸Šé¢ï¼Œ\nç¸½è¨ˆæœ‰ä¸‰è¬å¤šå¼µï¼Œä¸€èˆ¬åŸ·è¡Œæ™‚ï¼Œå¦‚æœç¢°åˆ°sshæ–·ç·šï¼ŒåŸ·è¡Œå°±å¤±æ•—äº†ï¼Œ\næ‰€ä»¥è¦è®“ä»–å°±ç®—sshæ–·ç·šï¼Œä¹Ÿä»æœƒåŸ·è¡Œ\næ­£æ–‡\nç›®å‰æœ‰å…©ç¨®æ–¹å¼\n\nnohup\nç®—æ˜¯æœ€ç°¡å–®ï¼Œå®¹æ˜“ç”¨çš„æ–¹å¼ï¼Œç›´æ¥ åœ¨å¾Œé¢æ¥commandå°±èƒ½ç”¨äº†ï¼Œ\nä½†æˆ‘ç¦®æ‹œäº”æ›ç€ï¼Œç„¶å¾Œç¦®æ‹œä¸€å›ä¾†çœ‹ï¼Œç™¼ç¾ç¨‹å¼æ›äº†ï¼Œcpué‚„é£†åˆ°100ï¼Œ\nå°±ç®—ç”¨ æŒ‡ä»¤æ‰¾åˆ°pidå¾Œï¼Œå¼·åˆ¶åˆªé™¤ï¼Œé‚„æ˜¯æœ‰commandåœ¨åŸ·è¡Œï¼Œæœ€å¾Œåªèƒ½é‡é–‹ã€‚\n\n\tps -aux | grep &quot;copyfile.sh&quot;\n\tkill -9 &lt;PID&gt;\n\nref. SSH é ç«¯ç™»å‡ºå¾Œç¹¼çºŒåŸ·è¡Œ\n\nscreen\nyumç›´æ¥æœå°‹æœƒæ‰¾ä¸åˆ°packageï¼Œéœ€è¦å…ˆé¡å¤–å®‰è£epel-release\n\nyum install epel-release\nyum install screen\n\nä½¿ç”¨æ–¹å¼\nå…ˆå»ºç«‹ä¸€å€‹screen\nå¯æŒ‡å®šåç¨±\nscreen -S &lt;name&gt;\n\nåœ¨screenè£é¢ï¼ŒåŸ·è¡Œç¨‹å¼ï¼Œé›¢é–‹æ™‚æŒ‰\nctrl+a -&gt; ctrlï¼ˆä¸æ”¾ï¼‰+d\n\næŸ¥çœ‹ç›®å‰æœ‰å“ªäº› screen\nscreen -ls\n\nå›åˆ°å‰›å‰›çš„screenï¼Œå¯ä»¥ä¸Šé¢æŒ‡ä»¤çœ‹åˆ°é€™å€‹screençš„idæ˜¯58245ã€‚\nscreen -r 58245\n\nref.\n\nã€Linuxã€‘screenè§£æ±ºé€€å‡ºçµ‚ç«¯æœƒè©±çµæŸå•é¡Œ\nå­¸æœƒä½¿ç”¨Screen,ä¸å†æ€•SSHä¸­æ–· Linuxï¼ˆCentos 7ï¼‰",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "blog-16.dustise sleep æ¸¬è©¦å·¥å…·ç°¡ä»‹",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/16.dustise sleep æ¸¬è©¦å·¥å…·ç°¡ä»‹/",
		"content": "å‰è¨€\nä¹‹å‰å°±æœ‰ç”¨é dustise/sleep ï¼Œç”¨for è¿´åœˆä¾†æ‰“ ç¶²å€åšæ¸¬è©¦ï¼Œ\nä»Šå¤©æƒ³èªªé‚£è£¡é¢çš„httpåˆ°åº•æ˜¯å“ªä¸€å¥—å·¥å…·ï¼Œæ‰ç™¼ç¾åŸä¾†è£¡é¢æœ‰é‚£éº¼å¤šçš„å·¥å…·èƒ½ç”¨ã€‚\n2021.03.18æ›´æ–°ï¼šåˆæ‰¾åˆ°äº†å¹¾æ¬¾ä¸éŒ¯ç”¨çš„å·¥å…·ï¼ŒåŒæ­¥å¢åŠ \næ­£æ–‡\nè£¡é¢çš„å·¥å…·åˆ—è¡¨ï¼Œå¯ä»¥åƒè€ƒä»–çš„gitï¼Œ\nç„¶å¾Œæˆ‘å€‘çœ‹åˆ°ä»–çš„dockerfile,è£¡é¢æœ‰\nbind-tools curl wrk vim\ntcptraceroute iptables httpie bash\ntini apache2-utils stress-ng strace\né€™æ¬¡æœƒæŠ“å¹¾å€‹è¨˜éŒ„ä¸€ä¸‹\n\nbind-tools\nå®‰è£nslookupç”¨ï¼Œå¯æŸ¥è©¢åŸŸå\n\nnslookup tw.yahho.com\n2. curl\nå–å¾—ç¶²é è³‡æ–™\ncurl ifconfig.me\nåƒæ•¸å¾ˆå¤šï¼Œé€šå¸¸æœƒä½¿ç”¨postmanå°‡è¦æˆªå–çš„è³‡æ–™è½‰æˆcurlï¼Œå†åˆ°commandåšæ¸¬è©¦ã€‚\nå¦‚æœåªæ˜¯è¦ç°¡å–®æ¸¬è©¦ï¼Œå¯ä»¥åŠ ä¸Š -v çœ‹è©³ç´°å…§å®¹\n3. wrk\næ¨¡æ“¬å¤šäººä¾†ç¶²ç«™æ™‚çš„æ•ˆèƒ½ï¼Œæœ‰é»åƒå£“åŠ›æ¸¬è©¦å·¥å…·ã€‚\nwrk -t12 -c400 -d30s -T30s --latency http://localhost/productpage\n# -t12 ç”¨ 12 å€‹ç·šç¨‹\n# -c400 æ¨¡æ“¬ 400 å€‹ä½µç™¼é€£æ¥\n# -d30s æŒçºŒ 30 ç§’\n# -T30s è¨­å®šè¶…é 30 ç§’å°±ç®—é€£æ¥è¶…æ™‚\n# --latency éŸ¿æ‡‰æ™‚é–“çš„åˆ†ä½ˆæƒ…æ³\n\n<a class=\"internal-link is-unresolved\" href=\"/404\">[16.fig-1.jpg</a>\n\nLatency: éŸ¿æ‡‰æ™‚é–“\nReq/Sec: æ¯å€‹ç·šç¨‹æ¯ç§’é˜çš„å®Œæˆçš„è«‹æ±‚æ•¸\nAvg: å¹³å‡å€¼\nStdev (Standard Deviation): å³æ¨™æº–åå·®ï¼Œæ˜¯çµ±è¨ˆå­¸çš„ä¸€å€‹åè©ï¼Œé€™è£¡è¡¨ç¤ºè«‹æ±‚éŸ¿æ‡‰æ™‚é–“çš„é›¢æ•£ç¨‹åº¦ï¼Œå€¼è¶Šå¤§ä»£è¡¨è«‹æ±‚éŸ¿æ‡‰æ™‚é–“çš„å·®è·è¶Šå¤§ï¼Œç³»çµ±çš„éŸ¿æ‡‰ç´„ä¸ç©©å®šã€‚\nMax: æœ€å¤§å€¼\n+/- Stdev: æ­£è² ä¸€å€‹æ¨™æº–å·®ä½”æ¯”\nLatency Distribution: 50% åœ¨ 3.23s ä»¥å…§å®Œæˆ / 99% åœ¨ 22.27s ä»¥å…§å®Œæˆ\nSocket errors: åˆ†ç‚º é€£æ¥éŒ¯èª¤, è®€å–éŒ¯èª¤, å¯«å…¥éŒ¯èª¤, è¶…æ™‚éŒ¯èª¤\nRequests/sec: æ¯ç§’è«‹æ±‚æ•¸é‡ï¼Œä¹Ÿå°±æ˜¯ä¸¦ç™¼èƒ½åŠ›\n\næ›´è©³ç´°çš„èªªæ˜ï¼Œè«‹åƒè€ƒï¼šHTTP Benchmark å·¥å…· Wrk\n\nvim\næ–‡å­—ç·¨è¼¯å™¨ï¼Œå°±ä¸ä»‹ç´¹äº†ã€‚\n\ntcptraceroute\nè·¯ç”±è¿½è¹¤å™¨ï¼Œè¿½è¹¤ç¶²è·¯æ­»åœ¨å“ªä¸€å±¤\n\ntraceroute tw.yahoo.com\n\niptables\nè·¯ç”±è¡¨\n\nhttpie\nä¹‹å‰ä½¿ç”¨\nfor i in seq 20;do http --body http://ipaddress/api/v1/Health/health; done;\næ‰“ç¶²å€çš„æŒ‡ä»¤ã€‚\nhttpie æ˜¯ä¸€å€‹ HTTP çš„å‘½ä»¤è¡Œå®¢æˆ¶ç«¯ã€‚å…¶ç›®æ¨™æ˜¯è®“ CLI å’Œ web æœå‹™ä¹‹é–“çš„äº¤äº’å„˜å¯èƒ½çš„äººæ€§åŒ–ã€‚\næƒ³ç”¨ä¾†å–ä»£wget ,curl ç­‰åŠŸèƒ½ï¼Œç„¶å¾Œç•«é¢æ¯”è¼ƒç¾è§€ï¼Œå¦‚æœå›ä¾†çš„æ˜¯jsonï¼Œé‚£å·®ç•°æœƒæ›´å¤§ã€‚\n\n[[16.fig-2.jpg]]\nä¸‹è¼‰\nhttp --download example.org/file\nåªçœ‹header\nhttp -h http://ipaddress/productpage\nref.\nHTTPie:è¶…çˆ½çš„HTTPå‘½ä»¤è¡Œå®¢æˆ¶ç«¯\nHTTPie å®˜æ–¹æ–‡æª”ä¸­æ–‡ç¿»è­¯ç‰ˆ\n\nåŒå ´åŠ è¨»\njid\nhttps://github.com/simeji/jid\njq\nhttps://stedolan.github.io/jq/manual/#Basicfilters\nhey\nhttps://github.com/rakyll/hey\ne.g. åŠ ä¸Š method ,content/type ,dataraw\nhey -z 3m -q 10 -c 3 -m POST -T 'application/json' -d '{ &quot;method&quot;: &quot;GetUrlForWard&quot;, &quot;host&quot;: &quot;landing500023.com&quot;}' https://landing500023.com/query.php",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "Shellçš„å€åˆ¥åŠæŸ¥è©¢",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/163.Shellçš„å€åˆ¥åŠæŸ¥è©¢/",
		"content": "å‰è¨€\nåœ¨æ¸¬è©¦gcloudå®‰è£å¾Œï¼Œé‚„æ˜¯æ‰¾ä¸åˆ°gcloud command ï¼Œ\næ–¼æ˜¯é–‹å§‹äº†æª¢æŸ¥ä¹‹è·¯ã€‚\næ­£æ–‡\nç†Ÿlinuxçš„æ‡‰è©²éƒ½çŸ¥é“shåªæ˜¯å€‹ä»£ç¨±ï¼Œä½ çš„shæ˜¯bash ã€ zsh æˆ– dashï¼Œ\néƒ½æœ‰å¯èƒ½ã€‚\næ‰€ä»¥åˆ¤æ–·ä½ çš„shæ˜¯å“ªä¸€ç¨®\necho $SHELL\n\nç„¶å¾Œä½ çš„shæœƒæ±ºå®šä½ çš„è¨­å®šæª”åç¨±æ˜¯å“ªä¸€å€‹ã€‚\nä¾‹å¦‚\nbash =&gt; ~/.bashrc\nzsh =&gt; ~/.zshrc\n\nå¦‚æœæŒ‡ä»¤æ–°å¢å¾Œï¼Œä¸æƒ³é‡å•“Terminalçš„è©±ï¼Œ\nå¯ä½¿ç”¨ä¸‹é¢æŒ‡ä»¤ï¼Œå°‡è¢«æŒ‡å®šç›®éŒ„çš„bashè®€å…¥ç›®å‰çš„ç’°å¢ƒä¸­ã€‚\nsource ~/.bashrc\n\nref.\n\ngcloud command not found - while installing Google Cloud SDK",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "Linuxè·¯ç”±è¿½è¹¤å·¥å…·",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/165. Linuxç¶²è·¯è¿½è¹¤å·¥å…·- MTR/",
		"content": "mtr\n\nMTR åœ¨ä¸€é–‹å§‹æœƒé‡å°æŒ‡å®šçš„ä¸»æ©Ÿï¼Œä»¥Â tracerouteÂ æ‰¾å‡ºä¸­é–“çš„æ¯ä¸€å€‹ç¶²è·¯ç¯€é»ï¼ˆé–˜é“å™¨ã€è·¯ç”±å™¨ã€æ©‹æ¥å™¨ç­‰ï¼‰ï¼Œç„¶å¾Œä½¿ç”¨Â pingÂ å»æª¢æŸ¥æ¯ä¸€å€‹ç¯€é»çš„ç¶²è·¯é€£ç·šç‹€æ³\n\nè£œå……ï¼Œtraceroute -P -t 1935 &lt;ip&gt; å¯é€éæŒ‡å®športæ¸¬è©¦é€£ç·š\nå®‰è£æ–¹å¼\n# Debian/Ubuntu\nsudo apt install mtr\n\n# RHEL/CentOS/Fedora\nsudo yum install mtr\n\n# MAC\nbrew install mtr\n\nMACå®‰è£å¾Œï¼Œç„¡æ³•åŸ·è¡Œï¼Œå› çˆ²å®‰è£çš„è·¯å¾‘æ˜¯åœ¨ /usr/local/sbinåº•ä¸‹ï¼Œ\næ‰¾å°‹è‡ªå·±çš„shell<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/163.Shellçš„å€åˆ¥åŠæŸ¥è©¢/\">163.Shellçš„å€åˆ¥åŠæŸ¥è©¢</a>ï¼Œå¢åŠ æŒ‡å®šè·¯å¾‘\nvim ~/.bash_profile\nexport PATH=$PATH:/usr/local/sbin\n\nä½¿ç”¨ sudo åŸ·è¡Œ\nsudo mtr -c 5 -wbr https://daimom.vercel.app &gt; output.txt\n\nåƒæ•¸ä»‹ç´¹\n\nmtr -h æä¾›å¹«åŠ©å‘½ä»¤\n\nmtr -v é¡¯ç¤ºmtrçš„ç‰ˆæœ¬è³‡è¨Š\n\nmtr -r ä»¥å ±å‘Šæ¨¡å¼é¡¯ç¤º\n\nmtr -s ç”¨ä¾†æŒ‡å®špingå°åŒ…çš„å¤§å°\n\nmtr -n no-dnsä¸å°IPåœ°å€åšåŸŸåè§£æ\n\nmtr -a ä¾†è¨­å®šå‚³é€å°åŒ…çš„IPåœ°å€ é€™å€‹å°ä¸€å€‹ä¸»æ©Ÿç”±å¤šå€‹IPåœ°å€æ˜¯æœ‰ç”¨çš„\n\nmtr -i ä½¿ç”¨é€™å€‹åƒæ•¸ä¾†è¨­å®šICMPè¿”å›ä¹‹é–“çš„è¦æ±‚é»˜èªæ˜¯1ç§’\n\nmtr -4 IPv4\n\nmtr -6 IPv6\n\nmtr -c è¨­å®šæ¯ç§’å‚³é€å°åŒ…çš„æ•¸é‡\n\nmtr -T ä½¿ç”¨TCPé€£ç·š\n\nmtr -P æŒ‡å®šport\n\næ•¸æ“šæ‰€ä»£è¡¨çš„æ„æ€\nä»¥ä¸‹æ˜¯å„å€‹è‹±æ–‡å­—æ¯æ‰€ä»£è¡¨çš„æ¬„ä½ï¼š\nRTT (Round Trip Time) äº¦å¯ç¨±ç‚ºå¾€è¿”æ™‚é–“\n\nLï¼šå°åŒ…éºå¤±ç‡ï¼ˆLoss ratioï¼‰ã€‚\nDï¼šå°åŒ…éºå¤±æ•¸ï¼ˆDropped packetsï¼‰ã€‚\nRï¼šå°åŒ…æ¥æ”¶æ•¸ï¼ˆReceived packetsï¼‰ã€‚\nSï¼šå°åŒ…ç™¼é€æ•¸ï¼ˆSent Packetsï¼‰ã€‚\nNï¼šæœ€æ–°çš„ RTTï¼ˆNewest RTTï¼Œå–®ä½ç‚º msï¼‰ã€‚\nBï¼šæœ€ä½³çš„ RTTï¼ˆMin/Best RTTï¼Œå–®ä½ç‚º msï¼‰ã€‚\nAï¼šå¹³å‡çš„ RTTï¼ˆAverage RTTï¼Œå–®ä½ç‚º msï¼‰ã€‚\nWï¼šæœ€å·®çš„ RTTï¼ˆMax/Worst RTTï¼Œå–®ä½ç‚º msï¼‰ã€‚\nVï¼šæ¨™æº–å·®ï¼ˆStandard Deviationï¼‰ã€‚\nGï¼šå¹¾ä½•å¹³å‡ï¼ˆGeometric Meanï¼‰ã€‚\nJï¼šç›®å‰çš„ Jitter å€¼ï¼ˆCurrent Jitterï¼‰ã€‚\nMï¼šå¹³å‡çš„ Jitter å€¼ï¼ˆJitter Mean/Avg.ï¼‰ã€‚\nXï¼šæœ€å·®çš„ Jitter å€¼ï¼ˆWorst Jitterï¼‰ã€‚\nIï¼šInterarrival Jitter\n\nref.\n\nMTR è¿½è¹¤ç¶²è·¯ç¯€é»\nMTRï¼šLinux ç¶²è·¯è¨ºæ–·å·¥å…·ä½¿ç”¨æ•™å­¸\nmac å®‰è£ mtr",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "linux topæŒ‡ä»¤è©³è§£",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/171. linux topæŒ‡ä»¤è©³è§£/",
		"content": "ç¡ç¡å”¸\nlinuxå¸¸ç”¨ top ï¼Œçœ‹ç›®å‰osè£é¢å“ªå€‹ç¨‹å¼è³‡æºåƒæ¯”è¼ƒå…‡ï¼Œ\nä½†æ¯æ¬¡éƒ½æ˜¯åªçœ‹å›ºå®šå¹¾å€‹æ¬„ä½ï¼Œ\næœ€è¿‘å‰›å¥½å–µåˆ°å®Œæ•´çš„èªªæ˜ã€‚\næ­£æ–‡\nä¸€èˆ¬topæœƒé•·é€™æ¨£\n\nç¬¬ä¸€è¡Œ\ntop\n\n15:40:37\nç›®å‰æ™‚é–“\n\nup 6 days\nå·²é–‹æ©Ÿæ™‚é–“\n\n3 users\nç›®å‰ç™»å…¥çš„ä½¿ç”¨è€…æ•¸é‡\n\nload average\n1 min,5 min,15minçš„ç³»çµ±ç“¶å‡è² è¼‰\n\nç¬¬äºŒè¡Œ\nTasks\n\n419 total\nç¸½è™•ç†ç¨‹åº\n\n1 running\nåŸ·è¡Œä¸­çš„ç¨‹å¼\n\n418 sleeping\nç¡çœ ä¸­çš„ç¨‹å¼\n\n0 stopped\nåœæ­¢ä¸­çš„ç¨‹å¼\n\n0 zombie\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/173. Linuxæ®­å±ç¨‹å¼/\">173. Linuxæ®­å±ç¨‹å¼</a>\n\nç¬¬ä¸‰è¡Œ\n%Cpu(s):\n\n0.2 us\nä½¿ç”¨è€…ä½”ç”¨çš„CPU\n\n0.1 sy\næ ¸å¿ƒç©ºé–“ä½”ç”¨çš„CPU\n\n0.0 ni\næ”¹è®Šéå„ªå…ˆé †åºçš„ç¨‹å¼ä½”ç”¨çš„CPU\n\n99.7 id\né–’ç½®çš„CPU\n\n0.0 wa\nIOç­‰å¾…ä½”ç”¨çš„CPU\n\n0.0 hi\nç¡¬é«”ä¸­æ–·(Hardware IRQ)ä½”ç”¨Cçš„PU\n\n0.0 si\nè»Ÿé«”ä¸­æ–·(Software IRQ)ä½”ç”¨çš„CPU\n\n0.0 st\nå·å–æ™‚é–“(Steal Time)ä½”ç”¨çš„CPU\n\nHardware IRQ : ç¡¬é«”ä¸­æ–·æ˜¯å¾å¤–éƒ¨è£ç½®ï¼ˆå¦‚ç£ç¢Ÿæ§è£½å™¨ã€ç¶²è·¯å¡ã€éµç›¤æ§è£½å™¨ã€å¤–éƒ¨è¨ˆæ™‚å™¨ã€ç¡¬é«”æ„Ÿæ‡‰å™¨ç­‰ï¼‰ç™¼é€åˆ°è™•ç†å™¨çš„é›»å­è­¦å ±è¨Šè™Ÿ\nref . Hardware Interrupt time â€“ â€˜hiâ€™ time in top\nSoftware IROï¼šè»Ÿé«”ä¸­æ–·å¾ç¨‹å¼å¼•ç™¼çš„ä¸­æ–·è¡Œçˆ²\nref. Software Interrupt time â€“ â€˜siâ€™ time in top\nSteal CPU Time ï¼šè™›æ“¬æ©Ÿå™¨çš„CPUåœ¨è™›æ“¬æ©Ÿç›£è­·ç¨‹å¼æ­£åœ¨è™•ç†å…¶ä»–è™›æ“¬æ©Ÿå™¨æ™‚ï¼Œç­‰å¾…å¯¦éš›CPUçš„æ™‚é–“ç™¾åˆ†æ¯”ã€‚\nref. Steal CPU time â€“ â€˜stâ€™ time in top\nç«Šå– CPU æ™‚é–“ â€“ é ‚éƒ¨çš„ã€Œstã€æ™‚é–“\nç¬¬å››è¡Œ\nMiB Mem\n\n64207.4 total\nç‰©ç†è¨˜æ†¶é«”ç¸½é‡\n\n7866.7 free\nå¯ç”¨è¨˜æ†¶é«”\n\n16649.0 used\nå·²ä½¿ç”¨è¨˜æ†¶é«”\n\n39691.6 buff/cache\nç·©å­˜çš„è¨˜æ†¶é«”é‡\n\nç¬¬äº”è¡Œ\nMiB Swap\n\n2048.0 total\nè™›æ“¬è¨˜æ†¶é«”ç¸½é‡\n\n2048.0 free\nå¯ç”¨è™›æ“¬è¨˜æ†¶é«”ç¸½é‡\n\n0.0 used\nå·²ä½¿ç”¨è™›æ“¬è¨˜æ†¶é«”\n\n46765.3.0 avail Mem\nå¯ç”¨è¨˜æ†¶é«”[free+(buff/cache)]\n\nè£œå…… Linuxçš„è¨ˆç®—æ–¹å¼è·Ÿwindowsçš„ä¸ä¸€æ¨£ï¼Œ\nç•¶ ã€å¯ä»¥è¢«æ‡‰ç”¨ç¨‹å¼ä½¿ç”¨ï¼Œä½†è¢«æš«æ™‚å€Ÿå»åšåˆ¥çš„ç”¨é€”ã€ï¼Œ\nåœ¨Linuxè£é¢ä¹Ÿæ˜¯é¡¯ç¤ºç‚ºusedã€‚\næ‰€ä»¥è¦æŸ¥ç›®å‰è¨˜æ†¶é«”ä½¿ç”¨é‡å¯ä»¥æ”¹ç”¨htopæˆ–free -m\nref . Linux çš„è¨˜æ†¶é«”å¿«å–ï¼ˆCache Memoryï¼‰åŠŸèƒ½ï¼šLinux ç³»çµ±æŠŠè¨˜æ†¶é«”ç”¨å…‰äº†ï¼Ÿ\nç¬¬ä¸ƒè¡Œ\né è¨­çš„æ¬„ä½åç¨±\n\nPID: åŸ·è¡Œä»»å‹™çš„ Process ID\nUSER: åŸ·è¡Œä»»å‹™çš„ä½¿ç”¨è€…åç¨±\nPR: ä»»å‹™çš„å„ªå…ˆåº¦ (Priority)\nNI: ä»»å‹™çš„ Nice Valueï¼Œè² çš„å€¼ä»£è¡¨å„ªå…ˆåº¦é«˜ï¼Œæ­£çš„å€¼ä»£è¡¨å„ªå…ˆåº¦ä½\nVIRT: ç¸½å…±ç”¨åˆ°å¤šå°‘ kB è™›æ“¬è¨˜æ†¶é«” (Virtual Memory)\nRES: å¯¦é«”è¨˜æ†¶é«” (Resident Size) å¤§å° kB\nSHR: ç¸½å…±ç”¨åˆ°å¤šå°‘ kB çš„å…±äº«è¨˜æ†¶é«” (Shared Memory)\nS: ç‹€æ…‹ (Status)\n\nR ä»£è¡¨åŸ·è¡Œä¸­\nD ä»£è¡¨ä¸å¯ä¸­æ–·ç¡çœ  (ä¸å¯è¢« signal æ‰“æ–·é€šå¸¸åœ¨ç­‰ I/O)\nS ä»£è¡¨ç¡çœ  (å¯è¢«å–šé†’)\nT ä¸­æ–·ä¸­æˆ–åœæ­¢ï¼Œå¯èƒ½æ˜¯è¢«Â SIGSTOPÂ æˆ–Â SIGTSTPÂ åœæ­¢ï¼Œæˆ–æ˜¯è¢« degubber ä¸­æ–· (ptrace)\nZ ä»£è¡¨æ®­å±ï¼Œé€šå¸¸ç™¼ç”Ÿåœ¨ Child å·²ç¶“åŸ·è¡Œå®Œï¼Œç­‰å¾… Parent çµæŸæˆ–å›æ”¶\n\n%CPU: ä½”ç”¨åˆ°å¤šå°‘ CPU %ï¼Œæ³¨æ„åˆ°ä¸€å€‹æ ¸å¿ƒæ˜¯ 100%ï¼Œæ‰€ä»¥å¤šæ ¸å¿ƒæ˜¯å¯ä»¥æ“é 100% çš„\n%MEM: ä½”ç”¨åˆ°å¤šå°‘å…¨éƒ¨è¨˜æ†¶é«”å¤šå°‘æ¯”ä¾‹\nTIME+: ç¨‹å¼å·²ç¶“åŸ·è¡Œå¤šå°‘æ™‚é–“ï¼Œå–®ä½1/100ç§’\nCOMMAND: ä»»å‹™çš„æŒ‡ä»¤åç¨±\n\néé è¨­çš„æ¬„ä½åç¨±ï¼Œ\nå«å‡ºä¾†çš„æ–¹å¼ç‚º f -&gt; é¸æ“‡æ¬„ä½(space) -&gt; é›¢é–‹(q)\n\nPPID: åŸ·è¡Œä»»å‹™çš„ Process IDçš„çˆ¶è¦ª ï¼ˆåŸå› åƒè€ƒ<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/173. Linuxæ®­å±ç¨‹å¼/\">173. Linuxæ®­å±ç¨‹å¼</a>\nUID:åŸ·è¡Œç¨‹å¼çš„ä½¿ç”¨è€…ID\nRUID: çœŸæ­£çš„ä½¿ç”¨è€…ID\nRUSER: çœŸæ­£çš„ä½¿ç”¨è€…\nSUID: æš«å­˜ä½¿ç”¨è€…ID\nSUSER: æš«å­˜ä½¿ç”¨è€…åç¨±\nGID: ç¾¤çµ„ID\nGROUP: ç¾¤çµ„åç¨±\nPGRP: Process Group Id\nTTY: æ§åˆ¶çµ‚ç«¯çš„åç¨±\nTPGID: Tty Process Group Id\nSID: session ID ï¼ˆä¸€å€‹loginè£é¢çš„æ‰€æœ‰process)ï¼Œæœ‰é»åƒ <a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ§ Linux/134. é—œé–‰sshé€£ç·šå¾Œï¼Œä»å¯åŸ·è¡Œç¨‹å¼/\">134. é—œé–‰sshé€£ç·šå¾Œï¼Œä»å¯åŸ·è¡Œç¨‹å¼</a>è£é¢çš„screen\nnTH: èˆ‡ä¸€å€‹é€²ç¨‹é—œè¯çš„åŸ·è¡Œç·’æ•¸é‡\np: æœ€å¾Œä½¿ç”¨çš„CPU\nTIME: ç¨‹å¼å·²ç¶“åŸ·è¡Œå¤šå°‘æ™‚é–“ï¼Œå–®ä½ 1ç§’\nSWAP: ç•¶å‰è¢«ç§»åˆ°äº¤æ›å€çš„è¨˜æ†¶é«”å¤§å°\nCODE: ç›®å‰ç”¨æ–¼åŸ·è¡Œç¨‹å¼ç¢¼ç¢¼çš„ç‰©ç†è¨˜æ†¶é«”\nDATA:ä¸€å€‹ç¨‹å¼ä¿ç•™çš„ç§æœ‰è¨˜æ†¶é«”é‡\nnMaj:å·²ç™¼ç”Ÿçš„ä¸»è¦åˆ†é éŒ¯èª¤æ¬¡æ•¸\nnMin:å·²ç™¼ç”Ÿçš„æ¬¡è¦åˆ†é éŒ¯èª¤æ¬¡æ•¸\nnDRT: ï¼ˆå·²æ£„ç”¨ï¼‰\nWCHAN: é¡¯ç¤ºäº†æ¯å€‹é€²ç¨‹æˆ–åŸ·è¡Œç·’ç›®å‰æ­£åœ¨ç­‰å¾…çš„å…§æ ¸å‡½æ•¸æˆ–äº‹ä»¶çš„åç¨±æˆ–æŒ‡é‡\nFlags:ç›®å‰ä»»å‹™çš„æ’ç¨‹æ¨™èªŒï¼Œä»¥åå…­é€²è£½è¡¨ç¤ºï¼Œä¸¦ä¸”å»æ‰äº†é›¶\nCGROUPS:è¡¨ç¤ºç¨‹å¼æ‰€åœ¨çš„æ§åˆ¶çµ„çš„åç¨±\nSUPGIDS:è¡¨ç¤ºé€²ç¨‹æ‰€åœ¨çš„çˆ¶æ§åˆ¶çµ„çš„ ID\nSUPGRPS:è¡¨ç¤ºç¨‹å¼æ‰€åœ¨çš„çˆ¶æ§åˆ¶çµ„çš„åç¨±\nTGID: Thread Group Id\nOOMa: ç”¨ä¾†èª¿æ•´æ¯å€‹é€²ç¨‹çš„ OOMS å€¼ï¼Œä»¥å½±éŸ¿å…¶è¢«çµ‚æ­¢çš„æ©Ÿç‡\nOOMs: è¨˜æ†¶é«”åˆ†æ•¸ï¼Œè©•ä¼°é€²ç¨‹æˆ–ä»»å‹™å°å…§å­˜éœ€æ±‚çš„æ•¸å€¼\nENVIRON: é¡¯ç¤ºæ‰€æœ‰çš„ç’°å¢ƒè®Šæ•¸\nvMj: ä¸»è¦åˆ†é éŒ¯èª¤è¨ˆæ•¸å¢é‡\nvMn: æ¬¡è¦åˆ†é éŒ¯èª¤è¨ˆæ•¸å¢é‡\nUSED: è¨˜æ†¶é«” Res+Swap Size\nnsIPC: IPC å‘½åç©ºé–“ï¼Œç”¨æ–¼éš”é›¢é€²ç¨‹é–“é€šè¨Šè³‡æºï¼Œç¢ºä¿å®ƒå€‘åœ¨ä¸åŒçš„å‘½åç©ºé–“ä¸­äº’ä¸å¹²æ“¾\nnsMNT: MNT å‘½åç©ºé–“ï¼Œç”¨æ–¼éš”é›¢å’Œç®¡ç†ä¸åŒå‘½åç©ºé–“ä¸­çš„æª”æ¡ˆç³»çµ±æ›è¼‰é»è³‡è¨Š\nnsNET: NET å‘½åç©ºé–“ï¼Œç”¨æ–¼éš”é›¢å’Œç®¡ç†ä¸åŒå‘½åç©ºé–“ä¸­çš„ç¶²çµ¡è³‡æºå’Œç¶²çµ¡è¨­ç½®\nnsPID: PID å‘½åç©ºé–“ï¼Œç”¨æ–¼éš”é›¢ä¸åŒå‘½åç©ºé–“ä¸­çš„é€²ç¨‹è­˜åˆ¥è™Ÿï¼Œç¢ºä¿å®ƒå€‘åœ¨å„è‡ªçš„å‘½åç©ºé–“ä¸­å…·æœ‰å”¯ä¸€çš„ PID\nnsUSER:USER å‘½åç©ºé–“ï¼Œç”¨æ–¼éš”é›¢ä¸åŒå‘½åç©ºé–“ä¸­çš„ç”¨æˆ¶å’Œç”¨æˆ¶è¨±å¯æ¬Šï¼Œç¢ºä¿å®ƒå€‘åœ¨å„è‡ªçš„å‘½åç©ºé–“ä¸­å…·æœ‰ç¨ç«‹çš„ç”¨æˆ¶èº«ä»½å’Œæ¬Šé™\nnsUTS:UTS (UNIX Time-sharing System)å‘½åç©ºé–“ï¼Œç”¨æ–¼éš”é›¢ä¸åŒå‘½åç©ºé–“ä¸­çš„ä¸»æ©Ÿåå’ŒåŸŸåè¨­ç½®ï¼Œç¢ºä¿å®ƒå€‘åœ¨å„è‡ªçš„å‘½åç©ºé–“ä¸­å…·æœ‰ç¨ç«‹çš„çµ„æ…‹\nLXC: LXC(Linux Containers)å®¹å™¨åç¨±\nRSan: ä»£è¡¨ä¸€å€‹é€²ç¨‹æˆ–ä»»å‹™æ­£åœ¨ä½¿ç”¨çš„åŒ¿åå…§å­˜çš„å¤§å°\nRSfd: ä»£è¡¨ä¸€å€‹é€²ç¨‹æˆ–ä»»å‹™æ­£åœ¨ä½¿ç”¨çš„æª”æ¡ˆå…§å­˜çš„å¤§å°\nRSlk: ä»£è¡¨ä¸€å€‹é€²ç¨‹æˆ–ä»»å‹™æ­£åœ¨ä½¿ç”¨çš„å·²é–å®šé é¢çš„å¤§å°\nRSsh: ä»£è¡¨ä¸€å€‹é€²ç¨‹æˆ–ä»»å‹™æ­£åœ¨ä½¿ç”¨çš„å…±äº«å…§å­˜çš„å¤§å°\nCGNAME: æ§åˆ¶çµ„åç¨±ï¼Œç”¨æ–¼æ¨™è­˜å’Œç®¡ç†ç›¸é—œçš„é€²ç¨‹æˆ–è³‡æºçš„åˆ†çµ„ã€‚\nNU: &quot;æœ€å¾Œå·²çŸ¥çš„ NUMA ç¯€é»&quot;\n\nref.\n\nè¨˜æ†¶é«”éƒ½å»å“ªäº†\ntopå‘½ä»¤è©³è§£ç¤ºä¾‹\nUnix/Linux TOP æŒ‡ä»¤ä½¿ç”¨è©³è§£\nubntu-top\nLInuxä¸­çš„process",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "æ®­å±ç¨‹å¼",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/173. Linuxæ®­å±ç¨‹å¼/",
		"content": "å‰è¨€\nçœ‹æ–‡ç« çœ‹åˆ°ä¸€ç¯‡è©³è§£ï¼ŒTOPæŒ‡ä»¤ï¼Œé‡æ–°æŠŠlinuxçš„topç†è§£ä¸€éã€‚\nç„¶å¾Œçœ‹åˆ°ä¸€å€‹æ€ªåè© zombie ï¼Œé€™æ˜¯æˆ‘ç†è§£çš„æ„æ€å—ï¼ï¼Ÿ\næ­£æ–‡\nç°¡å–®èªªæœ‰é»åƒæ˜¯windows çš„æ‡‰ç”¨ç¨‹å¼ï¼Œè¦æ­»ä¸æ­»ï¼Œå¡åœ¨é‚£é‚Šç•¶æ‰çš„æƒ…æ³ã€‚\næ¯ä¸€å€‹processéƒ½æœƒæœ‰ä¸€å€‹parent processï¼Œ\nç•¶child processè™•æ–¼çµæŸèˆ‡å°šæœªçµæŸä¸­é–“æ™‚æœƒç™¼ç”Ÿã€‚\nè©³ç´°ï¼Œè«‹åƒè€ƒDay 17: æ®­å±èˆ‡å­¤å…’\ntop é¡¯ç¤ºPPID\n\nåŸ·è¡Œ top\næŒ‰ä¸‹f\né¸æ“‡éœ€è¦çš„æ¬„ä½ï¼ŒæŒ‰d æˆ– space é¸æ“‡\næŒ‰ä¸‹â†’ éµç›¤çš„æ–¹å‘éµï¼Œç„¶å¾ŒæŒ‰ä¸Šä¸‹éµå¯ä»¥èª¿æ•´é †åº\næŒ‰qé›¢é–‹",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "centos 7å®‰è£redis æ”¹port",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/33. centos 7å®‰è£redis æ”¹port/",
		"content": "å‰è¨€\næ­£æ–‡\næœ€ç°¡å–®åœ°å®‰è£æ–¹å¼ï¼Œ\n\nyum install redis\n\nç·¨è¼¯ /etc/redis.conf\næ‰¾åˆ° port 6379 ï¼Œå°‡å®ƒæ”¹ç‚º port 8090\n\né‡å•Ÿæœå‹™ sudo systemctl restart redis\n\nç™¼ç¾æœå‹™ç„¡æ³•å•Ÿå‹•(fig.1)ï¼ŒæŸ¥log(fig.2)ï¼Œç™¼ç¾æ²’æœ‰æ¬Šé™ã€‚\n\n[[33.fig-1.jpg]]\n[[33.fig-2.jpg]]\n\nselinuxçš„å•é¡Œï¼Œè¦éº»é—œæ‰ï¼Œè¦éº»æ–°å¢port\n\nsudo: semanage: command not found\n\nå®‰è£\nyum install policycoreutils-python\n\nç„¶å¾ŒåŸ·è¡Œ\nsudo semanage port -a -t redis_port_t -p tcp 8090\n\nref.\nRedis: Creating Server TCP listening socket *:6388: bind: Permission denied\nè§£æ±º semanage command not found\n\né‡é–‹redisã€‚\n\nsudo systemctl restart redis\nsudo systemctl status redis\n\nref.\nå®‰è£ Redis æ™‚é‡åˆ°çš„éŒ¯èª¤æ’é™¤",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "SSHç„¡æ³•é€£ç·šï¼ŒREMOTE HOST IDENTIFICATION HAS CHANGED",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/48.SSHç„¡æ³•é€£ç·šï¼ŒREMOTE HOST IDENTIFICATION HAS CHANGED/",
		"content": "å‰è¨€\næ­£æ–‡\nå‡ºç¾ä¸‹åœ–çš„éŒ¯èª¤ï¼Œ\n[[48.fig-1.jpg]]\n\nä¸€èˆ¬éƒ½æ˜¯ç”¨æ–‡å­—ç·¨è¼¯å™¨é–‹å•Ÿ /root/.ssh/known_hosts\nå°‡èˆŠ10.7.10.48 çš„keyåˆªé™¤ã€‚\n\nä½†é€™æ¬¡ç¢°åˆ°æ²’æœ‰æ¬Šé™ï¼Œåªèƒ½ä¸‹æŒ‡ä»¤åˆªé™¤äº†ã€‚\n\nssh-keygen -R 10.7.10.48",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "npm èˆ‡ yarn æ¯”è¼ƒ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/49.npm èˆ‡ yarn æ¯”è¼ƒ/",
		"content": "å‰è¨€\næ­£æ–‡\n\nå›å‚³å€¼\næ–¹æ³•åç¨±\nèªªæ˜\n\nnpm install\nyarn install\nå®‰è£ json.package æ‰€æœ‰ä¾è³´\n\nnpm install [package]\n(N/A)\nYarnä¸æ”¯æ´ç›´æ¥å®‰è£å¥—ä»¶\n\nnpm install --save [package]\nyarn add [paakage]\nå„²å­˜åœ¨ json.packageä¸­çš„dependencies\n\nnpm install --save-dev [package]\nyarn add [paakage] --dev\nå„²å­˜åœ¨ json.packageä¸­çš„devDependencies\n\nnpm install --global [package]\nyarn global add [package]\nå®‰è£åœ¨é›»è…¦å…¨åŸŸä¸­\n\nnpm uninstall [package]\n(N/A)\nYarnä¸æ”¯æ´ç›´æ¥å®‰è£èˆ‡ç§»é™¤å¥—ä»¶\n\nnpm uninstall --save [package]\nyarn remove [package]\nç§»é™¤dependenciesæŸå¥—ä»¶\n\nnpm uninstall --save-dev [package]\nyarn remove [package]\nç§»é™¤devDependenciesæŸå¥—ä»¶\n\nrm -rf node_modules &amp;&amp; npm install\nyarn upgrade\næ›´æ–°node_modules\n\nref.\nç”¨Yarnå–ä»£npmåŠ é€Ÿé–‹ç™¼",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "curl ç­†è¨˜",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/51.curl ç­†è¨˜/",
		"content": "å‰è¨€\næ­£æ–‡\næœ€è¿‘åœ¨Kç¶²è·¯æ¶æ§‹ï¼Œæœ‰äº›æ±è¥¿æœ‰é»æ¦‚å¿µäº†ã€‚\næ­¤æ™‚ä¾†çœ‹é€™å¼µåœ–çµ‚æ–¼ç­è§£ä¸€é»ã€‚\n\nref. A Question of Timing\nå…ˆä¾†çœ‹é€™å¼µåœ–ï¼Œ\næœ‰å¹¾å€‹é—œéµå­—ç¸®å¯«å¿…é ˆè¦å…ˆçŸ¥é“\nSYN ï¼š åŒæ­¥åºåˆ—è™Ÿ\nACK ï¼š è¦æ±‚å›æ‡‰\nFIN ï¼šçµæŸ\nSEQ ï¼š åºåˆ—è™Ÿ\né€™é‚Šç°¡å–®è¬›ï¼Œè¦æ›´è©³ç´°çš„å…§å®¹ï¼Œå»ºè­°å»çœ‹ä¸€ä¸‹TCP ä¸‰å‘äº¤æ¡ (Three-way Handshake)\nåœ¨é€™å¼µåœ–è£¡é¢æ²’æœ‰SEQé€™å€‹ï¼Œå› ç‚ºæ²’ç•«å‡ºä¾†ï¼Œåœ¨SYNçš„æ™‚å€™ï¼Œå°±æœƒåŒ…å«SEQåœ¨è£¡é¢äº†ã€‚\næµç¨‹ç°¡å–®èªªæ˜¯é€™æ¨£çš„ï¼ŒTCPæ˜¯æœ‰é †åºæ€§çš„ã€‚\n\nclinet è©¢å•DNS server ï¼Œç¶²åŸŸèˆ‡IPçš„å°æ‡‰\nclient ç™¼å‡ºè«‹æ±‚\nserver å›æ‡‰\nclient å›æ‡‰ï¼Œæˆ‘çŸ¥é“ä½ å›äº†ã€‚\nserver é–‹å§‹å»ºç«‹sslæ†‘è­‰\nclient ç™¼å‡ºå…§å®¹è«‹æ±‚\nserver å›æ‡‰å…§å®¹\nçµæŸ\n\nå¥½äº†ï¼Œå†ä¾†æ‰æ˜¯è¬›curl ï¼Œ\nå…ˆå»ºç«‹ä¸€å€‹ txtæª”ï¼Œ\n\\n\n# DNS è§£ææ™‚é–“ï¼Œä¹Ÿå°±æ˜¯æŸ¥è©¢åˆ° IP çš„æ™‚é–“\\n\ntime_namelookup: %{time_namelookup}\\n\n# TCP é€£ç·šæ™‚é–“ï¼Œå°±æ˜¯ TCP ä¸‰é …äº¤æ¡çš„æ™‚é–“\\n\ntime_connect: %{time_connect}\\n\n# SSL é€£ç·šçš„æ™‚é–“\\n\ntime_appconnect: %{time_appconnect}\\n\n# å¾é–‹å§‹åˆ°æœ€å¾Œä¸€å€‹è«‹æ±‚çš„æ™‚é–“ï¼Œå¦‚æœç¶²é æœ‰è·³è½‰å°±æœƒæœ‰æ™‚é–“\\n\ntime_redirect: %{time_redirect}\\n\n# å¾é–‹å§‹åˆ°éŸ¿æ‡‰é–‹å§‹çš„æ™‚é–“\\n\ntime_pretransfer: %{time_pretransfer}\\n\n# å¾é–‹å§‹åˆ°éŸ¿æ‡‰é–‹å§‹å‚³è¼¸çš„æ™‚é–“\\n\ntime_starttransfer: %{time_starttransfer}\\n\n----------\\n\n# æ•´é«”æ™‚é–“\\n\ntime_total: %{time_total}\\n\n\\n\n\ncurl -w @curl-format.txt -o /dev/null https://daimom3020.blogspot.com/\n\né€™é‚Šè¦æ³¨æ„ï¼Œ @curl-format.txt é€™é‚Šä¸èƒ½ä½¿ç”¨è·¯å¾‘æ–¹å¼å»æ‰¾æª”æ¡ˆã€‚å¦‚æœæ€•æ”¹å¤©æ‰¾ä¸åˆ°æª”æ¡ˆçš„è©±ï¼Œ\ncurl å¯ä»¥æ”¹æˆä¸‹é¢çš„æŒ‡ä»¤\ncurl -o /dev/null https://daimom3020.blogspot.com/ -w &quot;\n# DNS è§£ææ™‚é–“ï¼Œä¹Ÿå°±æ˜¯æŸ¥è©¢åˆ° IP çš„æ™‚é–“\ntime_namelookup: %{time_namelookup}\n# TCP é€£ç·šæ™‚é–“ï¼Œå°±æ˜¯ TCP ä¸‰é …äº¤æ¡çš„æ™‚é–“\ntime_connect: %{time_connect}\n# SSL é€£ç·šçš„æ™‚é–“\ntime_appconnect: %{time_appconnect}\n# å¾é–‹å§‹åˆ°æœ€å¾Œä¸€å€‹è«‹æ±‚çš„æ™‚é–“ï¼Œå¦‚æœç¶²é æœ‰è·³è½‰å°±æœƒæœ‰æ™‚é–“\ntime_redirect: %{time_redirect}\n# å¾é–‹å§‹åˆ°éŸ¿æ‡‰é–‹å§‹çš„æ™‚é–“\ntime_pretransfer: %{time_pretransfer}\n# å¾é–‹å§‹åˆ°éŸ¿æ‡‰é–‹å§‹å‚³è¼¸çš„æ™‚é–“\ntime_starttransfer: %{time_starttransfer}\n----------\n# æ•´é«”æ™‚é–“\ntime_total: %{time_total}\n\\n&quot;\n\næ­é…ä¸Šæ–¹çš„åœ–ç‰‡ä¾†çœ‹ï¼Œ\né€™é‚Šé¡¯ç¤ºçš„æ™‚é–“æ˜¯ç´¯åŠ çš„ï¼Œå¦‚æœè¦ç®—å‡ºå€é–“çš„æ™‚é–“ï¼Œ\néœ€è¦è‡ªè¡Œåšç›¸æ¸›ã€‚\nä¾‹å¦‚ï¼Œ\nè¦çŸ¥é“serverè™•ç†è³‡æ–™çš„æ™‚é–“å¤šé•·ï¼Œ\nå¯ä½¿ç”¨ time_starttransfer - time_pretransfer ï¼Œ\nå°±å¯å¾—çŸ¥serverè™•ç†è³‡æ–™çš„æ™‚é–“ã€‚\nref.\n\nCURL è©³ç´°è³‡æ–™åŒ…å« TCP èˆ‡ SSL é€£ç·šæ™‚é–“\nCURL -w åƒæ•¸è©³è§£\ncurlå‘½ä»¤\n15 Special Characters You Need to Know for Bash\nCommand symbol ç¬¦è™Ÿ_Linux\ncurl æ‰€æœ‰åƒæ•¸ä»‹ç´¹\n\né©—è­‰ç¶²ç«™æ˜¯å¦ç‚ºhttp2 ï¼Œ\nç°¡å–®èªªæ˜\n-v é¡¯ç¤ºå‘¼å«çš„æ­¥é©Ÿ\n-s Silentæ¨¡å¼ã€‚ä¸è¼¸å‡ºä»»å‹™å…§å®¹\n-o æŒ‡å®šè¼¸å‡ºç›®éŒ„\nåªç”¨ -s çš„è©±ï¼Œé‚„æ˜¯æœƒè¼¸å‡ºå…§å®¹ã€‚\nåªç”¨ -oçš„è©±ï¼Œä¸æœƒè¼¸å‡ºå…§å®¹\n\tcurl https://www.cloudflare.com --http2 -vso /dev/null\n\næ˜¯çš„è©±ï¼Œæœƒå‡ºç¾ using http2",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "ç·¨è­¯ffmpeg ç¡¬é«”åŠ é€Ÿçš„å‘",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/6. ç·¨è­¯ffmpeg ç¡¬é«”åŠ é€Ÿçš„å‘/",
		"content": "å‰è¨€\næœ€è¿‘çš„æ¡ˆå­..è¦å¹«åŒä»æffmpegçš„æ©Ÿå™¨ï¼Œå¦‚æœæ²’æœ‰ä½¿ç”¨é¡¯å¡åŠ é€Ÿæ˜¯å€‹å¾ˆæ„‰å¿«çš„äº‹æƒ…\nä½†æ‰¯åˆ°é¡¯å¡å°±æ»¿æ»¿çš„å‘äº†ã€‚\næ­£æ–‡\nç’°å¢ƒï¼šGKEï¼Œé–‹å•ŸGPUç¯€é»ï¼Œè©³ç´°çš„ä½¿ç”¨æ–¹æ³•å¯åƒè€ƒä¹‹å‰å¯«éçš„ GKEä½¿ç”¨GPU\nç’°å¢ƒè¨­å®šé‚£éƒ¨åˆ†ï¼Œæœ‰é–‹å·¥å–®å»å•googleï¼Œä»–å€‘æœ‰èªªè¦æ”¹æ–‡ä»¶ã€‚\n1.ç·¨è­¯æ™‚æ‰¾ä¸åˆ° libnpp\nERROR: libnpp not found\nå®‰è£ CUDA Toolkit\nref.\nHow to install CUDA 9.2 on Ubuntu 18.04\nCUDA Toolkit 11.2 Downloads\nwget https://developer.download.nvidia.com/compute/cuda/11.2.0/local_installers/cuda_11.2.0_460.27.04_linux.run\nsudo sh cuda_11.2.0_460.27.04_linux.run\nå®‰è£æ™‚ï¼Œä¸è¦å¦å¤–è£é©…å‹•ï¼Œåªè£cuda\n\nåƒæ•¸è¨­å®šç·¨ç¢¼å…è¨±png,å‡ºç¾éŒ¯èª¤\n--enable-decoder=png --enable-encoder=png\n\nDisabled png_decoder because not all dependencies are satisfied: zlib\néœ€è¦å…ˆå®‰è£ zlib\nref. ffmpeg &amp; png watermark issue\napt-get install zlib1g-dev\n\nç·¨è­¯å®Œæˆå¾Œï¼ŒåŸ·è¡Œç™¼ç”ŸéŒ¯èª¤ï¼Œæ‰¾ä¸åˆ°libnpp\nffmpeg: error while loading shared libraries: libnppig.so.11: cannot open shared object file: No such file or directory\n\nref. libnppig.so.8.0 Missing FFmpeg\nè¨­å®šåƒæ•¸\nexport LD_LIBRARY_PATH=/usr/local/cuda-11.2/targets/x86_64-linux/lib\n\né©…å‹•ä¸æ”¯æ´\nDriver does not support the required nvenc API version. Required: 11.0 Found: 9.0\n\nThe minimum required Nvidia driver for nvenc is 455.28 or newer\nError initializing output stream 0:0 -- Error while opening encoder for output stream #0:0 - maybe incorrect parameters such as bit_rate, rate, width or height\nåˆ‡åˆ° nv-codec-headers çš„è³‡æ–™å¤¾åº•ä¸‹ï¼Œåˆ‡æ›åˆ†æ”¯\ngit checkout sdk/9.0\nref. [è¨˜éŒ„ä¸€å€‹bug]é—œæ–¼é‹è¡Œffmpeg with cudaå‡ºéŒ¯å•é¡Œï¼šDriver does not support the required nvenc API version..... [å·²è§£æ±º|è¨˜éŒ„ä¸€å€‹bug]é—œæ–¼é‹è¡Œffmpeg with cudaå‡ºéŒ¯å•é¡Œï¼šDriver does not support the required nvenc API version..... [å·²è§£æ±º]\n\nä½¿ç”¨æµ®æ°´å°è½‰æª”å‡ºç¾éŒ¯èª¤\nImpossible to convert between the formats supported by the filter 'graph 0 input from stream 0:0' and the filter 'auto_scaler_0'\nError reinitializing filters!\nFailed to inject frame into filter network: Function not implemented\n\nä¹‹å‰å¯«çš„\nffmpeg -hwaccel cuvid -y -i 49805.mp4 -i logo.png \\\n-filter_complex &quot;[0]scale='min(1280,iw)':-1[bg];[1][bg]scale2ref=w='iw*15/100':h='iw*15/100*166/446'[wm][vid];[vid][wm]overlay=10:10&quot; \\\n-c:v h264_nvenc ezio.mp4\n\næœƒç™¼ç”Ÿä¸Šé¢çš„éŒ¯èª¤(auto_scaler_0)ï¼Œä½†åªè¦å°‡ cuvidæ”¹æˆ nvdec å°±æ­£å¸¸äº†ã€‚\nffmpeg -hwaccel nvdec -y -i 49805.mp4 -i logo.png \\\n-filter_complex &quot;[0]scale='min(1280,iw)':-1[bg];[1][bg]scale2ref=w='iw*15/100':h='iw*15/100*166/446'[wm][vid];[vid][wm]overlay=10:10&quot; \\\n-c:v h264_nvenc ezio.mp4\n\nref. Filter complex through CUDA hevc_cuvid with FFMPEG input 4k hevc, help needed\n\nè½‰ç¢¼æ™‚æŸ¥è©¢ è©³ç´°çš„logè¨˜éŒ„\nåœ¨ffmpegçš„å¾Œé¢åŠ ä¸Š -loglevel debug\nref. FFMPEGçš„é»˜èªåƒç´ æ ¼å¼å°‡åœ–åƒå †æ£§ç·¨ç¢¼ç‚ºé›»å½±\n\nffmpeg å¸¸ç”¨æŒ‡ä»¤\n\nffmpeg -hwaccels æŸ¥è©¢èƒ½ç”¨çš„ç¡¬é«”åŠ é€Ÿ\nffmpeg -codecs | grep cuvid æŸ¥çœ‹ffmpegæ”¯æŒçš„cuvidçš„ç·¨ç¢¼æ ¼å¼\nref. Ubuntu 16.04ä¸‹ç·¨è­¯ffmpegæ”¯æŒCUDAä¸‹çš„cuvid vnencå’ŒNPP\nä½¿ç”¨GPUç¡¬ä»¶åŠ é€ŸFFmpegè¦–é »è½‰ç¢¼åŠæ’å‘\nå…¶ä»–åƒè€ƒé …ç›®\nref. Matching CUDA arch and CUDA gencode for various NVIDIA architectures\nFFmpegå†å­¸ç¿’ -- Linux å®‰è£èªªæ˜(åƒæ•¸èªªæ˜)\nåœ¨k8sä¸­èª¿ç”¨NVIDIA-GPU\nåœ¨k8sä¸­èª¿ç”¨NVIDIA-GPU(Dockerfile)",
		"tags": ["0", "note","ğŸ§"]
},

{
		"title": "alpine linux apk ERROR unable to select packages",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/63.alpine linux apk ERROR unable to select packages/",
		"content": "å‰è¨€\né€™å¥½åƒæ˜¯åœ¨æŸ¥å•é¡Œçš„æ™‚å€™ç¢°åˆ°çš„ï¼Œ\nå› ç‚ºæŸäº›å¥‡æ€ªçš„ç¶²è·¯å•é¡Œï¼Œ\nå°è‡´å¿…é ˆæŠ“å°åŒ…æŸ¥è©¢ï¼Œç„¶å¾Œåˆå› ç‚ºåœ¨GKEçš„å…§ç¶²ï¼Œ\nä¸èƒ½åœ¨æœ¬æ©Ÿæ’ˆ.\næ­£æ–‡\nè¦å®‰è£ä¸€å€‹linuxé¡ä¼¼fiddlerçš„è»Ÿé«”ï¼Œ\næœå°‹alpine liunx çš„ repositoryæœ‰æ‰¾åˆ°ï¼Œ\nä½†ä¸€ç›´ç„¡æ³•å®‰è£ã€‚\næœƒå‡ºç¾\nERROR: unable to select packages:\nmitmproxy (no such package):\nrequired by: world[mitmproxy]\n\nå¾Œä¾†æ‰ç™¼ç¾ï¼Œä»–çš„repositoryæ˜¯ æ¸¬è©¦çš„\n\næ‰€ä»¥å®‰è£æ™‚ï¼Œè¦æŒ‡å®š repositoryçš„ä½ç½®\napk add mitmproxy --repository=http://dl-cdn.alpinelinux.org/alpine/edge/testing/\n\nref.\n\nERROR: unable to select packages error on Alpine Linux\nHow to add a edge/testing package to Alpine Linux?\nalpine Linux - package search\nalpine Linux - Enable Community Repository",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "Linux command - grep",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/65. Linux command - grep/",
		"content": "å‰è¨€\næ­£æ–‡\nç”¨é€”\né€šå¸¸æ˜¯ç”¨åœ¨æŸäº›æŒ‡ä»¤å¾Œçš„è™•ç†ä¸Šã€‚\nä»¥å‰çš„è©±ï¼Œé€šå¸¸æ˜¯æŠŠæŒ‡ä»¤åŸ·è¡Œå®Œå¾Œï¼Œ\nå†å°‡å…§å®¹è²¼å»excelåšè™•ç†\né€™é‚Šä¹Ÿå¾ˆå¸¸ç”¨åˆ°pipe ï¼Œ\nç°¡å–®çš„ä¾‹å­ï¼Œè¦æ‰¾å‡ºé€™å€‹è³‡æ–™å¤¾å…§æœ‰å¤šå°‘æª”æ¡ˆã€‚\nls | wc\n\næœƒæœ‰ä¸‰å€‹å€¼ï¼Œ æ›è¡Œæ•¸ã€å­—æ•¸ã€å­—å…ƒæ•¸\nä½†å¦‚æœè¦é‡å° å‰¯æª”åæ˜¯ jpgçš„è©±ï¼Œ\nå°±å¿…é ˆè¦ç”¨grep åœ¨åšåŠ ç¸½\nls | grep -c \\.jpg\n\nå¦‚æœåªå–®ç´”åšåŠ ç¸½çš„è©±ï¼Œå¾Œé¢å¿…é ˆçµ¦å€‹è¦åŠ ç¸½çš„æ±è¥¿ã€‚\nls | grep -c .\n\nå¾Œé¢çš„åƒæ•¸ç‚º æ­£å‰‡è¡¨ç¤ºæ³•\nref.\n\nLinux I/O è¼¸å…¥èˆ‡è¼¸å‡ºé‡æ–°å°å‘ï¼ŒåŸºç¤æ¦‚å¿µæ•™å­¸\nLinux ä½¿ç”¨ wc æŒ‡ä»¤è¨ˆç®—å­—æ•¸ã€è¡Œæ•¸æ•™å­¸èˆ‡ç¯„ä¾‹\nLinux grep å‘½ä»¤\nLinux åŒ¹é…æ–‡å­— grep æŒ‡ä»¤ç”¨æ³•æ•™å­¸èˆ‡ç¯„ä¾‹",
		"tags": [ "note","ğŸ§"]
},

{
		"title": "shellscriptè§£æ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/93. shellscriptè§£æ/",
		"content": "å‰è¨€\næ­£æ–‡\n#!/bin/bash\nF=&quot;proxy-linux-amd64.tar.gz&quot;\nset -e\nif [ -e /tmp/proxy ]; then\nrm -rf /tmp/proxy\nfi\nmkdir /tmp/proxy\ncd /tmp/proxy\n\necho -e &quot;\\n&gt;&gt;&gt; downloading ... $F\\n&quot;\nmanual=&quot;https://snail.gitee.io/proxy/manual/&quot;\nLAST_VERSION=$(curl --silent &quot;https://mirrors.host900.com/https://api.github.com/repos/snail007/goproxy/releases/latest&quot; | grep -Po '&quot;tag_name&quot;:&quot;\\K.*?(?=&quot;)')\nwget -t 1 &quot;https://mirrors.host900.com/https://github.com/snail007/goproxy/releases/download/${LAST_VERSION}/$F&quot;\n\necho -e &quot;&gt;&gt;&gt; installing ... \\n&quot;\n# #install proxy\ntar zxvf $F &gt;/dev/null\nset +e\nkillall -9 proxy &gt;/dev/null 2&gt;&amp;1\nset -e\ncp -f proxy /usr/bin/\nchmod +x /usr/bin/proxy\nif [ ! -e /etc/proxy ]; then\nmkdir /etc/proxy\ncp blocked /etc/proxy\ncp direct /etc/proxy\nfi\nif [ ! -e /etc/proxy/proxy.crt ]; then\ncd /etc/proxy/\nproxy keygen -C proxy &gt;/dev/null 2&gt;&amp;1\nfi\nrm -rf /tmp/proxy\nversion=`proxy --version 2&gt;&amp;1`\necho -e &quot;&gt;&gt;&gt; install done, thanks for using snail007/goproxy $version\\n&quot;\necho -e &quot;&gt;&gt;&gt; install path /usr/bin/proxy\\n&quot;\necho -e &quot;&gt;&gt;&gt; configuration path /etc/proxy\\n&quot;\necho -e &quot;&gt;&gt;&gt; uninstall just exec : rm /usr/bin/proxy &amp;&amp; rm -rf /etc/proxy\\n&quot;\necho -e &quot;&gt;&gt;&gt; How to using? Please visit : $manual\\n&quot;\n\nå¹¾å€‹ä¸å¸¸ç”¨åˆ°çš„æŒ‡ä»¤\n\ntar :è§£å£“ç¸®\n\n/dev/null ï¼Œé€™å€‹åœ¨linuxä¸Šé¢è¡¨ç¤º é»‘æ´ï¼Œä¸åšä»»ä½•è™•ç†ã€‚\næ‰€ä»¥ tar zxvf è¡¨ç¤ºèªªï¼Œè§£å£“ç¸®F&gt;/dev/nullè¡¨ç¤ºèªªï¼Œè§£å£“ç¸®Fçš„æª”æ¡ˆï¼Œä½†ä¸å°å‡ºä»»ä½•çš„è¨Šæ¯\n\nset -e åœ¨ &quot;setÂ -e&quot;ä¹‹å¾Œå‡ºç¾çš„ä»£ç¢¼ï¼Œä¸€æ—¦å‡ºç¾äº†è¿”å›å€¼éé›¶ï¼Œæ•´å€‹è…³æœ¬å°±æœƒç«‹å³é€€å‡ºã€‚\n\nset +e åœ¨ &quot;set +e&quot;ä¹‹å¾Œå‡ºç¾çš„ä»£ç¢¼ï¼Œä¸€æ—¦å‡ºç¾äº†è¿”å›å€¼é0ï¼Œè…³æœ¬é‚„æ˜¯æœƒç¹¼çºŒåŸ·è¡Œ\n\nif -e ...åˆ¤æ–·æ­¤ç›®æ¨™æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨å›true\n\nref.\n- â€œ&gt; /dev/null 2&gt;&amp;1â€ çš„æ„æ€\n- å­¸ç¿’ç­†è¨˜ï¼š shell ä¸­çš„ set -e ï¼Œ set +e ç”¨æ³•\n- What does &quot;if [ -e $name ]&quot; mean? Where $name is a path to a directory",
		"tags": ["install", "note","ğŸ§"]
},

{
		"title": "1.php exec ssh ç™¼ç”Ÿ Host key verification failed éŒ¯èª¤",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ§ Linux/php exec ssh ç™¼ç”Ÿ Host key verification failed éŒ¯èª¤/",
		"content": "å‰è¨€\nå‰å¹¾å¤©ä¸€ç›´åœ¨æ‰¾phpçš„execå‘ï¼Œ\næœ€å¾Œçµ‚æ–¼è§£äº†ï¼Œ\nè¨˜éŒ„ä¸€ä¸‹ã€‚\næ­£æ–‡\né¦–å…ˆä¾†æ®µcodeï¼Œ\né€™æ®µçš„ç”¨é€”æ˜¯è¦æŠŠ æª”æ¡ˆå¾A è¤‡è£½åˆ° B ï¼Œ\nå¦‚æœç›´æ¥åœ¨AåŸ·è¡Œ scp çš„æŒ‡ä»¤ï¼Œæ˜¯æ­£å¸¸çš„ã€‚\n&lt;?php\nexec(&quot;scp -i /var/www/.ssh/id_rsa -r /var/www/html/WebService/upload/tmp/fe8abe8e88fb3a2d88cc17a45a7575b1.png www-data@10.7.0.17:/var/www/html/tmp/ 2&gt;&amp;1&quot;, $output, $return_var);\nprint_r($output);\necho &quot;return&quot; .$return_var;\necho &quot;&lt;br&gt;&quot;;\nexec(&quot;ssh -i /var/www/.ssh/id_rsa www-data@10.7.0.17 2&gt;&amp;1&quot;, $output,$return_var);\nprint_r($output);\necho &quot;return:&quot;.$return_var;\n?&gt;\n\né€™æ®µç¨‹å¼ï¼Œæœ‰é¡å¤–åŠ ä¸Š 2&gt;&amp;1 é€™æ˜¯å°‡éŒ¯èª¤å°å‡ºä¾†çš„æ–¹å¼\n\nä½¿ç”¨ 2&gt;&amp;1, å‘½ä»¤å°±æœƒè¼¸å‡ºshellåŸ·è¡Œæ™‚çš„éŒ¯èª¤åˆ°$outputè®Šé‡, è¼¸å‡ºè©²è®Šé‡å³å¯åˆ†æã€‚\nå‚™è¨»: execæœ‰3å€‹åƒæ•¸ï¼Œç¬¬ä¸€å€‹æ˜¯è¦åŸ·è¡Œçš„å‘½ä»¤ï¼Œç¬¬äºŒå€‹æ˜¯åƒæ•¸æ˜¯ä¸€å€‹æ•¸çµ„ï¼Œæ•¸çµ„çš„å€¼æ˜¯ç”±ç¬¬ä¸€å€‹å‘½ä»¤åŸ·è¡Œå¾Œç”Ÿæˆçš„ï¼Œç¬¬ä¸‰å€‹åƒæ•¸åŸ·è¡Œçš„ç‹€æ…‹ï¼Œ0è¡¨ç¤ºæˆåŠŸï¼Œå…¶ä»–éƒ½è¡¨ç¤ºå¤±æ•—ã€‚\n(ref. https://blog.csdn.net/zy112289/article/details/52671373)\nç„¶å¾Œçµ‚æ–¼æœ‰éŒ¯èª¤è¨Šæ¯äº†ï¼Œé€™å€‹éŒ¯èª¤å»è®“æˆ‘å¾ˆæ…Œ....\nHost key verification failed\næŸ¥äº†ä¸€ä¸‹æ˜¯é©—è­‰çš„éŒ¯èª¤ï¼Œéƒ½èªªåŸºæœ¬ä¸Šå°±æ˜¯åˆªé™¤ known_host å°±å¥½äº†ã€‚\nä½†åˆªäº†ä¸»æ©Ÿã€æœ¬æ©Ÿéƒ½ä¸€æ¨£\n(ref. https://blog.csdn.net/iteye_19045/article/details/103704924)ã€‚\nä½¿ç”¨find å»å°‹æ‰¾æ‰€æœ‰çš„*.pubæª”æ¡ˆï¼Œæ ¹æ“šè£¡é¢çš„å…§å®¹åšä¿®æ”¹ï¼Œä¸¦åœ¨ä¸»æ©ŸåŠæœ¬æ©ŸåŠ ä¸Šæ¬Šé™\n(ref. https://xenby.com/b/220-æ•™å­¸-ç”¢ç”Ÿssh-keyä¸¦ä¸”é€ékeyé€²è¡Œå…å¯†ç¢¼ç™»å…¥)\n/var/www/.ssh/id_rsaï¼Œæœ‰åƒç…§ä¹‹å‰ä¸»æ©Ÿè¨­å®šï¼Œæ¬Šé™è¨­å®šæˆ www-dataï¼ˆæ­¤æ™‚æˆ‘æ²’æ³¨æ„åˆ°ï¼Œå¦ä¸€å€‹é—œéµé»ï¼‰ã€‚\nè§£æ±ºæ–¹æ¡ˆ\n1.å…ˆç™»å…¥æœ€é«˜æ¬Šé™\nsudo -i\n2.åˆ‡æ›æˆwww-data\nsu www-data\n3.å…ˆé€£ç·š\nssh 10.7.0.17\né‡æ¸…åŸå› \n\nä¸€é–‹å§‹æˆ‘ä»¥ç‚ºåªè¦æ˜¯ä½¿ç”¨è€…å¸³è™Ÿï¼Œéƒ½æ‡‰è©²æœƒåœ¨ homeåº•ä¸‹æœ‰ä½¿ç”¨è€…çš„è³‡æ–™å¤¾ï¼Œä½†ä¸çŸ¥é“www-dataï¼Œ\nä¸æœƒå»ºç«‹é€™å€‹è³‡æ–™å¤¾ï¼Œé è¨­æˆªå– /var/www/.sshçš„ id_rsa\nexec å¯èƒ½è®€ä¸åˆ° /var/www/.ssh/id_rsa çš„æª”æ¡ˆ\nsshçš„æ©Ÿåˆ¶æ˜¯é€™æ¨£çš„ï¼Œå‡è¨­Aè¦é€£ç·šåˆ°Bï¼Œè¦é€£ç·šçš„è©±ï¼Œé ˆå°‡ Açš„ .pub é‡‘é‘°ï¼Œè¤‡è£½åˆ°Bçš„ authorized_keysã€‚\nç¬¬ä¸€æ¬¡é€²å…¥æ™‚ï¼Œæœƒå°‡Aé‡‘é‘°è¨˜æ†¶å†Bçš„known_hostä¸Šï¼Œè®“æ—¥å¾ŒAå¯ä»¥å¿«é€Ÿé€£ç·šã€‚\n\næ‰€ä»¥ï¼Œåªè¦é€£ç·šéä¸€æ¬¡ï¼Œå°±æœƒè¨˜æ†¶ç›®å‰çš„é‡‘é‘°åˆ°ä¸»æ©Ÿä¸Šï¼Œæ—¥å¾Œå°±èƒ½å¤ ç›´æ¥ä½¿ç”¨IPé€£ç·š\nç¨‹å¼æœƒåƒä»¥ä¸‹ï¼Œä¸å†éœ€è¦-i ï¼Œé è¨­å°±æœƒæŠ“id_rsaä¾†ä½¿ç”¨ã€‚\n\n&lt;?php\nexec(&quot;scp -r /var/www/html/WebService/upload/tmp/fe8abe8e88fb3a2d88cc17a45a7575b1.png 10.7.0.17:/var/www/html/tmp/ 2&gt;&amp;1&quot;, $output, $return_var);\nprint_r($output);\necho &quot;return&quot; .$return_var;\necho &quot;&lt;br&gt;&quot;;\nexec(&quot;ssh 10.7.0.17 2&gt;&amp;1&quot;, $output,$return_var);\nprint_r($output);\necho &quot;return:&quot;.$return_var;\n?&gt;",
		"tags": [ "note","ğŸ§"]
},

{
		"title": " ğŸ³ Container MOC  ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ³ Container/0.Container MOC/",
		"content": "Docker Debug\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ³ Container/29.Dockerfile echo something/\">29.Dockerfile echo something</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ³ Container/152. ç¡¬ç¢Ÿç©ºé–“ä¸è¶³ï¼Œç„¡æ³•é€²å…¥å®¹å™¨/\">152. ç¡¬ç¢Ÿç©ºé–“ä¸è¶³ï¼Œç„¡æ³•é€²å…¥å®¹å™¨</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ³ Container/168. Docker buildå¤±æ•—è·³å‡ºkilled/\">168. Docker buildå¤±æ•—è·³å‡ºkilled</a>\n\nDockerfile\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ³ Container/32. nuxtJS çš„ Dockerfile/\">32. nuxtJS çš„ Dockerfile</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ³ Container/112. pyenchant & opencc error fix/\">112. pyenchant &amp; opencc error fix</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ³ Container/115. .net core æ‰“åŒ…dockerfile/\">115. .net core æ‰“åŒ…dockerfile</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ³ Container/138. gerapy+scrapyd+mongoçˆ¬èŸ²æ•´å¥—æµç¨‹/\">138. gerapy+scrapyd+mongoçˆ¬èŸ²æ•´å¥—æµç¨‹</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ³ Container/170. Dockerå•“ç”¨GPU/\">170. Dockerå•“ç”¨GPU</a>",
		"tags": [ "note","ğŸ³"]
},

{
		"title": "pythonæ‰“åŒ…dockerfileé™¤éŒ¯æ—¥è¨˜",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ³ Container/112. pyenchant &amp; opencc error fix/",
		"content": "ç¢ç¢å¿µ\næ–°å…¬å¸çš„ç¬¬ä¸€å€‹dockerfileå°±æ’ç‰†ï¼Œ\nè«åçš„éŒ¯èª¤ï¼Œè£äº†é‚„æ˜¯éä¸äº†ï¼Œ\nå¯«é€™å€‹ç¨‹å¼çš„èªªä¹Ÿæ²’ç”¨éï¼Œä»–å€‘éƒ½æ˜¯ç”¨æœ¬æ©Ÿè·‘AIã€‚\nåªå¥½è‡ªå·±äº‚æäº†..\næ­£æ–‡\ndebugæ–¹å¼ï¼Œéƒ½æ˜¯ç›´æ¥å»ç¿»pythonçš„ç¨‹å¼ç¢¼çœ‹è£é¢çš„å…§å®¹ã€‚\né€™å…©å€‹å¤§éƒ¨åˆ†éƒ½ç”¨ ctypes.util.find_library å»æ‰¾libraryã€‚\nç„¶å¾Œç¨‹å¼å…§éƒ½æœ‰å¯«é¡å¤–æ¢ä»¶ï¼Œç•¶find_libraryæ‰¾ä¸åˆ°æ™‚ï¼Œ\nå¯ä»¥å¾ç’°å¢ƒè®Šæ•¸å–å€¼ã€‚\næ‰€ä»¥ä¸‹é¢éƒ½æ˜¯ä½¿ç”¨ç’°å¢ƒè®Šæ•¸çš„æ–¹å¼ï¼Œè®“packageèƒ½å¤ å–å¾—libraryã€‚\npython debugæ™‚çš„å‚™å¿˜äº‹é …\n\npython3 package çš„ä½ç½®åœ¨ /usr/local/lib/python3.10/site-packages\nfind_libraryï¼Œæ ¹æ“šåŒäº‹çš„èªªæ³•ï¼Œæ‡‰è©²æ˜¯æŠ“pathçš„è·¯å¾‘ä¸‹å»åšæœå°‹\n\nç„¶å¾Œé–‹å§‹çœ‹codeå§ã€‚\nalpine linuxå®‰è£enchant\nè§£æ±º 'enchant' C library was not found\nImportError: The 'enchant' C library was not found and maybe needs to be installed.\nSee https://pyenchant.github.io/pyenchant/install.html\nfor details\n\nå…¶å¯¦æœ‰å®‰è£ py3-enchant å°±å¥½äº†ï¼Œ\nå¾ŒçºŒæ˜¯å› ç‚ºæ‰¾ä¸åˆ°libraryæ‰æœƒå™´éŒ¯ã€‚\napk add py3-enchant aspell aspell-en\n\næ‰€ä»¥è¨­å®šä¸€ä¸‹ç’°å¢ƒè®Šæ•¸ï¼Œæ”¶å·¥ã€‚\nä¸‹é¢ç¨‹å¼æ˜¯dockerfileç”¨çš„ï¼Œå¦‚æœè¦æ¸¬è©¦å°±æŠŠenvæ”¹æˆexportå§\nENV PYENCHANT_LIBRARY_PATH=/usr/lib/libenchant-2.so.2\n\nref.\nCannot find Enchant C library on Apple Silicon\nalpine linux å®‰è£opencc\nè§£æ±º libopencc.so.1 : No such file\nTraceback (most recent call last):\nFile &quot;/usr/local/app/Speech_control.py&quot;, line 3, in &lt;module&gt;\nfrom opencc import OpenCC\nFile &quot;/usr/local/lib/python3.10/site-packages/opencc.py&quot;, line 24, in &lt;module&gt;\nlibopencc = CDLL('libopencc.so.1', use_errno=True)\nFile &quot;/usr/local/lib/python3.10/ctypes/__init__.py&quot;, line 374, in __init__\nself._handle = _dlopen(self._name, mode)\nOSError: Error loading shared library libopencc.so.1: No such file or directory\n\nå› ç‚ºopenccåœ¨ repositoryçš„testingä¸Šé¢ï¼Œ\nç”¨ä¸‹é¢çš„æ–¹æ³•è£\napk add opencc --repository=http://dl-cdn.alpinelinux.org/alpine/edge/testing/\n\nå¥½äº†å¾Œè¨­å®šç’°å¢ƒè®Šæ•¸(é€™æ˜¯dockerfileç”¨çš„)\nENV LIBOPENCC=/usr/lib/libopencc.so.1.1\n\nå®Œæ•´dockerfile\né€™å€‹alpine linux , buildå‡ºä¾† 181.73MB\nFROM python:alpine3.16\nENV PATH &quot;$PATH:/usr/local/bin&quot;\nWORKDIR /usr/local/app\nRUN apk update &amp;&amp; apk add py3-enchant aspell aspell-en &amp;&amp; apk add opencc --repository=http://dl-cdn.alpinelinux.org/alpine/edge/testing/\nENV LIBOPENCC=/usr/lib/libopencc.so.1.1\nENV PYENCHANT_LIBRARY_PATH=/usr/lib/libenchant-2.so.2\nCOPY ./Chatbot_Speech /usr/local/app\nRUN pip3 install --upgrade pip\nRUN pip3 install --no-cache-dir -r requirements.txt\nENTRYPOINT [&quot;python&quot;, &quot;Speech.py&quot;]\n\nç”¨ubuntu ,build å‡ºä¾† 511.74MBï¼Œ\næœ¬ä¾†æ˜¯6xxï¼Œå¾Œä¾†æ¸…äº†ä¸€ä¸‹cacheï¼Œç¸®æ¸›ä¸€ä¸‹æ­¥é©Ÿå¾Œï¼Œæ‰è®Šæˆ511MB\nFROM ubuntu:20.04\nENV PATH &quot;$PATH:/usr/local/bin&quot;\nWORKDIR /usr/local/app\nCOPY ./Chatbot_Speech /usr/local/app\nRUN apt-get update &amp;&amp; apt-get install -y enchant &amp;&amp; apt-get install -y python3.6 python3-pip &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*\nRUN pip3 install --upgrade pip\nRUN pip3 install --no-cache-dir -r requirements.txt\nENTRYPOINT [&quot;python3&quot;, &quot;Speech.py&quot;]\n\nref.\n- æœ€ä½³åŒ– Dockerfile - ç²¾ç°¡ image",
		"tags": [ "note","ğŸ³"]
},

{
		"title": ".Net Coreæ‰“åŒ…Dockerfile",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ³ Container/115. .net core æ‰“åŒ…dockerfile/",
		"content": "ç¢ç¢å¿µ\nä»Šå¤©æ‰çŸ¥é“vistual studio çš„ç¥å¥‡åœ°æ–¹ï¼Œ\nç›´æ¥æ»‘é¼ æŒ‰ä¸€æŒ‰ï¼Œdockerfileå°±è‡ªå‹•ç”¢ç”Ÿäº†ï¼Œ\nä¹Ÿä¸ç”¨å¯«ï¼Œä¸éä¸æ˜¯vs codeçš„ç‰ˆæœ¬ã€‚\næ­£æ–‡\nFROM mcr.microsoft.com/dotnet/aspnet:3.1 AS base\nRUN apt-get update -y &amp;&amp; apt-get install -y libc6-dev libgdiplus libx11-dev &amp;&amp; apt-get clean &amp;&amp; ln -s /usr/lib/libgdiplus.so /usr/lib/gdiplus.dll\nWORKDIR /app\nEXPOSE 80\nEXPOSE 443\n\nFROM mcr.microsoft.com/dotnet/sdk:3.1 AS build\nWORKDIR /src\nCOPY ./**/*.csproj ./\n# RUN pwd &amp;&amp; ls -ahl\nRUN for file in $(ls *.csproj); do mkdir -p ./${file%.*}/ &amp;&amp; mv $file ./${file%.*}/; done\n# RUN pwd &amp;&amp; ls SystemManageService.Backend -ahl\nRUN dotnet restore SystemManageService.Backend/SystemManageService.Backend.csproj\n\nCOPY . .\nRUN dotnet build SystemManageService.Backend/SystemManageService.Backend.csproj -c Release -o /app/build\n\nFROM build AS publish\nRUN dotnet publish SystemManageService.Backend/SystemManageService.Backend.csproj -c Release -o /app/publish\n\nFROM base AS final\nWORKDIR /app\nCOPY --from=publish /app/publish .\nRUN ls\n\né€™é‚Šçš„é‡é»åœ¨é€™å…©æ®µï¼Œå–å¾—å°ˆæ¡ˆå…§æ‰€æœ‰çš„csprojï¼Œç„¶å¾Œä¸Ÿé€²å»buildçš„imageè£é¢ã€‚\nä½†æ˜¯ï¼Œé€™æ¨£ä¸¦ä¸æœƒæ ¹æ“šè³‡æ–™å¤¾æ”¾åˆ°å…¶ä»–ç‰¹å®šçš„åœ°æ–¹ï¼Œ\næ‰€ä»¥æ‰æœ‰for fileå»ºç«‹è³‡æ–™å¤¾è·Ÿç§»å‹•æª”æ¡ˆã€‚\nCOPY ./**/*.csproj ./\n# RUN pwd &amp;&amp; ls -ahl\nRUN for file in $(ls *.csproj); do mkdir -p ./${file%.*}/ &amp;&amp; mv $file ./${file%.*}/; done\n\nç¬¬ä¸€è¡Œé‡é»ï¼Œ\nFROM mcr.microsoft.com/dotnet/aspnet:3.1 AS base\n\næ­¤imageä¸èƒ½æ‹¿æ‰ï¼Œä¸€å®šè¦æœ‰ä¸€å€‹baseçš„ï¼Œ\nä¸ç„¶åœ¨é–‹ç™¼çš„æ™‚å€™ï¼Œæ¯æ¬¡éƒ½æœƒé‡buildä¸€æ¬¡image\nref. .NET Core Docker å†ä¹Ÿä¸ç”¨é€å€‹ COPY csproj æª”æ¡ˆå•¦ï¼",
		"tags": [ "note","ğŸ³"]
},

{
		"title": "gerapy+scrapyd+mongoçˆ¬èŸ²æ•´å¥—æµç¨‹",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ³ Container/138. gerapy+scrapyd+mongoçˆ¬èŸ²æ•´å¥—æµç¨‹/",
		"content": "ç¡ç¡å¿µ\næœ‰ä¸€å¤©çªç„¶ç™¼ç¾ï¼Œæˆ‘çš„çˆ¬èŸ²ä¸æœƒå‹•äº†ï¼ŒåŸå› æ˜¯ç¶²ç«™æ”¹ç‰ˆï¼Œæ‰€ä»¥è¦å‰‡è¦æ”¹ã€‚\næ–¼æ˜¯ï¼Œæ—¢ç„¶éƒ½è¦æ”¹äº†ï¼Œé‚£å°±æŠŠå¾ˆä¹…ä»¥å‰æ²’æœ‰æ¦‚å¿µçš„dockeréƒ½æ”¹ä¸€æ”¹å§ï¼Œ\né †ä¾¿æ”¹æˆdocker composeä¸€æ¬¡è§£æ±ºã€‚\næ­£æ–‡\næ›´æ–°ï¼Œå¾Œä¾†ä¹Ÿæ²’ç”¨é€™å¥—äº†ï¼Œä»–åœ¨æ’ç¨‹åŸ·è¡Œæ™‚æœ‰é»å•é¡Œï¼Œ\næœ€å¾Œé‚„æ˜¯å›æœ¬ä¾†çš„scrapyweb+scrapyd+mongoDBï¼Œ\nè«‹è¦‹æ–‡ç« æœ€å¾Œçš„Docker-compose.yaml\næ¶è¨­æœå‹™\ndocker-compose.yml\nversion: '3'\nservices:\nscrapyd:\ncontainer_name: scrapyd\nimage: vimagick/scrapyd\nvolumes:\n- ./data:/var/lib/scrapyd\n- /usr/local/lib/python3.7/dist-packages\nrestart: unless-stopped\nnetworks:\n- scrapy_net\ngerapy:\ncontainer_name: gerapy\nimage: germey/gerapy\nvolumes:\n- ./gerapy:/app/gerapy\nports:\n- 8000:8000\nnetworks:\n- scrapy_net\nmongo:\ncontainer_name: mongo\nimage: mongo:latest\nrestart: always\nvolumes:\n- ./mongodbdata:/data/db\nenvironment:\nMONGO_INITDB_ROOT_USERNAME: daimomadmin\nMONGO_INITDB_ROOT_PASSWORD: d@imom\nnetworks:\n- scrapy_net\nports:\n- 27017:27017\nmongo-express:\ncontainer_name: mongo-express\nimage: mongo-express\nrestart: always\nports:\n- 8081:8081\nenvironment:\nME_CONFIG_MONGODB_SERVER: 192.168.1.78\nME_CONFIG_MONGODB_PORT: 27017\nME_CONFIG_MONGODB_ADMINUSERNAME: daimomadmin\nME_CONFIG_MONGODB_ADMINPASSWORD: d%40imom\nnetworks:\n- scrapy_net\nnetworks:\nscrapy_net:\nname: scrapy\ndriver: bridge\n\nåŸ·è¡Œ\ndocker compose up -d\n\næ³¨æ„äº‹é …\nmongo-express åº•ä¸‹çš„ ME_CONFIG_MONGODB_ADMINPASSWORD\nç‚ºä»€éº¼æœƒå‡ºç¾ %40ï¼Ÿ\nå› ç‚ºç›´æ¥ç”¨@ æœƒå‡ºç¾éŒ¯èª¤ã€‚\n\nUnhandledPromiseRejectionWarning: MongoParseError: Unescaped at-sign in authority section\n\nä»¥ä¸‹æ˜¯chatGPTçš„å›ç­”\n\nè¨­å®šgerapy\nå¦‚æœæ˜¯æ ¹æ“šä¸Šé¢çš„docker composeå»ºç«‹çš„è©±ï¼Œ\nç¶²å€ç”¨ localhost:8000ç™»å…¥ï¼Œ\né è¨­çš„å¸³å¯†æ˜¯ admin/adminï¼Œé€²å»å¾Œæœ€å¥½æ”¹ä¸€ä¸‹ã€‚\n\nè¨­å®š scrapydçš„ä½ç½®ï¼Œåœ¨åŒä¸€å€‹networkè£é¢ï¼Œ\næ‰€ä»¥èƒ½é€™æ¨£äº’æ‰“ã€‚\n\nä¸Šå‚³å°ˆæ¡ˆ\né€™é‚Šè¦æ³¨æ„ï¼Œä¸Šå‚³çš„å£“ç¸®æª”æ¡ˆè£é¢è¦æœ‰ã€ .cfgã€çš„æª”æ¡ˆ\næª”æ¡ˆçµæ§‹å¦‚ä¸‹\n\nå£“ç¸®çš„æ™‚å€™ï¼Œè«‹é‡å°ä¸Šå±¤ç›®éŒ„ç›´æ¥å£“ç¸®ï¼Œä»¥ä¸Šåœ–ä¾†èªªå°±æ˜¯å£“ç¸®TaazeSpideré€™å€‹è³‡æ–™å¤¾ã€‚\nä¸Šå‚³å®Œå¾Œï¼Œå¯ä»¥æŒ‰Editï¼Œå¯ä»¥çœ‹åˆ°ç¨‹å¼ã€‚\n\néƒ¨ç½²åˆ°ä¸»æ©Ÿä¸Š\n\nå¿…é ˆå…ˆbuildï¼Œç„¶å¾Œæ‰å¯ä»¥deployåˆ°ä¸»æ©Ÿä¸Š\n\nå¦‚æœç¢°åˆ°æ‰“åŒ…å¤±æ•—æˆ–æ˜¯éƒ¨ç½²å¤±æ•—ï¼Œå¯ä»¥åˆ°ä¸»æ©Ÿä¸Šçœ‹ä¸€ä¸‹logã€‚\n\ndocker logs gerapy\ndocker logs scrapyd\n\næ¸¬è©¦é‹ä½œ\nåˆ°ä¸»æ©Ÿçš„è¨­å®šç•«é¢ï¼Œé¸æ“‡schedule ï¼Œç„¶å¾ŒæŒ‰ä¸‹run è·‘è·‘çœ‹æœ‰æ²’æœ‰æ­£å¸¸ã€‚\n\nè¨­å®šæ’ç¨‹\nName : éš¨æ„\nProject ï¼šprojectsçš„åç¨±\nSpiderï¼šåœ¨Scheduleçš„åç¨±ï¼Œå¯åƒè€ƒä¸Šåœ–\nClientsï¼šä¸»æ©Ÿåç¨±ï¼Œå¯ä»¥ç”¨é¸çš„\nTriggerï¼šcrontab æ˜¯å›ºå®šçš„æ™‚é–“åŸ·è¡Œ\ninterval æ˜¯ éš”å¤šä¹…åŸ·è¡Œ\ndate æ˜¯ ç‰¹å®šæ—¥æœŸ\n\nå¥½äº†å¾Œå¯ä»¥æŒ‰ä¸‹statusï¼Œå¯ä»¥çœ‹åˆ°ä¸‹æ¬¡åŸ·è¡Œæ™‚é–“ï¼Œå¾é€™çœ‹æœ‰æ²’æœ‰è¨­å®šæˆåŠŸã€‚\n\né€™é‚Šå¯ä»¥çœ‹åˆ° Next timeçš„æ™‚é–“\n\nref.\n- dockeréƒ¨ç½²æ‰“åŒ…å¤±æ•—\n- gerapy\n- CSSÂ SelectorÂ Reference\nScrapyweb+scrapyd\næœ€å¾Œé‚„æ˜¯ç”¨å›é€™å¥—äº†ï¼Œ\nç©©å®šåº¦å¤§å‹ï¼Œdbçš„å¸³è™Ÿå¯†ç¢¼ï¼Œå¿…é ˆèˆ‡çˆ¬èŸ²ä¸€è‡´\n\nversion: '3'\nservices:\nscrapyd:\ncontainer_name: scrapyd\nimage: germey/scrapyd\nvolumes:\n- ./data:/var/lib/scrapyd\n- /usr/local/lib/python3.7/dist-packages\nrestart: unless-stopped\nnetworks:\n- scrapy_net\nscrapydweb:\ncontainer_name: scrapydweb\nimage: ryanvin/scrapydweb\ndepends_on:\n- scrapyd\nports:\n- 5000:5000\nenvironment:\nUSERNAME: daiomom\nPASSWORD: password\nSCRAPYD_SERVERS: scrapyd\nvolumes:\n- ./scrapydweb_data:/app\nnetworks:\n- scrapy_net\nmongo:\ncontainer_name: mongo\nimage: mongo:latest\nrestart: always\nvolumes:\n- ./mongodbdata:/data/db\nenvironment:\nMONGO_INITDB_ROOT_USERNAME: daimomadmin\nMONGO_INITDB_ROOT_PASSWORD: password\nnetworks:\n- scrapy_net\nports:\n- 27017:27017\nmongo-express:\ncontainer_name: mongo-express\nimage: mongo-express\nrestart: always\nports:\n- 8081:8081\nenvironment:\nME_CONFIG_MONGODB_SERVER: 192.168.1.78\nME_CONFIG_MONGODB_PORT: 27017\nME_CONFIG_MONGODB_ADMINUSERNAME: daimomadmin\nME_CONFIG_MONGODB_ADMINPASSWORD: password\nnetworks:\n- scrapy_net\nnetworks:\nscrapy_net:\nname: scrapy\ndriver: bridge",
		"tags": [ "note","ğŸ³"]
},

{
		"title": "ç¡¬ç¢Ÿç©ºé–“ä¸è¶³ï¼Œç„¡æ³•é€²å…¥å®¹å™¨ï¼Œæ¸…é™¤è³‡æ–™å¤§ä½œæˆ°",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ³ Container/152. ç¡¬ç¢Ÿç©ºé–“ä¸è¶³ï¼Œç„¡æ³•é€²å…¥å®¹å™¨/",
		"content": "<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ³ Container/152. ç¡¬ç¢Ÿç©ºé–“ä¸è¶³ï¼Œç„¡æ³•é€²å…¥å®¹å™¨/#2024-07-16-docker-compose\">#2024/07/16ï¼Œdocker composeè¨­å®šæ–¹æ³•</a>\nç¡ç¡å¿µ\nä¸Šé€±åŒäº‹å•æˆ‘æ€éº¼é€£é€²å»å®¹å™¨è£é¢ï¼Œ\næˆ‘å¾ˆé †çš„å›ç­”æŒ‡ä»¤ï¼Œ\nç„¶å¾Œä»–å°±è·³å‡º é€™å€‹éŒ¯èª¤\n\nfailed to create runc console socket: mkdir /tmp/pty2070058578: no space left on device: unknown\n\næ­£æ–‡\nè™•ç†å•é¡Œ\nå¾éŒ¯èª¤è¨Šæ¯çœ‹èµ·ä¾†ï¼Œå°±æ˜¯ç©ºé–“ä¸è¶³ã€‚\nå…ˆçœ‹çœ‹æ˜¯å“ªé‚Šç¡¬ç¢Ÿåƒæ»¿äº†\ndf -h\n\nç„¶å¾Œçœ‹åˆ°user 100%...ç„¶å¾Œæ›è¼‰åœ¨ / æ ¹ç›®éŒ„ä¸‹ã€‚\nå†ä¾†æª¢æŸ¥ç•¶å‰ç›®éŒ„ï¼Œæ¯å€‹è³‡æ–™å¤¾çš„å¤§å°\ndu -hcd 1 | sort -n\n\næœ€å¾Œè¿½é˜¿è¿½çš„ï¼Œè¿½åˆ°äº†containerçš„ç›®éŒ„\n\n/var/lib/docker/\nè£é¢æœ‰ä¸€äº›containerå®¹é‡åƒå¾—å¾ˆå¤šï¼Œ\næœ€å¾Œç¢ºèªæ˜¯è©²containerçš„logï¼Œé‚£å°±ç äº†å§ã€‚\n\nrm -rf &lt;container_id&gt;.log\n\nå†è«‹åŒäº‹é€£ç·šï¼Œé‚„æ˜¯å‡ºç¾åŒæ¨£çš„éŒ¯èª¤ï¼Œ\næ˜¯ç”±æ–¼linuxçš„ç‰¹æ€§ï¼Œå°±ç®—ä½ ç äº†æª”æ¡ˆï¼Œ\næ­¤æª”æ¡ˆé‚„æ˜¯è¢«å’¬ä½æ²’æœ‰é‡‹æ”¾é–‹(windowæ˜¯é€£ç éƒ½ä¸èƒ½ç )ï¼Œ\næ‰€ä»¥æ­¤æ™‚å»æŸ¥ç¡¬ç¢Ÿå¤§å°ï¼Œé‚„æ˜¯100% usedçš„ç‹€æ…‹ï¼Œ\nå°‡dockeré‡é–‹å¾Œï¼Œå°±èƒ½é‡‹æ”¾ç©ºé–“äº†ã€‚\n\nè§£æ±ºå•é¡Œ\nç¾åœ¨çŸ¥é“æ˜¯containerçš„logæœƒä¸€ç›´å¢é•·ï¼Œ\né‚£å°±è¨­å€‹æ¢ä»¶ï¼Œè®“ä»–é•·åˆ°ä¸€å®šç¨‹åº¦å¾Œå°±ä¸èƒ½å†é•·å¤§äº†ã€‚\nå¦‚æœæ­¤è·¯å¾‘æ²’æª”æ¡ˆï¼Œå‰‡å»ºç«‹\nvim /etc/docker/daemon.json\n\nè¼¸å…¥\n{\n&quot;log-driver&quot;:&quot;json-file&quot;,\n&quot;log-opts&quot;:{\n&quot;max-size&quot; :&quot;500m&quot;,&quot;max-file&quot;:&quot;3&quot;\n}\n}\n\nmax-size : å–®å€‹å®¹å™¨çš„å–®æª”å¤§å°\nmax-file: logæ•¸é‡\nå¥½äº†å¾Œï¼Œé‡å•“æœå‹™\nsystemctl daemon-reload\nsystemctl restart docker\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¨­å®šçš„æ—¥èªŒå¤§å°è¦å‰‡ï¼Œåªå°æ–°å»ºçš„å®¹å™¨æœ‰æ•ˆ\nref.\n\nã€dockerã€‘dockeré™åˆ¶è¨˜éŒ„æª”å¤§å°çš„æ–¹æ³•+æŸ¥çœ‹è¨˜éŒ„æª”çš„æ–¹æ³•\ndocker å ±éŒ¯ï¼š failed to create runc console socket: mkdir /tmp/pty328598598: no space left on device\n\n2024/07/16ï¼Œdocker composeè¨­å®šæ–¹æ³•\nåœ¨docker compose å¢åŠ ä¸‹é¢èªæ³•\nservices:\nsrs:\ncontainer_name: srs\nlogging:\ndriver: &quot;json-file&quot;\noptions:\nmax-size: &quot;300m&quot;\nmax-file: &quot;3&quot;",
		"tags": ["2024/07/16ï¼Œdocker", "note","ğŸ³"]
},

{
		"title": "python PaddlePaddle æ‰“åŒ…image",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ³ Container/154. PaddlePaddle æ‰“åŒ…image/",
		"content": "ç¢ç¢å¿µ\né€™æ¬¡çš„AIç¨‹å¼åˆæ›´ç‰¹åˆ¥äº†ï¼Œ\nä¸€å †ä¸ç›¸å®¹çš„å¥—ä»¶ï¼Œ\nRDæ˜¯åœ¨windowsä¸Šé–‹ç™¼ï¼Œè¦åŒ…æˆimageä¸€å †ç‰†ï¼Œå˜–å˜–ã€‚\næ­£æ–‡\n\nlibGL.so.1\n\napt-get install libgl1\n\npycocotools\n\né€™å€‹å¥½è§£æ±ºï¼Œç›´æ¥åœ¨requirements.txtä¸Šé¢å¢åŠ  pycocotools\n\nPaddle\n\npip3 install paddlepaddle==2.4.2 -i https://mirror.baidu.com/pypi/simple\n\nPaddleå®‰è£å¤±æ•—\né€™å€‹å°±çœŸçš„æ©Ÿè»Šäº†ï¼Œå¾Œä¾†æŸ¥æ˜¯å› çˆ²paddleï¼Œä¸æ”¯æ´alpine linuxï¼Œ\næœ€å¾Œåªå¥½è£åœ¨ubuntuä¸Šé¢ã€‚\nref. github issue\n\ntorch\n\npip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu\n\nFROM ubuntu:20.04\nENV PATH &quot;$PATH:/usr/local/bin&quot;\nWORKDIR /usr/local/app\nCOPY . /usr/local/app\n\nRUN apt-get update &amp;&amp; apt-get install -y enchant &amp;&amp; apt-get install -y python3.7 python3-pip libgl1 &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*\nRUN pip3 install --upgrade pip\nRUN pip3 install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu\nRUN pip3 install paddlepaddle==2.4.2 -i https://mirror.baidu.com/pypi/simple\nRUN pip3 install --no-cache-dir -r requirements.txt\nENTRYPOINT [&quot;gunicorn&quot;,&quot;-c&quot; ,&quot;gunicorn_config.py&quot;,&quot;wsgi:app&quot;]",
		"tags": [ "note","ğŸ³"]
},

{
		"title": "NGINX-Certbot è‡ªå‹•è·ŸLet'sEncrytpå–å¾—æ†‘è­‰",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ³ Container/157. Docker NGINX-Certbot è‡ªå‹•è·ŸLet&#39;sEncrytpå–å¾—æ†‘è­‰/",
		"content": "ç¡ç¡å¿µ\nå‰äººå¾ˆå¼·ï¼Œå¾ˆå²å®³ï¼Œå–œæ­¡è‡ªå·±å‹•æ‰‹ï¼Œ\næ‰€ä»¥ä»–ç•¶åˆé€ çš„è‡ªå‹•å–å¾—Let's Encryptçš„ç¨‹å¼ï¼Œéƒ½æ˜¯è‡ªå·±å¯«ä¸€æ•´å¥—ä¾†ç”¨ã€‚\nç„¶å¾Œï¼Œäº¤æ¥äº†æ•´å¥—ï¼Œä½†ç¨‹å¼æ²’äººçŸ¥é“åœ¨å¹¹å˜›ï¼Œåªæœ‰æ¯æ¬¡å‡ºå•é¡Œæ™‚ï¼Œ\næœƒå»ç¿»APIçœ‹æ˜¯è¦å…ˆcallå“ªå€‹ï¼Œå†callå“ªå€‹ï¼Œç„¶å¾Œå†é‡é–‹æŸäº›image\næ‰èƒ½æ­£ç¢ºå–å¾—ï¼Œèº«çˆ²ä¸€å€‹æ‡¶äººï¼Œè·Ÿè…¦ç´°èƒå®¹é‡éå°çš„æˆ‘ï¼Œå¯¦åœ¨è¨˜ä¸ä½é˜¿ï¼Œ\nåªå¥½æ”¹äº†ã€‚\næ­£æ–‡\né€™å€‹åªé©åˆDockerï¼Œk8sè«‹æ”¹ç”¨cert-manage\nä½¿ç”¨èªªæ˜\næˆ‘é€™é‚Šæ˜¯æ›è¼‰user_conf.d åˆ° /etc/nginx/user_conf.d ï¼Œ\nuser_conf.då°±æ˜¯è¨­å®šæª”å­˜æ”¾çš„ä½ç½®ã€‚\ndocker-compose.yaml\nversion: '3'\n\nservices:\nnginx:\nimage: jonasal/nginx-certbot:latest\ncontainer_name: nginx\nrestart: unless-stopped\nnetworks:\n- cicd_net\nenv_file:\n- ./nginx-certbot.env\nports:\n- 80:80\n- 443:443\nvolumes:\n- nginx_secrets:/etc/letsencrypt\n- ./user_conf.d:/etc/nginx/user_conf.d\n\nvolumes:\nnginx_secrets:\n\n# è·Ÿdrone servereæ›åœ¨åŒä¸€å±¤\nnetworks:\ncicd_net:\nname: cicd_net\ndriver: bridge\n\nè¨˜å¾—æ›´æ”¹emailï¼Œä¸ç„¶å•“å‹•æœƒå¤±æ•—\nnginx-certbot.env\n# Required\nCERTBOT_EMAIL=&lt;email&gt;\n\n# Optional (Defaults)\nDHPARAM_SIZE=2048\nELLIPTIC_CURVE=secp256r1\nRENEWAL_INTERVAL=8d\nRSA_KEY_SIZE=2048\nSTAGING=0\nUSE_ECDSA=1\n\n# Advanced (Defaults)\nCERTBOT_AUTHENTICATOR=webroot\nCERTBOT_DNS_PROPAGATION_SECONDS=&quot;&quot;\nDEBUG=0\nUSE_LOCAL_CA=0\n\nuser_conf.dè³‡æ–™å¤¾å…§çš„æª”æ¡ˆåç¨±\nserver {\n# Listen to port 443 on both IPv4 and IPv6.\nlisten 443 ssl http2;\nlisten [::]:443 ssl http2;\n\n# Domain names this server should respond to.\nserver_name otpat.domain.com;\n\n# Load the certificate files.\nssl_certificate /etc/letsencrypt/live/otpat-domain-com/fullchain.pem;\nssl_certificate_key /etc/letsencrypt/live/otpat-domain-com/privkey.pem;\nssl_trusted_certificate /etc/letsencrypt/live/otpat-domain-com/chain.pem;\n\nssl_protocols TLSv1.3 TLSv1.2;\nssl_prefer_server_ciphers on;\nssl_ecdh_curve X25519:secp521r1:secp384r1;\nssl_ciphers TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;\nssl_session_cache shared:TLS:2m;\nssl_buffer_size 4k;\n\n# OCSP stapling\nssl_stapling on;\nssl_stapling_verify on;\nresolver 1.1.1.1 1.0.0.1 [2606:4700:4700::1111] [2606:4700:4700::1001]; # Cloudflare\n\n# return 200 'Let\\'s Encrypt certificate successfully installed!';\n# add_header Content-Type text/plain;\n\nlocation / {\nproxy_set_header X-Forwarded-For $remote_addr;\nproxy_set_header X-Forwarded-Proto $scheme;\nproxy_set_header Host $http_host;\n\nproxy_pass http://totp-auth:9987;\n\nproxy_redirect off;\nproxy_http_version 1.1;\nproxy_buffering off;\n\nchunked_transfer_encoding off;\n}\n\n}\n\nå®Œæˆå“ï¼Œå› ç‚ºè¦å°‡proxy_passå°åˆ°æœå‹™ä¸Šé¢ï¼Œæœ€å¥½æ˜¯è¨­æˆåŒä¸€å€‹networkï¼Œé€™é‚Šè¨­ç‚º cicd_net\n\nå¦‚æœå•“å‹•å¤±æ•—çš„è©±ï¼Œ\nå¯ä»¥æŸ¥ä¸€ä¸‹nginxè£é¢çš„éŒ¯èª¤è¨Šæ¯ï¼Œä¸Šé¢é€šå¸¸å¯«çš„å¾ˆæ¸…æ¥šã€‚\nå»ºè­°å¯ä»¥å…ˆçœ‹çœ‹é€™å…©ç¯‡\nref.\n- D15 - NGINX-Certbot Image\n- github_good_to_know",
		"tags": [ "note","ğŸ³"]
},

{
		"title": "Docker buildå¤±æ•—è·³å‡ºkilled",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ³ Container/168. Docker buildå¤±æ•—è·³å‡ºkilled/",
		"content": "ç¡ç¡å”¸\nå…§éƒ¨è¦æä¸€å€‹AIçš„é–‹ç™¼å¹³è‡ºï¼Œ\næ‰€ä»¥æˆ‘è² è²¬pythonçš„è² è¼‰å¹³è¡¡æ¶æ§‹ï¼Œ\nå› çˆ²ä»–çš„ç¨‹å¼é–‹ç™¼å¥½åƒæœ‰é»å›°é›£ï¼Œå°±ç”¨nginxçš„LBä¾†åšäº†ã€‚\næ­£æ–‡\né©—è­‰<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸŒ Network/169. Nginxçš„è² è¼‰å¹³è¡¡/\">169. Nginxçš„è² è¼‰å¹³è¡¡</a>æ™‚ï¼Œéœ€è¦è®“ç¯„ä¾‹ç¨‹å¼é¡¯ç¤ºä¸€ä¸‹è«‹æ±‚çš„è³‡è¨Šï¼Œ\nç¢ºèªçœŸçš„æœ‰åšåˆ°é€™å¡Šã€‚\næ‰“åŒ…ä»¥å‰çš„èˆŠAIç¨‹å¼æ™‚å°±æš´æ‰äº†ï¼Œ\nå‡ºç¾ killedçš„errorã€‚\n&gt; [6/8] RUN pip3 install torch torchvision torchaudio --index-url [https://download.pytorch.org/whl/cpu](https://download.pytorch.org/whl/cpu &quot;https://download.pytorch.org/whl/cpu&quot;):\n\n1.293 Looking in indexes: [https://download.pytorch.org/whl/cpu](https://download.pytorch.org/whl/cpu &quot;https://download.pytorch.org/whl/cpu&quot;) 2.901 Collecting torch 2.917 Downloading [https://download.pytorch.org/whl/cpu/torch-2.0.1%2Bcpu-cp38-cp38-linux_x86_64.whl](https://download.pytorch.org/whl/cpu/torch-2.0.1%2Bcpu-cp38-cp38-linux_x86_64.whl &quot;https://download.pytorch.org/whl/cpu/torch-2.0.1%2Bcpu-cp38-cp38-linux_x86_64.whl&quot;) (195.4 MB) 11.30 Killed ------ Dockerfile:25 -------------------- 23 | RUN apt-get update &amp;&amp; apt-get install -y enchant &amp;&amp; apt-get install -y python3.7 python3-pip libgl1 &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/* 24 | RUN pip3 install --upgrade pip 25 | &gt;&gt;&gt; RUN pip3 install torch torchvision torchaudio --index-url [https://download.pytorch.org/whl/cpu](https://download.pytorch.org/whl/cpu &quot;https://download.pytorch.org/whl/cpu&quot;) 26 | RUN pip3 install paddlepaddle==2.4.2 -i [https://mirror.baidu.com/pypi/simple](https://mirror.baidu.com/pypi/simple &quot;https://mirror.baidu.com/pypi/simple&quot;) 27 | RUN pip3 install --no-cache-dir -r requirements.txt -------------------- ERROR: failed to solve: process &quot;/bin/sh -c pip3 install torch torchvision torchaudio --index-url [https://download.pytorch.org/whl/cpu](https://download.pytorch.org/whl/cpu &quot;https://download.pytorch.org/whl/cpu&quot;)&quot; did not complete successfully: exit code: 137\n\næŸ¥äº†ä¸€ä¸‹ï¼Œèªªæ˜¯å› çˆ²è¨˜æ†¶é«”ä¸è¶³å°è‡´docker buildçš„æ™‚å€™æš´æ‰ã€‚\nref. PyTorch Docker build error\n`Killed`Â means that the compiler was killed by the kernel because it used too much memory. There are a few workarounds:\n\n- increase the memory limit for docker container\n- limit the number of concurrent builds by changing theÂ `Dockerfile`Â to includeÂ `MAX_JOBS=1`Â [here](https://github.com/pytorch/pytorch/blob/master/docker/pytorch/Dockerfile#L30)\n\næŠŠæˆ‘çš„docker resource çš„è¨˜æ†¶é«”è³‡æºåŠ å¤§å¾Œå°±å¥½äº†ï¼ˆæˆ‘macè¨˜æ†¶é«”åªæœ‰16G)ã€‚\n[[168-fig.1.jpg]]",
		"tags": [ "note","ğŸ³"]
},

{
		"title": "Dockerå•“ç”¨GPU",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ³ Container/170. Dockerå•“ç”¨GPU/",
		"content": "ç¡ç¡å”¸\nä¸Šé¢<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ³ Container/168. Docker buildå¤±æ•—è·³å‡ºkilled/\">168. Docker buildå¤±æ•—è·³å‡ºkilled</a><a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸŒ Network/169. Nginxçš„è² è¼‰å¹³è¡¡/\">169. Nginxçš„è² è¼‰å¹³è¡¡</a>ï¼Œ\né€™å…©ç¯‡éƒ½æ˜¯ç‚ºäº†è¦é”åˆ°å…§éƒ¨AIå¹³è‡ºå†ç”¨ï¼Œ\nä¸è¦è®“æ¯å€‹äººçš„é›»è…¦éƒ½è‡ªå·±è£ä¸€å †ç¨‹å¼ã€‚\næ­£æ–‡\né›»è…¦è£å®Œé¡¯å¡é©…å‹•å¾Œï¼Œè¦è®“dockerè­˜åˆ¥ï¼Œ\né‚„éœ€è¦é¡å¤–è£ NVIDIA Container Toolkit\nç…§è‘—å®˜æ–¹æ–‡ä»¶ä¾†ï¼ŒæŒºå¿«çš„ã€‚\né€™é‚Šè¨˜éŒ„ubuntuçš„æ–¹æ³•ï¼Œå…¶ä»–çš„å®‰è£æ–¹å¼ï¼Œè«‹åƒè€ƒä¸Šé¢æ–‡ä»¶\n\næ›´æ–°\n\ncurl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \\\n&amp;&amp; curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | \\\nsed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \\\nsudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list \\\n&amp;&amp; \\\nsudo apt-get update\n\nå®‰è£\n\nsudo apt-get install -y nvidia-container-toolkit\n\ndockerè¨­å®š ï¼ˆcontainerdã€CRI-Oçš„è©±ï¼Œåƒè€ƒä¸Šé¢é€£çµï¼‰\n\nsudo nvidia-ctk runtime configure --runtime=docker\n\né‡å•“\n\nsudo systemctl restart containerd\n\né©—è­‰\n\nsudo docker run --rm --runtime=nvidia --gpus all ubuntu nvidia-smi\n\né¡¯ç¤ºä¸‹é¢çš„è³‡æ–™å°±è¡¨ç¤ºæœ‰äº†ã€‚\n\nDocker-compose\nå¦‚æœä½¿ç”¨docker composeçš„è©±ï¼Œ\né ˆåœ¨yamlä¸Šé¢å¢åŠ ä¸€äº›è¨­å®šï¼Œcommand åˆ° capabilities\nç•¶ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šæ­¤containerè¦åƒç¬¬å¹¾å€‹gpuï¼Œ\næ›´è©³ç´°èªªæ˜è«‹åƒè€ƒTurn on GPU access with Docker Compose\næç¤ºï¼šä¸»è¦åœ¨countçš„è¨­å®š\nversion: '3.8'\nservices:\npython-1:\ncontainer_name: yolox-brand-1\nimage: busybox\ncommand: nvidia-smi\ndeploy:\nresources:\nreservations:\ndevices:\n- driver: nvidia\ncount: all\ncapabilities: [gpu]\npull_policy: if_not_present\nrestart: always\nnetworks:\n- internal\nnetworks:\ninternal:\nname: internal\ndriver: bridge",
		"tags": [ "note","ğŸ³"]
},

{
		"title": "Dockerfileé™¤éŒ¯æ¨¡å¼",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ³ Container/29.Dockerfile echo something/",
		"content": "å‰è¨€\nåœ¨å¹«äººå¯«è‡ªå‹•ä½ˆç½²çš„æ™‚å€™ï¼Œç™¼ç¾ä»¥å¾€çš„Dockeræœƒé¡¯ç¤ºç•«é¢ä¸Šçš„æŒ‡ä»¤ï¼Œ\né€™æ¬¡éƒ½æ²’æœ‰å‡ºä¾†ã€‚\næ­£æ–‡\nè§£æ±ºæ–¹æ¡ˆï¼ŒåŠ ä¸Š --progress=plain\ndocker build --progress=plain -t ey:0.1 .\n\nå¦‚æœæ²’æœ‰åŠ çš„è©±ï¼Œæœƒåƒ (fig.1)ï¼Œæœ‰åŠ çš„è©±ï¼Œå‰‡æœƒåƒ(fig.2)ï¼Œå°‡è¢å¹•ä¸Šçš„è³‡æ–™é¡¯ç¤ºå‡ºä¾†\nFROM gcr.io/cloud-builders/yarn:node-8.12.0 as build-env\nWORKDIR /app\n\nCOPY . .\nRUN pwd\nRUN ls\n\n(fig.1)\n(fig.2)\nref.Docker build not showing any output from commands",
		"tags": [ "note","ğŸ³"]
},

{
		"title": "nuxtJSçš„Dockerfile",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ³ Container/32. nuxtJS çš„ Dockerfile/",
		"content": "å‰è¨€\nåˆå¤šäº†ä¸€å€‹æ–°çš„å¥—ä»¶è¦åšï¼Œé€™æ¬¡ç”¨çš„æ˜¯nuxt.js ï¼ŒåªçŸ¥é“æ˜¯vue.jså»¶ä¼¸å‡ºä¾†çš„æ±è¥¿...\nç„¶å¾Œï¼Œä¸Šå§ã€‚\næ­£æ–‡\nå›  nuxt.js ï¼Œè·Ÿgoæœ‰é»åƒéƒ½æœƒè‡ªå·±å•Ÿå‹•ä¸€å€‹ä¼ºæœå™¨çš„æœå‹™ï¼Œ\nèµ°çš„æ˜¯SSRï¼ˆServer-Side Renderingï¼‰ï¼Œ\nä¸æ˜¯å¡ç‰ŒéŠæˆ²çš„SSRé˜¿ã€‚\nSSRçš„æ„æ€æ˜¯ï¼Œé é¢ç”±å¾Œç«¯æ¸²æŸ“ï¼ŒHTMLç”±å¾Œç«¯ç”¢ç”Ÿï¼ˆæ“šèªªæ˜¯è¦è®“é€Ÿåº¦æ¯”è¼ƒå¿«ï¼‰\nref.02. è¬›æ­·å²ï¼Œè©±èªª SSR...\nå› ç‚ºnuxt.jsæœƒè‡ªå·±å»ºç«‹ä¸€å€‹jsï¼Œ\næ‰€ä»¥æœ‰è¸©åˆ°ä¸€å€‹å‘ï¼Œ\nåœ¨è¨­å®š nuxt.config.jsçš„æ™‚å€™ï¼Œ\nè«‹ç¢ºèªå¥½port ä»¥åŠ æ˜¯ä¸æ˜¯é–‹äº†https ã€‚\nå»ºè­°å…ˆæŸ¥ä¸€ä¸‹ nuxt.config.js çš„å…§å®¹å±¬æ€§ï¼Œå†ä¾†æ‰“åŒ…åŠä½ˆç½²ã€‚\nref. 16. Nuxt å…¨åŸŸè¨­å®šæª” (nuxt.config.js)ï¼Œå¯ä»¥åƒå—ï¼Ÿ\né€™æ˜¯ç¬¬ä¸€å€‹ç‰ˆæœ¬ï¼Œä½¿ç”¨npmç·¨è­¯ã€‚\nFROM node:11.13.0\nCOPY . /usr/src/nuxt-app/\n\nRUN npm install\nRUN npm run build:qa\n\nEXPOSE 80\n\nENV NUXT_HOST=0.0.0.0\nENV NUXT_PORT=80\n\nCMD [ &quot;npm&quot;, &quot;start&quot; ]\n\nç¬¬äºŒå€‹ç‰ˆæœ¬ï¼Œæ”¹ä½¿ç”¨yarnå®‰è£ï¼Œé€™é‚Šè¦æ³¨æ„ï¼Œnodeç‰ˆæœ¬ï¼Œè«‹æŠ“æœ€æ–°çš„ï¼Œä¸ç„¶ç·¨è­¯çš„æ™‚å€™æœƒå‡ºç¾pythonéŒ¯èª¤ã€‚\nFROM node:16.3.0-alpine\nWORKDIR /usr/src/app\n\nCOPY . .\nRUN yarn install &amp;&amp; yarn cache clean\nRUN yarn build\nCMD [ &quot;yarn&quot;, &quot;start&quot; ]\n\né€™é‚Šåªå¯« yarn build ï¼Œæ˜¯å› ç‚ºåœ¨è¨­å®šnuxtçš„æ™‚å€™ï¼Œæœ‰å¯« build:qa è·Ÿ buildã€‚\nå› ç‚ºæ˜¯æœ€å¾Œæ¸¬è©¦å®Œçš„æˆæœäº†ï¼Œå°±æ”¹ç”¨yarn build ï¼ŒåšçµæŸã€‚\nref.\nä½¿ç”¨ yarn install æŒ‡ä»¤å®‰è£å¥—ä»¶æ™‚é–å®š yarn.lock ç‰ˆæœ¬\ndocker-hub node",
		"tags": [ "note","ğŸ³"]
},

{
		"title": " ğŸ‘ Observability MOC  ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ‘ Observability/0.Observability MOC/",
		"content": "æ¦‚å¿µ\n\n<a class=\"internal-link is-unresolved\" href=\"/404\">blog.45.ç¶²ç«™æ•ˆèƒ½æŒ‡æ¨™ä¸€è¦½ï¼ˆæœªï¼‰</a>\n<a class=\"internal-link is-unresolved\" href=\"/404\">96. SREç›£æ§çš„å››å¤§æŒ‡æ¨™åŠSLIã€SLOã€SLA</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ‘ Observability/195. SREå¯è§€æ¸¬æ€§ä¸‰å¤§æ”¯æŸ±/\">195. SREå¯è§€æ¸¬æ€§ä¸‰å¤§æ”¯æŸ±</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ‘ Observability/198. SREå¥½æ–‡é€£çµ/\">198. SREå¥½æ–‡é€£çµ</a>\n\nGrafana\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ‘ Observability/24.grafanaè¨­è¨ˆç¯‡-ç¬¬äºŒå€‹Yè»¸/\">24.grafanaè¨­è¨ˆç¯‡-ç¬¬äºŒå€‹Yè»¸</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ‘ Observability/25.åœ¨GKEä¸Šçš„grafanaä¸Šå®‰è£grafana-image-renderer/\">25.åœ¨GKEä¸Šçš„grafanaä¸Šå®‰è£grafana-image-renderer</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ‘ Observability/26.grafana alert message parameterså‚³å…¥/\">26.grafana alert message parameterså‚³å…¥</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ‘ Observability/28.Prometheusçš„å°ˆç”¨èªè¨€promQL/\">28.Prometheusçš„å°ˆç”¨èªè¨€promQL</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ‘ Observability/122. Grafana 8.Xä»¥å¾Œçš„alert åƒæ•¸/\">122. Grafana 8.Xä»¥å¾Œçš„alert åƒæ•¸</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ‘ Observability/124. grafana alertæ¯å››å°æ™‚é‡ç™¼ä¸€æ¬¡/\">124. grafana alertæ¯å››å°æ™‚é‡ç™¼ä¸€æ¬¡</a>\n<a class=\"internal-link is-unresolved\" href=\"/404\">184. grafana error reverse proxy settings on istio</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ‘ Observability/197. Grafana ä»¥åŠPrometheus é™¤éŒ¯æ–¹å¼/\">197. Grafana ä»¥åŠPrometheus é™¤éŒ¯æ–¹å¼</a>\n\nPrometheus\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ‘ Observability/131. rabbitMQ on Prometheus/\">131. rabbitMQ on Prometheus</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ‘ Observability/178. Install Prometheus Operator/\">178. Install Prometheus Operator</a>\n<a class=\"internal-link is-unresolved\" href=\"/404\">179. install Bindplane</a>",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "Grafana 8.Xä»¥å¾Œçš„alert åƒæ•¸",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ‘ Observability/122. Grafana 8.Xä»¥å¾Œçš„alert åƒæ•¸/",
		"content": "ç¡ç¡å¿µ\næ­£æ–‡\næ–°ç‰ˆçš„Grafanaæ›äº†alert ,\nç¾åœ¨æŠŠalerté€šé€šæ•´åˆåœ¨ä¸€èµ·äº†ï¼Œ\nç„¶å¾Œæˆ‘ä»¥å‰ç”¨çš„å‚³åƒæ•¸æ–¹æ³•ä¸èƒ½ç”¨äº†ï¼Œ\næœ€è¿‘éƒ½åœ¨æ¸¬è©¦é€™å€‹æ±è¥¿\nPrint Labels\nå¦‚æœåœ¨summaryä¸Šé¢å¯«\n\næœƒå°å‡ºæ­¤alertä¸Šé¢çš„é è¨­labelsæ¨™ç±¤ï¼Œ\nä¸‹åœ–ï¼Œæ˜¯æˆ‘è‡ªè¨‚çš„æ¨™ç±¤\n\nä½†å¯¦éš›å°å‡ºä¾†çš„éƒ½æ²’æœ‰å‡ºç¾\n\né™£åˆ—å°å‡ºä¾†å¾Œï¼Œå°±èƒ½å¤ æŒ‡å®šåç¨±é¡¯ç¤ºäº†ã€‚\n\nPrint Value\né€™æ¬¡æ”¹ä½¿ç”¨é€™å€‹åƒæ•¸\n\næœƒé¡¯ç¤º ä¸‰å€‹å€¼ã€‚\n\nè¨­å®šæ‰€ç”¨çš„æ¢ä»¶æœ‰å…©å€‹ï¼Œ\n\nçµè«–\nåŸºæœ¬ä½¿ç”¨è®Šæ•¸çš„æ–¹æ³•ï¼Œ\nå¦‚æœè¦é€²éšé»ï¼Œå¯èƒ½å°±éœ€è¦æ”¹ç”¨alert templateäº†ã€‚\nalert templateåƒè€ƒä¸‹é¢ç¶²å€\n\nHow To Use Alert Message Templates in Grafana\nCreate and edit message templates\n\nåƒè€ƒä¾†æº\n\nTemplating labels and annotations\nLabels in Grafana Alerting",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "grafana alertæ¯å››å°æ™‚é‡ç™¼ä¸€æ¬¡",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ‘ Observability/124. grafana alertæ¯å››å°æ™‚é‡ç™¼ä¸€æ¬¡/",
		"content": "ç¡ç¡å¿µ\næ–°çš„Grafana alert manage ï¼Œå¯èª¿æ•´çš„åœ°æ–¹é‚„çœŸå¤šé˜¿..\næ­£æ–‡\nå‘Šè­¦ä¸Šç·šå¾Œï¼Œåªè¦å‘Šè­¦ç‹€æ…‹æ²’è§£é™¤çš„è©±ï¼Œä»–æ¯4å°æ™‚æœƒé‡ç™¼ä¸€æ¬¡ã€‚\n\nåˆ° Alerting çš„ Notification policies ï¼Œè¨­å®šRoot policy\n\nå±•é–‹ Timing optionsï¼Œè¨­å®š Repeat interval\n\nref\n- Unified Alerting: alert triggers every 4 hours",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "rabbitMQ on Prometheus",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ‘ Observability/131. rabbitMQ on Prometheus/",
		"content": "ç¡ç¡å¿µ\næœ€è¿‘demoç’°å¢ƒç™¼ç”Ÿå•é¡Œï¼Œåˆæ­¥æ‡·ç–‘æ˜¯MQå› ç‚ºè¨Šæ¯é‡å¤ªå¤§æ›äº†ã€‚\nä½†æ²’æœ‰è­‰æ“šï¼Œå› ç‚ºMQçš„ç®¡ç†ä»‹é¢åªèƒ½çœ‹åˆ°ä¸€å°æ™‚çš„è³‡æ–™ã€‚\næ­£æ–‡\næœ¬ä¾†ç”¨operatorå®‰è£å®Œå¾Œï¼Œçœ‹äº†ä¸€äº›ä»‹ç´¹éƒ½èªªè¦é¡å¤–å•“å‹•å¤–æ›ï¼Œ\nä½†operatorè¦æ€éº¼å•“å‹•å¤–æ›ï¼Œæˆ‘å°±å…©çœ¼ä¸€æŠ¹é»‘äº†ã€‚\nçœ‹åˆ° RabbitMQå­¸ç¿’ç­†è¨˜ï¼šå…§å»ºPrometheusæ”¯æ´rabbit_prometheuså¤–æ›\nåŸä¾†ï¼Œæˆ‘çš„MQçš„15692 port å·²ç¶“é–‹äº†ï¼Œprometheuså·²ç¶“è¨­å®šå¥½ã€‚\n\nç”¨curlå»æŠ“è³‡æ–™ä¹Ÿæœ‰metricsï¼Œçœ‹ä¾†æ²’å•é¡Œäº†ã€‚\næƒ³èªªå¯ä»¥çµæ¡ˆäº†ï¼Œä½†æ˜¯ï¼ˆå°±æ€•é€™å€‹ä½†æ˜¯ï¼‰ï¼Œè£é¢æ²’æœ‰queueçš„è³‡æ–™ï¼Œ\næ‰€ä»¥çœ‹ä¸åˆ°æ¯å€‹queueçš„message rate\n\næ’ˆäº†ç›¸é—œçš„metricè£é¢ä¹Ÿæ²’æœ‰Queueçš„åç¨±ï¼Œå¯ä¾›filter\nmetricsèªªæ˜\næ‰€ä»¥ï¼ŒrabitMQ on k8så»ºå¥½å¾Œï¼Œåªè¦åœ¨prometheuså¯«å€‹jobå°±èƒ½å»æ’ˆè³‡æ–™äº†ã€‚\n- job_name: 'rabbitmq'\nscrape_interval: 30s\nstatic_configs:\n- targets:\n- 'prod-rabbitmq.rabbitmq-system.svc.cluster.local:15692'\n\nprod-rabbitmq æŒ‡çš„æ˜¯service name.\nç„¶å¾Œï¼Œgrafana dashboardå¯ä»¥ç”¨ # RabbitMQ-Overview",
		"tags": [ "note","âˆ"]
},

{
		"title": "Install Prometheus Operator",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ‘ Observability/178. Install Prometheus Operator/",
		"content": "å‰è¨€\næœ€è¿‘çœ‹å®Œ2023 Google Cloud summit ï¼Œ\nçœ‹åˆ°ä¸€å€‹æ–°æ±è¥¿ï¼ŒOpenTelemetryï¼Œå¯ä»¥ä¸ç”¨åŸ‹ç¨‹å¼ç”¨sidecarçš„æ–¹å¼ï¼Œ\nå°±èƒ½åšåˆ°Observabilityçš„traceï¼Œ\nä½†åœ¨é‚£ä¹‹å‰ï¼Œæˆ‘è¦å…ˆåœ¨æ¸¬è©¦å¢é›†è£ä¸€ä¸‹Prometheus Operatorï¼Œ\nä¸ç„¶è³‡æ–™å‚³ä¸éå»ã€‚\næ­£æ–‡\n\ngit clone\n\ngit clone https://github.com/prometheus-operator/kube-prometheus\n\ninstall\n\nkubectl apply --server-side -f manifests/setup\nkubectl wait \\\n\t--for condition=Established \\\n\t--all CustomResourceDefinition \\\n\t--namespace=monitoring\nkubectl apply -f manifests/\n\nåˆªé™¤\n\nkubectl delete --ignore-not-found=true -f manifests/ -f manifests/setup\n\nä¸éé€™å€‹å®‰è£æ–¹å¼ï¼ŒæœƒåŒ…å«\n\nTheÂ Prometheus Operator\nHighly availableÂ Prometheus\nHighly availableÂ Alertmanager\nPrometheus node-exporter\nPrometheus Adapter for Kubernetes Metrics APIs\nkube-state-metrics\nGrafana\n\nè‡ªå®šå®‰è£çš„è©±ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨helm\nhelm repo add prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo update\n\nè‡ªè¨‚å®‰è£,è¨­å®šåƒè€ƒ\nhelm install test prometheus-community/kube-prometheus-stack --namespace monitoring --create-namespace --values values.yaml\n\nä¸Šé¢æŒ‡ä»¤ä½¿ç”¨testç•¶é—œéµå­—ï¼Œæ‰€ä»¥éƒ¨ç½²æ™‚ä¹Ÿæœƒåœ¨ä¸Šé¢å¢åŠ \nè£œå……\nå¦‚æœä¸æƒ³è‡ªå·±æ¶Prometheusï¼Œä¹Ÿä¸æƒ³ç”¨Google Cloud Monitorï¼Œ\nå¯ä»¥è€ƒæ…®Googleè‡ªå·±å‡ºçš„ Google Managed Prometheus å®˜æ–¹æ–‡ä»¶\nref.\n\nGithub- kube-prometheus\nHelmå®‰è£ Prometheus Operator â€” ç‚º Kubernetes è¨­å®šåŠç®¡ç† Prometheus\nGoogle Managed Prometheus (GMP)",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "install Bindplane",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ‘ Observability/179.  install Bindplane/",
		"content": "å‰è¨€\næœ€è¿‘çœ‹å®Œ2023 Google Cloud summit ï¼Œ\nçœ‹åˆ°ä¸€å€‹æ–°æ±è¥¿ï¼ŒOpenTelemetryï¼Œå¯ä»¥ä¸ç”¨åŸ‹ç¨‹å¼ç”¨sidecarçš„æ–¹å¼ï¼Œ\nå°±èƒ½åšåˆ°Observabilityçš„traceï¼Œ\nä¸€é–‹å§‹å®‰è£OpenTelemetryï¼Œå¾Œä¾†ç™¼ç¾ï¼Œ\nä»–å¥½è‚¥ï¼ˆæ¸¬è©¦clusterç©ºé–“ä¸è¶³ï¼‰ï¼Œä¹‹å¾Œé‚„æéŒ¯äº†ä¸€ä»¶äº‹æƒ…ã€‚\nå¾Œä¾†æ”¹æ¸¬è©¦Bindplaneã€‚\næ­£æ–‡\nWhat is Bindplane?\n\nBindplane is an open source solution utilizing the OpAMP protocol to configure, monitor, and deploy various collectors.\nBindplane æ˜¯ä¸€å€‹é–‹æºè§£æ±ºæ–¹æ¡ˆï¼Œåˆ©ç”¨ OpAMP å”å®šä¾†è¨­å®šã€ç›£æ§å’Œéƒ¨ç½²å„ç¨®æ”¶é›†å™¨ã€‚\n\nä»–æ˜¯ä¸€å€‹ç›£æ§è·Ÿlogçš„æ”¶é›†å™¨ï¼Œä»–ä¸¦ä¸æ˜¯åƒefkæˆ–google cloudé‚£æ¨£çš„æ±è¥¿ã€‚\nref. What is OpAMP? And what is Bindplane?\nå®‰è£\n\nHelm add source\n\nhelm repo add &quot;bindplane&quot; \\ &quot;https://observiq.github.io/bindplane-op-helm&quot;\nhelm repo update\n\nå»ºç«‹çµ„æ…‹ values.yaml\n\nconfig:\nusername: &quot;admin&quot;\npassword: &quot;admin&quot;\nsecret_key: &quot;13c15d7c-233e-49e3-bef4-f7498f33518f&quot;\nsessions_secret: &quot;a4e5aa85-5df4-4edd-8cfe-d8a7257d09dd&quot;\n\nå®Œæ•´è¨­å®šåƒæ•¸\n\nå®‰è£\n\nhelm upgrade --install &quot;bindplane&quot; \\\n--values &quot;values.yaml&quot; \\\n--namespace bindplane \\\n--create-namespace \\\nbindplane/bindplane\n\nref. Deploy BindPlane OP Server on K8s\nè¨­å®š\n\nè¨­å®šport forwardè½‰éå»æœå‹™ä¸Š\n\nkubectl port-forward -n bindplane svc/bindplane 3001",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "grafana error reverse proxy settings on istio",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ‘ Observability/184. grafana error  reverse proxy settings on istio/",
		"content": "å‰è¨€\næ¬projectï¼Œå°±æƒ³ä¹¾è„†ä¸Šistioäº†ï¼Œ\nç„¶å¾Œå°±å¡åˆ°æ€éº¼ä»¥å‰çš„grafanaé–‹çš„èµ·ä¾†ï¼Œç¾åœ¨çš„é–‹ä¸èµ·ä¾†ã€‚\næ­£æ–‡\nç…§ä»¥å‰çš„æ–¹å¼è¨­å®šå®Œ root_urlï¼Œ\né‚„æ˜¯å‡ºç¾ç›¸åŒéŒ¯èª¤\n\næŸ¥æ–‡ä»¶å¾Œæ‰ç™¼ç¾ï¼Œ\næ‡‰è©²æ˜¯æ–°ç‰ˆ(9.5.5)éœ€è¦åŠ ä¸Šserve_from_sub_pathçš„åƒæ•¸ï¼Œ\nå¦‚æœç¢°åˆ°åªåŠ äº†root_urlä¹Ÿæ˜¯çœ‹åˆ°éŒ¯èª¤ï¼Œå°±å†åŠ å€‹åƒæ•¸å§ã€‚\ngrafana.ini\n[server]\nroot_url = &quot;http://&lt;ip&gt;/grafana/&quot;\nserve_from_sub_path = true\n\nvirtualservice.yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\nname: istio-virtualservice\nnamespace: istio-system\nspec:\nhosts:\n- &quot;&lt;ip&gt;&quot;\ngateways:\n- istio-system/istio-gateway\nhttp:\n- name: &quot;grafana&quot;\nmatch:\n- uri:\nprefix: /grafana/\n- uri:\nexact: /grafana\nroute:\n- destination:\nport:\nnumber: 3000\nhost: grafana.istio-system.svc.cluster.local\n\nref. Run Grafana behind a reverse proxy",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "SREå¯è§€æ¸¬æ€§ä¸‰å¤§æ”¯æŸ±",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ‘ Observability/195. SREå¯è§€æ¸¬æ€§ä¸‰å¤§æ”¯æŸ±/",
		"content": "å‰è¨€\nå»å¹´åº•çœ‹googleçš„ç ”è¨æœƒå°±æœ‰è¬›åˆ°OpenTelemetryï¼Œ\nä»Šå¤©åˆå‰›å¥½ç¢°åˆ°æœ‰äººåœ¨è¬›é€™å€‹æ±è¥¿ï¼Œ\næŒ‘å€‹æ™‚é–“æŠŠå®ƒå¼„å‡ºä¾†äº†ã€‚\næ­£æ–‡\nLogs, Tracing, Metrics\nOpenTelemetry æ¨å‹•å¯è§€æ¸¬æ€§ä¸‰å¤§æ”¯æŸ±W3Cæ•¸æ“šæ¡é›†çš„æ¨™æº–åŒ–\n\nç¯„ä¾‹\n\nref. å¾®æœå‹™åœ¨é›²åŸç”Ÿç’°å¢ƒçš„å¯è§€æ¸¬æ€§æ‡‰ç”¨",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "Grafanaä»¥åŠPrometheus é™¤éŒ¯æ–¹å¼",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ‘ Observability/197. Grafana ä»¥åŠPrometheus é™¤éŒ¯æ–¹å¼/",
		"content": "å‰è¨€\næœ€è¿‘åœ¨æŸ¥å€‹å•é¡Œï¼Œç„¶å¾Œå°±ç¢°åˆ°grafanaçš„åœ–è¡¨ç”¢ä¸å‡ºä¾†ï¼Œ\nè¦æ’ˆå‡ºæ¯å€‹podç›®å‰çš„è¨˜æ†¶é«”ä½¿ç”¨é‡ç™¾åˆ†æ¯”æ˜¯å¤šå°‘ã€‚\næ¯å€‹podçš„è¨˜æ†¶é«”ä½¿ç”¨é‡æ˜¯å¤šå€‹ï¼Œä½†ç¸½è¨˜æ†¶é«”åªæœ‰ä¸€å€‹ï¼Œ\nå°±é–‹å§‹æ‰¾å•é¡Œäº†ã€‚\næ­£æ–‡\né€™å€‹åœ–ä¾†è‡ª Prometheus &amp; Grafana No Data æ’æŸ¥æ‰‹å†Š\n\næˆ‘ç›®å‰çš„æ’æŸ¥æ–¹å¼ï¼Œ\né€šå¸¸éƒ½æ˜¯å…ˆé–‹prometheusï¼Œçœ‹æŒ‡ä»¤æœ‰æ²’æœ‰è³‡æ–™ï¼Œæ²’è³‡æ–™å°±è¡¨ç¤ºå¯«éŒ¯ã€‚\næœ‰è³‡æ–™ï¼Œåœ¨grafana ç„¡æ³•é¡¯ç¤ºï¼Œé‚£å°±æ˜¯grafanaçš„å•é¡Œã€‚\nç›®å‰ç¢°åˆ°çš„å•é¡Œæ˜¯å–®å€‹queryéƒ½æœ‰è³‡æ–™ï¼Œä½†æ¹Šåœ¨ä¸€èµ·å°±æ²’äº†ã€‚\nå¾Œä¾†æœ‰å•äº†ä¸€ä¸‹GPTï¼Œ\nç™¼ç¾ç›¸é™¤çš„è©±ï¼Œè¦ç¬¦åˆä¸€äº›æ¢ä»¶ã€‚\n\nåœ¨ Grafana ä¸­é€²è¡ŒæŸ¥è©¢çš„ç›¸é™¤ï¼Œéœ€è¦ç¢ºä¿ä»¥ä¸‹æ¢ä»¶ï¼š\n\nå…©å€‹æŸ¥è©¢çš„æ™‚é–“æˆ³åŒ¹é…ï¼š ç¢ºä¿å…©å€‹æŸ¥è©¢çš„æ™‚é–“æˆ³æ˜¯å°æ‡‰çš„ã€‚å¦‚æœæ™‚é–“æˆ³ä¸åŒ¹é…ï¼Œå‰‡æŸ¥è©¢çµæœç„¡æ³•æ­£ç¢ºé€²è¡Œç›¸é™¤ã€‚\n\næ¨™ç±¤åŒ¹é…ï¼š ç¢ºä¿å…©å€‹æŸ¥è©¢çš„æ¨™ç±¤åŒ¹é…ã€‚é€™åŒ…æ‹¬æ™‚é–“æˆ³çš„æ¨™ç±¤ï¼Œä»¥åŠåœ¨ä½¿ç”¨ by() å­å¥é€²è¡Œåˆ†çµ„æ™‚çš„æ¨™ç±¤ã€‚å¦‚æœæ¨™ç±¤ä¸åŒ¹é…ï¼ŒæŸ¥è©¢çµæœå¯èƒ½ç„¡æ³•æ­£ç¢ºåˆä½µã€‚\n\nä½¿ç”¨ ignoring() æˆ– on() å­å¥ï¼š å¦‚æœæœ‰ä¸€äº›æ¨™ç±¤ä¸éœ€è¦åŒ¹é…ï¼Œå¯ä»¥ä½¿ç”¨ ignoring() æˆ– on() å­å¥ã€‚ä¾‹å¦‚ï¼š\nA / ignoring(label_name) B\n\nä½¿ç”¨ group_left æˆ– group_right å­å¥ï¼š å¦‚æœéœ€è¦åœ¨æŸ¥è©¢ä¸­ä¿ç•™æŸäº›æ¨™ç±¤ï¼Œå¯ä»¥ä½¿ç”¨ group_left æˆ– group_right ä»¥ç¢ºä¿é€™äº›æ¨™ç±¤åœ¨åˆä½µæ™‚ä¿æŒä¸€è‡´ã€‚ä¾‹å¦‚ï¼š\nA / B on(label_name) group_left(label_name)\n\nç¢ºä¿æŸ¥è©¢çµæœæ˜¯æ•¸å€¼ï¼š ç¢ºä¿å…©å€‹æŸ¥è©¢è¿”å›çš„çµæœæ˜¯æ•¸å€¼ï¼Œä¸¦ä¸”æ”¯æŒç›¸é™¤æ“ä½œã€‚\n\nä»¥ä¸‹æ˜¯ä¸€å€‹ç°¡å–®çš„ä¾‹å­ï¼Œå‡è¨­ä½ æœ‰å…©å€‹æŸ¥è©¢ A å’Œ Bï¼Œè¦è¨ˆç®— A ä¸­æ¯å€‹æ™‚é–“æˆ³çš„å€¼é™¤ä»¥ B ä¸­å°æ‡‰æ™‚é–“æˆ³çš„å€¼ï¼š\nA / B\n\næ ¹æ“šä½ çš„æ•¸æ“šæºå’Œå…·é«”çš„éœ€æ±‚ï¼Œå¯èƒ½éœ€è¦æ ¹æ“šä¸Šè¿°æ¢ä»¶é€²è¡Œèª¿æ•´ã€‚é€™äº›æ¢ä»¶æœ‰åŠ©æ–¼ç¢ºä¿æŸ¥è©¢çµæœçš„æ­£ç¢ºæ€§ã€‚",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "SREå¥½æ–‡é€£çµ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ‘ Observability/198. SREå¥½æ–‡é€£çµ/",
		"content": "å‰è¨€\nçœ‹åˆ¥äººSREçš„æ–‡ç« ï¼Œæ„Ÿè¦ºé€™å€‹éœ€è¦è¨˜éŒ„ä¸€ä¸‹ã€‚\næ­£æ–‡\n\nå¡ç“¦é‚¦å™¶-æœ€è¿‘çš„å·¥ä½œæ„Ÿæ‚Ÿ\n\né€™ç¯‡ä¸»è¦ä»‹ç´¹ï¼Œä»–æ˜¯æ€éº¼è§£æ±ºä¸€ç›´å ±éŒ¯çš„æ–¹æ³•ã€‚\nç•¶å‘Šè­¦å¤ªå¤šï¼Œåªæœƒéº»ç—¹è€Œå·²ã€‚\næˆ‘ç›®å‰æŠŠé€šçŸ¥åˆ†æˆå…©ç¨®ï¼Œç¬¬ä¸‰ç¨®ï¼Œå·¥å–®æˆ‘é‚„æ²’æœ‰ç¢°åˆ°é€™å€‹æ¡ˆä¾‹ã€‚\né€šçŸ¥ï¼šä¸€èˆ¬è¨Šæ¯ï¼Œä¸é‡è¦ï¼Œä½†å¿…é ˆè¦çŸ¥é“ï¼ˆæœ•ï¼ŒçŸ¥é“äº†ï¼‰é€™ç¨®æ„Ÿè¦ºã€‚\nç·Šæ€¥ï¼šç¾åœ¨ã€ç«‹åˆ»ã€é¦¬ä¸Šè™•ç†ï¼ˆè­·é§•ï¼ï¼ï¼‰é€™ç¨®æ„Ÿè¦º\nå·¥å–®ï¼šéœ€è¦äººåŠ›ä»‹å…¥çš„æ“ä½œï¼ˆé‚„æ²’ç”¨éé€™ç¨®ï¼‰\n\nSRE çš„å·¥ä½œä»‹ç´¹\n\nè·Ÿä¸Šä¸€ç¯‡åŒä¸€å€‹ä½œè€…ï¼Œè¬›SREçš„å·¥ä½œå…§å®¹ï¼Œä¸åŒå…¬å¸æœƒæœ‰ä¸åŒçš„æ¬Šé‡ã€‚\nä½†è‡ºç£æ‡‰è©²éƒ½æ˜¯è·ŸDevOpsæ··åœ¨ä¸€èµ·ã€‚å¯èƒ½è¦æ›´å¤§çš„å…¬å¸æ‰æœ‰å·®ï¼Ÿ\nä½†æˆ‘èƒ½åŠ›ä¸è¶³æ²’å»éå¤§å…¬å¸ğŸ˜¢\n\nCNCFç°¡æ˜“åˆ†é¡",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "grafanaè¨­è¨ˆç¯‡-ç¬¬äºŒå€‹Yè»¸",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ‘ Observability/24.grafanaè¨­è¨ˆç¯‡-ç¬¬äºŒå€‹Yè»¸/",
		"content": "å‰è¨€\næ‡‰è©²æ˜¯å€‹å¾ˆå¸¸è¦‹çš„åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘å»æ‰¾äº†å¾ˆä¹…ï¼Œä¸€ç›´æ‰¾ä¸åˆ°ã€‚\næ­£æ–‡\nè¦åšå‡ºä¾†çš„æ±è¥¿åƒï¼ˆFig.1) ä¸€æ¨£ï¼Œå·¦å³éƒ½å„æœ‰ä¸€å€‹Yè»¸æ•¸å€¼ã€‚\n(Fig.1)\n\né¦–å…ˆè¦å…ˆåœ¨å³é‚Šçš„åœ–è¡¨å°‡showæ‰“é–‹ï¼Œï¼Œé€™è£¡åˆ†æˆå·¦å³å…©é‚Šçš„Yè»¸\n\n(Fig.2)\n\né»ä¸€ä¸‹labelçš„æ¨™ç±¤ï¼Œé¸æ“‡ Y-Axis ï¼Œå°‡ use y-axis æ‰“é–‹\n\n(Fig.3)\n\nref.\nLearn Grafana: How to use dual axis graphs",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "åœ¨GKEä¸Šçš„grafanaä¸Šå®‰è£grafana-image-renderer",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ‘ Observability/25.åœ¨GKEä¸Šçš„grafanaä¸Šå®‰è£grafana-image-renderer/",
		"content": "å‰è¨€\nåœ¨å¯«grafanaçš„æ™‚å€™ï¼Œæ‰ç™¼ç¾å‘Šè­¦çš„åœ–ç‰‡ç„¡æ³•å¯„å‡ºï¼Œ\nå¿…é ˆè¦é¡å¤–å®‰è£plugin : grafana-image-renderer ï¼Œ\nç„¶å¾Œï¼Œæˆ‘åˆå¡ä½äº†...\næ­£æ–‡\nå¦‚æœä½ çœ‹åˆ°é€™å¼µåœ–(fig.1)ï¼Œå°±è¡¨ç¤ºä½ è©²è£Grafana Image Rendereräº†ã€‚\n\n(fig.1)\nå…ˆèªªçµè«–ï¼Œæˆ‘æ¸¬éã€åœ¨podè£¡é¢åˆ©ç”¨grafana-cli å®‰è£ã€ã€ã€æ”¹æˆä½¿ç”¨ubuntuçš„imageé å…ˆå®‰è£pluginã€ï¼Œéƒ½å¤±æ•—ï¼Œæœ€å¾Œåªèƒ½å»ºç«‹ grafana-image-rendererçš„ æœå‹™ï¼Œé€éé€™å€‹æœå‹™ï¼Œè² è²¬å®£æŸ“ç•¶ä¸‹çš„å‘Šè­¦åœ–ï¼Œå†éš¨ç€telegramé€å‡ºã€‚\nä½ˆç½²çš„yamlï¼Œ grafana-image-render.yaml\napiVersion: apps/v1\nkind: Deployment\n\nmetadata:\nnamespace: istio-system\nname: grafana-image-renderer\nlabels:\napp: grafana-image-renderer\nversion: v1\nspec:\nreplicas: 1\nselector:\nmatchLabels:\napp: grafana-image-renderer\nversion: v1\nstrategy:\ntype: RollingUpdate\nrollingUpdate:\nmaxSurge: 1\nmaxUnavailable: 1\ntemplate:\nmetadata:\nlabels:\napp: grafana-image-renderer\nversion: v1\nspec:\ncontainers:\n- image: grafana/grafana-image-renderer:latest\nimagePullPolicy: &quot;Always&quot;\nname: renderer\nports:\n- containerPort: 80\nenv:\n- name: &quot;RENDERING_VERBOSE_LOGGING&quot;\nvalue: &quot;true&quot;\nresources:\nrequests:\nmemory: &quot;30Mi&quot;\ncpu: &quot;30m&quot;\nrestartPolicy: Always\nserviceAccountName: &quot;&quot;\n---\napiVersion: v1\nkind: Service\nmetadata:\nnamespace: istio-system\nlabels:\napp: grafana-image-renderer\nname: grafana-image-renderer\nspec:\nports:\n- name: &quot;http&quot;\nport: 8081\nselector:\napp: grafana-image-renderer\n\nç„¶å¾Œåœ¨ä½ˆç½² grafanaçš„yamlä¸Šé¢ï¼Œå¢åŠ ç’°å¢ƒåƒæ•¸\n- name: &quot;GF_RENDERING_SERVER_URL&quot;\nvalue: &quot;http://grafana-image-renderer.istio-system:8081/render&quot;\n- name: &quot;GF_RENDERING_CALLBACK_URL&quot;\nvalue: &quot;http://grafana.istio-system:3000/grafana/&quot;\n\nå¦‚æœè¦é–‹å•Ÿdebugçš„è©±ï¼ŒåŠ ä¸Š\n- name: &quot;GF_LOG_FILTERS&quot;\nvalue: &quot;rendering:debug&quot;\n\nå¦‚æœéœ€è¦æ›´å¤šçš„logè¨Šæ¯ï¼Œå¯åƒè€ƒ grafana-image-rendererï¼Œé€™é‚Šå°±æ˜¯æ”¹åŠ è‡³grafana-image-rendererä¸Šé¢äº†ã€‚\nä¸€é–‹å§‹åœ¨æ¸¬è©¦çš„æ™‚å€™æœ‰ç¢°åˆ°ä¸€å€‹å•é¡Œï¼Œ\né‚£å°±æ˜¯æŠ“åœ–çš„æ™‚å€™ï¼Œä¸€ç›´æŠ“åˆ°grafanaçš„é¦–é (Fig.2)\n[[25-fig.2.jpg]]\n(Fig.2)\nå¾Œä¾†æ‰ç™¼ç¾æ˜¯ GF_RENDERING_CALLBACK_URL éŒ¯èª¤ï¼Œç”±æ–¼æˆ‘çš„grafana.ini çš„ root_url æ˜¯ http://localhost/grafanaï¼Œ\næ‰€ä»¥ æˆ‘çš„ç¶²å€å¾Œé¢ä¹Ÿè¦åŠ ä¸Šgrafanaï¼Œä½†æ˜¯ï¼Œå¦‚æœåœ¨grafana.iniä¸Šé¢ çš„ root_url å¯« http://localhost/grafana\né‚£telegramçš„å‘Šè­¦ï¼Œé¡¯ç¤ºçš„urlä¹Ÿæœƒè®Šæˆlocalhost (fig.3)\n[[25-fig.3.jpg]]\n(Fig.3)\næ‰€ä»¥ï¼Œgrafana.iniçš„root_url æœ€å¥½é‚„æ˜¯å¯«å¯¦éš›çš„ipä½ç½®ã€‚",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "grafana alert message parameterså‚³å…¥",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ‘ Observability/26.grafana alert message parameterså‚³å…¥/",
		"content": "å‰è¨€\nåœ¨è¨­è¨ˆgrafana alert messageçš„æ™‚å€™ï¼Œ\nä¸€ç›´æƒ³å‚³åƒæ•¸é€²å»ï¼Œçœ‹å®˜æ–¹æ–‡ç« é¡¯ç¤ºæ˜¯å¯è¡Œçš„ï¼Œ\nä½†æ˜¯ä¸çŸ¥é“æ˜¯æˆ‘ç†è§£èƒ½åŠ›å¤ªçˆ›é‚„æ˜¯æ–‡ç« å¯«çš„å¤ªç°¡å–®...å¼„äº†åŠå¤©æ‰ç”Ÿå‡ºä¾†ã€‚\næ­£æ–‡\nå…ˆæ±ºæ¢ä»¶ï¼Œ Grafana v7.4 ä»¥ä¸Šï¼Œæ‰èƒ½å¤ ä½¿ç”¨ Notification templating ã€‚\nref. Notification templating\né€™é‚Šçš„parametersåªé™å®šæ–¼ åœ–è¡¨ä¸Šçš„ Legend çš„value\n\n(fig.1)ï¼Œ\néœ€ä½¿ç”¨ ï¼Œå°‡å€¼é¡¯ç¤ºåœ¨ä¸Šé¢ã€‚\næ‰€ä»¥é€™ä¸Šé¢æ²’æœ‰è³‡æ–™ï¼Œå°±ç„¡æ³•å‚³éå»çµ¦alert messageã€‚\n\n(fig.1)\nä¹‹å¾Œåœ¨alertä¸Šé¢å‰‡å¯ä»¥ä½¿ç”¨ ${label}ï¼Œå°‡å€¼å‚³å…¥ã€‚\n\ntelegram å‘ˆç¾\n\nç¼ºé»æ˜¯å‘Šè­¦è¨Šæ¯çš„Metricsä¸Šé¢çš„æ•¸å€¼ï¼Œæˆ‘ç›®å‰é‚„æ‰¾ä¸åˆ°æ–¹å¼å¯ä»¥è‡ªå®šã€‚\næ‰€ä»¥é•·çš„ä¸æ€éº¼è¨å–œã€‚\nå¦å¤–å¯ä»¥åœ¨åœ–è¡¨ä¸Šç›´æ¥å°‡Legendéš±è—ï¼Œé€™æ¨£è‡³å°‘ç•«é¢æœƒå¥½çœ‹è¨±å¤šã€‚\nref.\nAlert notification templating",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": "Prometheusçš„å°ˆç”¨èªè¨€promQL",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ‘ Observability/28.Prometheusçš„å°ˆç”¨èªè¨€promQL/",
		"content": "å‰è¨€\nåœ¨å¯«ç›£æ§å‘Šè­¦çš„æ™‚å€™ï¼Œçœ‹åˆ¥äººå¯«å¥½çš„dashboardè£¡é¢æœ‰ä¸€å †å‡½æ•¸ï¼Œ\nä½†å»ååä¸çŸ¥é“è©²æ€éº¼ä½¿ç”¨ï¼Œå¾Œä¾†æ‰çŸ¥é“é€™æ˜¯ Prometheusçš„èªè¨€ PromQLï¼Œ\né€™é‚Šæœƒå°‡å¯«ç›£æ§æ™‚ç”¨åˆ°çš„æ±è¥¿è¨˜ä¸‹ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯é‡å°metricsåšçš„è™•ç†ã€‚\næ­£æ–‡\nèšåˆå‡½æ•¸\n\nsum (æ±‚å’Œ)\nmin (æœ€å°å€¼)\nmax (æœ€å¤§å€¼)\navg (å¹³å‡å€¼)\nstddev (æ¨™å‡†å·®)\nstdvar (æ¨™å‡†å·®ç•°)\ncount (è¨ˆæ•¸)\ncount_values (å°valueé€²è¡Œè¨ˆæ•¸)\nbottomk (å¾Œnæ¢æ™‚åº)\ntopk (å‰næ¢æ™‚åº)\ntopk(10,prometheus_http_requests_total) ï¼šå‰10ç­†è³‡æ–™\nquantile (åˆ†ä½ˆçµ±è¨ˆ)\n\nèšåˆå‡½æ•¸å¯èˆ‡by æˆ– withoutå…±åŒä½¿ç”¨ ï¼Œå¯å–å¾—metricsè£¡çš„æ¬„ä½åç¨±\nä¾‹ï¼š\n\nsum(rate(istio_requests_total{reporter=&quot;destination&quot;}[1m])) by (destination_workload)\n\nå…§å»ºå‡½æ•¸\n\nabs(çµ•å°å€¼)\nabsent(åˆ¤æ–·æŒ‡æ¨™åç¨±æˆ–æ¨™ç±¤æ˜¯å¦æœ‰å€¼)\nabsent_over_time(åŒä¸Šï¼Œå¤šäº†æ™‚é–“ç¯„åœ)\nceil(å››æ¨äº”å…¥)\nchanges(è¿”å›å€é–“è®Šæ•¸æ¯å€‹æ¨£æœ¬å€¼è®ŠåŒ–çš„æ¬¡æ•¸)\ndelta(è¨ˆç®—å€é–“å‘é‡ç¬¬ä¸€å€‹å€¼å’Œæœ€å¾Œä¸€å€‹å€¼çš„å·®å€¼)\nfloor(å–æ•´æ•¸)\nincrease(è¿”å›å€é–“å‘é‡ç¬¬ä¸€å€‹å’Œæœ€å¾Œä¸€å€‹æ¨£æœ¬çš„å¢åŠ å€¼)\nrate(è¨ˆç®—å€é–“å‘é‡ v åœ¨æ™‚é–“è¦–çª—å…§å¹³å‡æ¯æ™‚é–“å¢é•·é€Ÿç‡)\nrate(prometheus_http_requests_total[5m]) ï¼š HTTPè«‹æ±‚é‡çš„å¢é•·ç‡\nirate(è¨ˆç®—å€é–“å‘é‡çš„å¢é•·ç‡ï¼Œä½†æ˜¯å®ƒåæ‡‰çš„æ˜¯ç¬æ™‚å¢é•·ç‡)\nderiv(è¨ˆç®—æ¨£æœ¬çš„ç·šæ€§å›æ­¸æ¨¡å‹)\npredict_linear(é æ¸¬æ™‚é–“åºåˆ—åœ¨nç§’å¾Œçš„å€¼)\nsort(å°å‘é‡æŒ‰å…ƒç´ çš„å€¼é€²è¡Œå‡åºæ’åº)\nsort_desc(å°å‘é‡æŒ‰å…ƒç´ çš„å€¼é€²è¡Œé™åºæ’åº)\n\nå¯¦éš›æ¼”ç·´\nå¯ä»¥å…ˆåœ¨prometheusä¸Šé¢æ¸¬è©¦èªæ³•ï¼Œç•¶æ¸¬è©¦å®Œæˆå¾Œï¼Œå†æ”¾åˆ°grafanaä¸Šé¢çœ‹å¯¦éš›çš„åœ–è¡¨ã€‚\nä¹Ÿå¯é€éç¾æœ‰çš„grafanaçš„dashboardè£¡é¢çš„Query Inspect å°‡Metricæ’ˆå‡ºä¾†ï¼ˆé€™é‚Šå¯ä»¥ç›´æ¥å°‡è®Šæ•¸å–å‡ºï¼‰(fig.1)\næ’ˆå‡ºä¾†çš„è³‡æ–™è¦å†ç¶“é urldecode å°‡ç¬¦è™Ÿè½‰æˆæ­£å¸¸çš„ç¬¦è™Ÿ\n\n(fig.1)\næ‰€æœ‰çš„Metricæ ¼å¼å¦‚ä¸‹ï¼Œ\næŒ‡æ¨™åç¨±åªèƒ½ç”±ASCIIå­—ç¬¦ã€æ•¸å­—ã€ä¸‹åŠƒç·šä»¥åŠå†’è™Ÿçµ„æˆä¸¦å¿…é ˆç¬¦åˆæ­£å‰‡è¡¨é”å¼[a-zA-Z_:][a-zA-Z0-9_:]*\n&lt;metric name&gt;{&lt;label name&gt;=&lt;label value&gt;, ...}\n\nåŒ¹é…å‡½æ•¸\n\n= ç­‰æ–¼\n!= ä¸ç­‰æ–¼\n=~ é–‹é ­ç­‰æ–¼\n!~ é–‹é ­ä¸ç­‰æ–¼\n\næœ‰æ™‚ä¹Ÿæœƒåœ¨label nameä¸Šé¢ä½¿ç”¨ æ­£è¦è¡¨ç¤ºæ³•ï¼Œé€™é‚Šä½¿ç”¨çš„æ˜¯RE2èªæ³•\nä¾‹å¦‚ï¼Œæˆ‘å€‘è¦å–å¾—memoryçš„è³‡æ–™ï¼Œå…¶ä¸­çš„imageçš„é–‹é ­åªè¦åŒ…å« gcr.io è·Ÿ istioã€‚\ncontainer_memory_working_set_bytes{id!=&quot;/&quot;,pod=~&quot;.*&quot;,image=~&quot;[gcr.io | istio].*&quot;}\n\nè®Šæ•¸è¨­å®š\nåœ¨grafanaä¸Šé¢é€šå¸¸æœƒè¨­å®šä¸€äº›åƒæ•¸ï¼Œé€™æ˜¯ç‚ºäº†çœ‹æŒ‡å®šçš„æŒ‡æ¨™\næœ‰å››ç¨®å¯é¸ï¼Œ\n\nlabel_values(label) :\nè¿”å›Promthuesæ‰€æœ‰ç›£æ§æŒ‡æ¨™ä¸­ï¼Œæ¨™ç±¤ç¨±ç‚ºlabelçš„æ‰€æœ‰å¯é¸å€¼\nlabel_values(metric, label) :\nè¿”å›Promthuesæ‰€æœ‰ç›£æ§æŒ‡æ¨™metricä¸­ï¼Œæ¨™ç±¤ç¨±ç‚ºlabelçš„æ‰€æœ‰å¯é¸å€¼\nmetrics(metric) :\nè¿”å›æ‰€æœ‰æŒ‡æ¨™åç¨±æ»¿è¶³metricå®šç¾©æ­£å‰‡è¡¨é”å¼çš„æŒ‡æ¨™åç¨±\nquery_result(query) :\nè¿”å›prometheusæŸ¥è©¢èªå¥çš„æŸ¥è©¢çµæœ\n\nå¸¸ç”¨çš„label_value\n$Node label_values(kubernetes_io_hostname)\n$Pod label_values(kube_pod_info, pod)\n$Pod_ip label_values(kube_pod_info, pod_ip)\n$phase label_values(kube_pod_status_phase, phase)\n$container label_values(kube_pod_container_info, container)\n\nquery_resultç¯„ä¾‹ï¼Œ\nquery_result(kube_deployment_status_replicas{namespace !~ &quot;istio-system|kube-system&quot;}&gt;0)\n\nè§£é‡‹ï¼šæ’é™¤Deploymentè£¡é¢çš„namespace ä¸æ˜¯ istio-systemæˆ– kube-systemï¼Œä¸¦ä¸”value&gt;0çš„metricsã€‚\né€™é‚Šæœƒé¡¯ç¤ºå…¨éƒ¨çš„è³‡æ–™ï¼Œæ•…åœ¨regexè¦å†æŒ‡å®šæŠ“å– deploymentçš„è³‡æ–™\n/.*deployment=&quot;(.*?)&quot;.*/\n\nref.\nGrafana templating with Prometheus labels\næ¨¡æ¿åŒ–Dashboard\nPromQLçš„ç°¡å–®ä½¿ç”¨\nref.\nPrometheus-åŸºç¤ç³»åˆ—-(å››)-PromQLèªå¥å¯¦è¸-2\nPromQL å…§ç½®å‡½æ•¸\nPromQLæ“ä½œç¬¦",
		"tags": [ "note","ğŸ‘"]
},

{
		"title": " ğŸ’» Code MOC ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ’» Code/0.Code MOC/",
		"content": "APIä¸²æ¥\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ’» Code/22.telegram apiä½¿ç”¨/\">22.telegram apiä½¿ç”¨</a>\n\nGolang\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ’» Code/Golang/40. golang é‡æ–°è®€å–è¨­å®šæª”çš„æ–¹æ³•/\">40. golang é‡æ–°è®€å–è¨­å®šæª”çš„æ–¹æ³•</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ’» Code/Golang/47. GO get åƒæ•¸/\">47. GO get åƒæ•¸</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ’» Code/Golang/155. scrapyçˆ¬æš—é»‘ç·¨å¹´å²çš„ä¸–ç•Œç‹æ™‚é–“/\">155. scrapyçˆ¬æš—é»‘ç·¨å¹´å²çš„ä¸–ç•Œç‹æ™‚é–“</a>\n<a class=\"internal-link is-unresolved\" href=\"/404\">156. Golangç°¡ç•¥ç­†è¨˜ï¼ˆä¸€ï¼‰</a>\n\næ­£å‰‡è¡¨é”å¼\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ’» Code/38.æ­£å‰‡å–ä»£ï¼Œç•™ä¸‹ç‰¹å®šå­—ä¸²/\">38.æ­£å‰‡å–ä»£ï¼Œç•™ä¸‹ç‰¹å®šå­—ä¸²</a>\n\nGit\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ’» Code/59. git refsï¼Œbranch è·Ÿ tagæ˜¯ä¸€æ¨£çš„ã€‚/\">59. git refsï¼Œbranch è·Ÿ tagæ˜¯ä¸€æ¨£çš„ã€‚</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ’» Code/110.github action pipelineç­†è¨˜/\">110.github action pipelineç­†è¨˜</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ’» Code/145. git submodule ä¸‹è¼‰å¤±æ•—/\">145. git submodule ä¸‹è¼‰å¤±æ•—</a>\n\nIDE\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ’» Code/107. vscode å¿½ç•¥è¨­å®šåŒæ­¥/\">107. vscode å¿½ç•¥è¨­å®šåŒæ­¥</a>",
		"tags": [ "note","ğŸ’»"]
},

{
		"title": "vscode å¿½ç•¥è¨­å®šåŒæ­¥",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ’» Code/107. vscode å¿½ç•¥è¨­å®šåŒæ­¥/",
		"content": "ç¢ç¢å¿µ\nå…¬å¸ä¸€è‡ºé›»è…¦ï¼Œæˆ‘è‡ªå·±å¸¶äº†ä¸€è‡ºmacéå»ï¼Œ\nå› ç‚ºæˆ‘å·²ç¶“linuxç”¨ç¿’æ…£äº†ï¼ˆXï¼‰\nä¸å¾—ä¸èªªmacç”¨ç¿’æ…£çœŸçš„å¥½é †...\næ­£æ–‡\n\næ‡‰è©²éƒ½çŸ¥é“linuxçš„æª”æ¡ˆç³»çµ±è·Ÿwindowsçš„æª”æ¡ˆç³»çµ±ä¸ä¸€æ¨£ã€‚\nå‰è€…æ²’æœ‰Cã€Dã€Eçš„æ¦‚å¿µï¼Œ\næ‰€ä»¥vscodeçš„ background\nåœ¨åœ–ç‰‡è·¯å¾‘çš„è¨­å®šä¸Šæœƒä¸ä¸€æ¨£ï¼Œmacæ˜¯ä½¿ç”¨ä¸‹éºµé€™ç¨®æ–¹å¼è¨­å®švscodeçš„èƒŒæ™¯\nfile:///Users/daimom/Pictures/1275337.jpeg\n\nwindowså‰‡æ˜¯\nfile://c:\\Users\\user\\Pictures\\1275337.jpeg\n\nä¸€æ—¦åŒæ­¥çš„è©±ï¼Œå…©é‚Šçš„è·¯å¾‘å°±æœƒè¡çªï¼Œå°è‡´ä¸€é‚Šæ²’åœ–ç‰‡ã€‚\næ‰€ä»¥ç¾åœ¨è¦è¨­å®šï¼Œå¿½ç•¥vscodeçš„åŒæ­¥è¨­å®šï¼Œè®“ä»–ä¸è¦æŠŠåœ–ç‰‡è¨­å®šçš„åœ°æ–¹ä¹ŸåŒæ­¥ã€‚\nåœ¨è¨­å®šçš„æŸ¥è©¢æ¬„ä½ï¼Œè¼¸å…¥ ã€åŒæ­¥ã€ï¼Œ\né¸æ“‡å¿½ç•¥çš„è¨­å®šã€‚\n\næ‡‰è©²æœƒçœ‹åˆ° settingsSync.ignoredSettings ï¼Œ\nåº•ä¸‹è¼¸å…¥background.customImages\n&quot;settingsSync.ignoredSettings&quot;: [\n\n&quot;background.customImages&quot;\n\n],",
		"tags": [ "note","ğŸ’»"]
},

{
		"title": "github action pipelineç­†è¨˜",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ’» Code/110.github action pipelineç­†è¨˜/",
		"content": "å‰è¨€\nå› ç‚ºä¹‹å‰ç”¨çš„å·´å“ˆè‡ªå‹•ç°½åˆ°ï¼Œé‚£å€‹githubè¢«å°äº†ï¼Œ\nèªªé•åæœå‹™æ¢æ¬¾ï¼Œé‚„å¥½æˆ‘ä¸»ç¨‹å¼æœ‰ä¸‹è¼‰ä¸‹ä¾†éã€‚\næœªä¾†æŠŠä»–æ‰“åŒ…æˆimageå¾Œåœ¨æœ¬æ©Ÿè·‘äº†å§ï¼Œ\nä¸éè¦å…ˆè§£ægithubçš„workflowçœ‹æ˜¯æ€éº¼æ‰“åŒ…æˆimageçš„\næ­£æ–‡\nname: Publish\n\non:\npush:\nbranches:\n- main\npaths-ignore:\n- &quot;**.md&quot;\nworkflow_dispatch:\n\njobs:\n\npublish_docker:\nruns-on: ubuntu-latest\nsteps:\n- name: Checkout Source Code\nuses: actions/checkout@v3\n\n- name: Install PNPM\nuses: pnpm/action-setup@v2.2.2\nwith:\nversion: latest\nrun_install: true\n\n- name: Build Package\nrun: pnpm build:package\n\n- name: Set up QEMU\nuses: docker/setup-qemu-action@v2\n\n- name: Set up Docker Buildx\nuses: docker/setup-buildx-action@v2\n\n- name: Login to Docker Hub\nuses: docker/login-action@v2\nwith:\nusername: $\npassword: $\n\n- name: Build Image and Push\nrun: |\npnpm build:package\npnpm build:docker\n\nname : actionçš„åç¨±\non ï¼šä»€éº¼æ™‚å€™è§¸ç™¼\njob: è¦åŸ·è¡Œçš„å‹•ä½œ\npublish_docker : ä½œæ¥­çš„åç¨±\nruns-on: åŸ·è¡Œçš„os\nstepsï¼šåŸ·è¡Œçš„æ­¥é©Ÿ\n\nçµè«–\nç”¨äº†ä¸€é™£å­ä»¥å¾Œï¼Œ\né‚£å€‹å°ˆæ¡ˆè¢«githubå°æ‰äº†ï¼Œ\næœ€å¾Œæ”¹ç”¨chrome çš„å¤–æ› ï¼Œ\nç¼ºé»å°±æ˜¯é›»è…¦è¦ä¸€ç›´é–‹è‘—ï¼Œåæ­£æˆ‘é›»è…¦ä¹Ÿä¸€ç›´é–‹ç€æ‰€ä»¥æ²’é—œä¿‚",
		"tags": [ "note","ğŸ’»"]
},

{
		"title": "git submodule ä¸‹è¼‰å¤±æ•—",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ’» Code/145. git submodule ä¸‹è¼‰å¤±æ•—/",
		"content": "ç¡ç¡å¿µ\nå› ç‚ºä»–å€‘çš„æ–°å°ˆæ¡ˆæœ‰ç”¨åˆ° gitçš„submoduleï¼Œ\nä¹‹å‰ä¹Ÿç”¨éä¸€æ¬¡äº†ï¼Œæƒ³èªªæ‡‰è©²é‚„å¥½ï¼Œ\nä½†é€™æ¬¡å°±æ˜¯æ€éº¼é©—è­‰ï¼Œæ€éº¼ä¸éã€‚\næ­£æ–‡\néƒ½æ˜¯å‡ºç¾é€™å€‹éŒ¯èª¤\n\nCloning into '/drone/src/BackendSharedLib'...\nHost key verification failed.\nfatal: Could not read from remote repository.\n\nä½†ä¹‹å‰å¯«çš„å°ˆæ¡ˆå°±æ²’é€™å€‹å•é¡Œï¼Œæ‰¾é˜¿æ‰¾ï¼Œæœ€å¾Œçµ‚æ–¼ç™¼ç¾ï¼Œ\nå·®ç•°åœ¨ å»ºç«‹ submoduleçš„æ™‚å€™ã€‚\næ‰“é–‹ .gitmodules ä¸Šé¢æœƒå¯« urlçš„ä½ç½®\n[submodule &quot;SMSBackendSharedLib&quot;]\n\tpath = SMSBackendSharedLib\n\turl = git@github.com:ABC/sms-backend-sharedlib.git\n\næœ¬ä¾†æ˜¯ä¸Šé¢é€™ç¨®å¯«æ³•ï¼Œä»–æœƒç”¨sshçš„æ–¹å¼å»æŠ“submoduleçš„æª”æ¡ˆã€‚\næ‰€ä»¥è¦æŠŠurlæ”¹æˆ\n[submodule &quot;SMSBackendSharedLib&quot;]\n\tpath = SMSBackendSharedLib\n\turl = https://github.com/ABC/sms-backend-sharedlib.git\n\nå†ä¾†ç”¨\ngit submodule update --init --recursive\n\næœ¬æ©Ÿä¹Ÿå¯ä»¥ä¸‹è¼‰äº†ã€‚\næœ¬ä¾†é‚„æ‡·ç–‘æ˜¯ä¸æ˜¯drone clone submoduleçš„æ™‚å€™ï¼Œç”¨åˆ°éŒ¯èª¤çš„ä½¿ç”¨è€…ã€‚\nçµæœä¸€æŸ¥æ ¹æœ¬æ²’æœ‰ä½¿ç”¨è€…ã€‚\nå¯ä»¥ç”¨ä¸‹é¢çš„æŒ‡ä»¤æŸ¥æŸ¥\ngit config --list\n\ngit config user.name\ngit config user.email\n\nç°¡å–®è§£é‡‹ä¸€ä¸‹ submoduleï¼Œ\nä»¥ä¸‹å¾chatGPTæŠ„ä¾†çš„ã€‚\n\nåœ¨ Git ä¸­ï¼ŒSubmodule æ˜¯ä¸€å€‹å…è¨±æ‚¨åœ¨ Git å€‰åº«ä¸­åŒ…å«å¦ä¸€å€‹ Git å€‰åº«çš„æ©Ÿåˆ¶ã€‚é€šéä½¿ç”¨ Submoduleï¼Œæ‚¨å¯ä»¥å°‡ä¸€å€‹ Git å€‰åº«ä½œç‚ºå¦ä¸€å€‹ Git å€‰åº«çš„å­ç›®éŒ„é€²è¡Œç®¡ç†ã€‚é€™å°æ–¼ç®¡ç†å¤§å‹å°ˆæ¡ˆæˆ–å…±äº«ç¨‹å¼åº«éå¸¸æœ‰ç”¨ã€‚\nç•¶æ‚¨åœ¨ Git å€‰åº«ä¸­æ–°å¢ Submodule æ™‚ï¼Œå®ƒå¯¦éš›ä¸Šæ˜¯åŒ…å«å¦ä¸€å€‹ Git å€‰åº«çš„æŒ‡å‘ã€‚ç•¶æ‚¨ clone æˆ– pull ä¸»å€‰åº«æ™‚ï¼ŒGit åªæœƒä¸‹è¼‰ Submodule çš„æŒ‡å‘ï¼Œè€Œä¸æœƒå°‡ Submodule çš„å…§å®¹ä¸€ä½µä¸‹è¼‰ã€‚é€™æ¨£å¯ä»¥ç¯€çœç©ºé–“å’Œæ™‚é–“ï¼ŒåŒæ™‚é‚„å¯ä»¥ä½¿ä¸»å€‰åº«æ›´åŠ è¼•ä¾¿ã€‚\nå¦‚æœæ‚¨æƒ³è¦æ›´æ–° Submodule çš„å…§å®¹ï¼Œå¯ä»¥ä½¿ç”¨ git submodule update å‘½ä»¤ä¾†ä¸‹è¼‰ Submodule çš„å…§å®¹ã€‚ç•¶æ‚¨ä¿®æ”¹ Submodule çš„å…§å®¹æ™‚ï¼Œæ‚¨éœ€è¦å…ˆé€²å…¥ Submodule çš„ç›®éŒ„ï¼Œå°å…¶é€²è¡Œ commit å’Œ pushï¼Œç„¶å¾Œè¿”å›ä¸»å€‰åº«ï¼Œå° Submodule çš„æŒ‡å‘é€²è¡Œ commit å’Œ pushã€‚é€™æ¨£å¯ä»¥ç¢ºä¿ Submodule çš„æŒ‡å‘æŒ‡å‘æ­£ç¢ºçš„ commitã€‚\nç¸½ä¹‹ï¼ŒSubmodule æ˜¯ä¸€å€‹éå¸¸æœ‰ç”¨çš„æ©Ÿåˆ¶ï¼Œå¯ä»¥ä½¿ Git å€‰åº«ç®¡ç†æ›´åŠ éˆæ´»å’Œæœ‰æ•ˆã€‚",
		"tags": [ "note","ğŸ’»"]
},

{
		"title": "telegram apiä½¿ç”¨æ–¹æ³•",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ’» Code/22.telegram apiä½¿ç”¨/",
		"content": "å‰è¨€\nä¸Šä¸€ç¯‡å¯«åˆ°ç”¨flaggerï¼Œå»ºç«‹webhookç™¼é€é€šçŸ¥ã€‚\nå…¬å¸æœ‰åœ¨ç”¨çš„å°±skypeè·Ÿ telegramï¼Œæ‰€ä»¥å°±....é–‹å§‹å§\næ­£æ–‡\n\né¦–å…ˆä½ è¦æœ‰telegramå¸³è™Ÿ XDDD\n\nåŠ å…¥ @BotFather ï¼Œè¼¸å…¥æŒ‡ä»¤ /newBotï¼Œé–‹å§‹å‘½åï¼Œæ³¨æ„æ©Ÿå™¨äººåç¨±å¯ä»¥ä¸ç”¨botçµå°¾ï¼Œä½†@å¸³è™Ÿæœ€å¾Œä¸€å®šæ˜¯Botçµå°¾\n\nå»ºç«‹å¥½äº†å¾Œï¼Œæœƒæœ‰ä¸€çµ„tokenï¼Œè«‹ä¸è¦éš¨æ„çµ¦äººï¼Œå› ç‚ºåªè¦æœ‰é€™çµ„å°±èƒ½ç™¼é€è¨Šæ¯å‡ºå»äº†ã€‚\n\nåˆ°æ­¤å·²ç¶“å®Œæˆä¸€åŠäº†ï¼Œå†ä¾†æ˜¯ä½¿ç”¨å–å¾—channelçš„idï¼Œå…ˆå°‡channelçš„é »é“è¨­å…¬é–‹ï¼Œä¸¦æŠŠæ©Ÿå™¨äººåŠ å…¥åˆ°channelè£¡é¢ã€‚\né€™é‚Šéœ€è¦è¨˜å¾—ä½ çš„chatidï¼Œä¸èƒ½è·Ÿå…¶ä»–äººçš„é‡è¤‡ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±è©¦è©¦ã€‚\n\nezioflaggernotfiyå°±æ˜¯æˆ‘çš„chatidï¼Œ\nç„¶å¾Œçµ„åˆä¸€ä¸‹apiï¼Œé€å‡ºå»å°±èƒ½å–å¾—channelçš„idï¼Œè«‹å…ˆå°‡æ©Ÿå™¨äººåŠ å…¥åˆ°channelè£¡é¢ã€‚\nhttps://api.telegram.org/bot{token}/sendMessage?chat_id={chatid}&amp;text=Hello,world\n\n{token} åœ¨ step.3ï¼Œå‰é¢è¨˜å¾—åŠ bot\n{chatid} åœ¨step.4 ï¼Œè¨˜å¾—å‰é¢è¦åŠ  @\né€å‡ºå»å¾Œï¼Œå›å‚³çš„è³‡æ–™ä¸Šé¢æœƒé¡¯ç¤º chat.idï¼Œæ­¤æ™‚å°±èƒ½æŠŠchannel è¨­æˆ privateäº†ã€‚\n\nå¦‚æœæ˜¯å…¬é–‹çš„channelï¼Œå°±åˆ°ç¬¬å››æ­¥å°±çµæŸäº†ã€‚\nå¦‚æœæ˜¯ç§äººçš„è©±ï¼Œå°‡chatidæ”¹æˆ ï¼Œä¸Šé¢step.4æ‹¿åˆ°çš„ chat.id ï¼Œå³å¯ã€‚\nä¸ç”¨å†åŠ @ åœ¨chat_idå‰é¢äº†ã€‚æ­¤æ™‚æ‰€ç”¨çš„å·²æ˜¯å”¯ä¸€çš„channel snã€‚\n\nhttps://api.telegram.org/bot1234:JMwL6qw/sendMessage\\?chat_id\\=-12345\\&amp;text\\=hello,telegram\n\nå¦‚æœè¨Šæ¯å¤ªé•·ï¼Œæƒ³è¦æœ‰æ˜é¡¯ä¸€é»çš„è¨Šæ¯ï¼Œå¯åŠ ä¸Šparse_mode=html\nä¸¦åœ¨å­—çš„å‰å¾ŒåŠ ä¸Šabcï¼Œåœ¨é›»è…¦ä¸Šçœ‹åˆ°çš„å­—æœƒæ˜é¡¯è¨±å¤šã€‚\n\n(fig.5)\nä½†åœ¨æ‰‹æ©Ÿä¸Šçš„telegramï¼Œçœ‹ä¸åˆ°æ­¤ç‰¹æ•ˆã€‚\nref.\n\nTelegram Botæ©Ÿå™¨äººç”³è«‹èˆ‡WebhookæŒ‡ä»¤å…¨ç´€éŒ„\nå¦‚ä½•ç²å¾—æ­£ç¢ºçš„telegram channel id?ï¼Ÿ\nAn introduction for developers\ntelegram-sendMessage\nsendMessage: Send text messages\né—œæ–¼ Telegram ä¸Šçš„è§£ææ¨¡å¼ï¼ˆMarkdownã€HTMLï¼‰ã€æ–‡å­—æ ¼å¼",
		"tags": [ "note","ğŸ’»"]
},

{
		"title": "æ­£å‰‡å–ä»£ï¼Œç•™ä¸‹ç‰¹å®šå­—ä¸²",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ’» Code/38.æ­£å‰‡å–ä»£ï¼Œç•™ä¸‹ç‰¹å®šå­—ä¸²/",
		"content": "å‰è¨€\næ‡¶äººçš„æ–¹å¼åˆä¾†äº†ï¼Œ\næœ‰ä¸€æ•´æ‰¹çš„è³‡æ–™ï¼Œä¸€å€‹ä¸€å€‹æ”¹æˆ‘è¦ºå¾—å¥½éº»ç…©ï¼Œ\né‚£å°±ç”¨æ­£å‰‡æ•´æ‰¹ä¿®å§\næ­£æ–‡\nå…ˆä¾†çœ‹å€‹ç¯„ä¾‹ï¼Œ\n&lt;code&gt;\n\t&lt;field name=&quot;videoId&quot;&gt;&lt;![CDATA[28713]]&gt;&lt;/field&gt;\n\t&lt;field name=&quot;code&quot;&gt;&lt;![CDATA[CWPBD-62]]&gt;&lt;/field&gt;\n\t&lt;field name=&quot;artistId&quot;&gt;&lt;![CDATA[5005]]&gt;&lt;/field&gt;\n\t&lt;field name=&quot;sort&quot;&gt;&lt;![CDATA[9054]]&gt;&lt;/field&gt;\n\t&lt;field name=&quot;views&quot;&gt;&lt;![CDATA[23004]]&gt;&lt;/field&gt;\n&lt;/code&gt;\n\nè¦å°‡![CDATA[]] ä¸­é–“çš„å­—ä¸²ç•™ä¸‹ä¾†ï¼Œ\né€™é‚Šå…¶å¯¦æœ‰å…©ç¨®åšæ³•ï¼Œ\n\nä¸€ç¨®æ˜¯ç”¨å–ä»£çš„ï¼Œå…ˆæŠŠ ![CDATA[ åˆªé™¤ï¼Œå†æŠŠ ]] åˆªé™¤\n\né‚„æœ‰å¦ä¸€ç¨®å°±æ˜¯ä¸‹é¢çš„ç¯„ä¾‹ï¼Œç›´æ¥ç”¨æ­£å‰‡å–ä»£ï¼Œç•™ä¸‹ä¸­é–“çš„å­—ä¸²ã€‚\nå…ˆå¯«å¥½ä¸€å€‹æ­£å‰‡ï¼Œå¯ä»¥æŠ“åˆ° CDATAçš„è³‡æ–™\n(\\!\\[CDATA\\[)(.*)(\\]\\])\n\nå¯ä»¥åˆ° æ­£å‰‡åœ¨ç·šæ¸¬è©¦ æ¸¬è©¦\nåœ¨ ATOMçš„è©±ï¼Œæ–¼å–ä»£çš„ä½ç½®å¯«ä¸Š$2 ï¼Œé€™æ¨£å°±æœƒ ç•™ä¸‹ä¸­é–“çš„å­—äº†ã€‚(fig.1)\n\nå¦‚æœæ˜¯åœ¨å¾®è»Ÿçš„excelï¼Œå‰‡æ˜¯ä½¿ç”¨ \\2 ï¼Œé€™æ¨£æ‰æœƒç•™ä¸‹ä¸­é–“çš„å­—ã€‚\nref.\nRegular Expressionï¼ˆæ­£å‰‡è¡¨é”å¼ï¼‰\nå…¥é–€ä¿®ç·´ Ver3.50",
		"tags": [ "note","ğŸ’»"]
},

{
		"title": "git refsï¼Œbranch è·Ÿ tagæ˜¯ä¸€æ¨£çš„",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ’» Code/59. git refsï¼Œbranch è·Ÿ tagæ˜¯ä¸€æ¨£çš„ã€‚/",
		"content": "å‰è¨€\næ­£æ–‡\ngitçš„ä¸»è¦æ¶æ§‹å…¶å¯¦éƒ½åœç¹ç€ refs ï¼Œ\nbranch è·Ÿ tag å…¶å¯¦æ˜¯ä¸€æ¨£çš„æ±è¥¿ï¼Œ\nç›´æ¥å»çœ‹ .gitçš„è³‡æ–™å¤¾ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢çš„æ¶æ§‹ã€‚\n\ttree .git/refs\n\nâ”œâ”€â”€ heads\nâ”‚Â Â  â”œâ”€â”€ apm2\nâ”‚Â Â  â””â”€â”€ testapmlog\nâ”œâ”€â”€ remotes\nâ”‚Â Â  â””â”€â”€ origin\nâ”‚Â Â  â”œâ”€â”€ HEAD\nâ”‚Â Â  â”œâ”€â”€ apm2\nâ”‚Â Â  â”œâ”€â”€ dev_spring20211027\nâ””â”€â”€ tags\nheads ç›®éŒ„ï¼Œæè¿°åœ¨æœ¬æ©Ÿä¸Šçš„æ‰€æœ‰åˆ†æ”¯ï¼Œæ¯ä¸€å€‹æª”æ¡ˆå°æ‡‰ç›¸æ‡‰çš„ç›®éŒ„ã€‚\né–‹å•Ÿæª”æ¡ˆçš„è©±ï¼Œæœƒçœ‹åˆ°ä¸€å€‹commitçš„é›œæ¹Šå€¼ï¼Œ\nè€Œä¸ç®¡æ˜¯branch æˆ– tag éƒ½æ˜¯æ ¹æ“šæ­¤é›œæ¹Šå€¼ï¼Œä¾†æ±ºå®šä½ ç¨‹å¼ç›®å‰æ˜¯å“ªå€‹ç‰ˆæœ¬ã€‚\ncat .git/refs/heads/apm2\n\ngit log -1 apm2\nor\ngit show apm2\n\né€™å…©å€‹çš„é›œæ¹Šå€¼æœƒä¸€æ¨£ï¼Œ\næ‰€ä»¥å»ºç«‹ä¸€å€‹æ–°çš„åˆ†æ”¯ï¼Œå°gitä¾†èªªï¼Œä¹Ÿåªæ˜¯å°‡ç•¶ä¸‹çš„é›œæ¹Šå€¼å¯«åˆ°ä¸€å€‹æª”æ¡ˆå…§ã€‚\nref.\n\nGitç³»åˆ—ä¹‹Refs èˆ‡ Reflog\nåŸæ–‡- Refs and the Reflog",
		"tags": [ "note","ğŸ’»"]
},

{
		"title": "çˆ¬èŸ²æš—é»‘ç·¨å¹´å²çš„ä¸–ç•Œç‹æ™‚é–“",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ’» Code/Golang/155. scrapyçˆ¬æš—é»‘ç·¨å¹´å²çš„ä¸–ç•Œç‹æ™‚é–“/",
		"content": "ç¡ç¡å¿µ\nå¥½ä¹…æ²’å¯«çˆ¬èŸ²äº†ï¼Œ\næœ€è¿‘ç©æš—é»‘IVï¼Œé–‹å§‹æ¥è§¸åˆ°ä¸–ç•Œç‹çš„æ™‚å€™ï¼Œæ™‚é–“å¾ˆä¸å›ºå®šï¼Œ\nç„¶å¾Œéš”äº†å¹¾å¤©ç™¼ç¾æš—é»‘ç·¨å¹´å²ï¼Œ\næœ‰ä¸–ç•Œç‹çš„é€šçŸ¥æ™‚é–“å€’æ•¸äº†ã€‚\næœ‰è³‡æ–™å°±å¥½è¾¦äº†ã€‚\næ­£æ–‡\n\né–‹å•“scrapyå°ˆæ¡ˆ\n\nscrapy start &lt;project_name&gt;\n\nåˆå§‹åŒ–(åœ¨ä¸Šä¸€å€‹æ­¥é©ŸåŸ·è¡Œå®Œå¾Œï¼Œå°±æœ‰ç›¸é—œæŒ‡ä»¤æœƒé¡¯ç¤ºåœ¨è¢å¹•ä¸Š)\n\nscrapy genspider d4spider https://diablo4.cc/tw/\n\nçµæ§‹å¦‚ä¸‹\nâ”œâ”€â”€ LICENSE\nâ”œâ”€â”€ README.md\nâ”œâ”€â”€ d4notify\nâ”‚Â Â  â”œâ”€â”€ __init__.py\nâ”‚Â Â  â”œâ”€â”€ __pycache__\nâ”‚Â Â  â”‚Â Â  â”œâ”€â”€ __init__.cpython-310.pyc\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ settings.cpython-310.pyc\nâ”‚Â Â  â”œâ”€â”€ items.py\nâ”‚Â Â  â”œâ”€â”€ middlewares.py\nâ”‚Â Â  â”œâ”€â”€ pipelines.py\nâ”‚Â Â  â”œâ”€â”€ settings.py\nâ”‚Â Â  â””â”€â”€ spiders\nâ”‚Â Â  â”œâ”€â”€ __init__.py\nâ”‚Â Â  â”œâ”€â”€ __pycache__\nâ”‚Â Â  â”‚Â Â  â””â”€â”€ __init__.cpython-310.pyc\nâ”‚Â Â  â””â”€â”€ d4spider.py\nâ””â”€â”€ scrapy.cfg\n\nåŸ·è¡Œ\n\nscrapy crawl d4spider\n\nGITHUB-D4Notfiy\nTroubleshooting\n\nå–å¾—å±¬æ€§\nç¢°åˆ°å€‹å¥‡æ€ªçš„èªæ³•ï¼Œdivè£é¢æœ‰å€‹è‡ªè¨‚çš„å±¬æ€§ï¼Œ\nç”¨scrapyè¦å–å€¼çš„è©±ï¼Œ\n\n&lt;div data-displaytime=&quot;1687258903&quot;&gt;2023-06-20 19:01&lt;/div&gt;\n\ndiv::attr(data-displaytime).get()\n\né€™æ¨£æœƒå–å¾— 1687258903 é€™å€‹æ•¸å­—\nref. scrapy-scraping-html-custom-attributes\n\nextract_first() è·Ÿ extract() ,å¯ç”¨get()è·Ÿgetall()å–ä»£\n\nref. é¸æ“‡å™¨(Selectors)",
		"tags": [ "note","ğŸ’»"]
},

{
		"title": "Golang é‡æ–°è®€å–è¨­å®šæª”",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ’» Code/Golang/40. golang é‡æ–°è®€å–è¨­å®šæª”çš„æ–¹æ³•/",
		"content": "å‰è¨€\nå› ç‚ºç¢°åˆ°ä¸€å€‹å¥‡æ€ªçš„å•é¡Œï¼Œéœ€è¦ä¸€ç›´å»æ”¹golangçš„configæª”ï¼Œ\næ‰€ä»¥å°±å†æƒ³äº†ï¼Œèƒ½ä¸èƒ½åƒä»¥å‰çš„phpæˆ–htmlï¼Œå–®ç´”æ”¹configï¼Œé‡æ–°æ•´ç†å°±èƒ½æŠ“åˆ°è³‡æ–™ã€‚\nçµæœ.......\næ­£æ–‡\nå…ˆèªªçµè«–ï¼Œç›´æ¥ä¿®æ”¹configï¼Œç„¶å¾Œå¼·åˆ¶é—œé–‰golangçš„process ï¼Œæ˜¯è¡Œä¸é€šçš„ã€‚\nç’°å¢ƒï¼Œgolang podï¼ŒåŸ·è¡Œç¨‹å¼çš„æ–¹å¼ï¼Œ\næ˜¯å…ˆ æ‰“åŒ…æˆä¸€å€‹æª”æ¡ˆï¼Œå†æ”¾åˆ°alpine linuxä¸Šé¢çš„podç›´æ¥åŸ·è¡Œã€‚\nç›®æ¨™ï¼Œä¸é‡æ–°æ‰“åŒ…ç¨‹å¼ä¿®æ”¹config\nå¯¦é©—çš„æ–¹æ³•å¦‚ä¸‹ï¼š\n\nå…ˆæŸ¥è©¢æ˜¯ä¸æ˜¯æœ‰golangçš„ç¨‹å¼åœ¨åŸ·è¡Œ\n\n\tps\n\nç”±æ–¼æ­¤ç¨‹å¼æ˜¯ç›´æ¥æŠ“åŒè³‡æ–™å¤¾çš„config\n\næ‚²åŠ‡å¾—ä¾†äº†ï¼Œä¿®æ”¹å®Œappsettings.jsonå¾Œï¼Œåªè¦åˆªé™¤/app/main ï¼Œå°±æœƒç›´æ¥è·³å‡ºï¼Œpodè‡ªå‹•é‡å•Ÿã€‚\n\n\tkill -s 26\n\nref.\nåœ¨ Linux ä¸­ä½¿ç”¨ killã€killall èˆ‡ xkill ç­‰æŒ‡ä»¤å¼·è¿«é—œé–‰ç¨‹å¼\næœ€å¾Œæœ‰å¹¾å€‹æ–¹æ¡ˆï¼Œgolangæœ‰\nç†±æ›´æ–°é…ç½®æ–‡ä»¶\nGolangç†±åŠ è¼‰é…ç½®å¯¦è¸\nä¸å‹•ç¨‹å¼çš„è©±ï¼Œç›®å‰æƒ³åˆ°çš„æ˜¯ï¼Œç›´æ¥é‡æ–°æ‰“åŒ…ï¼ŒæŠŠconfigä¸Ÿé€²å»imageè£¡é¢ã€‚\nä¾†æºçš„æ˜ åƒæª”ï¼Œç›´æ¥æ”¹æˆæœ¬ä¾†çš„imageï¼Œ\nç„¶å¾Œcopy æ”¹å®Œçš„appsetings.jsonåˆ°ç›®çš„ï¼Œ\né€™æ¨£ç¨‹å¼ä¸ç”¨é‡æ–°ç·¨è­¯ï¼Œä½†è¦é‡æ–°æ‰“åŒ…imageã€‚\ndocker build\nFROM gcr.io/rproject/source:adminQA-0.0.27\nARG website\nARG location\nARG type\nWORKDIR /app\n\nCOPY appsettings.json /app/\n\nEXPOSE 80\n# ä¸æ›´æ”¹æ¬Šé™æœƒç™¼ç”Ÿæ¬Šé™éŒ¯èª¤\nRUN chmod +x /init.sh\nRUN [&quot;chmod&quot;, &quot;+x&quot;, &quot;/init.sh&quot;]\nENTRYPOINT [&quot;sh&quot;,&quot;-x&quot;,&quot;/init.sh&quot;]",
		"tags": [ "note","ğŸ’»"]
},

{
		"title": "GO get åƒæ•¸",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ’» Code/Golang/47. GO get åƒæ•¸/",
		"content": "å‰è¨€\næ­£æ–‡\nåƒæ•¸\næè¿°\n-d\nåŸ·è¡Œä¸‹è¼‰ï¼Œä½†ä¸åŸ·è¡Œå®‰è£å‹•ä½œã€‚\n-f\nåªæœ‰åœ¨ä½¿ç”¨ -u åƒæ•¸æ™‚ï¼Œæ‰æœƒæœ‰æ•ˆã€‚å¯ä»¥å¿½ç•¥æª¢æŸ¥ä»¥ä¸‹è¼‰ package çš„å°å…¥è·¯å¾‘ã€‚å¦‚æœä»£ç¢¼æ˜¯å¾å…¶ä»–é …ç›® fork ï¼Œå°±å¯ä»¥æ¡å–é€™æ¨£çš„åšæ³•ã€‚\n-fix\nä¸‹è¼‰ package å…ˆåŸ·è¡Œä¿®æ­£åœ¨é€²è¡Œç·¨è­¯å®‰è£ã€‚\n-insecure\nå…è¨±ä½¿ç”¨ http (éå®‰å…¨) ä¾†ä¸‹è¼‰ packageï¼Œé€šå¸¸æ˜¯åœ¨å…§éƒ¨é–‹ç™¼ç’°å¢ƒä½¿ç”¨ã€‚\n-t\nä¸‹è¼‰ package ï¼Œåœ¨å®‰è£éç¨‹åŒæ™‚ä¸‹è¼‰å®‰è£ç›¸é—œä¾è³´ä»£ç¢¼åŒ…ã€‚\n-u\nå¼·åˆ¶æ›´æ–°å·²ç¶“ä¸‹è¼‰çš„ package ä»¥åŠä¾è³´ä»£ç¢¼åŒ…ã€‚ï¼ˆgo get é è¨­æŒ‡æœƒä¸æœƒæ›´æ–°å·²ç¶“ä¸‹è¼‰çš„package)\nref.\nGO MODULEèˆ‡ GO GET å¸¸ç”¨åƒæ•¸èªªæ˜",
		"tags": [ "note","ğŸ’»"]
},

{
		"title": "å¾®è»Ÿå®˜æ–¹office å¤§é‡æˆæ¬Š",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ–¼ Window/113. å¾®è»Ÿå®˜æ–¹office å¤§é‡æˆæ¬Š/",
		"content": "ç¢ç¢å¿µ\nYTäº‚çœ‹çš„æ™‚å€™ï¼Œçœ‹åˆ°æœ‰ä¸€å€‹å½±ç‰‡ï¼Œå†è¬›å¦‚ä½•ç²å–å…è²»çš„officeï¼Œ\né€™å…¶å¯¦ä¸æ˜¯æ–°èï¼Œä½†æœ‰å•é¡Œçš„é€šå¸¸éƒ½æ˜¯å†ç ´è§£ä¸Šé¢ï¼Œ\nå¯èƒ½è¢«äººæƒ¡æ„äº‚å¡é–“è«œç¨‹å¼æˆ–æœ¨é¦¬ã€‚\nä½†ç¾åœ¨é©—è­‰ç›´æ¥å¾å®˜æ–¹ä¾†äº†\næ­£æ–‡\nå¾®è»Ÿå®˜æ–¹SNï¼š\nä»¥ KMS å’Œ Active Directory ç‚ºåŸºç¤çš„ Officeã€Project å’Œ Visio å•Ÿç”¨ GVLK\nä¸æƒ³çœ‹åœ–ç‰‡çš„ï¼Œè«‹ç›´æ¥çœ‹å½±ç‰‡\nå¦‚ä½•å…è²»ç²å–Officeè»Ÿä»¶ï¼Ÿé€™æ˜¯æœ€å¼·çš„å®‰è£æ•™å­¸ï¼ | é›¶åº¦è§£èªª\nä¸‹é¢å¿«é€Ÿèªªæ˜éç¨‹ï¼Œ\n\nå…ˆåˆ° å¾®è»Ÿå®˜æ–¹ä¸‹è¼‰ Office Deployment Toolï¼Œç„¶å¾Œå®‰è£åˆ°æ–°çš„è³‡æ–™å¤¾ï¼Œé€™é‚ŠæŒ‡å®šå®‰è£åˆ°\nD:\\office\n\nç„¶å¾Œé–‹å•“ office è‡ªè¨‚å·¥å…·\n\né¸æ“‡ä½ è¦çš„ç”¢å“ã€é …ç›®\nï¼ˆé™„è¨»ï¼ŒLTSCä»£è¡¨çš„æ˜¯Long Time Service Channelï¼Œé•·æœŸæœå‹™é€šé“)\nç”¢å“ç‰ˆæœ¬ï¼šè‡ªè¡ŒæŒ‘é¸\nèªè¨€ï¼šç¹é«”ä¸­æ–‡\næˆæ¬Šèˆ‡å•“ç”¨ï¼šç¢ºèªæ˜¯KMS\nå…¶ä»–é è¨­å³å¯ã€‚\nå¥½äº†å¾Œï¼ŒæŒ‰å³ä¸ŠåŒ¯å‡ºï¼Œç„¶å¾Œå­˜åˆ°å‰›å‰› 1. çš„ä½ç½®\nD:\\office\n\nä»¥æœ€é«˜æ¬Šé™é–‹å•“å‘½ä»¤æç¤ºå­—å…ƒï¼Œåˆ‡æ›ç›®éŒ„åˆ° å‰›å‰›ä¸‹è¼‰çš„ä½ç½®ï¼Œç„¶å¾Œä¸‹è¼‰officeï¼Œä¸‹è¼‰å®Œå¾Œå®‰è£ã€‚\ncd D:\\office\nsetup /download config.xml\nsetup /configure config.xml\n\nå®‰è£å®Œæˆå¾Œæ‡‰è©²å°±æœƒå•“å‹•äº†ï¼Œå¦‚æœæ²’æœ‰å•“å‹•ï¼Œåˆ°å‰›å‰›officeå®‰è£çš„ä½ç½®ï¼Œé€šå¸¸åœ¨ ä¸‹é¢ä½ç½®ï¼Œç‰ˆæœ¬ä¸åŒï¼Œå¾Œé¢çš„æ•¸å­—ä¹Ÿæœƒä¸åŒã€‚\nC:\\Program Files\\Microsoft Office\\Office16\n\nä»¥æœ€é«˜æ¬Šé™é–‹å•“å‘½ä»¤æç¤ºå­—å…ƒï¼Œåˆ‡æ›ç›®éŒ„åˆ° 5. çš„ä½ç½®ï¼Œç„¶å¾Œä¾åºåŸ·è¡ŒæŒ‡ä»¤ï¼Œå®Œæˆå¾Œã€é‡é–‹é›»è…¦ã€ã€‚\n\ncd C:\\Program Files\\Microsoft Office\\Office16\nslmgr /skms kms.03k.org\nslmgr /ato",
		"tags": [ "note","ğŸ–¼"]
},

{
		"title": "win10 ä¸‹è¼‰Microsoft Storeçš„æª”æ¡ˆ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ–¼ Window/174. win10 ä¸‹è¼‰Microsoft Storeçš„æª”æ¡ˆ/",
		"content": "ç¡ç¡å”¸\nçœ‹åˆ°XDMæœ‰æ–°ç‰ˆçš„ï¼Œå› çˆ²èˆŠç‰ˆåªè¦ä¸‹è¼‰æœ‰ä¸­æ–‡å­—çš„æª”æ¡ˆï¼Œ\næª”æ¡ˆåç¨±å°±æ˜¯äº‚ç¢¼ï¼Œä½†æ˜¯æ–°ç‰ˆåˆåªèƒ½å¾å¾®è»Ÿå•†åº—ä¸‹è¼‰...\næ­£æ–‡\n\næ‰¾åˆ°ç¶²å€\né¦–å…ˆä½ è¦çŸ¥é“ä½ è¦çš„ç¨‹å¼çš„å¾®è»Ÿå®˜æ–¹å•†åº—ç¶²å€ã€‚\nç›´æ¥ç”¨googleæœå°‹å³å¯ã€‚\n\nåˆ°ç¶²ç«™ ï¼Œè²¼ä¸Šä½ çš„ç¶²å€\n\né¸æ“‡å‰¯æª”åç‚º ã€appxbundleã€ ä¸‹è¼‰\n\nref. Win10/Win11 å¦‚ä½•ä¸‹è¼‰ Microsoft Store é›¢ç·šå®‰è£æª”ï¼Ÿ",
		"tags": [ "note","ğŸ–¼"]
},

{
		"title": " ğŸ—„ Database MOC  ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—„ Database/0.Database MOC/",
		"content": "MySQL\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—„ Database/150. mysqlå‚™ä»½é‚„åŸæŒ‡ä»¤/\">150. mysqlå‚™ä»½é‚„åŸæŒ‡ä»¤</a>\n\nMSSQL\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—„ Database/153. CloudSQL MSSQLæ¸›å°‘è³‡æ–™åº«å¤§å°/\">153. CloudSQL MSSQLæ¸›å°‘è³‡æ–™åº«å¤§å°</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â˜ï¸ GCP/120. æŒ‡ä»¤å‚™ä»½cloudSQLåŠä¸‹è¼‰/\">120. æŒ‡ä»¤å‚™ä»½cloudSQLåŠä¸‹è¼‰</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—„ Database/188. CloudSQL server æŸ¥è©¢è¨˜æ†¶é«”/\">188. CloudSQL server æŸ¥è©¢è¨˜æ†¶é«”</a>",
		"tags": [ "note","ğŸ—„"]
},

{
		"title": "150. mysqlå‚™ä»½é‚„åŸæŒ‡ä»¤",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—„ Database/150. mysqlå‚™ä»½é‚„åŸæŒ‡ä»¤/",
		"content": "ç¡ç¡å¿µ\nèª¿æ•´è‡ªå‹•å–å¾—letsEncriptçš„æ¶æ§‹ï¼Œ\næ‰€ä»¥å°±ç¨ç«‹é–‹äº†ä¸€å€‹serverï¼Œè¦æŠŠæœå‹™ç§»éå»ã€‚\nç„¶å¾Œæ‰ç™¼ç¾ï¼Œæˆ‘çš„ä¸Šä¸€ä»»æ˜¯å€‹å¾ˆæˆç†Ÿçš„å·¥ç¨‹å¸«ï¼Œæœ€æ„›é€ è¼ªå­\næ­£æ–‡\nä»¥ä¸‹éƒ½æ˜¯ç”±dockerå»ºç«‹ï¼Œä¹Ÿæœ‰å…¶ä»–æ–¹å¼å¯ä»¥åšã€‚\n\nå‚™ä»½å…¨éƒ¨dbçš„æŒ‡ä»¤\n\ndocker exec percona sh -c &quot;mysqldump -u root -p&lt;password&gt; -A --opt&quot; &gt; backup.sql\n\nç•¶ç„¶ï¼Œä¹Ÿå¯ä»¥é¸æ“‡é€²å…¥åˆ°containerè£é¢ï¼ŒåŸ·è¡ŒæŒ‡ä»¤ï¼Œå†ç”¨docker cpçš„æ–¹å¼æŠŠæª”æ¡ˆæ‹‰å‡ºä¾†ã€‚\n\né‚„åŸDBçš„æŒ‡ä»¤\n\ndocker exec -i mysql sh -c &quot;mysql -u root -p&lt;password&gt;&quot; &lt; backup.sql\n\né€£ç·šè‡³mysql\n\nmysql -uroot -p&lt;password&gt;\n\né¡¯ç¤ºå…¨éƒ¨DB\n\nshow databases;\n\né¡¯ç¤ºå…¨éƒ¨table\n\nshow tables;\n\nå»ºç«‹ä½¿ç”¨è€…\n\nCREATE USER 'totp-auth'@'localhost' IDENTIFIED BY 'password';\n\né€™é‚Šæ³¨æ„ï¼Œå¦‚æœä½¿ç”¨è€…æ˜¯å¾éæœ¬åœ°é€£éä¾†è³‡æ–™åº«çš„è©±ï¼Œä¸è¦ä½¿ç”¨localhostã€‚æˆ‘å¿˜äº†é€™é»ã€‚\n\nä¿®æ”¹ä½¿ç”¨è€…\n\nRENAME USER 'totp-auth'@'localhost' TO 'totp-auth'@'%';\n\næ‰¿æ¥ä¸Šä¸€æ®µèªæ³•ï¼Œå¦‚æœå·²ç¶“æ–°å¢çš„è©±ï¼Œç”¨æ­¤æ–¹å¼ä¿®æ”¹ã€‚\n%ç‚ºä»»æ„ipï¼Œæˆ–è€…å¯ä»¥æ”¹æˆ192.168.1.% è«¸å¦‚æ­¤é¡çš„ã€‚\n\næˆäºˆä½¿ç”¨è€…DBæ¬Šé™\n\nGRANT ALL PRIVILEGES ON db.* TO 'totp-auth'@'localhost';\n\nref.\n\npercona(dockerhub)\n[MySQL]è³‡æ–™åº«çš„å‚™ä»½èˆ‡é‚„åŸ\nMySQL æ–°å¢ä½¿ç”¨è€…åŠå»ºç«‹è³‡æ–™åº«æ¬Šé™\nMySQL users changed their IP address. What's the best way to deal with this?\næ¯å¤©å®šæ™‚è‡ªå‹•å‚™ä»½Dockerå…§çš„MySQLã€MariaDBèˆ‡MongoDBï¼ŒLinuxã€macOSèˆ‡Windowséƒ½å¯ç”¨",
		"tags": [ "note","ğŸ—„"]
},

{
		"title": "153. CloudSQL MSSQLæ¸›å°‘è³‡æ–™åº«å¤§å°",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—„ Database/153. CloudSQL MSSQLæ¸›å°‘è³‡æ–™åº«å¤§å°/",
		"content": "ç¡ç¡å¿µ\nä¹Ÿä¸çŸ¥é“æˆ‘æ€éº¼ä¹Ÿå…¼DBAäº†ï¼Œæœ‰ç¨®MISçš„æ„Ÿè¦ºï¼Œå•¥éƒ½ç®¡ã€‚\nå¦‚æœè³‡æ–™é‡å¤ªå¤šï¼Œåˆªé™¤è³‡æ–™å¾Œï¼Œæ˜¯ä¸æœƒæŠŠç©ºé–“é‡‹æ”¾çš„ï¼Œ\néœ€è¦å°è³‡æ–™åº«åšå£“ç¸®ï¼Œå®¹é‡æ‰æœƒé‚„å‡ºä¾†ã€‚\næ­£æ–‡\né †ä¾¿èªªä¸€ä¸‹æŸ¥å®¹é‡çš„æ­¥é©Ÿ\n\næŸ¥è³‡æ–™åº«çš„å®¹é‡\n\nSELECT DB_NAME(database_id) N'è³‡æ–™åº«', physical_name N'å¯¦é«”æª”æ¡ˆ', type_desc N'æª”æ¡ˆé¡å‹', state_desc N'æª”æ¡ˆç‹€æ…‹', size*8.0/1024 N'æª”æ¡ˆå¤§å°(MB)'\nFROM sys.master_files\n\næŸ¥è©¢è³‡æ–™è¡¨å¤§å°\n\nSELECT\nt.NAME AS TableName,\ns.Name AS SchemaName,\np.rows,\nSUM(a.total_pages) * 8 AS TotalSpaceKB,\nCAST(ROUND(((SUM(a.total_pages) * 8) / 1024.00), 2) AS NUMERIC(36, 2)) AS TotalSpaceMB,\nSUM(a.used_pages) * 8 AS UsedSpaceKB,\nCAST(ROUND(((SUM(a.used_pages) * 8) / 1024.00), 2) AS NUMERIC(36, 2)) AS UsedSpaceMB,\n(SUM(a.total_pages) - SUM(a.used_pages)) * 8 AS UnusedSpaceKB,\nCAST(ROUND(((SUM(a.total_pages) - SUM(a.used_pages)) * 8) / 1024.00, 2) AS NUMERIC(36, 2)) AS UnusedSpaceMB\nFROM\nsys.tables t\nINNER JOIN\nsys.indexes i ON t.OBJECT_ID = i.object_id\nINNER JOIN\nsys.partitions p ON i.object_id = p.OBJECT_ID AND i.index_id = p.index_id\nINNER JOIN\nsys.allocation_units a ON p.partition_id = a.container_id\nLEFT OUTER JOIN\nsys.schemas s ON t.schema_id = s.schema_id\nWHERE\nt.NAME NOT LIKE 'dt%'\nAND t.is_ms_shipped = 0\nAND i.OBJECT_ID &gt; 255\nGROUP BY\nt.Name, s.Name, p.Rows\nORDER BY\nTotalSpaceMB DESC, t.Name\n\nåˆªé™¤å®Œå¾Œï¼Œå¯ä»¥å…ˆåšäº¤æ˜“è¨˜éŒ„æª”å£“ç¸®\n\nALTER DATABASE DB_name SET RECOVERY simple\nuse DB_name\ngo\ndbcc shrinkfile('DB_name_log',2)\n\nALTER DATABASE table_name SET RECOVERY FULL\n\nå£“ç¸®DBï¼Œå°‡ç©ºé–“é‡‹æ”¾ï¼Œå¯ä»¥ç”¨æŒ‡ä»¤ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨SSMSæ“ä½œ\næŒ‡ä»¤ï¼Œå¯ä»¥è·Ÿstep 3 ä¸€èµ·å‹•ä½œ\n\n1. DBCC SHRINKDATABASE(N'DB_name' )\n\næˆ–æ˜¯ç›´æ¥ç…§åœ–æ“ä½œ\n\nref.\n\nSQL SERVER å£“ç¸®è³‡æ–™åº«å¾ŒMDFæ²’è®Šå°\nMsSql å£“ç¸®è³‡æ–™åº«(å«ä¿®å¾©è³‡æ–™åº«)\n[SQL]æ–¯æ–¯æœ‰ä¸‰ç¨®ï¼ŒSQL Server ä¸Šè³‡æ–™åº«çš„ã€Œå£“ç¸®ã€ä¹Ÿæœ‰ä¸‰ç¨®å–” !\nDBCC SHRINKDATABASE (Transact-SQL)\næ¸…é™¤SQL Server Logæª” (äº¤æ˜“ç´€éŒ„)\nè§£æ±ºå¤§é‡è³‡æ–™åˆªé™¤ï¼Œé€ æˆè³‡æ–™åº«äº¤æ˜“ç´€éŒ„æª”æ¡ˆå®¹é‡éå¤§ä¸”è€—è²»æ™‚é–“ä¹‹è™•ç†",
		"tags": [ "note","ğŸ—„"]
},

{
		"title": "MSSQLç‰ˆæœ¬å·®ç•°",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—„ Database/166. MSSQL 2017ç‰ˆæœ¬å·®ç•°/",
		"content": "å‰è¨€\nä»Šå¤©åœ¨æŸ¥linuxçš„MSSQLæ˜¯ä»€éº¼ç‰ˆæœ¬ï¼Œæ‰ç™¼ç¾é è¨­æ˜¯é–‹ç™¼ç‰ˆã€‚\nåˆå»¶ä¼¸ä¸€å€‹å•é¡Œï¼Œé–‹ç™¼æ¿çš„ä¸Šé™åˆ°å“ªï¼Ÿ\næ­£æ–‡\nå› ç‚ºå¾®è»Ÿçš„ç¶²ç«™ï¼Œé€£çµå¸¸æ­»æ‰ï¼Œå°±å…ˆç¯€éŒ„éä¾†äº†ï¼Œ\nåœ¨linuxä¸Šé¢å®‰è£çš„æ˜¯Developeré–‹ç™¼è€…ç‰ˆæœ¬ï¼Œ\nåŠŸèƒ½è·ŸEnterpriseä¸€è‡´ã€‚\nå·®ç•°\næŒ‡åˆ—å‡ºè³‡æºä½¿ç”¨çš„æ¯”è¼ƒï¼Œå…¶ä»–ç´°éƒ¨åŠŸèƒ½ï¼Œè«‹åƒè€ƒä¸‹é¢ç¶²å€\n\nåŠŸèƒ½\nEnterprise\næ¨™æº–\nWeb\nExpress\nå¿«é€Ÿ\n\nå–®ä¸€åŸ·è¡Œå€‹é«”æ‰€ä½¿ç”¨çš„è¨ˆç®—å®¹é‡ä¸Šé™ - SQL Server è³‡æ–™åº«å¼•æ“1\nä½œæ¥­ç³»çµ±æœ€å¤§å€¼\né™åˆ¶ç‚º 4 å€‹æ’æ§½æˆ– 24 å€‹æ ¸å¿ƒçš„è¼ƒå°è€…\né™åˆ¶ç‚º 4 å€‹æ’æ§½æˆ– 16 å€‹æ ¸å¿ƒçš„è¼ƒå°è€…\né™åˆ¶ç‚º 1 å€‹æ’æ§½æˆ– 4 å€‹æ ¸å¿ƒçš„è¼ƒå°è€…\né™åˆ¶ç‚º 1 å€‹æ’æ§½æˆ– 4 å€‹æ ¸å¿ƒçš„è¼ƒå°è€…\n\nå–®ä¸€åŸ·è¡Œå€‹é«”æ‰€ä½¿ç”¨çš„è¨ˆç®—å®¹é‡ä¸Šé™ - Analysis Services æˆ– Reporting Services\nä½œæ¥­ç³»çµ±æœ€å¤§å€¼\né™åˆ¶ç‚º 4 å€‹æ’æ§½æˆ– 24 å€‹æ ¸å¿ƒçš„è¼ƒå°è€…\né™åˆ¶ç‚º 4 å€‹æ’æ§½æˆ– 16 å€‹æ ¸å¿ƒçš„è¼ƒå°è€…\né™åˆ¶ç‚º 1 å€‹æ’æ§½æˆ– 4 å€‹æ ¸å¿ƒçš„è¼ƒå°è€…\né™åˆ¶ç‚º 1 å€‹æ’æ§½æˆ– 4 å€‹æ ¸å¿ƒçš„è¼ƒå°è€…\n\næ¯å€‹ SQL Server è³‡æ–™åº«å¼•æ“åŸ·è¡Œå€‹é«”çš„ç·©è¡é›†å€è¨˜æ†¶é«”ä¸Šé™\nä½œæ¥­ç³»çµ±æœ€å¤§å€¼\n128 GB\n64 GB\n1410 MB\n1410 MB\n\næ¯å€‹ SQL Server è³‡æ–™åº«å¼•æ“åŸ·è¡Œå€‹é«”çš„ç·©è¡é›†å€å»¶ä¼¸å®¹é‡ä¸Šé™\n32 * (æœ€å¤§ä¼ºæœå™¨è¨˜æ†¶é«”è¨­å®š)\n4 * (æœ€å¤§ä¼ºæœå™¨è¨˜æ†¶é«”è¨­å®š)\nN/A\nN/A\nN/A\n\næ¯å€‹ SQL Server è³‡æ–™åº«å¼•æ“åŸ·è¡Œå€‹é«”çš„è³‡æ–™è¡Œå­˜æ”¾å€å€æ®µå¿«å–çš„è¨˜æ†¶é«”ä¸Šé™\nç„¡é™åˆ¶çš„è¨˜æ†¶é«”\n32 GB\n16 GB\n352 MB\n352 MB\n\nSQL Server è³‡æ–™åº«å¼•æ“ä¸­æ¯å€‹è³‡æ–™åº«çš„è¨˜æ†¶é«”æœ€ä½³åŒ–è³‡æ–™å¤§å°ä¸Šé™\nç„¡é™åˆ¶çš„è¨˜æ†¶é«”\n32 GB\n16 GB\n352 MB\n352 MB\n\næ¯å€‹ Analysis Services åŸ·è¡Œå€‹é«”ä½¿ç”¨çš„è¨˜æ†¶é«”ä¸Šé™\nä½œæ¥­ç³»çµ±æœ€å¤§å€¼\nè¡¨æ ¼å¼ï¼š16 GB MOLAPï¼š64 GB\nN/A\nN/A\nN/A\n\næ¯å€‹ Reporting Services åŸ·è¡Œå€‹é«”ä½¿ç”¨çš„è¨˜æ†¶é«”ä¸Šé™\nä½œæ¥­ç³»çµ±æœ€å¤§å€¼\n64 GB\n64 GB\n4 GB\nN/A\n\né—œè¯å¼è³‡æ–™åº«å¤§å°ä¸Šé™\n524 PB\n524 PB\n524 PB\n10 GB\n10 GB\n\nè¨‚åƒ¹\n\nSQL Server 2017 ç‰ˆæœ¬\né©åˆ...\næˆæ¬Šæ¨¡å‹\né€šè·¯ä¾›æ‡‰æƒ…æ³\nå…¬é–‹ç„¡ç´šåˆ¥åƒ¹æ ¼ (ç¾å…ƒ)\n\nEnterprise\nå…¨æ–¹ä½çš„ä»»å‹™é—œéµæ€§æ•ˆèƒ½ï¼Œå¯æ»¿è¶³åš´è‹›çš„è³‡æ–™åº«å’Œå•†æ¥­æ™ºæ…§éœ€æ±‚ã€‚æä¾›æœ€é«˜ç´šçš„æœå‹™å’Œæ•ˆèƒ½ï¼Œè¶³ä»¥æ‡‰ä»˜ç¬¬ 1 å±¤å·¥ä½œè² è¼‰ã€‚[7]\næ¯å€‹æ ¸å¿ƒ[8]\nå¤§é‡æˆæ¬Šã€ä»£ç®¡\n14,256 ç¾å…ƒ[9]\n\nStandard - æ¯ä¸€æ ¸å¿ƒ\næ ¸å¿ƒè³‡æ–™ç®¡ç†å’Œå•†æ¥­æ™ºæ…§åŠŸèƒ½ï¼Œèƒ½ä»¥æœ€å°‘çš„ IT è³‡æºä¾†è™•ç†éé—œéµçš„å·¥ä½œè² è¼‰ã€‚\næ¯å€‹æ ¸å¿ƒ[8]\nå¤§é‡æˆæ¬Šã€ä»£ç®¡\n3,717 ç¾å…ƒ[9]\n\nStandard - ä¼ºæœå™¨ + CAL\næ ¸å¿ƒè³‡æ–™ç®¡ç†å’Œå•†æ¥­æ™ºæ…§åŠŸèƒ½ï¼Œèƒ½ä»¥æœ€å°‘çš„ IT è³‡æºä¾†è™•ç†éé—œéµçš„å·¥ä½œè² è¼‰ã€‚\nä¼ºæœå™¨ + CAL[10]\nå¤§é‡æˆæ¬Šã€ä»£ç®¡ã€é›¶å”® FPP\n931 ç¾å…ƒ[9]\n\nDeveloper\nå…·æœ‰å®Œæ•´åŠŸèƒ½çš„ SQL Server è»Ÿé«”ç‰ˆæœ¬ï¼Œå¯è®“é–‹ç™¼äººå“¡ä»¥ç¬¦åˆæˆæœ¬æ•ˆç›Šçš„æ–¹å¼å»ºç½®ã€æ¸¬è©¦å’Œå±•ç¤ºä»¥ SQL Server è»Ÿé«”ç‚ºåŸºç¤çš„æ‡‰ç”¨ç¨‹å¼ã€‚\næ¯å€‹ä½¿ç”¨è€…\nå…è²»ä¸‹è¼‰\nå…è²»\n\nWeb\nå®‰å…¨ã€ç¬¦åˆæˆæœ¬æ•ˆç›Šä¸”å¯é«˜åº¦èª¿æ•´çš„è³‡æ–™å¹³å°ï¼Œå¯ç”¨ä¾†æ‰“é€ å…¬ç”¨ç¶²ç«™ã€‚åƒ…ä¾›ç¬¬ä¸‰æ–¹è»Ÿé«”æœå‹™æä¾›è€…ä½¿ç”¨ã€‚\nä¸é©ç”¨\nåƒ…æä¾›ä»£ç®¡\nè«‹åƒé–±ä»£ç®¡åˆä½œå¤¥ä¼´çš„å®šåƒ¹\n\nExpress\nå…è²»çš„å…¥é–€ç´šçš„è³‡æ–™åº«ï¼Œéå¸¸é©åˆç”¨ä¾†å­¸ç¿’å’Œå»ºç½®æœ€å¤š 10 GB çš„æ¡Œé¢èˆ‡å°å‹ä¼ºæœå™¨è³‡æ–™é©…å‹•æ‡‰ç”¨ç¨‹å¼ã€‚\nä¸é©ç”¨\nå…è²»ä¸‹è¼‰\nå…è²»\n\nref.\n- SQLServer 2017\n- SQL Server 2017 çš„ç‰ˆæœ¬åŠæ”¯æ´åŠŸèƒ½",
		"tags": [ "note","ğŸ—„"]
},

{
		"title": "188. SQL server æŸ¥è©¢è¨˜æ†¶é«”",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—„ Database/188. CloudSQL server æŸ¥è©¢è¨˜æ†¶é«”/",
		"content": "å‰è¨€\né€±äº”ç¢°åˆ°sql serverçš„è¨˜æ†¶é«”é£†æ¼²åˆ°90%ï¼Œ\næ‰¾å¾Œç«¯çœ‹äº†ä¸€ä¸‹ï¼Œçœ‹ä¸å‡ºå€‹æ‰€ä»¥ç„¶ã€‚\nå¾ˆä¸å¹¸çš„ï¼Œç¦®æ‹œå…­åˆè¡åˆ°95%ï¼Œ\nåªå¥½ç·Šæ€¥ç¶­è­·é‡é–‹äº†ï¼Œ\nç¦®æ‹œä¸€é–‹å§‹æ‰¾å•é¡Œã€‚\næ­£æ–‡\nå¯¦éš›ä¸Šè¦æŠŠè¨˜æ†¶é«”æ“åˆ°100%ï¼Œé‚„çœŸçš„å¾ˆé›£ã€‚\nè©¦äº†å¥½å¹¾å¤©ï¼Œæœ€å¤šåªèƒ½åˆ°97%ã€‚\nç„¶å¾Œæœå‹™éƒ½æ²’ä»€éº¼ç—‡ç‹€ï¼Œ\nè®“æˆ‘å€‘é–‹å§‹æƒ³ï¼Œæ˜¯ä¸æ˜¯cloudSQLçœŸçš„å¼·ï¼Œ\né€™è¦æ“ä¸‹å»éƒ½æ²’äº‹ã€‚\nå†ä¾†æŸ¥åˆ°cloudSQLçš„ä¸€ç¯‡æ–‡ç« ï¼Œ\nCloudSQLçš„è¨˜æ†¶é«”åˆ†æˆä¸‹é¢å¹¾ç¨®\n\nCachesÂ Â å¿«å–\nFixed memoryÂ Â å›ºå®šè¨˜æ†¶é«”\nSQL Server overheadÂ Â SQL Server é–‹éŠ·\nIn-Memory online transactional processing (OLTP)\nè¨˜æ†¶é«”ä¸­ç·šä¸Šäº‹å‹™è™•ç† (OLTP)\n\nç„¶å¾Œï¼Œæˆ‘å€‘å¾—çŸ¥å¯ä»¥æ›´æ”¹ max server memoryï¼Œ\nå¼·è¿«SQLä¸è¦ä½¿ç”¨é‚£éº¼å¤šçš„è¨˜æ†¶é«”ã€‚\n\nç„¶å¾Œï¼Œå†ç…§ä¹‹å‰çš„å£“æ¸¬æ–¹å¼æ‰“ä¸‹å»ï¼Œæš´äº†ã€‚\nç¢ºå®šæœƒå½±éŸ¿æœå‹™ã€‚\nå†é‡å° max server memory ï¼Œå¢åŠ å®¹é‡æ¸¬è©¦ï¼Œ\næˆ‘å€‘å¾—åˆ°ä¸‹é¢çš„çµè«–ã€‚\nç•¶ Page life expectancyÂ é€™å€‹å€¼åªè¦&lt;300ï¼Œ\nå°±æœ‰å¯èƒ½é€ æˆæœå‹™çš„å»¶é²ã€‚\nç•¶æ‰çš„ç•¶ä¸‹ï¼Œé€™å€‹å€¼éƒ½æ˜¯è™•æ–¼0ã€‚\nPage life expectancyÂ è¡¨ç¤ºæœ€èˆŠçš„é é¢åœ¨ç·©è¡æ± ä¸­åœç•™çš„æ™‚é–“ï¼ˆä»¥ç§’ç‚ºå–®ä½ï¼‰ï¼Œå¾®è»Ÿå»ºè­°é€™å€‹å€¼å†300ä»¥ä¸Šã€‚\nSELECT Â  [object_name],Â  [counter_name],Â  [cntr_value] FROM Â  sys.dm_os_performance_countersWHERE Â  [object_name] LIKE Â  '%Manager%'AND Â  [counter_name] = 'Page life expectancy'\n\næˆ‘å€‘å¯ä»¥åŒæ™‚çœ‹ä¸€ä¸‹æœ‰æ²’æœ‰SQLè™•æ–¼pendingç‹€æ…‹ã€‚\nSELECTÂ  @@SERVERNAME AS [Server Name],Â  RTRIM([object_name]) AS [Object Name],Â  cntr_value AS [Memory Grants Pending]FROM Â  sys.dm_os_performance_counters WITH(NOLOCK)WHEREÂ  [object_name] LIKE Â  N'%Memory Manager%' Â -- Handles named instancesAND Â  counter_name = N'Memory Grants Pending'\n\nç•¶é€™å€‹å€¼&gt;0æ™‚ï¼Œè¡¨ç¤ºsqlæœå‹™å·²ç¶“é¢è‡¨å´©æ½°é‚Šç·£ï¼Œ\nè©²æº–å‚™é‡å•“è³‡æ–™åº«äº†ã€‚\nref. Optimize high memory consumption in instances",
		"tags": [ "note","ğŸ—„"]
},

{
		"title": " ğŸ—’ Drone MOC  ",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/0.EFK MOC/",
		"content": "æ¦‚å¿µ\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/55. esåŸºæœ¬æ¦‚å¿µç¯‡/\">55. esåŸºæœ¬æ¦‚å¿µç¯‡</a>\n<a class=\"internal-link is-unresolved\" href=\"/404\">81. Beat vs elastic agent</a>\n<a class=\"internal-link is-unresolved\" href=\"/404\">83. Elasticsearch æ¬Šå¨æŒ‡å— ä¿®æ­£</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/84.Elasticsearchç­†è¨˜/\">84.Elasticsearchç­†è¨˜</a>\n\nå»ºç½®\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/43.è‡ªå»ºECK on GKE/\">43.è‡ªå»ºECK on GKE</a>\n\nè¨­å®š\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/â›µï¸ istio/54. istio æ›è¼‰ECK kibana/\">54. istio æ›è¼‰ECK kibana</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/52. ILM è¨­å®š/\">52. ILM è¨­å®š</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/57.filebeat è£œå……èªªæ˜/\">57.filebeat è£œå……èªªæ˜</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/80. ECK 8.1 ,APM intergrationå®‰è£æ–¹å¼/\">80. ECK 8.1 ,APM intergrationå®‰è£æ–¹å¼</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/90. elasticsearch ingest pipeline/\">90. elasticsearch ingest pipeline</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/91. elasticsearch ingest processorè£œå……/\">91. elasticsearch ingest processorè£œå……</a>\n\nUsage\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/68.ECK , apiç­†è¨˜/\">68.ECK , apiç­†è¨˜</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/61. kibana æŸ¥è©¢èªæ³•/\">Kibanaä¸€èˆ¬ä½¿ç”¨è€…æŸ¥è©¢èªæ³•</a>\n<a class=\"internal-link is-unresolved\" href=\"/404\">86. efk apmåœ–è¡¨</a>\n\nTroubleshooting\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/53. apm error/\">53. apm error</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/60. ECKçš„ kibana è­¦å‘Šï¼Œ server.publicBaseUrl is missing/\">60. ECKçš„ kibana è­¦å‘Šï¼Œ server.publicBaseUrl is missing</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/67. ECKï¼Œfilebeat LOGè’é›†éºå¤±/\">67. ECKï¼Œfilebeat LOGè’é›†éºå¤±</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/69. kibanaéŒ¯èª¤è§£æ³• , parent Data too large.../\">69. kibanaéŒ¯èª¤è§£æ³• , parent Data too large...</a>\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/111. filebeat error/\">111. filebeat error</a>",
		"tags": [ "note","ğŸ—’"]
},

{
		"title": "filebeat error",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/111. filebeat error/",
		"content": "ç¢ç¢å¿µ\nç¦®æ‹œä¸€ä¸Šç­å°±è½åŒäº‹å†èªªï¼Œfilebeat stageç’°å¢ƒæœ‰å•é¡Œï¼Œ\næˆ‘é‚„åœ¨ç¦®æ‹œä¸€ç—‡å€™ç¾¤é˜¿~~\nå“ï½SREçš„å®¿å‘½ï¼Œå…ˆä¿®å§\næ­£æ–‡\nä¸€é–‹å§‹çš„å•é¡Œå¾ˆç°¡å–®ï¼Œå°±output serviceè¨­å®šéŒ¯èª¤ï¼Œ\nç„¡æ³•é€£ç·šã€‚\næ”¹å®Œå¾Œï¼Œæ›å¦ä¸€å€‹éŒ¯èª¤ã€‚\n\nValidation Failed: 1: this action would add [2] total shards, but this cluster currently has [1000]/[1000] maximum shards open\n\ngoogleä¸€ä¸‹ï¼Œå°±çœ‹åˆ°Elasticsearch 7.x node é–‹æ”¾ 1000 å€‹ shards é™åˆ¶äº†ã€‚\nä¸Šé¢é€£çµæ˜¯ç”¨curl æ‰“ç¶²å€ç›´æ¥æ”¹ï¼Œä¸‹é¢æ˜¯åˆ°dev Toolsä¸‹æŒ‡ä»¤ï¼Œ\næ‰€ä»¥æœ‰é»ä¸ä¸€æ¨£ã€‚\nåˆ°kibanaä¸Šçš„dev toolsåŠ ä¸Šé€™æ®µï¼ŒæŠŠ1000çš„ä¸Šé™æ‹‰å¤§ã€‚\nPUT _cluster/settings\n{\n&quot;persistent&quot;: {\n&quot;cluster.max_shards_per_node&quot;: &quot;3000&quot;\n}\n}\n\nref. cluster-update-settings\nNon-zero metrics in the last 30s\nçœ‹filebeatè£é¢çš„è¨Šæ¯ï¼Œä¸€ç›´å‡ºç¾é€™ä¸²ã€‚\né—œæ‰å§ã€‚\n# If enabled, filebeat periodically logs its internal metrics that have changed\n# in the last period. For each metric that changed, the delta from the value at\n# the beginning of the period is logged. Also, the total values for\n# all non-zero internal metrics are logged on shutdown. The default is true.\n#logging.metrics.enabled: true\n\n# The period after which to log the internal metrics. The default is 30s.\n#logging.metrics.period: 30s\n\nä½†åœ¨filebeat yamlä¸­ï¼Œæ˜¯é€™æ¨£çš„ã€‚\nlogging:\nmetrics.enabled: false\nlevel: info\nto_files: true\nfiles:\npath: /var/log/filebeat\nname: filebeat\nkeepfiles: 7\npermissions: 0644\n\nref. Non-zero metrics in the last 30s: meaning",
		"tags": ["logging", "logging", "note","ğŸ—’"]
},

{
		"title": "187. ECKçš„filebeat",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/187. ECKçš„filebeat/",
		"content": "å‰è¨€\nä¸€èˆ¬filebeatï¼Œæˆ‘ä¹‹å‰éƒ½æ˜¯åšæˆdaemonsetï¼Œ\nç›´æ¥æŠ“æ¨™æº–è¼¸å‡ºï¼Œå‚³å»elasticserachè£é¢ã€‚\nä½†ç›®å‰ï¼Œä»–å€‘é‚„æ˜¯ç¿’æ…£å¯«æ–‡å­—æª”åˆ°ç‰¹å®šç›®éŒ„ï¼Œ\nfilebeatå†å»é‚£å€‹ç›®éŒ„æŠ“è³‡æ–™å¯«å…¥ï¼Œ\næ‰€ä»¥è®Šæˆä¹Ÿè¦æ›è¼‰ä¸€å€‹readwritemanyçš„nfsã€‚\né‚£é‚Šè¨­å®šæˆ‘é‚„æœ‰é»å›°æƒ‘ï¼Œé‚„éœ€è¦æ¸¬è©¦ã€‚\næ­£æ–‡\nElasticsearch 8.* ç‰ˆæœ¬å¾Œï¼Œéƒ½è¦æ±‚åŠ å¯†æ†‘è­‰ï¼Œ\næ‰€ä»¥è¦ç”¨httpå‚³å¾ˆéº»ç…©ï¼Œ\nå¯èƒ½é‚„è¦é™å®šç‰ˆæœ¬ï¼Œæœ€å¾Œæˆ‘ä¹Ÿæ”¾æ£„äº†ã€‚\nä½¿ç”¨ECKçš„å¥½è™•æ˜¯ä¸ç”¨ç‰¹åˆ¥è¨­å®šcaï¼Œ\nä½†filebeaté€™é‚Šçš„è¨­å®šå°±è¦æŒ‡å®škibanaè·Ÿelasticsearchäº†\nä½†åœ¨ä¸åŒçš„nsï¼Œæ•…éœ€ç‰¹åˆ¥æŒ‡å®šnsã€‚\napiVersion: beat.k8s.elastic.co/v1beta1\nkind: Beat\nmetadata:\nname: filebeat\nspec:\ntype: filebeat\nversion: 8.11.0\nelasticsearchRef:\nname: fixed\nnamespace: elastic-system\nkibanaRef:\nname: fixed\nnamespace: elastic-system\nconfig:\nfilebeat.inputs:\n#websocketclient\n- type: log\nignore_older: 24h\nenabled: true\npaths:\n- /var/log/app-logs/websocketclient/*.log\njson.keys_under_root: true\njson.add_error_key: true\nfields_under_root: true\ntags: [&quot;prod-sms-back-websocketclient&quot;]\n#filebeat_self\n- type: log\nignore_older: 24h\nenabled: true\npaths:\n- /var/log/filebeat/*.ndjson\njson.keys_under_root: true\njson.add_error_key: true\nfields_under_root: true\ntags: [&quot;filebeat_self&quot;]\nprocessors:\n- timestamp:\nfield: LoggingTime\nlayouts:\n- '2006-01-02T15:04:05Z'\n- '2006-01-02T15:04:05.999Z'\n- '2006-01-02T15:04:05.999-07:00'\ntest:\n- '2019-06-22T16:33:51Z'\n- '2019-11-18T04:59:51.123Z'\n- '2020-08-03T07:10:20.123456+02:00'\n- add_locale:\nformat: offset\n- drop_fields:\nfields: [&quot;agent&quot;, &quot;input&quot;, &quot;host&quot;, &quot;log&quot;, &quot;ecs&quot;, &quot;data_stream&quot;, &quot;event.timezone&quot;, &quot;LoggingTime&quot;]\noutput.elasticsearch:\nusername: &quot;elastic&quot;\npassword: &quot;abc&quot;\nindices:\n#websocketclient\n- index: &quot;prod-sms-back-websocketclient-%{+yyyy.MM.dd}&quot;\nwhen.contains:\ntags: &quot;prod-sms-back-websocketclient&quot;\n#filebeat_self\n- index: &quot;filebeat_self-%{+yyyy.MM.dd}&quot;\nwhen.contains:\ntags: &quot;filebeat_self&quot;\nlogging:\nmetrics.enabled: false\nlevel: info\nto_files: true\nfiles:\npath: /var/log/filebeat\nname: filebeat\nkeepfiles: 7\npermissions: 0644\ndeployment:\npodTemplate:\nspec:\nautomountServiceAccountToken: true\nterminationGracePeriodSeconds: 30\ndnsPolicy: ClusterFirstWithHostNet\nhostNetwork: true # Allows to provide richer host metadata\ncontainers:\n- name: filebeat\nsecurityContext:\nrunAsUser: 0\n# If using Red Hat OpenShift uncomment this:\n#privileged: true\nvolumeMounts:\n- name: applog\nmountPath: /var/log/app-logs\nvolumes:\n- name: applog\npersistentVolumeClaim:\nclaimName: logs-nfs-test-pvc\n\nå‚™è¨»ä¸€ä¸‹ï¼Œå®Œæ•´ECKå®‰è£çš„yaml\n# 1. setup eck operator and crd\n# kubectl create -f https://download.elastic.co/downloads/eck/2.10.0/crds.yaml\n# kubectl apply -f https://download.elastic.co/downloads/eck/2.10.0/operator.yaml\n\napiVersion: elasticsearch.k8s.elastic.co/v1\nkind: Elasticsearch\nmetadata:\nname: fixed\n# name: yabo\nnamespace: elastic-system\nspec:\nversion: 8.11.0\nnodeSets:\n- name: all\ncount: 1\npodTemplate:\nspec:\ncontainers:\n- name: elasticsearch\nenv:\n- name: ES_JAVA_OPTS\nvalue: -Xms2g -Xmx2g\nresources:\nrequests:\nmemory: 4Gi\nlimits:\nmemory: 4Gi\nconfig:\nnode.roles:\n- master\n- data\n- ingest\nnode.attr.attr_name: attr_value\nnode.store.allow_mmap: false\nvolumeClaimTemplates:\n- metadata:\nname: elasticsearch-data # Do not change this name unless you set up a volume mount for the data path.\nspec:\naccessModes:\n- ReadWriteOnce\nresources:\nrequests:\nstorage: 100Gi\nstorageClassName: standard\n# å„²å­˜ç©ºé–“éœ€è¦åŠ å¤§ï¼Œé è¨­åªæœ‰1G ä¸å¤ \n\n---\n\napiVersion: kibana.k8s.elastic.co/v1\nkind: Kibana\nmetadata:\nname: fixed\nnamespace: elastic-system\nspec:\nversion: 8.11.0\ncount: 1\nelasticsearchRef:\nname: fixed\nhttp:\ntls:\nselfSignedCertificate:\ndisabled: true\nservice:\nspec:\nports:\n- name: http\nport: 5601\ntargetPort: 5601\n\n---\n\nref. ECKéƒ¨ç½²",
		"tags": ["websocketclient", "filebeat_self", "websocketclient", "filebeat_self", "privileged", "note","ğŸ—’"]
},

{
		"title": "è‡ªå»ºECK on GKE",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/43.è‡ªå»ºECK on GKE/",
		"content": "å‰è¨€\næ­£æ–‡\nElastic Cloud on Kubernetes ç°¡åŒ–äº†åœ¨ Kubernetes ä¸­é‹è¡Œ Elasticsearch å’Œ Kibana çš„ä½œæ¥­ï¼ŒåŒ…æ‹¬è¨­ç½®ã€å‡ç´šã€å¿«ç…§ã€æ“´å±•ã€é«˜å¯ç”¨æ€§ã€å®‰å…¨æ€§ç­‰\nistio å®‰è£æ™‚ï¼Œé–‹log\nistioctl manifest install -f loadBalancerSourceRange.yaml --set meshConfig.accessLogFile=/dev/stdout\n\næˆ–æ˜¯æ›´æ”¹yaml ï¼ŒåŠ ä¸Š meshConfigé€™æ®µ\nkind: IstioOperator\napiVersion: install.istio.io/v1alpha1\nmetadata:\nannotations:\ninstall.istio.io/ignoreReconcile: 'true'\nname: istio-external\nnamespace: istio-system\nspec:\nmeshConfig:\naccessLogFile: /dev/stdout\n\nECK\nKubernetes before 1.16ä»¥ä¸Šç‰ˆæœ¬\nkubectl create -f https://download.elastic.co/downloads/eck/2.1.0/crds.yaml\nkubectl apply -f https://download.elastic.co/downloads/eck/2.1.0/operator.yaml\n\néœ€å…ˆå®‰è£ elasticsearch Operator\nref.Elasticsearch (ECK) Operator\n\nä½ˆç½² elasticsearch\n\ncat &lt;&lt;EOF | kubectl apply -f -\napiVersion: elasticsearch.k8s.elastic.co/v1\nkind: Elasticsearch\nmetadata:\nname: quickstart\nspec:\nversion: 7.15.0\nnodeSets:\n- name: default\ncount: 1\nconfig:\nnode.store.allow_mmap: false\nEOF\n\næª¢æŸ¥ç‹€æ…‹\n\tkubectl get elasticsearch\n\nåˆ°podè£¡é¢æ¸¬è©¦elasticæ˜¯å¦æ­£å¸¸\nå¯†ç¢¼éœ€ä½¿ç”¨ kubectl get secret å–å¾—ï¼Œ<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/43.è‡ªå»ºECK on GKE/#å–å¾—å¯†ç¢¼ï¼š\">#å–å¾—å¯†ç¢¼ï¼š</a>\ncurl https://10.107.201.126:9200 -u 'elastic:J1fO9bu8adfsepYK8rIu91a73o' -k\n\næ­£å¸¸çš„è©±ï¼Œæœƒé¡¯ç¤º\n\nä½ˆç½²kibana\n\ncat &lt;&lt;EOF | kubectl apply -f -\napiVersion: kibana.k8s.elastic.co/v1\nkind: Kibana\nmetadata:\nname: quickstart\nspec:\nversion: 7.15.0\ncount: 1\nelasticsearchRef:\nname: quickstart\nEOF\n\næª¢æŸ¥ç‹€æ…‹\n\tkubectl get kibana\n\nç™»å…¥\nå¸³è™Ÿï¼šelastic\nå–å¾—å¯†ç¢¼ï¼š\nkubectl get secret quickstart-es-elastic-user -o=jsonpath='{.data.elastic}' | base64 --decode; echo\n\nè½‰port\nkubectl port-forward service/quickstart-kb-http 5601\n\nurl : https://localhost:5601\nbeat\nBeats å…¶å¯¦æ˜¯ä¸€ç³»åˆ—å·¥å…·çš„ç¸½ç¨±ï¼Œå¯ä»¥è§£æ±ºä¸‹åˆ—çš„å•é¡Œï¼š\n\nè®€å–æª”æ¡ˆ\næå–æŒ‡æ¨™\næå–ç¶²è·¯è³‡æ–™\næ¸¬è©¦æœå‹™å¯ç”¨æ€§\n\næœ‰é€™äº› Filebeat, Metricbeat,Heartbeat,Packetbeat...ç­‰\n\næŸ¥è©¢ç›®å‰æœ‰å“ªäº›indexäº†\n\nåˆ°DevToolsåŸ·è¡Œ\nGET _cat/indices?s=index\n\nref.\nBeats\nã€ESæ–°æ‰‹ï¼Œç ´é–€è€Œå…¥ï¼ã€‘Day9 - æˆ‘è¦‹æ•…æˆ‘åœ¨ï¼Observability åŸºç¤ä¹‹è¶´ç‰¹ç¡\nã€ESæ–°æ‰‹ï¼Œç ´é–€è€Œå…¥ï¼ã€‘Day13 - é—œæ–¼ Metrics çš„ 23456 äº‹\nFilebeat\næ—¥èªŒè™•ç†å·¥å…·ï¼Œåªè¦æœƒç”¢ç”Ÿæ—¥èªŒçš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å®ƒï¼Œå®ƒå¯ä»¥å¹«åŠ©ä½ å°‡æ—¥èªŒå‚³é€åˆ° Elasticsearch æˆ–å…¶ä»–çš„ç³»çµ±ã€‚\n\nlog ä½ç½®\n/var/log/containers\næŸ¥è©¢å‚³äº†å“ªäº›è³‡æ–™åˆ°elastic searchè£¡é¢ã€‚\nåŒæ¨£ä½¿ç”¨ Devtools\nGET filebeat-*/_search\n\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/57.filebeat è£œå……èªªæ˜/\">57.filebeat è£œå……èªªæ˜</a>\nref.\nElastic Logging X Filebeat æ·±å…¥ç†è§£\nMetricsbeat\nå°‡æŒ‡æ¨™å‚³é€åˆ° Elasticsearch åˆ†æï¼Œä¸¦æ­é… Kibana åšè¦–è¦ºåŒ–ã€‚\næŒ‡æ¨™è‘—é‡åœ¨è³‡è¨Šçš„é€±æœŸæ€§æ¸¬é‡ï¼Œè®“æˆ‘å€‘å¯ä»¥ç­è§£ç³»çµ±çš„ç‹€æ…‹å¦‚ç¡¬ç¢Ÿç©ºé–“ã€CPUä½¿ç”¨ç‡ç­‰ç­‰ã€‚\nref. ESæ–°æ‰‹ï¼Œç ´é–€è€Œå…¥ï¼ã€‘Day10 - çœ¼è¦‹ç‚ºæ†‘ï¼Observability åŸºç¤ä¹‹è¶´ç‰¹ä½›\nAPM\nAPM çš„å…¨åæ˜¯ Application Performance Monitoringï¼ˆæ‡‰ç”¨ç¨‹å¼æ•ˆèƒ½ç›£æ§ï¼‰ï¼Œæ˜¯ç”¨ä¾†å›ç­”ä¸‹é¢å…©å€‹ä¸»è¦çš„å•é¡Œï¼š\n\næ‡‰ç”¨ç¨‹å¼è¦èŠ±å¤šä¹…æ™‚é–“ä¾†ç­”è¦†è«‹æ±‚ï¼ˆrequestï¼‰ï¼Ÿ\næ‡‰ç”¨ç¨‹å¼é‡åˆ°ä»€éº¼ç¨®é¡çš„éŒ¯èª¤ï¼Ÿ\n\nElastic APM æ˜¯ç”±ä¸‹åˆ— 4 å€‹çµ„ä»¶æ‰€æ§‹æˆï¼š\n\nAPM Agents\nAPM Server\nElasticsearch\nKibana\n\nä½ˆç½²APM server\ncat &lt;&lt;EOF | kubectl apply -f -\napiVersion: apm.k8s.elastic.co/v1\nkind: ApmServer\nmetadata:\nname: apm-server-quickstart\nnamespace: default\nspec:\nversion: 7.15.0\ncount: 1\nelasticsearchRef:\nname: quickstart\nkibanaRef:\nname: quickstart\nconfig:\noutput:\nelasticsearch:\nhost: [quickstart-es-http.default:9200]\nusername: elastic\npassword: &quot;E1R10XXXXXXfr40&quot;\nprotocol: &quot;http&quot;\nEOF\n\né€™é‚Šçš„passwordè¦ç›´æ¥ä¸‹æŒ‡ä»¤æŸ¥è©¢ï¼Œé€™å€‹æ˜¯å‰é¢ç™»å…¥kibanaçš„å¯†ç¢¼ã€‚\nkubectl get secret quickstart-es-elastic-user -o=jsonpath='{.data.elastic}' | base64 --decode; echo\n\nç‚ºäº†ç’°å¢ƒå–®ç´”ï¼Œæ‰€ä»¥åªä½¿ç”¨httpï¼Œè¦ç”¨httpsè«‹åƒè€ƒé€£çµ Reference an existing Elasticsearch clusterã€‚\nref.\nElastic APM åŸºç¤æ•™å­¸\nESæ–°æ‰‹ï¼Œç ´é–€è€Œå…¥ï¼ã€‘Day10 - çœ¼è¦‹ç‚ºæ†‘ï¼Observability åŸºç¤ä¹‹è¶´ç‰¹ä½›\nRun APM Server on ECK\nGO-APM agent\nåœ¨å»ºç«‹ apm-serverçš„æ™‚å€™ï¼Œ\næœƒåŒæ™‚å»ºç«‹å¥½ secret token ï¼Œé€™å€‹åŒæ¨£éœ€è¦ä¸‹æŒ‡ä»¤å–å¾—ï¼Œ\nä¹‹å¾Œåœ¨ agentä¸Šé¢è¨­å®šå®Œï¼Œæ‰èƒ½å°‡è³‡æ–™å‚³åˆ° APM serverä¸Šé¢ã€‚\né€™é‚Šå–config nameç‚º ( [apm name]apm-token )\nkubectl get secret apm-server-quickstart-apm-token -o=jsonpath='{.data.secret-token}' | base64 --decode; echo\n\nè¨­å®šAPM serverç’°å¢ƒè®Šæ•¸ï¼Œç”±æ–¼æˆ‘çš„æœå‹™éƒ½æ˜¯docker imageï¼Œ\næ‰€ä»¥è¦æŠŠè®Šæ•¸å¯«åœ¨Dockerfileè£¡é¢ï¼Œç•¶æ‰“åŒ…æ™‚ï¼Œä¸€ä½µè¨­å®šå¥½ç’°å¢ƒè®Šæ•¸ã€‚\n\n...\nENV ELASTIC_APM_SERVER_URL=https://apm-server-quickstart-apm-http.default:8200\nENV ELASTIC_APM_SERVICE_NAME=webhook\nENV ELASTIC_APM_SECRET_TOKEN=9m9XXXXXXGjwdIk41\nENV ELASTIC_APM_VERIFY_SERVER_CERT=false\nENV ELASTIC_APM_ENVIRONMENT=qa\n...\n\nç„¶å¾Œå† main.go ï¼ŒåŠ ä¸Šä¸‹é¢å¹¾è¡Œã€‚\né€™ä»½goçš„ç¨‹å¼ï¼Œæœ¬èº«ä½¿ç”¨äº† gorilla/muxçš„webæ¡†æ¶\næ‰€ä»¥ç…§å®˜æ–¹æ–‡ä»¶çš„èªªæ˜ï¼ŒåŠ ä¸Šä¸‹é¢å¹¾è¡Œã€‚\nimport (\n\t&quot;github.com/gorilla/mux&quot;\n\n\t&quot;go.elastic.co/apm/module/apmgorilla&quot;\n)\n\nfunc main() {\n\trouter := mux.NewRouter()\n\tapmgorilla.Instrument(router)\n\thttp.ListenAndServe(&quot;:80&quot;, router)\n}\n\nä¸»è¦åªæœ‰ apmgorilla.Instrument(router) é€™è¡Œï¼Œ\nç„¶å¾Œåªè¦æœ‰ç¶“é80 portçš„è³‡æ–™å°±é€šé€šéƒ½æœƒé€²å…¥åˆ°APMè£¡é¢äº†ã€‚\n\né€™å¼µåœ–è£¡é¢çš„TPSæ„æ€ï¼Œå¯åƒè€ƒ <a class=\"internal-link is-unresolved\" href=\"/404\">blog.45.ç¶²ç«™æ•ˆèƒ½æŒ‡æ¨™ä¸€è¦½ï¼ˆæœªï¼‰</a>\nref.\nAPM Server secret token\nå¦‚ä½•ä½¿ç”¨ Elastic APM Go ä»£ç†ç‚º Go æ‡‰ç”¨è£è¼‰æ¸¬é‡å·¥å…·\n[Docker ç’°å¢ƒè®Šæ•¸ä½¿ç”¨ç­†è¨˜](https://myapollo.com.tw/zh-tw/docker-env/)\nElastic APM-Go Agentä»‹ç´¹(ä¸­æ–‡ç¿»è­¯)\nconnect to the APM Server\nSolutionsï¼šå®‰å…¨çš„APMæœå‹™å™¨è¨ªå•\nvue-APM agent\nå®‰è£ä¾è³´å¥—ä»¶\nKibana\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/61. kibana æŸ¥è©¢èªæ³•/\">61. kibana æŸ¥è©¢èªæ³•</a>\nref.\nKibana Query Language",
		"tags": ["å–å¾—å¯†ç¢¼ï¼š", "note","ğŸ—’"]
},

{
		"title": "ILM è¨­å®š",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/52. ILM è¨­å®š/",
		"content": "å‰è¨€\nä½¿ç”¨é è¨­çš„filebeat.yamlè¨­å®šï¼Œ\nå°è‡´ç¾åœ¨elasticsearchçš„logçˆ†ç‚¸äº†ã€‚\né€£é–‹éƒ½é–‹ä¸èµ·ä¾†ã€‚\næ‰€ä»¥é€™æ¬¡è¦è§£æ±ºå…©å€‹å•é¡Œï¼Œ\n\nè‡ªå‹•åˆªé™¤èˆŠçš„log\nå°‡logæ ¹æ“šæ—¥æœŸåˆ†é…\n\nç¶“éä¸€æ—©ä¸Šçš„ç ”ç©¶ï¼Œç™¼ç¾æˆ‘æƒ³å¾—è·Ÿæˆ‘è¦è§£æ±ºçš„å•é¡Œä¸ä¸€æ¨£XDDD\næ‰€ä»¥æœ¬æ–‡æœƒåœ¨æ¢è¨ILMçš„è¨­å®š\næ­£æ–‡\næœ‰äº›è§€å¿µè·Ÿæˆ‘æƒ³å¾—ä¸ä¸€æ¨£ï¼Œ\nä¸‹åœ–çœ‹åˆ°çš„ indicesï¼Œæ˜¯åœ¨elasticSearchï¼ˆç°¡ç¨±ESï¼‰ä¸Šï¼Œ\næ‰€å»ºç«‹çš„ã€‚\nESä¸Šçš„indicesæœƒé•·é€™æ¨£\n\næ‰€ä»¥è·ŸfileBeatæ²’æœ‰é—œä¿‚ï¼ŒfileBeatåªè² è²¬æŠŠè³‡æ–™ä¸Ÿéå»ESä¸Šã€‚\nç•¶ç„¶è£¡é¢ä¹Ÿæœ‰ä¸€äº›è¨­å®šï¼Œç­‰ä»¥å¾Œæœ‰ç©ºå†ä¾†ç ”ç©¶ã€‚\né¦–å…ˆåˆ° kibanaçš„ç•«é¢ï¼Œ\nåˆ° Management ä¸­å»è¨­å®šILM\n\nè£¡é¢çš„è¨­å®šï¼Œè«‹åƒè€ƒä¸‹é¢æ–‡ç« ï¼Œ\næˆ–æ˜¯ç›´æ¥çœ‹è‹±æ–‡ä¹Ÿå¯ä»¥æ‡‚ã€‚\nä½†æœ€å¥½å…ˆçœ‹ä¸€ä¸‹æ–‡ç« ï¼Œesçš„ indices å€åˆ†æˆä¸‰å€‹éšæ®µï¼Œ\næ”¹å®Œè¨­å®šå¾Œï¼Œä¸¦ä¸æœƒç«‹å³ç”Ÿæ•ˆï¼Œåªæœ‰ç•¶éåº¦åˆ°ä¸‹ä¸€å€‹éšæ®µçš„æ™‚å€™ï¼Œé…ç½®æ‰æœƒç”Ÿæ•ˆã€‚\nä¹Ÿå°±æ˜¯èªªï¼Œå¦‚æœä½ ä¸€ç›´åœ¨ Hot phaseï¼Œ\né‚£æ°¸é ä¸æœƒåŸ·è¡Œä½ å‰›è¨­å®šçš„åƒæ•¸ã€‚\nä½†ä¸€ç•¶ä½ é€²å…¥Warm phaseæ™‚ï¼Œ\nä½ å‰›å‰›è¨­å®šçš„åƒæ•¸å°±éƒ½æœƒåŸ·è¡Œäº†ã€‚\n\nå¦å¤–åœ¨å„å€‹ phase ï¼Œèƒ½åšçš„äº‹æƒ…ä¹Ÿéƒ½ä¸ä¸€æ¨£ã€‚\n\nIndex Lifecycle Management çš„éšæ®µ\næ­¤éšæ®µä¸­å¯ä»¥åŸ·è¡Œçš„æ“ä½œæœ‰ä»€éº¼\n\nHot\nForce merge, Rollover, Set priority, Unfollow\n\nWarm\nAllocate, Force merge, Read only, Set priority, Shrink, Unfollow\n\nCold\nAllocate, Freeze, Set priority, Unfollow\n\nDelete\nDelete, Wait for snapshot\n\nåƒè¦åˆªé™¤ indices çš„è©±ï¼Œå°±å¿…é ˆè¦åˆ° Delete phaseçš„éšæ®µæ‰å¯ä»¥ã€‚\nps. å¦‚æœç™¼ç¾æ²’æœ‰çœ‹åˆ° delete phaseï¼Œ\nè¦å…ˆæŠŠä¸‹åœ–çš„é–‹é—œåˆ‡æ›éå»ï¼Œdelete phase æ‰æœƒå‡ºç¾ã€‚\n\nè¨­å®šå®Œå¾Œï¼Œå¯ä»¥åˆ° Dev Tools ï¼Œ\n\næŸ¥è©¢æœ‰å“ªäº› indices\n\nGET /_cat/indices\n\næŸ¥indicesç‹€æ…‹\nå°‡å³é‚Šçš„ indicsï¼Œå–ä»£ä¸‹é¢çš„url ã€‚\né€™é‚Šä½¿ç”¨çš„ indices åç¨±ç‚º filebeat-7.15.0-2021.10.07-000001 ï¼Œå¦‚æœè¦çŸ¥é“jsonå…§çš„å…§å®¹æ„ç¾©ï¼Œè«‹åƒè€ƒä¸‹é¢é€£çµã€Explain lifecycle APIã€ã€‚\n\nGET filebeat-7.15.0-2021.10.07-000001/_ilm/explain\n\nå•Ÿå‹• ILM\n\nPOST /_ilm/start\n\nref.\n\nå–¬å”æ•™ Elastic - 11 - ç®¡ç† Index çš„ Best Practices (3/7) - Index Lifecycle Management (ILM)\nä½¿ç”¨ç´¢å¼•ç”Ÿå‘½é€±æœŸç®¡ç†å¯¦ç¾ç†±æº«å†·æ¶æ§‹\nExplain lifecycle API\nAutomatically delete old indices\n\nè·Ÿé€™æ¬¡çš„å•é¡Œæ²’é—œä¿‚ï¼Œä½†é‚„æ˜¯ç•™å€‹é€£çµ\n\nFilebeat \bharvester çš„ file handler close èˆ‡ clean æ©Ÿåˆ¶\nfilebeaté€²ç¨‹å¯«æ»¿ç£ç›¤çš„æƒ…æ³è™•ç†\nä¸€ç¯‡æ–‡ç« ææ‡‚filebeatï¼ˆELKï¼‰\nFilebeaté…ç½®åƒè€ƒæ‰‹å†Š]\n\ncurator\n\nelasticsearch curatorå®‰è£åŠæ‡‰ç”¨\nInstall and configure Elasticsearch Curator to delete the old indices.\nELK æ•™å­¸ - å®šæœŸæ¸…é™¤ Elasticsearch è³‡æ–™",
		"tags": [ "note","ğŸ—’"]
},

{
		"title": "apm error",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/53. apm error/",
		"content": "å‰è¨€\næ­£æ–‡\néŒ¯èª¤è¨Šæ¯\n\nThere are no ingest nodes in this cluster, unable to forward request to an ingest node.\n\nESçš„yaml\nå¢åŠ \nnode.roles:\n- ingest\n\nref.\n\nNode\nå¦‚ä½•åœ¨ Elasticsearch ä¸­ä½¿ç”¨ pipeline API ä¾†å°äº‹ä»¶é€²è¡Œè™•ç†\nThere are no ingest nodes in this cluster, unable to forward request to an ingest node",
		"tags": [ "note","ğŸ—’"]
},

{
		"title": "esåŸºæœ¬æ¦‚å¿µç¯‡",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/55. esåŸºæœ¬æ¦‚å¿µç¯‡/",
		"content": "å‰è¨€\næ­£æ–‡\nå…ˆä¾†å€‹æ¯”è¼ƒå®¹æ˜“å°æ¯”çš„è¡¨æ ¼ï¼Œä½†ä¸å®Œå…¨ä¸€æ¨£ï¼Œ\næœ‰å¹¾å€‹æ˜¯æˆ‘è‡ªå·±åŠ ä¸Šå»çš„ã€‚\n\nRDBMS\nElasticsearch\n\nVM\nNode\n\nTable\nIndex\n\nRow\nDocument\n\nColumn\nField\n\nSchema\nMapping\n\nSQL\nDSL\n\nref. [Elasticsearch] åŸºæœ¬æ¦‚å¿µ &amp; æœå°‹å…¥é–€\næ‘˜è¦\nNode\n\nMaster Node\n\nè™•ç†å»ºç«‹/åˆªé™¤ index çš„ requestï¼Œä¸¦å¯¦éš›åŸ·è¡Œ\næ±ºå®šæ¯å€‹ shard è¦è¢«åˆ†é…åˆ°å“ªå€‹ data node ä¸Š\nç¶­è­· &amp; æ›´æ–° cluster state\nç•¶ master nodeå‡ºå•é¡Œï¼Œmaster eligible nodeï¼ˆå¾clusterè¨­å®šå¤šå€‹ï¼‰æœƒé–‹å§‹é¸èˆ‰ï¼Œé¸å‡ºä¸‹ä¸€å€‹ master node\n\nCoordinating Node(å”èª¿ç¯€é»)\n\næ‰€æœ‰nodeé è¨­éƒ½æ˜¯ Coordinating Node\nè™•ç†requestçš„node ä»¥åŠ æœ€å¾Œé€²è¡Œçµæœçš„å½™æ•´\ncoordinating node å¯ä»¥ç›´æ¥æ¥æ”¶ search request ä¸¦è™•ç†ï¼Œä¸éœ€è¦é€é master node è½‰éä¾†\n\nData Node\n\nå¯ä»¥ä¿å­˜è³‡æ–™çš„ nodeï¼Œæ¯å€‹ node å•Ÿå‹•å¾Œéƒ½æœƒé è¨­æ˜¯ data nodeï¼Œå¯ä»¥é€éè¨­å®š node.data: false åœç”¨ data node åŠŸèƒ½\né€éå¢åŠ  data node å¯ä»¥è§£æ±ºè³‡æ–™æ°´å¹³æ“´å±• &amp; è§£æ±ºå–®é»æ•…éšœå°è‡´è³‡æ–™éºå¤±çš„å•é¡Œ\n\nCluster Stateï¼ˆé›†ç¾¤ç‹€æ…‹)\n\nåŒ…å«æ‰€æœ‰nodeè³‡è¨Š\nåŒ…å«æ‰€æœ‰index åŠ ç›¸å°æ‡‰çš„ mapping/settingé…ç½®\nshardçš„è·¯ç”±è³‡è¨Š\næ¯å€‹nodeä¸Šéƒ½æœ‰Cluster Stateï¼Œåªæœ‰master å¯ä¿®æ”¹\n\nShard\nå°‡ç´¢å¼•åŠƒåˆ†æˆå¤šä»½çš„èƒ½åŠ›ï¼Œé€™äº›ä»½å°±å«åšåˆ†ç‰‡ï¼ˆshardï¼‰\nä¾‹å¦‚ä½ æœ‰ä¸€å€‹index ï¼ˆ1T) ï¼Œè¦æ€éº¼å­˜åˆ°ä¸åŒçš„Nodeï¼Œ\næ­¤æ™‚å°±éœ€è¦ä½¿ç”¨(shard)\n\nshard æ˜¯ ESåˆ†æ•£å¼å„²å­˜çš„åŸºç¤ï¼ŒåŒ…å« primary shard åŠ replica shard\n\næ¯ä¸€å€‹shard å°±æ˜¯ä¸€å€‹ Lucene instance(ç”¨æ–¼å…¨æ–‡æª¢ç´¢å’Œæœå°‹ e.g. Solr,Elasticsearch...)\n\nPrimary Shard(æå‡ç³»çµ±å„²å­˜å®¹é‡)\n\nå°‡ä¸€ä»½è¢«ç´¢å¼•å¾Œçš„è³‡æ–™ï¼Œåˆ†æ•£åˆ°å¤šå€‹data nodeä¸Šå­˜æ”¾\nprimary shard çš„æ•¸é‡åœ¨å»ºç«‹ indexæ™‚å°±æœƒæŒ‡å®šï¼Œç„¡æ³•å¾ŒçºŒä¿®æ”¹\n\nReplica Shardï¼ˆæé«˜è³‡æ–™å¯ç”¨æ€§)\n\nç•¶primary shardéºå¤±ï¼ŒReplica shardå¯ä»¥è¢«æ¨æˆ primary shard\nreplica shardæ•¸é‡å¯å‹•æ…‹èª¿æ•´ï¼Œè®“æ¯å€‹data nodeä¸Šéƒ½æœ‰å®Œæ•´è³‡æ–™\nå¯ä¸€å®šç¨‹åº¦æé«˜æŸ¥è©¢çš„æ•ˆèƒ½\nES7.0é–‹å§‹ï¼Œprimary shard é è¨­ç‚º1 ,replica shardé è¨­ ç‚º0\n\nå¦‚ä¸è¨­å®šreplica shardï¼Œä¸€æ—¦data node æ•…éšœå°è‡´ primary shardéºå¤±ï¼Œè³‡æ–™ç„¡æ³•å¾©åŸ\n\nShardè¨­å®š\n\nreplica shardè¨­å®šéå¤šï¼Œæœƒé™ä½clsuteræ•´é«”çš„å¯«å…¥æ•ˆèƒ½\n\nreplica shard å¿…é ˆå’Œ primary shard è¢«åˆ†é…åœ¨ä¸åŒçš„ data node ä¸Šï¼›ä½†æ‰€æœ‰çš„ primary shard å¯ä»¥åœ¨åŒä¸€å€‹ data node ä¸Š\n\nCommand\n\nå–å¾—Cluster å¥åº·ç‹€æ…‹\n\tGET _cluster/health/\n\nStatus\n- Green ï¼šè¡¨ç¤º Primary shard &amp; Replica Shardå¯æ­£å¸¸åˆ†é…\n- Yellowï¼šè¡¨ç¤º Primay shardå¯æ­£å¸¸åˆ†é…ï¼Œä½†Replica shard åˆ†é…æœ‰å•é¡Œ\n- Redï¼šæœ‰Primary shard ç„¡æ³•æ­£å¸¸åˆ†é…\n\nå–å¾— Shardç‹€æ…‹\n\tGET _cat/shards\n\np ï¼šä»£è¡¨ primary shard\nr ï¼šä»£è¡¨ replica shard\n2. shardçš„åˆ†ä½ˆæƒ…å½¢ï¼Œåœ¨å“ªå€‹nodeä¸Š\n3. æ¯å€‹shardåŒ…å«çš„documentæ•¸é‡ &amp; ç©ºé–“\næƒ…å¢ƒ\n\nå¦‚æœcluster åªæœ‰ä¸€å€‹node ï¼Œå…¨éƒ¨æœƒè¢« primary shardä½”æ“šï¼Œå°è‡´ replica shard ç„¡æ³•è¢«åˆ†é…ï¼Œå› æ­¤clusterå¥åº·ç‹€æ…‹ç‚º yellow\n\nè³‡æ–™å¯«å…¥\n\ncache\n\nè³‡æ–™å¯«å…¥å¾Œç„¡æ³•è®Šå‹•ï¼Œé¿å…lockæ©Ÿåˆ¶æ‰€å¸¶ä¾†çš„æ•ˆèƒ½å•é¡Œ\nå› ä¸å¯è®Šå‹•ï¼Œè‹¥è¦è®“æ–°çš„document å¯è¢«æœå°‹ï¼Œéœ€è¦é‡å»ºindex\nå¯«å…¥documentå‰ï¼Œæœƒå…ˆå¯«åˆ° Index Bufferçš„å„²å­˜ç©ºé–“\næ»¿è¶³æ¢ä»¶(Index Bufferä½”æ»¿) or ç‰¹å®šæ™‚é–“(é è¨­ä¸€ç§’ä¸€æ¬¡)ï¼Œæœƒå°‡ Buffer å¯«å…¥ Segment ã€‚å¯«å…¥çš„éç¨‹å«Refreshã€‚\n\ntransaction log\n\næ¯å€‹shardéƒ½æœ‰å°æ‡‰çš„transaction log\nå¯«å…¥documentçš„æ™‚å€™ï¼ŒåŒæ™‚ä¹Ÿæœƒå¯«å…¥ transaction log\n\nref.\n\n[Elasticsearch] åˆ†æ•£å¼ç‰¹æ€§ &amp; åˆ†æ•£å¼æœå°‹çš„æ©Ÿåˆ¶\nElasticsearch ä¸­çš„ä¸€äº›é‡è¦æ¦‚å¿µ: cluster, node, index, document, shards åŠ replica\nElasticsearch åŸºæœ¬åŸç†åŠè¦åŠƒ",
		"tags": [ "note","ğŸ—’"]
},

{
		"title": "filebeat è£œå……èªªæ˜",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/57.filebeat è£œå……èªªæ˜/",
		"content": "å…§å®¹\n<a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/57.filebeat è£œå……èªªæ˜/#2024-05-28\">#2024/05/28è£œå……</a>\nfilebeatæŠ“è³‡æ–™çš„æ–¹å¼\n\nautodiscover\nwithout autodiscover\n\nè¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç”¨(2) çš„æ–¹å¼ï¼Œåœ¨GKEä¸Šé¢ï¼Œä½ è¦ä½¿ç”¨ add_kubernetes_metadataï¼Œå»å–å¾—pod name,namespace..ç­‰ï¼Œ\né€šé€šæŠ“ä¸åˆ°ã€‚\nå› ç‚º(2)æ˜¯ç›´æ¥å»nodeçš„logè£¡é¢æŠ“è³‡æ–™ï¼Œä¸¦æ²’æœ‰é€éapiçš„æ–¹å¼ï¼Œ\næ‰€ä»¥å¦‚æœè¦å–å¾— pod nameçš„è©±ï¼Œå¯èƒ½è¦å¾log pathç€æ‰‹ã€‚\næ‡‰è©²æ˜¯å¯ä»¥å¾ingest å»è™•ç†ã€‚\nä½†ç”¨(1)ï¼Œè³‡æ–™å°±é€šé€šé€²ä¾†äº†ã€‚\n\næ‰€ä»¥é‚„æ˜¯ç”¨(1)å§ã€‚\nref.\n\nConfiguration Examples\nAdd Kubernetes metadata\n\næ’é™¤è³‡æ–™çš„æ–¹å¼\næ²’æœ‰è¨˜éŒ„logä¸çŸ¥é“ï¼Œä¸€è¨˜éŒ„äº†æ‰çŸ¥é“ã€‚\nè³‡æ–™æœ‰å¤ è‚¥ã€‚\né–‹å§‹è·ŸåŒä»èªªï¼Œæ²’æœ‰å¿…è¦çš„ä¸è¦ç•™ã€‚\nä½†æœ‰äº›æ˜¯å…ˆå¤©é™åˆ¶ï¼Œå°±æ˜¯æœƒæ‹¼å‘½å°ï¼Œé‚£è©²æ€éº¼è§£æ±ºã€‚\n\næ’é™¤è¨Šæ¯å…§çš„ç‰¹å®šæ–‡å­—ï¼Œé€šé€šä¸æ”¶\nåœ¨autodiscover åº•ä¸‹ä½¿ç”¨ exclude_lines\n\nautodiscover:\nproviders:\n- type: kubernetes\nnode: ${NODE_NAME}\nhints:\nenabled: true\ndefault_config:\ntype: container\npaths:\n- /var/log/containers/*${data.kubernetes.container.id}.log\nexclude_lines:\n- &quot;.*(NAT rule custom-iptables|unknown operand).*&quot; # æ’é™¤ k8s-custom-iptables\n\nref. Log input\n\næ’é™¤ç‰¹å®šnamespace\nåœ¨ processors åº•ä¸‹åŠ  drop_eventï¼Œé€™é‚Šæœ‰ç”¨åˆ°conditionçš„æ¢ä»¶ï¼Œå»ºè­°çœ‹ä¸€ä¸‹æ–‡ä»¶æ¯”è¼ƒæ¸…æ¥šã€‚\n\nprocessors:\n- add_cloud_metadata: {}\n- drop_event.when:\nor:\n- equals:\nkubernetes.namespace: &quot;kube-system&quot;\n- equals:\nkubernetes.namespace: &quot;elastic-system&quot;\n\nref.\n\nDrop events\nhow-we-can-filter-namespace-in-filebeat-kubernetes\nconditions\n\nç§»é™¤ç‰¹å®šæ¬„ä½\næœ‰äº›æ¬„ä½å¾—åˆ°çš„å€¼æ˜¯é‡è¤‡çš„ï¼Œ\næ‰€ä»¥é€™äº›ä¹Ÿéƒ½å¯ä»¥ç æ‰ã€‚\nprocessors åº•ä¸‹åŠ  drop_fields\nprocessors:\n- drop_fields:\nfields:\n- 'kubernetes.node'\n- 'kubernetes.namespace_uid'\n- 'agent.hostname'\n- 'cloud.account'\n- 'cloud.provider'\n- 'cloud.instance.name'\n- 'container.id'\n\nref. Drop fields from events\n\nè©³ç´°åƒæ•¸èªªæ˜\ntype: log #inputé¡å‹ç‚ºlog\nenable: true #è¡¨ç¤ºæ˜¯è©²logé¡å‹é…ç½®ç”Ÿæ•ˆ\npathsï¼š #æŒ‡å®šè¦ç›£æ§çš„æ—¥èªŒï¼Œç›®å‰æŒ‰ç…§Goèªè¨€çš„globå‡½æ•¸è™•ç†ã€‚æ²’æœ‰å°é…ç½®ç›®éŒ„åšéæ­¸è™•ç†ï¼Œæ¯”å¦‚é…ç½®çš„å¦‚æœæ˜¯ï¼š\n- /var/log/* /*.log #å‰‡åªæœƒå»/var/logç›®éŒ„çš„æ‰€æœ‰å­ç›®éŒ„ä¸­å°‹æ‰¾ä»¥&quot;.log&quot;çµå°¾çš„æ–‡ä»¶ï¼Œè€Œä¸æœƒå°‹æ‰¾/var/logç›®éŒ„ä¸‹ä»¥&quot;.log&quot;çµå°¾çš„æ–‡ä»¶ã€‚\nrecursive_glob.enabled: #å•Ÿç”¨å…¨å±€éæ­¸æ¨¡å¼ï¼Œä¾‹å¦‚/foo/**åŒ…æ‹¬/foo, /foo/*, /foo/*/*\nencodingï¼š#æŒ‡å®šè¢«ç›£æ§çš„æ–‡ä»¶çš„ç·¨ç¢¼é¡å‹ï¼Œä½¿ç”¨plainå’Œutf-8éƒ½æ˜¯å¯ä»¥è™•ç†ä¸­æ–‡æ—¥èªŒçš„\nexclude_lines: ['^DBG'] #ä¸åŒ…å«åŒ¹é…æ­£å‰‡çš„è¡Œ\ninclude_lines: ['^ERR', '^WARN'] #åŒ…å«åŒ¹é…æ­£å‰‡çš„è¡Œ\nharvester_buffer_size: 16384 #æ¯å€‹harvesteråœ¨ç²å–æ–‡ä»¶æ™‚ä½¿ç”¨çš„ç·©æ²–å€çš„å­—ç¯€å¤§å°\nmax_bytes: 10485760 #å–®å€‹æ—¥èªŒæ¶ˆæ¯å¯ä»¥æ“æœ‰çš„æœ€å¤§å­—ç¯€æ•¸ã€‚max_bytesä¹‹å¾Œçš„æ‰€æœ‰å­—ç¯€éƒ½è¢«ä¸Ÿæ£„è€Œä¸ç™¼é€ã€‚é»˜èªå€¼ç‚º10MB (10485760)\nexclude_files: ['\\.gz$'] #ç”¨æ–¼åŒ¹é…å¸Œæœ›Filebeatå¿½ç•¥çš„æ–‡ä»¶çš„æ­£å‰‡è¡¨é”å¼åˆ—è¡¨\ningore_older: 0 #é»˜èªç‚º0ï¼Œè¡¨ç¤ºç¦ç”¨ï¼Œå¯ä»¥é…ç½®2hï¼Œ2mç­‰ï¼Œæ³¨æ„ignore_olderå¿…é ˆå¤§æ–¼close_inactiveçš„å€¼.è¡¨ç¤ºå¿½ç•¥è¶…éè¨­ç½®å€¼æœªæ›´æ–°çš„\næ–‡ä»¶æˆ–è€…æ–‡ä»¶å¾ä¾†æ²’æœ‰è¢«harvesteræ”¶é›†\nclose_* #close_ *é…ç½®é¸é …ç”¨æ–¼åœ¨ç‰¹å®šæ¨™å‡†æˆ–æ™‚é–“ä¹‹å¾Œé—œé–‰harvesterã€‚ é—œé–‰harvesteræ„å‘³è‘—é—œé–‰æ–‡ä»¶è™•ç†ç¨‹åºã€‚ å¦‚æœåœ¨harvesteré—œé–‰\nå¾Œæ–‡ä»¶è¢«æ›´æ–°ï¼Œå‰‡åœ¨scan_frequencyéå¾Œï¼Œæ–‡ä»¶å°‡è¢«é‡æ–°æ‹¾å–ã€‚ ä½†æ˜¯ï¼Œå¦‚æœåœ¨harvesteré—œé–‰æ™‚ç§»å‹•æˆ–åˆªé™¤æ–‡ä»¶ï¼ŒFilebeatå°‡ç„¡æ³•å†æ¬¡æ¥æ”¶æ–‡ä»¶\nï¼Œä¸¦ä¸”harvesteræœªè®€å–çš„ä»»ä½•æ•¸æ“šéƒ½å°‡ä¸Ÿå¤±ã€‚\nclose_inactive #å•Ÿå‹•é¸é …æ™‚ï¼Œå¦‚æœåœ¨åˆ¶å®šæ™‚é–“æ²’æœ‰è¢«è®€å–ï¼Œå°‡é—œé–‰æ–‡ä»¶å¥æŸ„\nè®€å–çš„æœ€å¾Œä¸€æ¢æ—¥èªŒå®šç¾©ç‚ºä¸‹ä¸€æ¬¡è®€å–çš„èµ·å§‹é»ï¼Œè€Œä¸æ˜¯åŸºæ–¼æ–‡ä»¶çš„ä¿®æ”¹æ™‚é–“\nå¦‚æœé—œé–‰çš„æ–‡ä»¶ç™¼ç”Ÿè®ŠåŒ–ï¼Œä¸€å€‹æ–°çš„harversterå°‡åœ¨scan_frequencyé‹è¡Œå¾Œè¢«å•Ÿå‹•\nå»ºè­°è‡³å°‘è¨­ç½®ä¸€å€‹å¤§æ–¼è®€å–æ—¥èªŒé »ç‡çš„å€¼ï¼Œé…ç½®å¤šå€‹prospectorä¾†å¯¦ç¾é‡å°ä¸åŒæ›´æ–°é€Ÿåº¦çš„æ—¥èªŒæ–‡ä»¶\nä½¿ç”¨å…§éƒ¨æ™‚é–“æˆ³æ©Ÿåˆ¶ï¼Œä¾†åæ˜ è¨˜éŒ„æ—¥èªŒçš„è®€å–ï¼Œæ¯æ¬¡è®€å–åˆ°æœ€å¾Œä¸€è¡Œæ—¥èªŒæ™‚é–‹å§‹å€’è¨ˆæ™‚ä½¿ç”¨2h 5m ä¾†è¡¨ç¤º\nclose_rename #ç•¶é¸é …å•Ÿå‹•ï¼Œå¦‚æœæ–‡ä»¶è¢«é‡å‘½åå’Œç§»å‹•ï¼Œfilebeaté—œé–‰æ–‡ä»¶çš„è™•ç†è®€å–\nclose_removed #ç•¶é¸é …å•Ÿå‹•ï¼Œæ–‡ä»¶è¢«åˆªé™¤æ™‚ï¼Œfilebeaté—œé–‰æ–‡ä»¶çš„è™•ç†è®€å–é€™å€‹é¸é …å•Ÿå‹•å¾Œï¼Œå¿…é ˆå•Ÿå‹•clean_removed\nclose_eof #é©åˆåªå¯«ä¸€æ¬¡æ—¥èªŒçš„æ–‡ä»¶ï¼Œç„¶å¾Œfilebeaté—œé–‰æ–‡ä»¶çš„è™•ç†è®€å–\nclose_timeout #ç•¶é¸é …å•Ÿå‹•æ™‚ï¼Œfilebeatæœƒçµ¦æ¯å€‹harvesterè¨­ç½®é å®šç¾©æ™‚é–“ï¼Œä¸ç®¡é€™å€‹æ–‡ä»¶æ˜¯å¦è¢«è®€å–ï¼Œé”åˆ°è¨­å®šæ™‚é–“å¾Œï¼Œå°‡è¢«é—œé–‰\nclose_timeout ä¸èƒ½ç­‰æ–¼ignore_older,æœƒå°è‡´æ–‡ä»¶æ›´æ–°æ™‚ï¼Œä¸æœƒè¢«è®€å–å¦‚æœoutputä¸€ç›´æ²’æœ‰è¼¸å‡ºæ—¥èªŒäº‹ä»¶ï¼Œé€™å€‹timeoutæ˜¯ä¸æœƒè¢«å•Ÿå‹•çš„ï¼Œ\nè‡³å°‘è¦è¦æœ‰ä¸€å€‹äº‹ä»¶ç™¼é€ï¼Œç„¶å¾Œhaverterå°‡è¢«é—œé–‰\nè¨­ç½®0 è¡¨ç¤ºä¸å•Ÿå‹•\nclean_inactived #å¾æ³¨å†Šè¡¨æ–‡ä»¶ä¸­åˆªé™¤å…ˆå‰æ”¶ç²çš„æ–‡ä»¶çš„ç‹€æ…‹\nè¨­ç½®å¿…é ˆå¤§æ–¼ignore_older+scan_frequencyï¼Œä»¥ç¢ºä¿åœ¨æ–‡ä»¶ä»åœ¨æ”¶é›†æ™‚æ²’æœ‰åˆªé™¤ä»»ä½•ç‹€æ…‹\né…ç½®é¸é …æœ‰åŠ©æ–¼æ¸›å°æ³¨å†Šè¡¨æ–‡ä»¶çš„å¤§å°ï¼Œç‰¹åˆ¥æ˜¯å¦‚æœæ¯å¤©éƒ½ç”Ÿæˆå¤§é‡çš„æ–°æ–‡ä»¶\næ­¤é…ç½®é¸é …ä¹Ÿå¯ç”¨æ–¼é˜²æ­¢åœ¨Linuxä¸Šé‡ç”¨inodeçš„Filebeatå•é¡Œ\nclean_removed #å•Ÿå‹•é¸é …å¾Œï¼Œå¦‚æœæ–‡ä»¶åœ¨ç£ç›¤ä¸Šæ‰¾ä¸åˆ°ï¼Œå°‡å¾æ³¨å†Šè¡¨ä¸­æ¸…é™¤filebeat\nå¦‚æœé—œé–‰close removed å¿…é ˆé—œé–‰clean removed\nscan_frequency #prospectoræª¢æŸ¥æŒ‡å®šç”¨æ–¼æ”¶ç²çš„è·¯å¾‘ä¸­çš„æ–°æ–‡ä»¶çš„é »ç‡,é»˜èª10s\ntail_filesï¼š#å¦‚æœè¨­ç½®ç‚ºtrueï¼ŒFilebeatå¾æ–‡ä»¶å°¾é–‹å§‹ç›£æ§æ–‡ä»¶æ–°å¢å…§å®¹ï¼ŒæŠŠæ–°å¢çš„æ¯ä¸€è¡Œæ–‡ä»¶ä½œç‚ºä¸€å€‹äº‹ä»¶ä¾æ¬¡ç™¼é€ï¼Œ\nè€Œä¸æ˜¯å¾æ–‡ä»¶é–‹å§‹è™•é‡æ–°ç™¼é€æ‰€æœ‰å…§å®¹ã€‚\nsymlinksï¼š#ç¬¦è™Ÿéˆæ¥é¸é …å…è¨±Filebeaté™¤å¸¸è¦æ–‡ä»¶å¤–,å¯ä»¥æ”¶é›†ç¬¦è™Ÿéˆæ¥ã€‚æ”¶é›†ç¬¦è™Ÿéˆæ¥æ™‚ï¼Œå³ä½¿å ±å‘Šäº†ç¬¦è™Ÿéˆæ¥çš„è·¯å¾‘ï¼Œ\nFilebeatä¹Ÿæœƒæ‰“é–‹ä¸¦è®€å–åŸå§‹æ–‡ä»¶ã€‚\nbackoffï¼š #backoffé¸é …æŒ‡å®šFilebeatå¦‚ä½•ç©æ¥µåœ°æŠ“å–æ–°æ–‡ä»¶é€²è¡Œæ›´æ–°ã€‚é»˜èª1sï¼Œbackoffé¸é …å®šç¾©Filebeatåœ¨é”åˆ°EOFä¹‹å¾Œ\nå†æ¬¡æª¢æŸ¥æ–‡ä»¶ä¹‹é–“ç­‰å¾…çš„æ™‚é–“ã€‚\nmax_backoffï¼š #åœ¨é”åˆ°EOFä¹‹å¾Œå†æ¬¡æª¢æŸ¥æ–‡ä»¶ä¹‹å‰Filebeatç­‰å¾…çš„æœ€é•·æ™‚é–“\nbackoff_factorï¼š #æŒ‡å®šbackoffå˜—è©¦ç­‰å¾…æ™‚é–“å¹¾æ¬¡ï¼Œé»˜èªæ˜¯2\nharvester_limitï¼š#harvester_limité¸é …é™åˆ¶ä¸€å€‹prospectorä¸¦è¡Œå•Ÿå‹•çš„harvesteræ•¸é‡ï¼Œç›´æ¥å½±éŸ¿æ–‡ä»¶æ‰“é–‹æ•¸\n\ntags #åˆ—è¡¨ä¸­æ·»åŠ æ¨™ç°½ï¼Œç”¨ééæ¿¾ï¼Œä¾‹å¦‚ï¼štags: [&quot;json&quot;]\nfields #å¯é¸å­—æ®µï¼Œé¸æ“‡é¡å¤–çš„å­—æ®µé€²è¡Œè¼¸å‡ºå¯ä»¥æ˜¯æ¨™é‡å€¼ï¼Œå…ƒçµ„ï¼Œå­—å…¸ç­‰åµŒå¥—é¡å‹\né»˜èªåœ¨sub-dictionaryä½ç½®\nfilebeat.inputs:\nfields:\napp_id: query_engine_12\nfields_under_root #å¦‚æœå€¼ç‚ºtureï¼Œé‚£éº¼fieldså­˜å„²åœ¨è¼¸å‡ºæ–‡æª”çš„é ‚ç´šä½ç½®\n\nmultiline.pattern #å¿…é ˆåŒ¹é…çš„regexpæ¨¡å¼\nmultiline.negate #å®šç¾©ä¸Šé¢çš„æ¨¡å¼åŒ¹é…æ¢ä»¶çš„å‹•ä½œæ˜¯ å¦å®šçš„ï¼Œé»˜èªæ˜¯false\nå‡å¦‚æ¨¡å¼åŒ¹é…æ¢ä»¶'^b'ï¼Œé»˜èªæ˜¯falseæ¨¡å¼ï¼Œè¡¨ç¤ºè¬›æŒ‰ç…§æ¨¡å¼åŒ¹é…é€²è¡ŒåŒ¹é… å°‡ä¸æ˜¯ä»¥bé–‹é ­çš„æ—¥èªŒè¡Œé€²è¡Œåˆä¸¦\nå¦‚æœæ˜¯trueï¼Œè¡¨ç¤ºå°‡ä¸ä»¥bé–‹é ­çš„æ—¥èªŒè¡Œé€²è¡Œåˆä¸¦\nmultiline.match # æŒ‡å®šFilebeatå¦‚ä½•å°‡åŒ¹é…è¡Œçµ„åˆæˆäº‹ä»¶,åœ¨ä¹‹å‰æˆ–è€…ä¹‹å¾Œï¼Œå–æ±ºæ–¼ä¸Šé¢æ‰€æŒ‡å®šçš„negate\nmultiline.max_lines #å¯ä»¥çµ„åˆæˆä¸€å€‹äº‹ä»¶çš„æœ€å¤§è¡Œæ•¸ï¼Œè¶…éå°‡ä¸Ÿæ£„ï¼Œé»˜èª500\nmultiline.timeout #å®šç¾©è¶…æ™‚æ™‚é–“ï¼Œå¦‚æœé–‹å§‹ä¸€å€‹æ–°çš„äº‹ä»¶åœ¨è¶…æ™‚æ™‚é–“å…§æ²’æœ‰ç™¼ç¾åŒ¹é…ï¼Œä¹Ÿå°‡ç™¼é€æ—¥èªŒï¼Œé»˜èªæ˜¯5smax_procs #è¨­ç½®å¯ä»¥åŒæ™‚åŸ·è¡Œçš„æœ€å¤§CPUæ•¸ã€‚é»˜èªå€¼ç‚ºç³»çµ±ä¸­å¯ç”¨çš„é‚è¼¯CPUçš„æ•¸é‡ã€‚name #ç‚ºè©²filebeatæŒ‡å®šåå­—ï¼Œé»˜èªç‚ºä¸»æ©Ÿçš„hostname\n\nref.\n\nä¸€ç¯‡æ–‡ç« ææ‡‚filebeatï¼ˆELKï¼‰\n\nfilebeat logå¯«å…¥åˆ°æª”æ¡ˆ\nfilebeatåœ¨é‹ä½œæ™‚ï¼Œæœƒç”¢ç”Ÿä¸€å †logï¼Œé€™äº›æˆ‘åŸæœ¬éƒ½ä¸æƒ³è®“ä»–è¼¸å‡ºï¼Œç›´æ¥å¯«åœ¨è‡ªå·±çš„æª”æ¡ˆå°±å¥½ã€‚\n\nä½†æ²’æ¸¬è©¦æˆåŠŸï¼Œæœ€å¾Œåªå¥½æ¡ç”¨æ²»æ¨™ä¸æ²»æœ¬çš„æ–¹å¼ï¼Œ\nåœ¨è©²namespaceåº•ä¸‹çš„logé€šé€šä¸é€²ESã€‚\nç•™ä¸€ä¸‹æŸ¥åˆ°çš„è³‡æ–™ã€‚\nlogging:\nto_files: true\nmetrics.enabled: false\nfiles:\npath: '/usr/share/filebeat/logs'\nname: 'filebeat'\nrotateeverybytes: 10485760 # = 10MB\nkeepfiles: 7\npermission: '0640'\n\nref.\n\nConfigure logging\n\nå®Œæ•´yamlï¼Œä½¿ç”¨operator\napiVersion: beat.k8s.elastic.co/v1beta1\nkind: Beat\nmetadata:\nname: yabo\nnamespace: elastic-system\nspec:\ntype: filebeat\nversion: 7.15.0\nelasticsearchRef:\nname: yabo\nkibanaRef:\nname: yabo\nconfig:\nfilebeat:\nautodiscover:\nproviders:\n- type: kubernetes\nnode: ${NODE_NAME}\nhints:\nenabled: true\ndefault_config:\ntype: container\npaths:\n- /var/log/containers/*${data.kubernetes.container.id}.log\nexclude_lines:\n- &quot;.*(NAT rule custom-iptables|unknown operand).*&quot; # æ’é™¤ k8s-custom-iptables\n- &quot;.*(YABO_WS.Services.PromoWebSocketService|YABO_WS.BLL.ActivityEventLogic).*&quot;\nprocessors:\n- add_cloud_metadata: {}\n# - add_host_metadata: {}\n- drop_event.when:\nor:\n- equals:\nkubernetes.namespace: &quot;kube-system&quot;\n- equals:\nkubernetes.namespace: &quot;elastic-system&quot;\n- drop_fields:\nfields:\n- 'kubernetes.node'\n- 'kubernetes.namespace_uid'\n- 'agent.hostname'\n- 'cloud.account'\n- 'cloud.provider'\n- 'cloud.instance.name'\n- 'container.id'\n- decode_json_fields:\nfields: [&quot;message&quot;]\ntarget: &quot;&quot;\noverwrite_keys: true\n# æ¸¬è©¦æ²’ç”¨ï¼Œç„¡æ³•å¯«åˆ°\n# logging:\n# to_files: true\n# metrics.enabled: false\n# files:\n# path: '/usr/share/filebeat/logs'\n# name: 'filebeat'\n# rotateeverybytes: 10485760 # = 10MB\n# keepfiles: 7\n# permission: '0644'\ndaemonSet:\npodTemplate:\nspec:\nserviceAccountName: filebeat\nautomountServiceAccountToken: true\nterminationGracePeriodSeconds: 30\ndnsPolicy: ClusterFirstWithHostNet\nhostNetwork: true # Allows to provide richer host metadata\ncontainers:\n- name: filebeat\nsecurityContext:\nrunAsUser: 0\n# If using Red Hat OpenShift uncomment this:\n#privileged: true\nvolumeMounts:\n- name: varlogcontainers\nmountPath: /var/log/containers\n- name: varlogpods\nmountPath: /var/log/pods\n- name: varlibdockercontainers\nmountPath: /var/lib/docker/containers\nenv:\n- name: NODE_NAME\nvalueFrom:\nfieldRef:\nfieldPath: spec.nodeName\nvolumes:\n- name: varlogcontainers\nhostPath:\npath: /var/log/containers\n- name: varlogpods\nhostPath:\npath: /var/log/pods\n- name: varlibdockercontainers\nhostPath:\npath: /var/lib/docker/containers\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\nname: filebeat\nrules:\n- apiGroups: [&quot;&quot;] # &quot;&quot; indicates the core API group\nresources:\n- namespaces\n- pods\n- nodes\nverbs:\n- get\n- watch\n- list\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\nname: filebeat\nnamespace: elastic-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\nname: filebeat\nsubjects:\n- kind: ServiceAccount\nname: filebeat\nnamespace: elastic-system\nroleRef:\nkind: ClusterRole\nname: filebeat\napiGroup: rbac.authorization.k8s.io\n\n...\n\nref.\n\nECKéƒ¨ç½²\nFileBeat\nElastic Beats on Google Kubernetes Engine (GKE)\nfilebeat-kubernetes.yaml\nHow to Setup an ELK Stack and Filebeat on Kubernetes\n\n2024/05/28è£œå……\nä½¿ç”¨autodiscoverï¼Œæ‹†åˆ†å…©å€‹log indices\nä»¥ä¸‹ç¨‹å¼ç¢¼ç‚ºã€ç‰‡æ®µã€ã€‚\napiVersion: beat.k8s.elastic.co/v1beta1\nkind: Beat\nmetadata:\nname: prod\nnamespace: elastic-system\nspec:\ntype: filebeat\nversion: 8.13.2\nelasticsearchRef:\nname: prod\nnamespace: elastic-system\nkibanaRef:\nname: prod\nnamespace: elastic-system\nconfig:\nfilebeat:\nautodiscover:\nproviders:\n- type: kubernetes\nnode: ${NODE_NAME}\ntemplates:\n- condition:\nequals:\nkubernetes.labels.app: &quot;video&quot;\nconfig:\n- type: container\npaths:\n- /var/log/containers/*${data.kubernetes.container.id}.log\nprocessors:\n- add_kubernetes_metadata:\nhost: ${NODE_NAME}\n- condition:\nequals:\nkubernetes.labels.app: &quot;auth&quot;\nconfig:\n- type: container\npaths:\n- /var/log/containers/*${data.kubernetes.container.id}.log\nprocessors:\n- add_kubernetes_metadata:\nhost: ${NODE_NAME}\nprocessors:\n- add_cloud_metadata: {}\noutput.elasticsearch:\nusername: &quot;elastic&quot;\npassword: &quot;password&quot;\nindex: &quot;logs-%{[kubernetes.labels.app]}-%{+yyyy.MM.dd}&quot;\nindices:\n- index: &quot;videoworker-%{+yyyy.MM.dd}&quot;\nwhen.equals:\nkubernetes.labels.app: &quot;videoworker&quot;\n- index: &quot;authcontrol-%{+yyyy.MM.dd}&quot;\nwhen.equals:\nkubernetes.labels.app: &quot;authcontrol&quot;\nsetup.template.enabled: true\nsetup.template.name: &quot;filebeat-8.13.2&quot;\nsetup.template.pattern: &quot;filebeat-8.13.2&quot;\n\nèªªæ˜ï¼š\n\nconfig.filebeat.autodiscover.providers ï¼šåº•ä¸‹ä½¿ç”¨templateï¼Œä½œç‚ºæ‹†åˆ†çš„ç¯„æœ¬ï¼ŒåŸå…ˆæ˜¯ä½¿ç”¨hintsæ©Ÿåˆ¶ï¼Œä½¿ç”¨é—œéµlabelä½œç‚ºæ“·å–çš„æ–¹å¼ã€‚\n\noutput.elasticsearch: è¼¸å‡ºåˆ°elasticsearch ï¼Œé è¨­çš„indexä½¿ç”¨ logsä½œç‚ºdatastreamï¼Œåº•ä¸‹çš„indiceså‰‡æ˜¯å†ç´°åˆ†è¦å‰‡ï¼Œ å¦‚æœç¬¦åˆè¦å‰‡ï¼Œå‰‡ä½¿ç”¨å…¶ä»–çš„datastreamåç¨±ã€‚\nå®˜æ–¹æ–‡ä»¶ï¼Œæ˜¯ä¸ç”¨å¯«output.elasticsearchï¼Œä½†æˆ‘æä¸å‡ºä¾†ã€‚\næ”¹å¤©åœ¨ç¹¼çºŒè¿½äº†ã€‚\n\nref.\n\nHints based autodiscover\nFilebeat example",
		"tags": ["2024/05/28è£œå……", "inputé¡å‹ç‚ºlog", "è¡¨ç¤ºæ˜¯è©²logé¡å‹é…ç½®ç”Ÿæ•ˆ", "æŒ‡å®šè¦ç›£æ§çš„æ—¥èªŒï¼Œç›®å‰æŒ‰ç…§Goèªè¨€çš„globå‡½æ•¸è™•ç†ã€‚æ²’æœ‰å°é…ç½®ç›®éŒ„åšéæ­¸è™•ç†ï¼Œæ¯”å¦‚é…ç½®çš„å¦‚æœæ˜¯ï¼š", "å‰‡åªæœƒå»/var/logç›®éŒ„çš„æ‰€æœ‰å­ç›®éŒ„ä¸­å°‹æ‰¾ä»¥", "å•Ÿç”¨å…¨å±€éæ­¸æ¨¡å¼ï¼Œä¾‹å¦‚/foo/", "ä¸åŒ…å«åŒ¹é…æ­£å‰‡çš„è¡Œ", "åŒ…å«åŒ¹é…æ­£å‰‡çš„è¡Œ", "æ¯å€‹harvesteråœ¨ç²å–æ–‡ä»¶æ™‚ä½¿ç”¨çš„ç·©æ²–å€çš„å­—ç¯€å¤§å°", "å–®å€‹æ—¥èªŒæ¶ˆæ¯å¯ä»¥æ“æœ‰çš„æœ€å¤§å­—ç¯€æ•¸ã€‚max_bytesä¹‹å¾Œçš„æ‰€æœ‰å­—ç¯€éƒ½è¢«ä¸Ÿæ£„è€Œä¸ç™¼é€ã€‚é»˜èªå€¼ç‚º10MB", "ç”¨æ–¼åŒ¹é…å¸Œæœ›Filebeatå¿½ç•¥çš„æ–‡ä»¶çš„æ­£å‰‡è¡¨é”å¼åˆ—è¡¨", "é»˜èªç‚º0ï¼Œè¡¨ç¤ºç¦ç”¨ï¼Œå¯ä»¥é…ç½®2hï¼Œ2mç­‰ï¼Œæ³¨æ„ignore_olderå¿…é ˆå¤§æ–¼close_inactiveçš„å€¼", "close_", "å•Ÿå‹•é¸é …æ™‚ï¼Œå¦‚æœåœ¨åˆ¶å®šæ™‚é–“æ²’æœ‰è¢«è®€å–ï¼Œå°‡é—œé–‰æ–‡ä»¶å¥æŸ„", "ç•¶é¸é …å•Ÿå‹•ï¼Œå¦‚æœæ–‡ä»¶è¢«é‡å‘½åå’Œç§»å‹•ï¼Œfilebeaté—œé–‰æ–‡ä»¶çš„è™•ç†è®€å–", "ç•¶é¸é …å•Ÿå‹•ï¼Œæ–‡ä»¶è¢«åˆªé™¤æ™‚ï¼Œfilebeaté—œé–‰æ–‡ä»¶çš„è™•ç†è®€å–é€™å€‹é¸é …å•Ÿå‹•å¾Œï¼Œå¿…é ˆå•Ÿå‹•clean_removed", "é©åˆåªå¯«ä¸€æ¬¡æ—¥èªŒçš„æ–‡ä»¶ï¼Œç„¶å¾Œfilebeaté—œé–‰æ–‡ä»¶çš„è™•ç†è®€å–", "ç•¶é¸é …å•Ÿå‹•æ™‚ï¼Œfilebeatæœƒçµ¦æ¯å€‹harvesterè¨­ç½®é å®šç¾©æ™‚é–“ï¼Œä¸ç®¡é€™å€‹æ–‡ä»¶æ˜¯å¦è¢«è®€å–ï¼Œé”åˆ°è¨­å®šæ™‚é–“å¾Œï¼Œå°‡è¢«é—œé–‰", "å¾æ³¨å†Šè¡¨æ–‡ä»¶ä¸­åˆªé™¤å…ˆå‰æ”¶ç²çš„æ–‡ä»¶çš„ç‹€æ…‹", "å•Ÿå‹•é¸é …å¾Œï¼Œå¦‚æœæ–‡ä»¶åœ¨ç£ç›¤ä¸Šæ‰¾ä¸åˆ°ï¼Œå°‡å¾æ³¨å†Šè¡¨ä¸­æ¸…é™¤filebeat", "prospectoræª¢æŸ¥æŒ‡å®šç”¨æ–¼æ”¶ç²çš„è·¯å¾‘ä¸­çš„æ–°æ–‡ä»¶çš„é »ç‡", "backoffé¸é …æŒ‡å®šFilebeatå¦‚ä½•ç©æ¥µåœ°æŠ“å–æ–°æ–‡ä»¶é€²è¡Œæ›´æ–°ã€‚é»˜èª1sï¼Œbackoffé¸é …å®šç¾©Filebeatåœ¨é”åˆ°EOFä¹‹å¾Œ", "åœ¨é”åˆ°EOFä¹‹å¾Œå†æ¬¡æª¢æŸ¥æ–‡ä»¶ä¹‹å‰Filebeatç­‰å¾…çš„æœ€é•·æ™‚é–“", "æŒ‡å®šbackoffå˜—è©¦ç­‰å¾…æ™‚é–“å¹¾æ¬¡ï¼Œé»˜èªæ˜¯2", "åˆ—è¡¨ä¸­æ·»åŠ æ¨™ç°½ï¼Œç”¨ééæ¿¾ï¼Œä¾‹å¦‚ï¼štags", "å¯é¸å­—æ®µï¼Œé¸æ“‡é¡å¤–çš„å­—æ®µé€²è¡Œè¼¸å‡ºå¯ä»¥æ˜¯æ¨™é‡å€¼ï¼Œå…ƒçµ„ï¼Œå­—å…¸ç­‰åµŒå¥—é¡å‹", "å¦‚æœå€¼ç‚ºtureï¼Œé‚£éº¼fieldså­˜å„²åœ¨è¼¸å‡ºæ–‡æª”çš„é ‚ç´šä½ç½®", "å¿…é ˆåŒ¹é…çš„regexpæ¨¡å¼", "å®šç¾©ä¸Šé¢çš„æ¨¡å¼åŒ¹é…æ¢ä»¶çš„å‹•ä½œæ˜¯", "å¯ä»¥çµ„åˆæˆä¸€å€‹äº‹ä»¶çš„æœ€å¤§è¡Œæ•¸ï¼Œè¶…éå°‡ä¸Ÿæ£„ï¼Œé»˜èª500", "å®šç¾©è¶…æ™‚æ™‚é–“ï¼Œå¦‚æœé–‹å§‹ä¸€å€‹æ–°çš„äº‹ä»¶åœ¨è¶…æ™‚æ™‚é–“å…§æ²’æœ‰ç™¼ç¾åŒ¹é…ï¼Œä¹Ÿå°‡ç™¼é€æ—¥èªŒï¼Œé»˜èªæ˜¯5smax_procs", "è¨­ç½®å¯ä»¥åŒæ™‚åŸ·è¡Œçš„æœ€å¤§CPUæ•¸ã€‚é»˜èªå€¼ç‚ºç³»çµ±ä¸­å¯ç”¨çš„é‚è¼¯CPUçš„æ•¸é‡ã€‚name", "ç‚ºè©²filebeatæŒ‡å®šåå­—ï¼Œé»˜èªç‚ºä¸»æ©Ÿçš„hostname", "privileged", "note","ğŸ—’"]
},

{
		"title": "é™¤éŒ¯ç”¨çš„ECK API",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/58. é™¤éŒ¯ç”¨çš„ECK API/",
		"content": "å‰è¨€\nå¾ˆä¹…ä¹‹å‰è¦å¯«ä¸€ç›´æ²’å¯«ï¼Œ\næœ€è¿‘ç¢°åˆ°å•é¡Œï¼Œä¾†é‚„äº†ã€‚\næ­£æ–‡\nPrimary Shard (ææ˜‡ç³»çµ±å„²å­˜å®¹é‡)\n\nshard æ˜¯ Elasticsearch åˆ†æ•£å¼å„²å­˜çš„åŸºç¤ï¼ŒåŒ…å« primary shard &amp; replica shard\n\næ¯ä¸€å€‹ shard å°±æ˜¯ä¸€å€‹ Lucene instance\n\nprimary shard åŠŸèƒ½æ˜¯å°‡ä¸€ä»½è¢«ç´¢å¼•å¾Œçš„è³‡æ–™ï¼Œåˆ†æ•£åˆ°å¤šå€‹ data node ä¸Šå­˜æ”¾ï¼Œå¯¦ç¾å„²å­˜æ–¹é¢çš„æ°´å¹³æ“´å±•\n\nprimary shard çš„æ•¸é‡åœ¨å»ºç«‹ index æ™‚å°±æœƒæŒ‡å®šï¼Œå¾ŒçºŒæ˜¯ç„¡æ³•ä¿®æ”¹çš„ï¼Œè‹¥è¦ä¿®æ”¹å°±å¿…é ˆè¦é€²è¡Œ reindex\n\nReplica Shard (æé«˜è³‡æ–™å¯ç”¨æ€§)\n\nreplica shard ç”¨ä¾†æä¾›è³‡æ–™é«˜å¯ç”¨æ€§ï¼Œç•¶ primary shard éºå¤±æ™‚ï¼Œreplica shard å°±å¯ä»¥è¢« promote æˆ primary shard ä¾†ä¿æŒè³‡æ–™å®Œæ•´æ€§\n\nreplica shard æ•¸é‡å¯ä»¥å‹•æ…‹èª¿æ•´ï¼Œè®“æ¯å€‹ data node ä¸Šéƒ½æœ‰å®Œæ•´çš„è³‡æ–™\n\nreplica shard å¯ä»¥ä¸€å®šç¨‹åº¦çš„æé«˜è®€å–(æŸ¥è©¢)çš„æ•ˆèƒ½\n\nè‹¥ä¸è¨­å®š replica shardï¼Œä¸€æ—¦æœ‰ data node æ•…éšœå°è‡´ primary shard éºå¤±ï¼Œè³‡æ–™å¯èƒ½å°±ç„¡æ³•æ¢å¾©äº†\n\nES 7.0 é–‹å§‹ï¼Œprimary shard é è¨­ç‚ºÂ 1ï¼Œreplica shard é è¨­ç‚ºÂ 0\n\nref. [Elasticsearch] åˆ†æ•£å¼ç‰¹æ€§ &amp; åˆ†æ•£å¼æœå°‹çš„æ©Ÿåˆ¶\nShard çš„è¦åŠƒ &amp; è¨­å®š\n\nprimary shard æ•¸é‡è¨­å®šå¤ªå°æœƒé‡åˆ°ä»¥ä¸‹å•é¡Œï¼š\n\nè‹¥ index è³‡æ–™å¢åŠ å¾ˆå¿«æ™‚ï¼Œcluster ç„¡æ³•é€šéå¢åŠ  node æ•¸é‡å° index é€²è¡Œè³‡æ–™æ“´å±•\nå–®ä¸€ shard è³‡æ–™å¤ªå¤§ï¼Œå°è‡´è³‡æ–™é‡æ–°åˆ†é…è€—æ™‚\n\nprimary shard æ•¸é‡è¨­å®šå¤ªå¤§æœƒé‡åˆ°ä»¥ä¸‹å•é¡Œï¼š\n\nå°è‡´æ¯å€‹ shard å®¹é‡å¾ˆå°ï¼Œè®“ä¸€å€‹ data node ä¸Šæœ‰éå¤š shard è€Œå½±éŸ¿æ•ˆèƒ½\nå½±éŸ¿æœå°‹æ™‚çš„ç›¸é—œæ€§ç®—åˆ†ï¼Œæœƒè®“çµ±è¨ˆçµæœå¤±æº–\n\nreplica shard è‹¥è¨­å®šéå¤šï¼Œæœƒé™ä½ cluster æ•´é«”çš„å¯«å…¥æ•ˆèƒ½\n\n# æŸ¥nodeçš„ç‹€æ…‹\nGET _cluster/health/\n\n# å–å¾—ç›®å‰æ‰€æœ‰çš„shardï¼ŒåŠ ä¸Š?v å¯é¡¯ç¤ºæ¬„ä½åç¨±\nGET _cat/shards?v\n\n# å–å¾—ç›®å‰çš„shardè¨­å®šæ•¸é‡ï¼ˆå¥½å¹¾æ¬¡éƒ½æ˜¯é€™å€‹å€¼æš´äº†ï¼Œå°è‡´logç„¡æ³•å¯«å…¥)\nGET /_cluster/settings\n\n# è¨­å®šnodeçš„shardæœ€å¤§æ•¸é‡\nPUT /_cluster/settings\n{\n&quot;persistent&quot;: {\n&quot;cluster.max_shards_per_node&quot;: 1000\n}\n}\n\nref.\n\ncat shards APIæ¬„ä½ä»‹ç´¹",
		"tags": [ "note","ğŸ—’"]
},

{
		"title": "ECKçš„ kibana è­¦å‘Šï¼Œ server.publicBaseUrl is missing",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/60. ECKçš„ kibana è­¦å‘Šï¼Œ server.publicBaseUrl is missing/",
		"content": "å‰è¨€\næ­£æ–‡\nkibanaæ™‚å¸¸é€™å€‹è­¦å‘Šå‡ºä¾†ï¼Œ\nä½†æˆ‘ä¸€ç›´æ‰¾ä¸åˆ°configè¦åœ¨å“ªè¨­å®šã€‚\n\nä¹‹å¾Œå•äº†å¦å¤–ä¸€çµ„çš„å¤§å¤§ï¼Œä»–ä¹‹å‰ä¹Ÿåœ¨å¼„ECKï¼Œ\nçµ¦äº†æˆ‘é€™æ®µã€‚\nåŠ ä¸€å€‹configåœ¨yamlè£¡é¢\napiVersion: kibana.k8s.elastic.co/v1\nkind: Kibana\nmetadata:\nname: yabo\nnamespace: elastic-system\nspec:\nversion: 7.15.0\ncount: 1\nconfig:\nserver.publicBaseUrl: http://123.232.162/\nelasticsearchRef:\nname: yabo\nhttp:\ntls:\nselfSignedCertificate:\ndisabled: true\nservice:\nspec:\nports:\n- name: http\nport: 5601\ntargetPort: 5601\n\nref.\n\n[Solved] Kibana 7.14.0 error: server.publicBaseUrl is missing and should be configured when running in a production environment.\nConfigure Kibana",
		"tags": [ "note","ğŸ—’"]
},

{
		"title": "kibana æŸ¥è©¢èªæ³•",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/61. kibana æŸ¥è©¢èªæ³•/",
		"content": "å‰è¨€\næ­£æ–‡\nKQLå…¶å¯¦æ²’å¾ˆè¤‡é›œï¼Œ\nå»ºè­°æŠŠä»‹ç´¹Kibana Query Languageçœ‹å®Œå¾ŒåŸºæœ¬ä¸Šå°±æœƒäº†ã€‚\nä¸»è¦å¸¸ç”¨çš„æ˜¯ï¼Œä½¿ç”¨ ç‰¹å®šæ¬„ä½æœå°‹ï¼Œ\n\nè¬ç”¨å­—å…ƒ *\nä¾‹å¦‚ï¼Œ\nä»Šå¤©è¦æœå°‹ä¸€å€‹ pod Name å« grafana\né‚£KQL å¯è¼¸å…¥\n\nkubernetes.pod.name: *grafana*\n\næœå°‹å‡ºä¾†çš„åç¨±ï¼Œåªè¦æ˜¯ ä¸­é–“æœ‰ grafanaçš„é€šé€šæœƒåˆ—å‡ºã€‚\nè¦ºå¾—å‰é¢åç¨±å¤ªé•·çš„è©±ï¼Œè¼¸å…¥pod.nameï¼Œç”¨ä¸‹æ‹‰é¸æ“‡å°±å¥½ã€‚\n\nå¼•è™Ÿä½¿ç”¨&quot; &quot;\nå°‡è£¡é¢çš„å­—è®Šæˆä¸€å€‹è©æœå°‹\n\n\tmessage: &quot;hello world&quot;\n\nä¸ä½¿ç”¨å¼•è™Ÿ\nè£¡é¢çš„å­—éƒ½æœƒåˆ†åˆ¥æœå°‹ï¼Œå·²ä¸‹é¢ä¾†èªªå°±æ˜¯ æœƒæœå°‹ hello è·Ÿ world\n\nkubernetes.pod.name: hello world\n\nand è·Ÿ or æ¢ä»¶\nå¤šæ¢ä»¶æŸ¥è©¢\n\n\tmessage: &quot;hello world&quot; and kubernetes.pod.name:*grafana*\n\nnot å¦å®š\n\n\tnot (kubernetes.pod.name: *grafana*)\n\nå¤§æ–¼ å°æ–¼ ç­‰æ–¼ åˆ¤æ–·å¼ &gt;, &gt;= , &lt;,&lt;=\n\n\t@timestamp &lt; &quot;2021-01-30&quot;\n\né‚„æœ‰ä¸€ç¨®ä¸ä½¿ç”¨KQLçš„æŸ¥è©¢ï¼ŒLucene\né€™ç¨®èªæ³•å¯æ”¯æ´æ­£å‰‡è¡¨é”å¼ï¼Œä½†KQLä¸æ”¯æ´ã€‚\nref.Lucene query syntax\n\nnested fields çœ‹ä¾†æ˜¯å¯ä»¥æŸ¥è©¢æ•´ä¸²çš„json\nä½†æˆ‘æƒ³ä¸åˆ°å¯ä»¥é‹ç”¨åœ¨å“ª\n\næœå°‹x-forward-for ip\næœ‰ä¸€å€‹logå¦‚ä¸‹åœ–ï¼Œé€™å€‹ç‰¹åˆ¥å¥‡æ€ªï¼Œä¸èƒ½åŠ é›™å¼•è™Ÿï¼Œ\nã€.ã€ åœ¨kibanaè£¡é¢ä¼¼ä¹æœ‰ç‰¹æ®Šçš„ç”¨æ³•ï¼Œ\n\nkubernetes.namespace: istio-sigua and message: 103.170.26.90*\n\nå¦‚æœè¦åŠ é›™å¼•è™Ÿçš„è©±ï¼Œå°±å¿…é ˆæœå°‹å®Œæ•´çš„ipã€‚\nkubernetes.namespace: istio-sigua and message: &quot;221.210.89.170,10.120.17.1&quot;\n\nè¿½æ ¹ç©¶åº•ï¼Œé‚„æ˜¯è¦æŠŠmessageå°æ‡‰åˆ°æ¬„ä½...\næ²’æ™‚é–“ç”¨é˜¿QQ...\n\næœå°‹url path\n\nkubernetes.namespace: istio-sigua and message: &quot;img/huawei_ans02.c7bcdbdf.jpg&quot;\nkubernetes.namespace: istio-sigua and message: &quot;img*&quot;\n\nç‰¹æ®Šå­—å…ƒ\nå¦‚æœè¦ç”¨ç‰¹æ®Šå­—å…ƒæŸ¥è©¢çš„è©±ï¼Œè¦åŠ ä¸Š \\ ï¼Œ\nä½†åªé™æ–¼ä¸‹åˆ—é€™äº›é—œéµå­—+ - &amp;&amp; || ! ( ) { } [ ] ^ &quot; ~ * ? : \\ /\n\nref.\n\nKibana Query Language\nKibanaæŸ¥è©¢èªè¨€ï¼ˆKQLï¼‰\nKibanaæŸ¥è©¢èªæ³•è©³è§£\nkibanaæŸ¥è©¢èªæ³•\nå¤§ç¥éƒ½é€™éº¼åšï¼Œè®“ Kibana æœç´¢èªæ³• query string ä¹Ÿèƒ½è¼•æ¾ä¸Šæ‰‹",
		"tags": [ "note","ğŸ—’"]
},

{
		"title": "ECKï¼Œfilebeat LOGè’é›†éºå¤±",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/67. ECKï¼Œfilebeat LOGè’é›†éºå¤±/",
		"content": "å‰è¨€\næ­£æ–‡\næœ€è¿‘åŒäº‹å›å ±èªªï¼Œpod æœ‰äº›logæ²’æœ‰é€²åˆ°ECKè£é¢å»ï¼Œ\nä¸€æŸ¥é‚„çœŸçš„æ˜¯é€™æ¨£ï¼Œ\nä½†QAç’°å¢ƒæ²’å•é¡Œï¼Œ\nååProdå°±ç‚¸äº†ã€‚\næœ¬ä¾†ä¹Ÿæœ‰æƒ³èªªæ˜¯ä¸æ˜¯çœŸçš„æ²’æœ‰logï¼Œ\nåˆ°filebeatçš„podå»æŸ¥ï¼Œé‚£äº›æ²’é€²å»çš„pod logä¹Ÿéƒ½æ˜¯å­˜åœ¨ã€‚\nlogè·¯å¾‘\n/var/log/containers/\n\næ•…å…ˆæ’é™¤ï¼Œæœå‹™æ²’æœ‰å¯«å…¥logçš„å¯èƒ½æ€§ã€‚\n\næœƒä¸æœƒæ˜¯filebeatåœ¨è®€å–logæ™‚çš„æš«å­˜ç©ºé–“ä¸è¶³ã€‚\n\nä½†å¦‚æœæ˜¯æ­¤æƒ…æ³çš„è©±ï¼Œæ‡‰è©²æ˜¯å…¨éƒ¨çš„filebeatéƒ½æœƒæœ‰logéºå¤±ï¼Œé€™æ¬¡çš„æƒ…æ³æ˜¯åœ¨æŸäº›nodeä¸Šçš„æœå‹™ logéƒ½æœ‰é€²åˆ°ESï¼Œ\nå…¶ä»–çš„nodeéƒ½æ²’æœ‰ã€‚ä½†ä¹Ÿæ˜¯æœ‰æ­¤å¯èƒ½æ€§ã€‚\nèª¿æ•´filebeatå…§éƒ¨è³‡æº\nref.\n\nLogging with EFK in GKE\nConfigure the internal queue\n\nfilebeatä¸€ç›´é‡å•Ÿ\n\nä¹‹å¾Œè·‘å»çœ‹filebeatçš„podç‹€æ…‹ï¼Œ\nç™¼ç¾æœ‰å¾ˆå¤šå€‹podå¸¸å¸¸ä¸æ–·çš„é‡æ–°å•Ÿå‹•ï¼Œ\nå†åˆ°è£¡é¢å»çœ‹è©³ç´°å…§å®¹ï¼Œ\nç™¼ç¾cpuè·Ÿ è¨˜æ†¶é«”çš„ä½¿ç”¨é‡å¾ˆé«˜ï¼Œ\næ¨æ¸¬å¯èƒ½æ˜¯ç”±æ–¼è³‡æºä¸è¶³å°è‡´ã€‚\næŸ¥è©¢filebeatå®˜æ–¹å»ºè­°çš„ä½¿ç”¨è³‡æºæ˜¯å¤šå°‘ã€‚\nfilebeatå»ºè­°ä½¿ç”¨\ncpu : 500Mi\nmemory: 500Mi\næ”¹å®Œå¾Œï¼Œè§€å¯Ÿäº†ç´„ä¸€å€‹ç¦®æ‹œï¼Œlodéƒ½æœ‰æŒçºŒé€²å»ï¼Œæ‡‰è©²æ˜¯æ²’å•é¡Œï¼Œä½†å®¹é‡ä¹Ÿå› æ­¤çˆ†å¢äº†ã€‚\nref. Manage compute resources",
		"tags": [ "note","ğŸ—’"]
},

{
		"title": "ECK , apiç­†è¨˜",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/68.ECK , apiç­†è¨˜/",
		"content": "å‰è¨€\næ­£æ–‡\nåœ¨æ‰€æœ‰çš„apiå¾Œé¢ï¼ŒåŠ ä¸Š\nv=true é¡¯ç¤ºæ¨™é¡Œ\nsort=column name æ’åº\n\næŸ¥è©¢ç›®å‰çš„esè¨˜æ†¶é«”ä½¿ç”¨é‡\n\nGET _cat/nodes?v=true&amp;h=name,node*,heap*\n\nè©³ç´°çš„è³‡æ–™\nGET _nodes/stats?filter_path=nodes.*.jvm.mem.pools.old\n\nref.Fix common cluster issues\n\né¡¯ç¤ºclusterç‹€æ…‹\n\nGET _cluster/health/\n\né¡¯ç¤ºshard æ˜ç´°\n\nGET _cat/shards/filebeat*?v=true&amp;s=index\n\né¡¯ç¤ºindexæ˜ç´°\n\nGET _cat/indices/filebeat*?v=true&amp;s=index",
		"tags": [ "note","ğŸ—’"]
},

{
		"title": "kibanaéŒ¯èª¤è§£æ³• , parent Data too large...",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/69. kibanaéŒ¯èª¤è§£æ³• , parent Data too large.../",
		"content": "å‰è¨€\næ­£æ–‡\næœ€è¿‘ç”¨kibanaåšæŸ¥è©¢æˆ–ä»»ä½•çš„APIå–è³‡æ–™æ™‚ï¼Œ\næœ‰æ©Ÿç‡æœƒç™¼ç”Ÿä¸‹åˆ—çš„éŒ¯èª¤\n\n[parent] Data too large, data for [&lt;http_request&gt;] would be [1054296800/1005.4mb],\nwhich is larger than the limit of [1020054732/972.7mb],\nreal usage: [1054296800/1005.4mb],\nnew bytes reserved: [0/0b], usages [request=83853312/79.9mb,\nfielddata=0/0b, in_flight_requests=0/0b, model_inference=0/0b,\neql_sequence=0/0b, accounting=23686052/22.5mb]\n\né›–ç„¶èªªå¾ˆå¶ç™¼ï¼Œä½†æœ€è¿‘æœ‰è¶Šä¾†è¶Šåš´é‡çš„è¶¨å‹¢ã€‚\næ‰€ä»¥ï¼Œé¼»å­æ‘¸ä¸€æ‘¸ï¼Œä¾†è§£æ±ºå§ã€‚\né¦–å…ˆçœ‹åˆ°é€™ä¸€ç¯‡ What does this error mean - Data too large, data for [&lt;transport_request&gt;]\né€™é‚Šæœ‰å¾ˆå¥½çš„è§£é‡‹ï¼Œç™¼ç”Ÿçš„åŸå› ã€‚\nç°¡å–®èªªå°±æ˜¯ESæœ¬èº«çš„æ–·è·¯å™¨ç™¼ç”Ÿä½œç”¨ï¼Œ\nå°è‡´è«‹æ±‚å¤±æ•—ã€‚\næ–·è·¯å™¨çš„æ–‡ç« å¯åƒè€ƒä¸‹é¢\nref .circuit breaker æ–·è·¯å™¨\nä¸Šé¢çš„éŒ¯èª¤çš„æ„æ€è¡¨ç¤ºï¼Œ\n\n[&lt;http_request&gt;] would be [1054296800/1005.4mb],\n\nhttp_requestçš„è«‹æ±‚éœ€è¦ 1005.4 mb\n\nwhich is larger than the limit of [1020054732/972.7mb],\n\nè«‹æ±‚çš„ä¸Šé™æ˜¯ 972.7mb\næ­¤æ™‚å¯ä»¥åˆ° DevTools ï¼Œè¼¸å…¥ä¸‹é¢æŒ‡ä»¤[1]\nGET _cat/nodes?v=true&amp;h=name,node*,heap*\n\nå¯ä»¥çœ‹åˆ°ç›®å‰çš„è¨˜æ†¶é«”ä½¿ç”¨é‡ï¼ˆæ³¨æ„ï¼Œæ­¤åœ–ä¸¦ä¸æ˜¯äº‹ç™¼ç•¶ä¸‹çš„è¨˜æ†¶é«”ä½¿ç”¨é‡ï¼‰\nè§£æ±ºæ–¹å¼[2]ï¼š\n\nç•¶ä¸‹æŸ¥çœ‹heap.max åªæœ‰1G ï¼Œæ•…å…ˆåŠ å¤§è¨˜æ†¶é«”åˆ°2Gã€‚\n\napiVersion: elasticsearch.k8s.elastic.co/v1\nkind: Elasticsearch\nmetadata:\nname: yabo\nnamespace: elastic-system\nspec:\nversion: 7.16.2\nnodeSets:\n- name: all\ncount: 3\npodTemplate:\nspec:\ncontainers:\n- name: elasticsearch\nenv:\n- name: ES_JAVA_OPTS\nvalue: -Xms2g -Xmx2g\nresources:\nrequests:\nmemory: 4Gi\nlimits:\nmemory: 4Gi\n\nref. Manage compute resources\n\nshardsæ•¸é‡å¤ªå¤š\n\nåŒæ¨£50Gçš„æª”æ¡ˆï¼Œ5å€‹10Gï¼Œè·Ÿ1å€‹50G shardsï¼Œ\nå‰è€…çš„ramä½¿ç”¨é‡æœƒæ¯”è¼ƒå¤šã€‚\nä½†shardsè¨­å¤ªé«˜ï¼Œç•¶node æ›æ‰æ™‚ï¼Œ\nå›å¾©çš„æ™‚é–“æœƒè®Šé•·ã€‚\nä¿®æ”¹ILMçš„shardå¤§å°ï¼Œå»ºè­°ç¯„åœæ˜¯åœ¨ 10G~50G ä¹‹é–“ï¼Œ\nä½†ä»è¦è¦–æƒ…æ³è€Œå®šã€‚\nref. Size your shards\nref.\n[1] : <a class=\"internal-link\" data-note-icon=\"\" href=\"/ğŸ—’ EFK/68.ECK , apiç­†è¨˜/\">68.ECK , apiç­†è¨˜</a>\n[2] : Fix common cluster issues",
		"tags": [ "note","ğŸ—’"]
},

{
		"title": "ECK 8.1 ,APM intergrationå®‰è£æ–¹å¼",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/80. ECK 8.1 ,APM intergrationå®‰è£æ–¹å¼/",
		"content": "å‰è¨€\nä¸€å…©å€‹æœˆæ²’çœ‹ï¼Œæ²’æƒ³åˆ°ç‰ˆæœ¬å°±è¡åˆ°8.1äº†ï¼Œ\nç…§ä»¥å‰çš„åšæ³•ï¼Œç™¼ç¾ä¸€å †éŒ¯èª¤ï¼Œ\nprecondition 'apm integration installed' failed: error querying Elasticsearch for integration index templates: unexpected HTTP status: 404 Not Found..\næ­£æ–‡\nç‰ˆæœ¬å‡ç´šå¾Œï¼Œæ¶æ§‹è®Šæˆä¸‹åœ–(1)\n\næ‰€ä»¥æ‰å°è‡´ä¸‹åœ–çš„éŒ¯èª¤ç™¼ç”Ÿï¼Œ\n\nåŸå› æ˜¯ï¼ŒECKå‡ç´šï¼Œ\næ‰€ä»¥çµ±ä¸€è¦å…ˆåœ¨kibanaä¸Šé¢å…ˆå®‰è£ APM intergrationã€‚\n\nIf you install version 8.2.0 of APM Server before installing the APM integration, you will see error logs similar to the following. You must go back and install the APM integration before data can be ingested into Elasticsearch.\nref. Upgrade a self-installation of APM Server standalone to 8.2.0\nStep 1.\n\nStep 2.\nå®‰è£APM serverå³å¯ï¼Œå®‰è£å®Œå¾Œï¼Œ\né¸æ“‡ ã€Add Elastic Agent laterã€ã€‚\n\nref.\n1. Upgrade to the Elastic APM integration",
		"tags": [ "note","ğŸ—’"]
},

{
		"title": "Elasticsearchç­†è¨˜",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/84.Elasticsearchç­†è¨˜/",
		"content": "å‰è¨€\nä¸Šä¸€ç¯‡æ˜¯æ‹¿ä¾†ä¿®æ­£ç›®å‰ç‰ˆæœ¬èˆ‡2.xç‰ˆæœ¬çš„å·®ç•°\né€™ç¯‡æ˜¯æ‹¿ä¾†ç•¶ç­†è¨˜\næ­£æ–‡\n\nå…©ç¨®æŸ¥è©¢æ–¹å¼\n\nGET /megacorp/_search?q=last_name:Smith\nGET /megacorp/_search\n{\n&quot;query&quot; : {\n&quot;match&quot; : {\n&quot;last_name&quot; : &quot;Smith&quot;\n}\n}\n}\n\næœå°‹æ–¹å¼\nå¦‚æœç”¨kibanaæœå°‹çš„è©±ï¼Œå·®ç•°å°±åœ¨ä¸€å€‹æœ‰åŠ  &quot;&quot;(é›™å¼•è™Ÿ)ï¼Œå¦ä¸€å€‹æ²’æœ‰\nmatch_phrase ï¼š æ˜¯æœ‰åŠ é›™å¼•è™Ÿçš„çŸ­å¥æœå°‹\nmatch ï¼š æ˜¯å…¨æ–‡æœå°‹ï¼Œåˆ†æ•¸è¶Šé«˜çš„è¡¨ç¤ºé—œé€£åº¦è¶Šé«˜\n\naggreations(èšåˆ)\né¡ä¼¼sqlçš„ group by åŠŸèƒ½\n\nå¢é›†å¥åº·åº¦\n\nGET _cluster/health/\n\nstatus çš„ç‹€æ…‹\ngreenï¼šæ‰€æœ‰çš„ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½æ­£å¸¸é‹è¡Œã€‚\nyellowï¼šæ‰€æœ‰çš„ä¸»åˆ†ç‰‡éƒ½æ­£å¸¸é‹è¡Œï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„å‰¯æœ¬åˆ†ç‰‡éƒ½æ­£å¸¸é‹è¡Œã€‚\nredï¼šæœ‰ä¸»åˆ†ç‰‡æ²’èƒ½æ­£å¸¸é‹è¡Œã€‚\n\né›†ç¾¤nodeé…å°æ–¹å¼\ncluster.nameç›¸åŒï¼Œå°±æœƒè‡ªå‹•ç™¼ç¾é›†ç¾¤ä¸¦åŠ å…¥ã€‚",
		"tags": [ "note","ğŸ—’"]
},

{
		"title": "elasticsearch ingest pipeline",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/90. elasticsearch ingest pipeline/",
		"content": "å‰è¨€\nç”¨filebeat è’é›† nginxçš„è³‡æ–™ï¼Œå–å¾—çš„Nginxè³‡æ–™æ²’å†ç¶“éåˆ†è§£ï¼Œ\nå°è‡´æ²’è¾¦æ³•é‹ç”¨åœ¨efkä¸Šé¢ã€‚\næ­£æ–‡\n\nå…ˆç”¨UIè¬›è§£æ­¥é©Ÿã€‚\n\nå…ˆä¾†çœ‹ä¸€ä¸‹nginxçš„messageï¼Œç„¶å¾Œå†åˆ†æè£¡é¢çš„æ¬„ä½\n127.0.0.1 - - [06/May/2022:06:44:01 +0000] , http-host: \\&quot;abc.boxing.com\\&quot; , URL: \\&quot;GET /static/tpl/analytics/index.html?v=51817715.1 HTTP/1.1\\&quot; , request-status : \\&quot;200\\&quot; , body-byte: 0 ,http-referer: \\&quot;https://abc.boxing.com/mobile\\&quot; ,user-agent: \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36\\&quot; , X-Forwarded-For : \\&quot;132.235.211.18,10.107.10.14\\&quot; , request-time: \\&quot;0.000\\&quot; , response_time : \\&quot;-\\&quot;\n\né€™é‚Šçš„æ ¼å¼æœ‰ç‰¹åˆ¥å»èª¿æ•´éï¼Œè©³æƒ…å¯åƒè€ƒï¼Œ<a class=\"internal-link\" data-note-icon=\"\" href=\"/âˆ k8s/GKE/56. GKEè¨˜éŒ„ nginx log/\">56. GKEè¨˜éŒ„ nginx log</a>ã€‚\n\ningest pipeline\nUIç•«é¢ï¼ŒStack Management -&gt; Ingest Pipelines-&gt; Create pipeline\n\nAdd a processor\n\nProcessor ï¼š Grok\nField ï¼š message\npatterns:\n\n%{IPORHOST:nginx.source.ip} %{USER:nginx.user.id} %{USER:nginx.user.name} \\\\[%{HTTPDATE:nginx.@timestamp}\\\\] , http-host: \\&quot;%{DATA:nginx.url.host}\\&quot; , URL: \\&quot;%{WORD:nginx.http.request.method} %{DATA:nginx.url.path} HTTP/%{NUMBER:nginx.http.version}\\&quot; , request-status : \\&quot;%{NUMBER:nginx.http.response.status_code:int}\\&quot; , body-byte: %{NUMBER:nginx.http.response.body.bytes:int} ,http-referer: \\&quot;%{DATA:nginx.http.request.referer}\\&quot; ,user-agent: %{QS:nginx.user_agent} , X-Forwarded-For : \\&quot;%{DATA:nginx.http.request.xff}\\&quot; , request-time: \\&quot;%{NUMBER:nginx.http.request.time}\\&quot; , response_time : \\&quot;(?:-|%{NUMBER:nginx.http.request.time:int})\\&quot;\n\næ­¤è™•çš„patternsæ˜¯ç¬¦åˆæˆ‘ä¸Šé¢(1)çš„è¨Šæ¯ï¼Œæ‰€ç”¢ç”Ÿçš„ã€‚\nps. Grok Debugger è¨˜å¾—è¦8.1å¾Œæ‰æœ‰ï¼Œå¦‚æœç‰ˆæœ¬éä½ï¼Œå¯ä»¥åƒè€ƒä¸‹æ–¹ï¼Œç”¨DevToolsä¸‹æŒ‡ä»¤çš„æ–¹å¼é™¤éŒ¯ã€‚\nGrokç°¡å–®èªªï¼Œ\n\n%\n\nå‹æ…‹æœ‰å“ªäº›ï¼Œåƒè€ƒé€£çµã€ grok-patternsã€\nref.\n\nGrok Debugger\nGrok processor\nGrokking grok\ngrok-patterns\n\næ¸¬è©¦\nå¯«å¥½äº†å¾Œï¼Œä¸æ¸¬è©¦ä¸€ä¸‹ä¹Ÿä¸çŸ¥é“æ˜¯å°æˆ–éŒ¯ï¼Œ\nåˆ°æ–°å»ºçš„ç•«é¢ï¼Œå³é‚Šçš„ä¸­é–“ï¼Œæœ‰Add Documentçš„é¸é …ã€‚\n\nä¹‹å¾Œè¼¸å…¥è¦æ¸¬è©¦çš„ç¯„ä¾‹\n\nå…§å®¹ç‚ºï¼š\n\n{\n&quot;_source&quot;: {\n&quot;message&quot;: &quot;127.0.0.1 - - [06/May/2022:06:44:01 +0000] , http-host: \\&quot;abc.boxing.com\\&quot; , URL: \\&quot;GET /static/tpl/analytics/index.html?v=51817715.1 HTTP/1.1\\&quot; , request-status : \\&quot;200\\&quot; , body-byte: 0 ,http-referer: \\&quot;https://abc.boxing.com/mobile\\&quot; ,user-agent: \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36\\&quot; , X-Forwarded-For : \\&quot;132.235.211.18,10.107.10.14\\&quot; , request-time: \\&quot;0.000\\&quot; , response_time : \\&quot;-\\&quot;&quot;\n}\n}\n\næŒ‰ä¸‹ Run the pipelineï¼Œæœ‰æˆåŠŸå°±æœƒè·‘çµæœå‡ºä¾†äº†ã€‚\n\nå¤±æ•—çš„è©±ï¼Œæœƒè®Šæˆä¸‹é¢çš„åœ–ã€‚\n\næ­¤è™•çš†åƒè€ƒå®˜æ–¹ç¯„ä¾‹\nref. Example: Parse logs in the Common Log Format\nä½¿ç”¨apiæ¸¬è©¦\nåœ¨UIä¸Šé¢æ¸¬è©¦ Grokå¯¦åœ¨å¾ˆç´¯ï¼Œé™¤äº†ç”¨å‰›å‰›æåˆ°çš„ Grok Debugä»¥å¤–ã€‚\nå°±æ˜¯ç›´æ¥ç”¨apiæ–¹å¼ç›´æ¥é©—è­‰äº†ã€‚\n\nNote, 8.1 æˆ‘ç”¨Grok Debugger æœ‰äº›ç‰¹æ®Šå­—å…ƒæœƒç„¡æ³•match ï¼Œä½†ç”¨APIæ²’å•é¡Œã€‚\n\nNginx ç‚º ingest Pipeline Name\nä»¥ä¸‹API çš†åœ¨ DevToolsé©—è­‰\n\né©—è­‰Document\n\nPOST _ingest/pipeline/Nginx/_simulate\n{\n&quot;docs&quot;: [\n{\n&quot;_source&quot;: {\n&quot;message&quot;: &quot;127.0.0.1 - - [06/May/2022:06:44:01 +0000] , http-host: \\&quot;abc.boxing.com\\&quot; , URL: \\&quot;GET /static/tpl/analytics/index.html?v=51817715.1 HTTP/1.1\\&quot; , request-status : \\&quot;200\\&quot; , body-byte: 0 ,http-referer: \\&quot;https://abc.boxing.com/mobile\\&quot; ,user-agent: \\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36\\&quot; , X-Forwarded-For : \\&quot;132.235.211.18,10.107.10.14\\&quot; , request-time: \\&quot;0.000\\&quot; , response_time : \\&quot;-\\&quot;&quot;\n}\n}\n]\n}\n\nä¿®æ”¹grok\n\nPUT _ingest/pipeline/Nginx\n{\n&quot;description&quot;: &quot;My optional pipeline description&quot;,\n&quot;processors&quot;: [\n{\n&quot;grok&quot;: {\n&quot;description&quot;: &quot;Extract fields from 'message'&quot;,\n&quot;field&quot;: &quot;message&quot;,\n&quot;patterns&quot;: [&quot;%{IPORHOST:nginx.source.ip} %{USER:nginx.user.id} %{USER:nginx.user.name} \\\\[%{HTTPDATE:nginx.@timestamp}\\\\] , http-host: \\&quot;%{DATA:nginx.url.host}\\&quot; , URL: \\&quot;%{WORD:nginx.http.request.method} %{DATA:nginx.url.path} HTTP/%{NUMBER:nginx.http.version}\\&quot; , request-status : \\&quot;%{NUMBER:nginx.http.response.status_code:int}\\&quot; , body-byte: %{NUMBER:nginx.http.response.body.bytes:int} ,http-referer: \\&quot;%{DATA:nginx.http.request.referer}\\&quot; ,user-agent: %{QS:nginx.user_agent} , X-Forwarded-For : \\&quot;%{DATA:nginx.http.request.xff}\\&quot; , request-time: \\&quot;%{NUMBER:nginx.http.request.time}\\&quot; , response_time : \\&quot;(?:-|%{NUMBER:nginx.http.request.time:int})\\&quot;&quot;],\n&quot;ignore_failure&quot;: false\n}\n}\n]\n}\n\nignore_failure ç‚ºå¿½ç•¥éŒ¯èª¤ï¼Œfalseçš„è©±ï¼Œåªè¦æœ‰ä¸€å€‹æ²’éï¼Œ\ningest pipelineå°±æœƒåœæ­¢ã€‚\nçµè«–\nä¸Šè¿°å…©ç¨®æ–¹æ³•ï¼Œéƒ½å¯ä»¥å»ºç«‹ä¸”æ¸¬è©¦ï¼Œå°±çœ‹å“ªç¨®ç¿’æ…£ã€‚\nä½†è¦å°‡ingest å¥—ç”¨åˆ°data stream æˆ– indexçš„è©±ï¼Œ\nåˆæ˜¯å¦ä¸€ç¯‡äº†....ã€‚\nä¸è¶•æ™‚é–“çš„æ–¹æ³•ï¼Œåˆ° Index Managemenet ä¿®æ”¹ Index Templates\n\nåˆ° index settings å°‡ default_pipeline ä¿®æ”¹ç‚ºä½ çš„ ingest pipeline name\n\nç„¶å¾Œå°±ç­‰ lifecycleæ¢ä»¶é”åˆ°æ™‚ï¼Œå»ºç«‹æ–°çš„indexï¼Œå°±æœƒå¥—ç”¨ä¸Šå»äº†ã€‚\nè¶•æ™‚é–“çš„è©±ï¼Œè«‹çœ‹ä¸‹ä¸€ç¯‡ã€‚\nref.\n\nset-default-pipeline\nindex.default_pipeline\nElasticsearchï¼šElasticå¯è§€æ¸¬æ€§ - é‹ç”¨ pipeline ä½¿æ•¸æ“šçµæ§‹åŒ–",
		"tags": [ "note","ğŸ—’"]
},

{
		"title": "elasticsearch ingest processorè£œå……",
		"date":"Fri Jan 03 2025 10:22:37 GMT+0000 (Coordinated Universal Time)",
		"url":"/ğŸ—’ EFK/91. elasticsearch ingest processorè£œå……/",
		"content": "å‰è¨€\nè£œå……ingest çš„ processor\næ­£æ–‡\nä¸Šç¯‡æåˆ°ï¼Œæ­£å¸¸è¦ç­‰ILMè·‘å®Œå¾Œï¼Œæ‰€è¨­å®šçš„default_pipelineæ‰æœƒå¯«å…¥ã€‚\nä½†ä»Šå¤©æ˜¯å¯ä»¥ææ—©è®“ä»–è·‘ILMï¼Œé€™æ¨£å°±æœƒæŠŠé è¨­çš„default_pipelineå¯«é€²å»äº†ã€‚\nè€Œåªè¦åœ¨default_pipeline è¨­å®šå¥½ï¼Œå¾ŒçºŒå†æ”¹pipelineçš„è¨­å®šæ™‚ï¼Œéƒ½æœƒç›´æ¥å½±éŸ¿ç•¶ä¸‹çš„è¨­å®šã€‚\n\nåœ¨index templateè¨­å®špipeline\n\nåˆ° Devtools åŸ·è¡Œä¸‹é¢æŒ‡ä»¤\nå¼·åˆ¶datastreamåŸ·è¡ŒILM\n\nPOST /filebeat-8.1.0/_rollover\n\nref.\n- DataStream\n- Elasticsearch 7.X data stream æ·±å…¥è©³è§£\ningest è£œå……\nprocessoråˆ†æˆå¥½å¹¾å€‹é¡å‹\nä¸Šä¸€ç¯‡æ˜¯ä½¿ç”¨grok(é€™å€‹æ˜¯ä½¿ç”¨æ­£å‰‡å»ç¯©é¸å­—ä¸²)ï¼Œ\næœ‰äººå»ºè­°ä½¿ç”¨Dissectï¼Œé€Ÿåº¦æ¯”grokå¿«ï¼Œä½†åªé©ç”¨æ–¼æœ‰å›ºå®šåˆ†éš”å­—ä¸²çš„messageã€‚\nä¸‹é¢ç°¡å–®æ•˜è¿°ç”¨é€”ï¼Œè©³ç´°å°±é»é€£çµéå»çœ‹äº†ã€‚\n\nAppend\nåœ¨ç¾æœ‰çš„å­—ä¸²å…§å¢åŠ å€¼\nBytes\næŠŠç©ºé–“è¨ˆç®—æ–¹å¼(kb,mb,gb...)è½‰æˆbyte\nCircle\næŠŠåœ“å½¢è½‰çˆ²è¿‘ä¼¼ä»–å€‘çš„è¦å‰‡å¤šé‚Šå½¢ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“é€™èƒ½åšå•¥ï¼‰\nCommunity ID\nè¨ˆç®—ç¶²è·¯è³‡æ–™æµçš„idï¼Œèƒ½é€éæ­¤idé—œè¯ç›¸é—œçš„ç¶²è·¯äº‹ä»¶\nConvert\nå°‡æ¬„ä½å…§å®¹è½‰çˆ²integerã€longã€floatã€doubleã€stringã€booleanã€ip\nCSV\nå°‡æ¬„ä½ä¸­çš„çš„è³‡æ–™ç•¶ä½œcsvå»è¾¨åˆ¥\nDate\nå°‡æ¬„ä½å…§å®¹è½‰çˆ²æ—¥æœŸæ ¼å¼\nDate index name\nå°‡æ—¥æœŸå–å‡ºä½œçˆ²indexçš„åç¨±\nDissect\nèˆ‡grokç›¸ä¼¼ï¼Œä½†ä¸ä½¿ç”¨æ­£å‰‡ä½œçˆ²çµæ§‹åŒ–æ¬„ä½\nDot expander\næœƒå°‡ . è¦–çˆ²ä¸€å€‹ç‰©ä»¶çš„åç¨±ï¼Œ\n\nfoo.bar :value\nfoo : {\n\tbar: value\n}\n\nDrop\næ ¹æ“šæ¢ä»¶åˆªé™¤document\nEnrich\næ ¹æ“šæ¬„ä½è¦å‰‡ï¼Œè‡ªå‹•æ–°å¢è³‡æ–™\nFail\nç•¶éŒ¯èª¤æ™‚ï¼Œå‚³é€è¨Šæ¯\nFingerprint\nè¨ˆç®—documentçš„hashå€¼\nForeach\nç•¶å…ƒç´ æ•¸é‡ä¸ç¢ºå®šæ™‚ä½¿ç”¨\nGeoIP\næ ¹æ“šåœ°ç†ä½ç½®æä¾›æ›´å¤šè³‡è¨Š\nGrok\nå¾documentä¸­æˆªå–çµæ§‹åŒ–çš„å­—ä¸²å‡ºä¾†(æ­£å‰‡)\nGsub\nä½¿ç”¨æ­£å‰‡æˆ–å–ä»£ä¾†è½‰æ›å­—ä¸²\nHTML strip\nå¾æ¬„ä½ä¸­ç§»é™¤htmlçš„tag\nInference\nUses a pre-trained data frame analytics model to infer against the data that is being ingested in the pipeline.\nJoin\nå°‡æ¬„ä½ä¸­çš„arrayå€¼ç”¨åˆ†éš”ç¬¦ä¸²èµ·ä¾†\nJSON\nå°‡jsonå­—ä¸²è½‰æˆjsonæ ¼å¼\nKV\næŒ‡å®šæ¬„ä½è‡ªå‹•è§£æè¨Šæ¯\nLowercase\nå°‡å­—ä¸²è½‰æˆå°å¯«\nNetwork direction\næ ¹æ“šä¾†æºIPåŠç›®çš„IPè¨ˆç®—æ˜¯ inboundæˆ– outbonud\nPipeline\nåœ¨pipelineå…§åŸ·è¡Œå…¶ä»–çš„pipeline\nRegistered domain\nè§£ædomainï¼Œå€åˆ†å‡º sub-doaminã€top-level domain\nRemove\nç§»é™¤æ¬„ä½\nRename\næ›´æ”¹æ¬„ä½åç¨±\nScript\nåŸ·è¡Œscript\nSet\næŒ‡ä»¤æ¬„ä½å¯«å€¼\nSet security user\né€šéé è™•ç†ç¨‹åºï¼Œå¾ç›®å‰é©—è­‰çš„ä½¿ç”¨è€…æˆªå–è³‡æ–™\nSort\nå°æ¬„ä½å…§çš„arrayåšæ’åº\nSplit\nä½¿ç”¨åˆ†éš”ç¬¦è™Ÿï¼Œå°‡å­—ä¸²åˆ‡æˆarray\nTrim\nç§»é™¤æ¬„ä½ç©ºç™½\nUppercase\nå°‡å­—ä¸²è½‰æˆå¤§å¯«\nURL decode\nå°‡URLç¶²å€è§£ç¢¼\nURI parts\nå°‡URLè«‹æ±‚æ‹†é–‹æˆURI object\nUser agent\nè§£æuser_agent",
		"tags": [ "note","ğŸ—’"]
}
]